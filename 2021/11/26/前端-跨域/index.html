<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><meta name="author" content="Mrli"><meta name="renderer" content="webkit"><meta name="copyright" content="Mrli"><meta name="keywords" content="Mrli's Blog"><meta name="description" content="想和你讲，说了会心动 ，缄默会心安。"><meta name="Cache-Control" content="no-cache"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>前端-跨域 · Mr.li's Blog</title><link rel="stylesheet" href="/css/style.css?v=2018.7.9"><link rel="stylesheet" href="/css/animation.css?v=2018.7.9"><link rel="icon" href="/img/assets/favicon.ico"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.6"><!-- scripts--><script>(function( w ){
  "use strict";
  // rel=preload support test
  if( !w.loadCSS ){
    w.loadCSS = function(){};
  }
  // define on the loadCSS obj
  var rp = loadCSS.relpreload = {};
  // rel=preload feature support test
  // runs once and returns a function for compat purposes
  rp.support = (function(){
    var ret;
    try {
      ret = w.document.createElement( "link" ).relList.supports( "preload" );
    } catch (e) {
      ret = false;
    }
    return function(){
      return ret;
    };
  })();

  // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
  // then change that media back to its intended value on load
  rp.bindMediaToggle = function( link ){
    // remember existing media attr for ultimate state, or default to 'all'
    var finalMedia = link.media || "all";

    function enableStylesheet(){
      link.media = finalMedia;
    }

    // bind load handlers to enable media
    if( link.addEventListener ){
      link.addEventListener( "load", enableStylesheet );
    } else if( link.attachEvent ){
      link.attachEvent( "onload", enableStylesheet );
    }

    // Set rel and non-applicable media type to start an async request
    // note: timeout allows this to happen async to let rendering continue in IE
    setTimeout(function(){
      link.rel = "stylesheet";
      link.media = "only x";
    });
    // also enable media after 3 seconds,
    // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
    setTimeout( enableStylesheet, 3000 );
  };

  // loop through link elements in DOM
  rp.poly = function(){
    // double check this to prevent external calls from running
    if( rp.support() ){
      return;
    }
    var links = w.document.getElementsByTagName( "link" );
    for( var i = 0; i < links.length; i++ ){
      var link = links[ i ];
      // qualify links to those with rel=preload and as=style attrs
      if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
        // prevent rerunning on link
        link.setAttribute( "data-loadcss", true );
        // bind listeners to toggle media back
        rp.bindMediaToggle( link );
      }
    }
  };

  // if unsupported, run the polyfill
  if( !rp.support() ){
    // run once at least
    rp.poly();

    // rerun poly on an interval until onload
    var run = w.setInterval( rp.poly, 500 );
    if( w.addEventListener ){
      w.addEventListener( "load", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    } else if( w.attachEvent ){
      w.attachEvent( "onload", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    }
  }


  // commonjs
  if( typeof exports !== "undefined" ){
    exports.loadCSS = loadCSS;
  }
  else {
    w.loadCSS = loadCSS;
  }
}( typeof global !== "undefined" ? global : this ) );</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" defer></script><script src="/js/main.js?v=2018.7.9" defer></script><!-- fancybox--><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script><!-- busuanzi--><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></head><body><section class="profile-close" id="cxo-profile"><div class="profile-avatar"><i class="fa fa-caret-left"></i><img src="https://avatars1.githubusercontent.com/u/31088082?s=400&amp;u=7a99ff83916afb3f4c5312bd78a1be17fe0e34ed&amp;v=4"></div><!--.profile-saying
  i.fa.fa-comment
  .saying--><div class="cxo-profile-inner"><div class="profile-name">Mrli</div><div class="profile-signature">别装作很努力,<br>因为结局不会陪你演戏。</div><div class="contacts"><div>Contacts:</div><span><a href="http://sighttp.qq.com/msgrd?v=1&amp;uin=1063052964" target="_black">QQ</a></span><span><a href="https://www.cnblogs.com/nymrli/" target="_black">博客园</a></span></div><div class="read-progress"></div></div></section><header id="cxo-intro" style="height: 60vh;background-image: url(/img/intro/index-bg.png);"><nav id="cxo-intro-nav"><section><div class="intro-nav-title"><a href="/">Mr.li's Blog</a></div><div class="intro-nav-label-box"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div><i class="fa fa-bars intro-nav-menu"><div class="intro-nav-drop"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div></i><div class="clear"></div></section></nav><h1 class="post-title">前端-跨域</h1><div class="post-intros"><div class="post-intro-meta"><span class="post-intro-time"><i class="post-intro-calendar fa fa-edit"></i><span>2021/12/09</span></span><span class="busuanzi-pv" id="busuanzi_container_page_pv"><i class="post-intro-calendar fa fa-user-o"></i><span id="busuanzi_value_page_pv"></span></span><span class="post-intro-tags"><a class="intro-tag fa fa-tag" href="javascript:void(0)" date-tags="前端"> 前端</a></span></div><div class="post-intro-read"><span> Word count: <span class="post-count">1,779</span> | Reading time: <span class="post-count">8</span>min</span></div></div></header><article class="cxo-up" id="cxo-content-outer"><section id="cxo-content-inner"><article class="article-entry" id="post"><h2 id="什么是跨域问题"><a class="markdownIt-Anchor" href="#什么是跨域问题"></a> 什么是跨域问题</h2>
<blockquote>
<p>跨域问题的出现是因为浏览器的同源策略问题，所谓同源:就是两个页面具有相同的协议（protocol），主机（host）和端口号（port），即指协议，端口，域名。只要这个3个中有一个不同就是跨域。它是浏览器最核心也是最基本的功能，如果没有同源策略我们的浏览器将会十分的不安全，随时都可能受到攻击。</p>
<p>当我们请求一个接口的时候，出现如：Access-Control-Allow-Origin 字眼的时候说明请求跨域了</p>
<p><img src="/2021/11/26/前端-跨域/%E8%B7%A8%E5%9F%9F%E6%98%AF%E4%BB%80%E4%B9%88.png" alt="跨域是什么"></p>
</blockquote>
<h2 id="展示跨域问题"><a class="markdownIt-Anchor" href="#展示跨域问题"></a> 展示跨域问题</h2>
<p>前端请求后端8889端口开放的端口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.$axios(&#123;</span><br><span class="line">    method:<span class="string">'get'</span>,</span><br><span class="line">    url:<span class="string">'http://localhost:8889/'</span></span><br><span class="line">&#125;).then(<span class="function">(<span class="params">response</span>) =&gt;</span>&#123;          <span class="comment">//这里使用了ES6的语法</span></span><br><span class="line">    <span class="built_in">console</span>.log(response)       <span class="comment">//请求成功返回的数据</span></span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">error</span>) =&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error)       <span class="comment">//请求失败返回的数据</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>会出现因为跨域，所以请求失败的消息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access to XMLHttpRequest at &apos;http://localhost:8889/&apos; from origin &apos;http://localhost:8080&apos; has been blocked by CORS policy: No &apos;Access-Control-Allow-Origin&apos; header is present on the requested resource.</span><br></pre></td></tr></table></figure>
<h2 id="处理跨域"><a class="markdownIt-Anchor" href="#处理跨域"></a> 处理跨域</h2>
<h3 id="前端"><a class="markdownIt-Anchor" href="#前端"></a> 前端</h3>
<h4 id="jsonp"><a class="markdownIt-Anchor" href="#jsonp"></a> jsonp</h4>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 后端接口</span><br><span class="line">app.get("/", function(req, res)&#123;</span><br><span class="line">    var func = req.query.callback		// 拿到请求参数query中的callback数据</span><br><span class="line">    res.send(func + "('你好')")			// 拼接成函数调用的形式==》 f("你好")</span><br><span class="line">&#125;)</span><br><span class="line">// 前端请求</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">f</span><span class="params">(msg)</span></span>&#123;</span></span><br><span class="line"><span class="undefined">    	alter(msg)</span></span><br><span class="line"><span class="undefined">	&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://localhost:8999?callback=f"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>	// 请求这个接口的时候会得到f("你好")的返回结果，从而触发调用函数</span><br></pre></td></tr></table></figure>
<h4 id="proxy"><a class="markdownIt-Anchor" href="#proxy"></a> Proxy</h4>
<blockquote>
<p>通过网络代理，通过代理服务与另一个网络终端进行非直接的连接</p>
</blockquote>
<p>通过webpack搭建一个本地服务器，作为请求的代理对象，通过该服务器转发请求至目标服务器。</p>
<p>但存在的问题是，如果webpack服务器与web接口服务器不在一起，仍然存在跨域问题。===&gt;由于生产环境基本上后端有后端部署的服务器、前端有前端部署的服务器，因此这个无法在生产上使用</p>
<p><img src="/2021/11/26/前端-跨域/webpack%E6%9C%AC%E5%9C%B0.png" alt="webpack本地"></p>
<h5 id="vue"><a class="markdownIt-Anchor" href="#vue"></a> Vue</h5>
<ul>
<li>
<p>开发阶段: 配置代理</p>
<ul>
<li>
<p>如果你是用 Vue CLI 创建的项目，也可以开发阶段，配置一下 webpack 的 devServer，它有自带一个 proxy 代理服务器。</p>
</li>
<li>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Vue3中是在vue.config.js配置</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    devServer:&#123;</span><br><span class="line">        host: <span class="string">'localhost'</span>,</span><br><span class="line">        open: <span class="literal">true</span>, 			<span class="comment">// vue项目启动时自动打开浏览器</span></span><br><span class="line">        port: <span class="number">8080</span>,             <span class="comment">// 本地服务器使用的端口</span></span><br><span class="line">        proxy: &#123;  				<span class="comment">//配置跨域</span></span><br><span class="line">          <span class="string">'/api'</span>: &#123;				<span class="comment">// `/api`是代理标识，用于告诉node，url前面是`/api`的就是使用代理的</span></span><br><span class="line">            target: <span class="string">'http://127.0.0.1:5000/'</span>,  <span class="comment">// 目标地址，应该写提供接口的后台服务器的真实地址</span></span><br><span class="line">            changOrigin: <span class="literal">true</span>,  	<span class="comment">// 是否跨域</span></span><br><span class="line">            pathRewrite: &#123;</span><br><span class="line">              <span class="string">'^/api'</span>: <span class="string">''</span> 			<span class="comment">// 把实际request URL中的`/api`用``来代替</span></span><br><span class="line">             <span class="comment">/* 重写路径，当我们在浏览器中看到请求的地址为：http://localhost:8080/api/core/getData/userInfo 时, 实际上访问的地址是：http://121.121.67.254:8185/core/getData/userInfo */</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>后端配置</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_cors <span class="keyword">import</span> cross_origin</span><br><span class="line">    </span><br><span class="line">app = Flask(__name__)</span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello World!'</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route('/api')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">apix</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello api!'</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route('/do')</span></span><br><span class="line"><span class="meta">@cross_origin()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">api</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello do!'</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<ul>
<li>访问<code>http://localhost:8080/</code>时会出现跨域问题，<code>http://localhost:8080/api</code>时浏览器直接跳转到后端内容</li>
<li>网络请求<code>http://localhost:8080/do</code>由于do接口允许跨域所以成功拿到数据, <code>/api</code>成功拿到Hello World实现跨域
<ul>
<li>为什么get(&quot;/api&quot;)拿到的是<code>http://localhost:8080/</code>的数据呢？首先拼接成<code>http://localhost:8080/</code>, 然后符合代理规则，所以根据pathRewrite吧<code>/api</code>替换成了<code>&quot;&quot;</code>，于是请求变成了访问<code>http://localhost:8080/</code>。再因为vue.config.vue中target指定了axios的目标url，会把<code>http://localhost:8080</code>代理掉，所以就代理转向访问了<code>http://localhost:5000/</code><br>
注： 没有指定axios的baseURL则为本身, 会自动加上http://localhost</li>
<li>可以测试是不是这个逻辑，axios.get(&quot;/do&quot;), 提示<code>http://localhost:8080/do</code>不存在, 也不符合代理规则
<ul>
<li>axios.get(&quot;/&quot;), 虽然也不符合代理规则，但其本身<code>http://localhost:8080/</code>是有的, 所以也能请求到数据，只不过这个是index.html的数据</li>
</ul>
</li>
<li>如果指定axios的baseURL=“<a href="http://baidu.com" target="_blank" rel="noopener">http://baidu.com</a>”，则xxx.get(&quot;/api&quot;)会变成<code>http://baidu.com/api</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>生产环境: 配置nginx转发</p>
</li>
</ul>
<h3 id="服务器端"><a class="markdownIt-Anchor" href="#服务器端"></a> 服务器端</h3>
<blockquote>
<p>根据CORS的定义，是不允许浏览器调用的<strong>前端服务</strong>主动<strong>去拿</strong>另一个域下的资源，那么就改变前端服务直接拿的方式，而是通过请求代理服务器数据从而间接请求另一个域下的资源，代理服务器再请求到数据后，再让代理把数据交给前端即实现了跨域的效果。</p>
<p>==》前端服务跟代理服务器是同源的，而nginx对服务端转发的请求不会触发<strong>浏览器的同源策略</strong>。</p>
</blockquote>
<h4 id="nginx"><a class="markdownIt-Anchor" href="#nginx"></a> nginx</h4>
<p><strong>基础使用-简单版</strong></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 配置反向代理的参数</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>    <span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">server_name</span> xx_domain.com</span><br><span class="line">    <span class="comment">## 1. 用户访问 http://xx_domain.com/api，则反向代理到 https://github.com/api</span></span><br><span class="line">    location /api &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span>  https://github.com;</span><br><span class="line">        <span class="comment"># 下面的不写也没事</span></span><br><span class="line">        <span class="attribute">proxy_redirect</span>     <span class="literal">off</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>   Host             <span class="variable">$host</span>;        <span class="comment"># 传递域名</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span>   X-Real-IP        <span class="variable">$remote_addr</span>; <span class="comment"># 传递ip</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span>   X-Scheme         <span class="variable">$scheme</span>;      <span class="comment"># 传递协议</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span>   X-Forwarded-For  <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里是起了一个叫xx_domain的nginx服务器，侦听8080端口(一般是localhost)。 这边写的是xx_domain，则axios中也应该请求这个链接(baseURL设置为http://xx_domain.com)</p>
<p><strong>更多操作</strong></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如下的是青龙的转发配置</span></span><br><span class="line"><span class="attribute">upstream</span> api &#123;</span><br><span class="line">  <span class="attribute">server</span> <span class="number">0.0.0.0:5600</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">map</span> <span class="variable">$http_upgrade</span> <span class="variable">$connection_upgrade</span> &#123; </span><br><span class="line">  <span class="attribute">default</span> keep-alive;</span><br><span class="line">  'websocket' upgrade;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  <span class="attribute">listen</span> <span class="number">5700</span>;</span><br><span class="line">  <span class="attribute">root</span> /ql/dist;</span><br><span class="line">  <span class="attribute">ssl_session_timeout</span> <span class="number">5m</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">location</span> /api &#123;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://api;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Connection <span class="variable">$connection_upgrade</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">location</span> /open &#123;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://api;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line">  <span class="attribute">gzip_static</span> <span class="literal">on</span>;    </span><br><span class="line">  <span class="attribute">gzip_types</span> text/plain application/json application/javascript application/x-javascript text/css application/xml text/javascript;</span><br><span class="line">  <span class="attribute">gzip_proxied</span>  any;</span><br><span class="line">  <span class="attribute">gzip_vary</span> <span class="literal">on</span>;</span><br><span class="line">  <span class="attribute">gzip_comp_level</span> <span class="number">6</span>;</span><br><span class="line">  <span class="attribute">gzip_buffers</span> <span class="number">16</span> <span class="number">8k</span>;</span><br><span class="line">  <span class="attribute">gzip_http_version</span> <span class="number">1</span>.<span class="number">0</span>;  </span><br><span class="line"></span><br><span class="line">  <span class="attribute">location</span> / &#123;</span><br><span class="line">    <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">    <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/11/26/前端-跨域/nginx.png" alt="nginx"></p>
<h3 id="后端"><a class="markdownIt-Anchor" href="#后端"></a> 后端</h3>
<h4 id="修改响应头"><a class="markdownIt-Anchor" href="#修改响应头"></a> 修改响应头</h4>
<blockquote>
<p>根据上述CORS反馈的消息<code>No 'Access-Control-Allow-Origin' header is present on the requested resource.</code>来看，是由于没有设置响应头<code>Access-Control-Allow-Origin</code>，因此其中一个做法是可以修改响应头中的Access-Control-Allow-Origin</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">"/"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">	res.header(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"*"</span>)	<span class="comment">// 允许任何域的请求</span></span><br><span class="line">	res.send(<span class="string">"你好"</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="还在相应的接口上添加crossorigin表示允许跨域请求"><a class="markdownIt-Anchor" href="#还在相应的接口上添加crossorigin表示允许跨域请求"></a> 还在相应的接口上添加<code>@CrossOrigin</code>表示允许跨域请求</h5>
<blockquote>
<p>可以看做是修改响应头的变种</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InfoController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@CrossOrigin</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> HashMap&lt;Object, Object&gt; <span class="title">getInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        hashMap.put(<span class="string">"cl"</span>, <span class="number">19</span>);</span><br><span class="line">        <span class="keyword">return</span> hashMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="附录"><a class="markdownIt-Anchor" href="#附录"></a> 附录</h2>
<ul>
<li><a href="https://www.bilibili.com/video/BV1Kt411E76z?spm_id_from=333.999.0.0" target="_blank" rel="noopener">B站视频：【跨域请求】【前端】什么是CORS，教你解决跨域问题</a></li>
</ul>
<p>采坑说明：</p>
<ul>
<li>CORS是浏览器的限制，而HbuilderX中内置的浏览器是没有跨域问题的，需要打开外部浏览器才能看到。</li>
</ul>
</article><!-- lincense--><div class="license-wrapper"><p> <span>Author:  </span><a href="https://nymrli.top">Mrli</a></p><p> <span>Link:  </span><a href="https://nymrli.top/2021/11/26/前端-跨域/">https://nymrli.top/2021/11/26/前端-跨域/</a></p><p> <span>Copyright:  </span><span>All articles in this blog are licensed under <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/3.0">CC BY-NC-SA 3.0</a> unless stating additionally.</span></p></div><div class="post-paginator"><a class="prevSlogan" href="/2021/11/28/Vue3初体验/" title="Vue3初体验"><span>< PreviousPost</span><br><span class="prevTitle">Vue3初体验</span></a><a class="nextSlogan" href="/2021/11/25/党员在线培训课程-免除暂停烦恼/" title="党员在线培训课程~免除暂停烦恼"><span>NextPost ></span><br><span class="nextTitle">党员在线培训课程~免除暂停烦恼</span></a><div class="clear"></div></div><div id="comment"><div id="container"></div><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script><script>var gitment = new Gitment({
  id: '前端-跨域',
  owner: 'Freedomisgood',
  repo: 'Freedomisgood.github.io',
  oauth: {
    client_id: 'bc5a81fe36017dcd8b63',
    client_secret: '949cec3a1b91742c6249c47259791e4b80a6fa69',
  },
})
gitment.render('container')</script></div></section></article><footer id="cxo-footer-outer"><div id="cxo-footer-inner"><p class="footer-container"><span>Site by </span><a href="http://hexo.io"><span>Hexo</span></a><span> | theme </span><a href="https://github.com/Longlongyu/hexo-theme-Cxo"><span>Cxo</span></a></p><p class="beian"><a href="https://beian.miit.gov.cn/"> <span>备案号:苏ICP备18015439号</span></a></p><i class="fa fa-user"> </i><span id="busuanzi_value_site_uv"></span><span> | </span><i class="fa fa-eye"> </i><span id="busuanzi_value_site_pv"></span></div></footer><!-- catelog--><div class="toc-wrapper" style="top: 60vh;"><div class="toc-catalog"><i class="fa fa-list"> </i><span>CATALOG</span></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是跨域问题"><span class="toc-number">1.</span> <span class="toc-text"> 什么是跨域问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#展示跨域问题"><span class="toc-number">2.</span> <span class="toc-text"> 展示跨域问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#处理跨域"><span class="toc-number">3.</span> <span class="toc-text"> 处理跨域</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#前端"><span class="toc-number">3.1.</span> <span class="toc-text"> 前端</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#jsonp"><span class="toc-number">3.1.1.</span> <span class="toc-text"> jsonp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#proxy"><span class="toc-number">3.1.2.</span> <span class="toc-text"> Proxy</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#vue"><span class="toc-number">3.1.2.1.</span> <span class="toc-text"> Vue</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#服务器端"><span class="toc-number">3.2.</span> <span class="toc-text"> 服务器端</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#nginx"><span class="toc-number">3.2.1.</span> <span class="toc-text"> nginx</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#后端"><span class="toc-number">3.3.</span> <span class="toc-text"> 后端</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#修改响应头"><span class="toc-number">3.3.1.</span> <span class="toc-text"> 修改响应头</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#还在相应的接口上添加crossorigin表示允许跨域请求"><span class="toc-number">3.3.1.1.</span> <span class="toc-text"> 还在相应的接口上添加@CrossOrigin表示允许跨域请求</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#附录"><span class="toc-number">4.</span> <span class="toc-text"> 附录</span></a></li></ol></div><!-- top--><i class="fa fa-arrow-up close" id="go-up" aria-hidden="true"></i></body></html>
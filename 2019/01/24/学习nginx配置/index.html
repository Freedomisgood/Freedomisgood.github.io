<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><meta name="author" content="Mrli"><meta name="renderer" content="webkit"><meta name="copyright" content="Mrli"><meta name="keywords" content="Mrli's Blog"><meta name="description" content="想和你讲，说了会心动 ，缄默会心安。"><meta name="Cache-Control" content="no-cache"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>学习nginx配置 · Mr.li's Blog</title><link rel="stylesheet" href="/css/style.css?v=2018.7.9"><link rel="stylesheet" href="/css/animation.css?v=2018.7.9"><link rel="icon" href="/img/assets/favicon.ico"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.6"><!-- scripts--><script>(function( w ){
  "use strict";
  // rel=preload support test
  if( !w.loadCSS ){
    w.loadCSS = function(){};
  }
  // define on the loadCSS obj
  var rp = loadCSS.relpreload = {};
  // rel=preload feature support test
  // runs once and returns a function for compat purposes
  rp.support = (function(){
    var ret;
    try {
      ret = w.document.createElement( "link" ).relList.supports( "preload" );
    } catch (e) {
      ret = false;
    }
    return function(){
      return ret;
    };
  })();

  // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
  // then change that media back to its intended value on load
  rp.bindMediaToggle = function( link ){
    // remember existing media attr for ultimate state, or default to 'all'
    var finalMedia = link.media || "all";

    function enableStylesheet(){
      link.media = finalMedia;
    }

    // bind load handlers to enable media
    if( link.addEventListener ){
      link.addEventListener( "load", enableStylesheet );
    } else if( link.attachEvent ){
      link.attachEvent( "onload", enableStylesheet );
    }

    // Set rel and non-applicable media type to start an async request
    // note: timeout allows this to happen async to let rendering continue in IE
    setTimeout(function(){
      link.rel = "stylesheet";
      link.media = "only x";
    });
    // also enable media after 3 seconds,
    // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
    setTimeout( enableStylesheet, 3000 );
  };

  // loop through link elements in DOM
  rp.poly = function(){
    // double check this to prevent external calls from running
    if( rp.support() ){
      return;
    }
    var links = w.document.getElementsByTagName( "link" );
    for( var i = 0; i < links.length; i++ ){
      var link = links[ i ];
      // qualify links to those with rel=preload and as=style attrs
      if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
        // prevent rerunning on link
        link.setAttribute( "data-loadcss", true );
        // bind listeners to toggle media back
        rp.bindMediaToggle( link );
      }
    }
  };

  // if unsupported, run the polyfill
  if( !rp.support() ){
    // run once at least
    rp.poly();

    // rerun poly on an interval until onload
    var run = w.setInterval( rp.poly, 500 );
    if( w.addEventListener ){
      w.addEventListener( "load", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    } else if( w.attachEvent ){
      w.attachEvent( "onload", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    }
  }


  // commonjs
  if( typeof exports !== "undefined" ){
    exports.loadCSS = loadCSS;
  }
  else {
    w.loadCSS = loadCSS;
  }
}( typeof global !== "undefined" ? global : this ) );</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" defer></script><script src="/js/main.js?v=2018.7.9" defer></script><!-- fancybox--><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script><!-- busuanzi--><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></head><body><section class="profile-close" id="cxo-profile"><div class="profile-avatar"><i class="fa fa-caret-left"></i><img src="https://avatars1.githubusercontent.com/u/31088082?s=400&amp;u=7a99ff83916afb3f4c5312bd78a1be17fe0e34ed&amp;v=4"></div><!--.profile-saying
  i.fa.fa-comment
  .saying--><div class="cxo-profile-inner"><div class="profile-name">Mrli</div><div class="profile-signature">别装作很努力,<br>因为结局不会陪你演戏。</div><div class="contacts"><div>Contacts:</div><span><a href="http://sighttp.qq.com/msgrd?v=1&amp;uin=1063052964" target="_black">QQ</a></span><span><a href="https://www.cnblogs.com/nymrli/" target="_black">博客园</a></span></div><div class="read-progress"></div></div></section><header id="cxo-intro" style="height: 60vh;background-image: url(/img/intro/index-bg.png);"><nav id="cxo-intro-nav"><section><div class="intro-nav-title"><a href="/">Mr.li's Blog</a></div><div class="intro-nav-label-box"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div><i class="fa fa-bars intro-nav-menu"><div class="intro-nav-drop"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div></i><div class="clear"></div></section></nav><h1 class="post-title">学习nginx配置</h1><div class="post-intros"><div class="post-intro-meta"><span class="post-intro-time"><i class="post-intro-calendar fa fa-edit"></i><span>2022/02/27</span></span><span class="busuanzi-pv" id="busuanzi_container_page_pv"><i class="post-intro-calendar fa fa-user-o"></i><span id="busuanzi_value_page_pv"></span></span><span class="post-intro-tags"><a class="intro-tag fa fa-tag" href="javascript:void(0)" date-tags="环境配置"> 环境配置</a><a class="intro-tag fa fa-tag" href="javascript:void(0)" date-tags="nginx"> nginx</a></span></div><div class="post-intro-read"><span> Word count: <span class="post-count">2,445</span> | Reading time: <span class="post-count">10</span>min</span></div></div></header><article class="cxo-up" id="cxo-content-outer"><section id="cxo-content-inner"><article class="article-entry" id="post"><h2 id="nginx配置"><a class="markdownIt-Anchor" href="#nginx配置"></a> nginx配置</h2>
<h3 id="多台虚拟主机"><a class="markdownIt-Anchor" href="#多台虚拟主机"></a> 多台虚拟主机:</h3>
<p>1.分配IP地址</p>
<p>2.新建、编写usr/local/nginx的conf配置文件</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">    sever&#123;</span><br><span class="line">        listen 192.168.1.17:80;				//监听 (IP地址:) 端口</span><br><span class="line">        server_name 192.168.1.17;			// 域名或者ip</span><br><span class="line">        access_log logs/server1.access.log conbined;//指定位置+使用日志文件默认格式</span><br><span class="line">        <span class="attribute">location</span> /</span><br><span class="line">        &#123;</span><br><span class="line">        index index.html index.htm; //index表示意义(关键字),左边优先级高.指定的首页</span><br><span class="line">        <span class="attribute">root</span> html/ss2;			</span><br><span class="line">        //虚拟主机目录(网站目录)==&gt;ss2下的所以html文件都可以通过192.168.1.17/xxx访问</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3.编写目录下的首页index.html文件</p>
<p>4.运行nginx</p>
<p><code>usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/xnzj.conf</code></p>
<p>▲在根目录下可以直接通过路径访问,如根目录下只有index文件,而配置中设置的是<code>index index.html</code>此时没有找到index.html后就会显示403错误,但是可以通过<code>192.168.1.17</code>==&gt;<code>192.168.1.17/index</code>添加路径的方法来加载index界面</p>
<h3 id="其他配置"><a class="markdownIt-Anchor" href="#其他配置"></a> 其他配置</h3>
<ul>
<li>缓存</li>
</ul>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">	<span class="attribute">listen</span> xxx;</span><br><span class="line">	<span class="attribute">server_name</span> yyy;</span><br><span class="line">	<span class="attribute">location</span> <span class="regexp">~ .*\.(jpg|png|)<span class="variable">$&#123;</span></span></span><br><span class="line"><span class="regexp"><span class="variable">        expires 30d;</span></span></span><br><span class="line"><span class="regexp"><span class="variable">	&#125;</span></span></span><br><span class="line"><span class="regexp"></span>	location <span class="regexp">~ .*\.(css|js|)<span class="variable">$&#123;</span></span></span><br><span class="line"><span class="regexp"><span class="variable">        expires 1h;</span></span></span><br><span class="line"><span class="regexp"><span class="variable">	&#125;</span></span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>自动列目录</li>
</ul>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[/ect/nginx/nginx.conf]</span><br><span class="line">server&#123;</span><br><span class="line">	..</span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">      <span class="attribute">root</span> html;</span><br><span class="line">      <span class="attribute">index</span> index.html index.hml;</span><br><span class="line">      <span class="attribute">autoindex</span> <span class="literal">on</span>; <span class="comment">#▲</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="命令解释"><a class="markdownIt-Anchor" href="#命令解释"></a> 命令解释</h2>
<h3 id="server_name"><a class="markdownIt-Anchor" href="#server_name"></a> server_name</h3>
<blockquote>
<p>server_name 为虚拟服务器的识别路径。因此不同的域名会通过将请求头中的HOST字段与虚拟主机设置的URI进行匹配，从而匹配到特定的server块，将请求转发到对应的应用服务器中去。</p>
</blockquote>
<p>from : <a href="https://blog.csdn.net/Cheng_Kohui/article/details/82930464" target="_blank" rel="noopener">https://blog.csdn.net/Cheng_Kohui/article/details/82930464</a></p>
<p>server_name与host匹配优先级如下：</p>
<ol>
<li>完全匹配</li>
<li>通配符在前的，如<code>*.test.com</code></li>
<li>通配符<code>*</code>在后的，如<a href="https://blog.csdn.net/" target="_blank" rel="noopener">www.test.*</a></li>
<li>正则匹配，如~^.www.test.com$</li>
</ol>
<h3 id="location"><a class="markdownIt-Anchor" href="#location"></a> location</h3>
<blockquote>
<p><code>location</code>是Nginx中的块级指令(block directive),，location指令的功能是用来匹配不同的url请求，进而对请求做</p>
<p>开始之前先明确一些约定，我们输入的网址叫做<code>请求URI</code>，nginx用<code>请求URI</code>与<code>location中配置的URI</code>做匹配。不同的处理和响应。</p>
</blockquote>
<p><strong>匹配顺序</strong></p>
<ol>
<li>= 表示精确匹配。只有请求的url路径与后面的字符串完全相等时，才会命中。</li>
<li>^~ 表示如果该符号后面的字符是最佳匹配，采用该规则，不再进行后续的查找。</li>
<li>~ 表示该规则是使用正则定义的，区分大小写。</li>
<li>~* 表示该规则是使用正则定义的，不区分大小写。</li>
</ol>
<p>注意的是，nginx的匹配优先顺序按照上面的顺序进行优先匹配，而且注意的是<strong>一旦某一个匹配命中直接退出，不再进行往下的匹配</strong></p>
<p>剩下的普通匹配<strong>会按照最长匹配长度优先级来匹配</strong>，就是谁匹配的越多就用谁。</p>
<h3 id="try_files详解"><a class="markdownIt-Anchor" href="#try_files详解"></a> <a href="https://www.cnblogs.com/jedi1995/p/10900224.html" target="_blank" rel="noopener">try_files详解</a></h3>
<blockquote>
<p>nginx中http_core核心模块所带的指令，主要是能替代一些rewrite的指令，提高解析效率</p>
<p>格式1：<code>try_files file ... uri</code>; 格式2: <code>try_files file ... file = ReturnCode</code>;</p>
</blockquote>
<ul>
<li>关键点1：按指定的file顺序查找存在的文件，并使用第一个找到的文件进行请求处理</li>
<li>关键点2：查找路径是按照给定的root或alias为根路径来查找的</li>
<li>关键点3：如果给出的file都没有匹配到，则重新请求最后一个参数给定的uri，就是新的location匹配</li>
<li>关键点4：如果是格式2，如果最后一个参数是 = 404，若给出的file都没有匹配到，则最后返回ReturnCode(如404)的响应码</li>
</ul>
<p>举例说明</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /images/ &#123;</span><br><span class="line">    <span class="attribute">root</span> /opt/html/;</span><br><span class="line">    <span class="attribute">try_files</span> <span class="variable">$uri</span>   <span class="variable">$uri</span>/  /images/default.gif; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 比如 请求 127.0.0.1/images/test.gif 会依次查找 1.文件/opt/html/images/test.gif   2.文件夹 /opt/html/images/test.gif/下的index文件  3. 请求127.0.0.1/images/default.gif</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.其他注意事项</span></span><br><span class="line"><span class="comment">#1.try-files 如果不写上 $uri/，当直接访问一个目录路径时，并不会去匹配目录下的索引页  即 访问127.0.0.1/images/ 不会去访问  127.0.0.1/images/index.html</span></span><br></pre></td></tr></table></figure>
<p>from： <a href="https://www.cnblogs.com/jedi1995/p/10900224.html" target="_blank" rel="noopener">https://www.cnblogs.com/jedi1995/p/10900224.html</a></p>
<p>例子2： 因为不可能每一个项目开启一个域名，仅仅指向通过增加路径来划分多个网站，比如：</p>
<ol>
<li><code>www.taobao.com/tmall/login</code>访问天猫的登录页面</li>
<li><code>www.taobao.com/alipay/login</code>访问支付宝的登录页面</li>
</ol>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> taobao.com;</span><br><span class="line">    <span class="attribute">index</span> index.html index.htm;</span><br><span class="line">    <span class="comment"># 通过正则来匹配捕获 [tmall|alipay]中间的这个路径</span></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ ^/([^\/]+)/(.*)$</span> &#123;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /<span class="variable">$1</span>/dist/index.html =<span class="number">404</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="rewrite-用法"><a class="markdownIt-Anchor" href="#rewrite-用法"></a> rewrite 用法</h3>
<blockquote>
<p>用rewrite去除URL中的特定参数。</p>
<p>日常服务中经常会用Nginx做一层代理转发，把Nginx当做前置机，这里的rewrite 就是为了去除URL中的<code>/apis</code>,因为实际的后端api中是没有这个参数的，但是为了做到在Nginx转发请求，前端需要加上这个参数，以便于区别开请求前端页面还是后端接口</p>
</blockquote>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="comment"># 对外暴露 80 端口</span></span><br><span class="line">    <span class="attribute">listen</span>    <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> <span class="number">192.168.10.231</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment"># 后端API地址暴露为：http://192.168.10.231/apis</span></span><br><span class="line">    <span class="comment"># 后端服务实际运行的地址和端口为: http://127.0.0.1:8000</span></span><br><span class="line">    <span class="attribute">location</span> /apis &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span>   http://127.0.0.1:8000/;</span><br><span class="line">        <span class="attribute">proxy_pass_request_headers</span>      <span class="literal">on</span>;</span><br><span class="line">        <span class="comment"># 重写URL 去除apis</span></span><br><span class="line">        <span class="attribute">rewrite</span> <span class="string">"^/apis/(.*)$"</span> /<span class="variable">$1</span> <span class="literal">break</span>;	</span><br><span class="line">        <span class="comment"># "^/api/(.)$": 匹配路径的正则表达式，用了分组语法就是*(.)**，把/api/以后的所有部分当做1组；</span></span><br><span class="line">        <span class="comment"># /$1：重写的目标路径，这里用$1引用前面正则表达式匹配到的分组（组编号从1开始，也就是api），即/api/后面的所有。这样新的路径就是除去/api/以外的所有，就达到了去除/api前缀的目的</span></span><br><span class="line">        <span class="comment"># break：指令。常用的有2个，分别是：last、break；</span></span><br><span class="line">        	<span class="comment"># last: 重写路径结束后，将得到的路径重新进行一次路径匹配；</span></span><br><span class="line">        	<span class="comment"># break: 重写路径结束后，不再重新匹配路径。</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>比如前端的请求地址是</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//192.168.10.231/apis/user</span></span><br></pre></td></tr></table></figure>
<p>那么实际上经过Nginx转发后请求的地址是</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1:8000/user</span></span><br></pre></td></tr></table></figure>
<h3 id="index配置"><a class="markdownIt-Anchor" href="#index配置"></a> <a href="https://www.cnblogs.com/kukudi/p/11496315.html" target="_blank" rel="noopener">index配置</a></h3>
<blockquote>
<p>在前后端分离的基础上，通过Nginx配置，指定网站初始页。</p>
<p>格式: <code>index index.htm ... file3 /index.html</code></p>
<p>如果包括多个文件，Nginx会根据文件的枚举顺序来检查，直到查找的文件存在；<br>
文件可以是相对路径也可以是绝对路径，<strong>绝对路径需要放在最后</strong>；<br>
文件可以使用变量<code>$</code>来命名；<code>index index.$geo.html index.0.html /index.html;</code></p>
</blockquote>
<p>如果文件存在，则使用文件作为路径，发起内部重定向。直观上看上去就像再一次从客户端发起请求，Nginx再一次搜索location一样。</p>
<p>既然是内部重定向，域名+端口不发生变化，所以只会在同一个server下搜索。</p>
<p>同样，如果内部重定向发生在proxy_pass反向代理后，那么重定向只会发生在代理配置中的同一个server。</p>
<p>实例</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> example.org www.example.org;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span> /data/www;</span><br><span class="line">        <span class="attribute">index</span> index.html index.php;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">    	<span class="attribute">root</span> /data/www/test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的例子中，如果你使用example.org或www.example.org直接发起请求，那么首先会访问到“/”的location，结合root与index指令，会先判断/data/www/index.html是否存在，如果不，则接着查看<br>
/data/www/index.php ，如果存在，则使用/index.php发起内部重定向，就像从客户端再一次发起请求一样，Nginx会再一次搜索location，毫无疑问匹配到第二个~ .php$，从而访问到/data/www/test/index.php。</p>
<h3 id="more"><a class="markdownIt-Anchor" href="#more"></a> More:</h3>
<p><a href="https://juejin.cn/post/7064378702779891749#comment" target="_blank" rel="noopener">前端到底用nginx来做啥</a></p>
<h2 id="uwsgi模块使用"><a class="markdownIt-Anchor" href="#uwsgi模块使用"></a> uwsgi模块使用</h2>
<p>安装<br>
<code>source activate</code># 开启虚拟开发环境模式<br>
<code>pip install uwsgi</code> # 安装uwsgi<br>
配置<br>
uwsgi配置文件支持很多格式，我采用.ini格式，命名为uconfig.ini具体内容如下：</p>
<p>启动uwsgi , 命令输入<code>uwsgi uconfig.ini</code></p>
<p>外部访问测试</p>
<p>此时在外部访问 公网IP：5000就可以访问了</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[uwsgi]</span></span><br><span class="line"><span class="comment"># 外部访问地址，可以指定多种协议，现在用http便于调试，之后用socket</span></span><br><span class="line"><span class="attr">http</span> = <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">5000</span></span><br><span class="line"><span class="comment"># 指向项目目录</span></span><br><span class="line"><span class="attr">chdir</span> =  /home/pythonproject/my_flask/py3env/myblog/</span><br><span class="line"><span class="comment"># flask启动程序文件</span></span><br><span class="line"><span class="attr">wsgi-file</span> = manage.py</span><br><span class="line"><span class="comment"># flask在manage.py文件中的app名</span></span><br><span class="line"><span class="attr">callable</span> = app #很多人习惯将Flask应用对象取名为”app”，但是WSGI标准是”application”。uWSGI提供了一个功能，可以指定应用对象，方法就是在配置文件中加上”callable”项：</span><br><span class="line"><span class="comment"># 处理器数</span></span><br><span class="line"><span class="attr">processes</span> = <span class="number">4</span></span><br><span class="line"><span class="comment"># 线程数</span></span><br><span class="line"><span class="attr">threads</span> = <span class="number">2</span></span><br><span class="line"><span class="comment">#状态检测地址</span></span><br><span class="line"><span class="attr">stats</span> = <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9191</span></span><br></pre></td></tr></table></figure>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line">    <span class="attribute">include</span> uwsgi_params;</span><br><span class="line">    <span class="attribute">uwsgi_pass</span> <span class="number">127.0.0.1:3031</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段配置表明Nginx会将收到的所有请求都转发到”127.0.0.1:3031″端口上，即uWSGI服务器上。现在让我们重启Nginx，</p>
<h2 id="附使用记录"><a class="markdownIt-Anchor" href="#附使用记录"></a> 附：使用记录</h2>
<p>单server基本配置</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;					<span class="comment"># 侦听端口 weight=1;</span></span><br><span class="line">        <span class="attribute">server_name</span> localhost;		 <span class="comment"># 服务器名称  weight=10;</span></span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> / &#123;				<span class="comment"># 侦听URL路径</span></span><br><span class="line">                <span class="attribute">root</span>   /usr/share/nginx/html;		<span class="comment"># 工程根目录</span></span><br><span class="line">                <span class="attribute">index</span>  index-test.html index.htm;	<span class="comment"># 入口文件</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="反向代理"><a class="markdownIt-Anchor" href="#反向代理"></a> 反向代理：</h3>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> group1&#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">49.235.118.244:7070</span>;			<span class="comment"># 这边的IP地址不能写127.0.0.1实测</span></span><br><span class="line">    <span class="attribute">server</span> <span class="number">49.235.118.244:7069</span>;			<span class="comment"># 且云服务器需要在防火墙将这个端口开放，否则无法反向代理</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line">    <span class="attribute">location</span> /demo1 &#123;</span><br><span class="line">        <span class="comment"># 在该位置配置反向代理，将ip/demo1请求拦截，发送给8080端口，如果不是本机请使用公网ip</span></span><br><span class="line">        <span class="attribute">proxy_pass</span>   http://group1/;</span><br><span class="line">                <span class="attribute">proxy_set_header</span>   Host             <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>   X-Real-IP        <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span>   X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article><!-- lincense--><div class="license-wrapper"><p> <span>Author:  </span><a href="https://nymrli.top">Mrli</a></p><p> <span>Link:  </span><a href="https://nymrli.top/2019/01/24/学习nginx配置/">https://nymrli.top/2019/01/24/学习nginx配置/</a></p><p> <span>Copyright:  </span><span>All articles in this blog are licensed under <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/3.0">CC BY-NC-SA 3.0</a> unless stating additionally.</span></p></div><div class="post-paginator"><a class="prevSlogan" href="/2019/02/01/ACM-贪心专题/" title="ACM_贪心专题"><span>< PreviousPost</span><br><span class="prevTitle">ACM_贪心专题</span></a><a class="nextSlogan" href="/2019/01/24/C++日期操作/" title="C++日期操作"><span>NextPost ></span><br><span class="nextTitle">C++日期操作</span></a><div class="clear"></div></div><div id="comment"><div id="container"></div><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script><script>var gitment = new Gitment({
  id: '学习nginx配置',
  owner: 'Freedomisgood',
  repo: 'Freedomisgood.github.io',
  oauth: {
    client_id: 'bc5a81fe36017dcd8b63',
    client_secret: '949cec3a1b91742c6249c47259791e4b80a6fa69',
  },
})
gitment.render('container')</script></div></section></article><footer id="cxo-footer-outer"><div id="cxo-footer-inner"><p class="footer-container"><span>Site by </span><a href="http://hexo.io"><span>Hexo</span></a><span> | theme </span><a href="https://github.com/Longlongyu/hexo-theme-Cxo"><span>Cxo</span></a></p><p class="beian"><span>备案号:苏ICP备18015439号</span></p><i class="fa fa-user"> </i><span id="busuanzi_value_site_uv"></span><span> | </span><i class="fa fa-eye"> </i><span id="busuanzi_value_site_pv"></span></div></footer><!-- catelog--><div class="toc-wrapper" style="top: 60vh;"><div class="toc-catalog"><i class="fa fa-list"> </i><span>CATALOG</span></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#nginx配置"><span class="toc-number">1.</span> <span class="toc-text"> nginx配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#多台虚拟主机"><span class="toc-number">1.1.</span> <span class="toc-text"> 多台虚拟主机:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#其他配置"><span class="toc-number">1.2.</span> <span class="toc-text"> 其他配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#命令解释"><span class="toc-number">2.</span> <span class="toc-text"> 命令解释</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#server_name"><span class="toc-number">2.1.</span> <span class="toc-text"> server_name</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#location"><span class="toc-number">2.2.</span> <span class="toc-text"> location</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#try_files详解"><span class="toc-number">2.3.</span> <span class="toc-text"> try_files详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rewrite-用法"><span class="toc-number">2.4.</span> <span class="toc-text"> rewrite 用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#index配置"><span class="toc-number">2.5.</span> <span class="toc-text"> index配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#more"><span class="toc-number">2.6.</span> <span class="toc-text"> More:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#uwsgi模块使用"><span class="toc-number">3.</span> <span class="toc-text"> uwsgi模块使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#附使用记录"><span class="toc-number">4.</span> <span class="toc-text"> 附：使用记录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#反向代理"><span class="toc-number">4.1.</span> <span class="toc-text"> 反向代理：</span></a></li></ol></li></ol></div><!-- top--><i class="fa fa-arrow-up close" id="go-up" aria-hidden="true"></i></body></html>
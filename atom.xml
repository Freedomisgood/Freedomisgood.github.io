<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Mrli&#39;s Blog</title>
  
  <subtitle>åˆ«è£…ä½œå¾ˆåŠªåŠ›ï¼Œç»“å±€ä¸ä¼šé™ªä½ æ¼”æˆã€‚</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://nymrli.top/"/>
  <updated>2022-05-09T15:47:44.833Z</updated>
  <id>https://nymrli.top/</id>
  
  <author>
    <name>Mrli</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ã€Šä»£ç æ•´æ´ä¹‹é“ã€‹â€”â€”é˜…è¯»ç¬”è®°</title>
    <link href="https://nymrli.top/2022/05/09/%E3%80%8A%E4%BB%A3%E7%A0%81%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93%E3%80%8B%E2%80%94%E2%80%94%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"/>
    <id>https://nymrli.top/2022/05/09/ã€Šä»£ç æ•´æ´ä¹‹é“ã€‹â€”â€”é˜…è¯»ç¬”è®°/</id>
    <published>2022-05-09T15:47:02.000Z</published>
    <updated>2022-05-09T15:47:44.833Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä»£ç æ•´æ´ä¹‹é“é˜…è¯»"><a class="markdownIt-Anchor" href="#ä»£ç æ•´æ´ä¹‹é“é˜…è¯»"></a> ä»£ç æ•´æ´ä¹‹é“â€”â€”é˜…è¯»</h1><h2 id="ç¬¬äºŒç« æœ‰æ„ä¹‰çš„å‘½å"><a class="markdownIt-Anchor" href="#ç¬¬äºŒç« æœ‰æ„ä¹‰çš„å‘½å"></a> ç¬¬äºŒç« ï¼šæœ‰æ„ä¹‰çš„å‘½å</h2><ol><li>åå‰¯å…¶å®ï¼Œåœ¨ä»–ä»¬åœ¨çš„åœ°æ–¹è¡¨è¾¾å‡ºä»–ä»¬å«ä¹‰çš„åç§°</li><li>é¿å…è¯¯å¯¼ï¼šé¿å…ä¸“æœ‰åè¯ï¼›ç±»å‹ç¬¦åˆï¼›</li><li>åšæœ‰æ„ä¹‰çš„åŒºåˆ†ï¼šå˜é‡ä¸ç”¨å†åŠ Varæ¥è¯´æ˜ï¼Œå³åŠ ä¸Šaå’Œtheå¯¹æ„æ€å¹¶æ²¡æ²¡æœ‰å¸®åŠ©</li><li>ä½¿ç”¨è¯»å¾—å‡ºæ¥çš„åç§°</li><li>ä½¿ç”¨å¯æœç´¢çš„åç§°ï¼šåç§°é•¿çŸ­åº”è¯¥ä¸ä½œç”¨åŸŸå¤§å°å¯¹åº”ã€‚å•å­—æ¯åç§°<strong>ä»…</strong>ç”¨äºæ®µæ–¹æ³•ä¸­çš„æœ¬åœ°å˜é‡</li><li>é¿å…ä½¿ç”¨ç¼–ç ï¼šåŒˆç‰™åˆ©è¯­æ ‡è®°ï¼š<code>PhoneNumber phoneString</code>ã€æˆå‘˜å‰ç¼€:<code>private String m_dsc;</code>ï¼›æ¥å£å’Œå®ç°: <code>IShapeFactory</code>å‰å¯¼å­—æ¯Iè¢«æ»¥ç”¨äº†ï¼Œå…¶å®ä¸€ç§åºŸè¯ï¼Œç”¨äº†<code>IXxxx</code>åå°±æ²¡å¿…è¦<code>XxxxImpl</code>äº†ã€‚</li><li>ç±»åå’Œå¯¹è±¡ååº”è¯¥æ˜¯åè¯æˆ–åè¯çŸ­è¯­ï¼Œä¸åº”è¯¥æ˜¯åŠ¨è¯ï¼šCustomerã€WikePageã€Accountï¼Œé¿å…ä½¿ç”¨Managerã€Processorã€Dataã€Infoè¿™æ ·çš„ç±»å</li><li>æ–¹æ³•ååº”å½“æ˜¯åŠ¨è¯æˆ–åŠ¨è¯æ–­å¥ï¼špostPaymentã€deletePageã€saveã€‚å±æ€§è®¿é—®å™¨ã€ä¿®æ”¹å™¨ã€æ–­è¨€åº”è¯¥æ ¹æ®å…¶å€¼å‘½åï¼Œå¹¶æ ¹æ®Javabeanæ ‡å‡†åŠ ä¸Šgetã€setã€iså‰ç¼€</li><li>åˆ«æ‰®å¯çˆ±ï¼Œç”¨å¯çˆ±çš„åç§°ï¼Œè¿˜æ˜¯è¦è¡¨è¾¾å‡†ç¡®</li><li>ä¸è¦æ·»åŠ æ²¡ç”¨çš„è¯­å¢ƒï¼Œæ¯”å¦‚å…¨æ–‡éƒ½æ˜¯åœ¨GPSçš„ç¯å¢ƒä¸‹ï¼Œå°±ä¸éœ€è¦åœ¨AccountAddresså‰å†åŠ GPSå‰ç¼€äº†</li></ol><h2 id="ç¬¬ä¸‰ç« å‡½æ•°"><a class="markdownIt-Anchor" href="#ç¬¬ä¸‰ç« å‡½æ•°"></a> ç¬¬ä¸‰ç« ï¼šå‡½æ•°</h2><ol><li><p>çŸ­å°ï¼šå‡½æ•°çš„ç¬¬ä¸€è§„åˆ™æ˜¯çŸ­å°ï¼Œç¬¬äºŒæ¡è§„åˆ™æ˜¯è¿˜è¦æ›´çŸ­å°</p></li><li><p>åªåšä¸€ä»¶äº‹ï¼šå€¼åšè¯¥å‡½æ•°åä¸‹åŒä¸€æŠ½è±¡å±‚ä¸Šçš„æ­¥éª¤ã€‚ï¼ˆç¼–å†™å‡½æ•°æ¯•ç«Ÿå°±æ˜¯ä¸ºäº†æŠŠå¤§ä¸€äº›çš„æ¦‚å¿µæ‹†åˆ†æˆå¦ä¸€æŠ½è±¡å±‚ä¸Šçš„ä¸€ç³»åˆ—æ­¥éª¤ï¼‰ã€‚åˆ¤æ–­å‡½æ•°æ˜¯å¦ä¸çŸ¥åšäº†ä¸€ä»¶äº‹ï¼Œå°±çœ‹èƒ½ä¸èƒ½å†æ‹†é™¤ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸ä»…åªæ˜¯å•çº¯çš„é‡æ–°é˜é‡Šå…¶å®ç°ï¼ˆæ¯”å¦‚å°†ifæ‹†å‡ºæ¥åšä¸€ä¸ªåä¸ºincludeSetupAndTeardownsIfTestpageçš„å‡½æ•°ï¼Œåªæ˜¯é‡æ–°è¯ é‡Šäº†ä»£ç ï¼Œå¹¶æœªæ”¹å˜æŠ½è±¡å±‚çº§ï¼‰ã€‚</p></li><li><p>æ¯ä¸ªå‡½æ•°ä¸€ä¸ªæŠ½è±¡å±‚çº§ï¼šè¦ç¡®ä¿å‡½æ•°åªåšä¸€ä»¶äº‹ï¼Œå‡½æ•°ä¸­çš„è¯­å¥éƒ½è¦åœ¨åŒä¸€æŠ½è±¡å±‚çº§ä¸Šã€‚</p><p>è‡ªé¡¶å‘ä¸‹è¯»ä»£ç ï¼šå‘ä¸‹è§„åˆ™â€”â€”æˆ‘ä»¬æƒ³è¦è®©æ¯ä¸ªå‡½æ•°åé¢éƒ½è·Ÿç€ä½äºä¸‹ä¸€æŠ½è±¡å±‚çº§çš„å‡½æ•°ï¼Œè¿™æ ·ä¸€æ¥ï¼Œåœ¨æŸ¥çœ‹å‡½æ•°åˆ—è¡¨æ—¶ï¼Œå°±èƒ½å¾ªç€æŠ½è±¡å±‚çº§å‘ä¸‹é˜…è¯»äº†ã€‚</p></li><li><p>switchè¯­å¥ï¼šå†™å‡ºçŸ­å°çš„switchå¾ˆéš¾ï¼Œif/elseåŒç†ã€‚Switchå¤©ç”Ÿè¦åšNä»¶äº‹ï¼Œä¸å¹¸æˆ‘ä»¬æ€»æ— æ³•é¿å…switchè¯­å¥ï¼Œä¸è¿‡è¿˜æ˜¯èƒ½å¤Ÿ<strong>ç¡®ä¿æ¯ä¸ªswitchéƒ½åŸ‹è—åœ¨è¾ƒä½çš„æŠ½è±¡å±‚çº§</strong>ï¼Œå¹¶ä¸”æ°¸è¿œä¸é‡å¤ã€‚å½“ç„¶æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¤šæ€æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p></li><li><p>ä½¿ç”¨æè¿°æ€§çš„åç§°ï¼šå‡½æ•°è¶ŠçŸ­å°ã€åŠŸèƒ½è¶Šé›†ä¸­ï¼Œå°±è¶Šä¾¿äºå–ä¸ªå¥½åå­—ã€‚åˆ«å®³æ€•é•¿åç§°ï¼Œé•¿è€Œå…·æœ‰æè¿°æ€§çš„åç§°è¦æ¯”çŸ­è€Œä»¤äººè´¹è§£çš„åç§°å¥½ã€‚</p><p>å‘½åæ–¹å¼è¦ä¿æŒä¸€ç›´ã€‚ä½¿ç”¨ä¸æ¨¡å—åä¸€è„‰ç›¸æ‰¿çš„çŸ­è¯­ã€åè¯å’ŒåŠ¨è¯ç»™å‡½æ•°å‘½åã€‚æ¯”å¦‚includeSetupAndTearDownPagesã€includeSetupPagesã€includeSuiteSetupPageã€includeSetupPageï¼Œè¿™äº›åè¯éƒ½ç”¨äº†ç±»ä¼¼çš„æªè¾ï¼Œä¾åºè®²å‡ºä¸€ä¸ªæ•…äº‹</p></li><li><p>å‡½æ•°å‚æ•°ï¼šæœ€ç†æƒ³çš„å‚æ•°æ•°é‡æ˜¯0ï¼›å…¶æ¬¡æ˜¯1ï¼Œå†æ¬¡æ˜¯äºŒï¼Œåº”è¯¥å°½é‡é¿å…ä¸‰å‚æ•°ï¼ˆè¿™æ¡æ ¹æ®ç¼–ç¨‹è¯­è¨€è€Œå®šï¼‰</p><p>å‚æ•°è¶Šå¤šï¼Œæµ‹è¯•è¦†ç›–æ‰€æœ‰å¯èƒ½å€¼çš„ç»„åˆè®©äººç”Ÿç•</p></li><li><p>ä¸€å…ƒå‡½æ•°ï¼š</p><p>æœ‰è¿”å›å€¼ï¼š</p><ul><li>æ“ä½œè¯¥å‚æ•°ï¼Œæ¯”å¦‚å°†å…¶è½¬æ¢ä¸ºå…¶ä»–ä»€ä¹ˆä¸œè¥¿å†è¾“å‡ºä¹‹</li></ul><p>æ— è¿”å›å€¼</p><ul><li>æ ¹æ®è¯¥å‚æ•°è¿›è¡ŒæŒ‡å®šæ“ä½œï¼Œäº‹ä»¶</li></ul></li><li><p>å‚æ•°å¯¹è±¡ï¼šå¦‚æœå‡½æ•°éœ€è¦ä¸¤ä¸ªã€ä¸‰ä¸ªæˆ–ä¸‰ä¸ªä»¥ä¸Šå‚æ•°ï¼Œå°±è¯´æ˜<strong>å…¶ä¸­ä¸€äº›å‚æ•°åº”è¯¥å°è£…ä¸ºç±»</strong>äº†</p></li><li><p>åŠ¨è¯ä¸å…³é”®å­—ï¼šassertEqualæ”¹æˆassertExpectedEqualsActual(expected, actual)å¯èƒ½ä¼šå¥½ä¸€ç‚¹ï¼Œè¿™æ ·å¤§å¤§å‡è½»äº†è®°å¿†å‚æ•°é¡ºåºçš„è´Ÿæ‹…</p></li><li><p>æ— å‰¯ä½œç”¨ï¼šå‡½æ•°æ‰¿è¯ºåªåšä¸€ä»¶äº‹ï¼Œä½†è¿˜æ˜¯ä¼šåšå…¶ä»–è¢«è—èµ·æ¥çš„äº‹</p></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ä»£ç æ•´æ´ä¹‹é“é˜…è¯»&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#ä»£ç æ•´æ´ä¹‹é“é˜…è¯»&quot;&gt;&lt;/a&gt; ä»£ç æ•´æ´ä¹‹é“â€”â€”é˜…è¯»&lt;/h1&gt;
&lt;h2 id=&quot;ç¬¬äºŒç« æœ‰æ„ä¹‰çš„å‘½å&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#
      
    
    </summary>
    
    
      <category term="è¯»ä¹¦ç¬”è®°" scheme="https://nymrli.top/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>toy reimplementation of an event loop in Python[ç¿»è¯‘]</title>
    <link href="https://nymrli.top/2022/05/08/toy-reimplementation-of-an-event-loop-in-Python-%E7%BF%BB%E8%AF%91/"/>
    <id>https://nymrli.top/2022/05/08/toy-reimplementation-of-an-event-loop-in-Python-ç¿»è¯‘/</id>
    <published>2022-05-08T07:34:46.000Z</published>
    <updated>2022-05-09T14:04:56.146Z</updated>
    
    <content type="html"><![CDATA[<h1 id="äº‹ä»¶å¾ªç¯çš„ä¸€ä¸ªå°æ•…äº‹"><a class="markdownIt-Anchor" href="#äº‹ä»¶å¾ªç¯çš„ä¸€ä¸ªå°æ•…äº‹"></a> äº‹ä»¶å¾ªç¯çš„ä¸€ä¸ªå°æ•…äº‹</h1><blockquote><p>Translated from: <a href="https://github.com/AndreLouisCaron/a-tale-of-event-loops" target="_blank" rel="noopener">https://github.com/AndreLouisCaron/a-tale-of-event-loops</a></p></blockquote><p>æˆ‘æœ€è¿‘è¢«ä¼¯å…‹åˆ©å¤§å­¦çš„ç ”ç©¶å‘˜Nathaniel J. Smithå…³äº <a href="https://docs.python.org/3/library/asyncio.html" target="_blank" rel="noopener">asyncio</a> çš„æƒŠäººè§è§£æ‰€å›°ã€‚ä»–çš„æ–‡ç« ã€Šå…³äºåasync/awaitä¸–ç•Œä¸­å¼‚æ­¥APIè®¾è®¡çš„ä¸€äº›æƒ³æ³•ã€‹( <a href="https://vorpus.org/blog/some-thoughts-on-asynchronous-api-design-in-a-post-asyncawait-world/" target="_blank" rel="noopener">Some thoughts on asynchronous API design in a post-async/await world</a>) ä½¿å¾—æˆ‘ åœ¨æœ€è¿‘å¤§é‡ä½¿ç”¨asyncioåï¼Œå¯¹å®ƒæœ‰äº†ä¸€äº›ï¼ˆç•¥ï¼‰å¤æ‚çš„æ„Ÿå—ã€‚</p><p>è™½ç„¶è¿™æˆ–å¤šæˆ–å°‘æ˜¯ä»–æ–‡ç« çš„é‡ç‚¹ï¼Œä½†ä»–è®¤ä¸º <a href="https://github.com/dabeaz/curio" target="_blank" rel="noopener">curio</a> çš„å®ç°æ¯”asyncioç®€å•å¾—å¤šï¼Œå› ä¸ºå®ƒé¢„å…ˆå‡å®šä½ æœ‰ä¸€ä¸ªå®ç°<a href="https://www.python.org/dev/peps/pep-0492/" target="_blank" rel="noopener">PEP 492</a>ï¼ˆ<code>async</code>å’Œ<code>await</code>å…³é”®å­—ï¼‰çš„Pythonç‰ˆæœ¬ã€‚</p><p>æˆ‘å¾ˆæ„Ÿå…´è¶£ï¼Œçœ‹äº†ä¸€ä¸‹curioçš„æºä»£ç ï¼Œâ€¦ç”±äºå®ƒè·å¾—äº†å¾ˆå¤šåŠŸèƒ½ï¼ˆæœ‰å¸Œæœ›ä½¿å®ƒæ›´æ¥è¿‘äºä¸€ä¸ªå¯ç”Ÿäº§çš„åº“ï¼‰ï¼Œæˆ‘è®¤ä¸ºå®ƒç°åœ¨å·²ç»æ‹¥æœ‰è¶³å¤Ÿçš„åŠŸèƒ½ï¼Œä¸»è¦çš„æœ¬è´¨å·²ç»è¢«æ·¡åŒ–ã€‚è¿™ç»å¯¹ä¸æ˜¯ä¸€ä»¶åäº‹ï¼Œä½†å¦‚æœæ˜¯åƒæˆ‘ä¸€æ ·ï¼Œæƒ³äº†è§£Nathanielåœ¨è¯´ä»€ä¹ˆï¼Œå¹¶å­¦ä¹ ä¸€äº›æ•´æ´çš„PythonæŠ€å·§çš„è¯ï¼Œé˜…è¯»curioçš„æºä»£ç å‡ ä¹ä¸æ˜¯ä¸€ä¸ªå¥½çš„èµ·ç‚¹ã€‚</p><p>Pythonæ ¸å¿ƒå¼€å‘äººå‘˜Brett Cannonåœ¨ä»–çš„å¸–å­ã€Š<a href="http://www.snarky.ca/how-the-heck-does-async-await-work-in-python-3-5" target="_blank" rel="noopener">How the heck does async/await work in Python 3.5?</a>ã€‹ä¸­æä¾›äº†ä¸€äº›å…³äºå¦‚ä½•ä½¿ç”¨åç¨‹å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœä½ æ­£åœ¨å®ç°äº‹ä»¶å¾ªç¯ï¼‰éå¸¸å¥½çš„è§è§£ï¼Œä»–çš„é‡ç‚¹æ˜¯å®ç°ç»†èŠ‚ï¼Œè‡³å°‘å¯¹æˆ‘æ¥è¯´ï¼Œè¦æ‘¸æ¸…coroutineè¿˜æ˜¯ç¼ºå°‘ä¸€å°å—ã€‚</p><p>TL; DR: è¿™æ˜¯æˆ‘è¯•å›¾æŠ“ä½curioæ‰€åŸºäºçš„æ ¸å¿ƒåŸºæœ¬åŸç†çš„å°è¯•ã€‚å¸Œæœ›å®ƒèƒ½æˆä¸ºç†Ÿæ‚‰curioæºä»£ç çš„ä¸€ä¸ªå¥½çš„å«è„šçŸ³ã€‚</p><p>è®©æˆ‘ä»¬å¼€å§‹å§ ğŸ˜ƒ</p><h2 id="åç¨‹çš„æœ¬è´¨"><a class="markdownIt-Anchor" href="#åç¨‹çš„æœ¬è´¨"></a> åç¨‹çš„æœ¬è´¨</h2><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å½“è°ƒç”¨ä¸€ä¸ªåç¨‹æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p><p><strong>æç¤º</strong>ï¼šä½ å¾—åˆ°ä¸€ä¸ª â€œcoroutineå¯¹è±¡â€ï¼Œå®ƒæœ‰ä¸€ä¸ª<code>.send()</code>å’Œä¸€ä¸ª<code>.throw()</code>æ–¹æ³•ï¼Œå°±åƒç”Ÿæˆå™¨å¯¹è±¡é‚£æ ·ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'Hello, %s!'</span> % (name,))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coro = hello(<span class="string">'world'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(coro)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">coroutine</span>'&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">type</span><span class="params">(coro.send)</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">builtin_function_or_method</span>'&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">type</span><span class="params">(coro.throw)</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">builtin_function_or_method</span>'&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt;</span></span><br><span class="line"><span class="class">...</span></span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œä½ é€šå¸¸ä¸ä¼šä½¿ç”¨è¿™äº›æ–¹æ³•ï¼Œå› ä¸ºå®ƒä»¬éšè—åœ¨<code>await coro</code>å’Œ<code>asyncio.get_event_loop().run_until_complete()</code>åé¢ï¼Œä½†æ—¢ç„¶æˆ‘ä»¬æƒ³ç ”ç©¶å®ƒçš„å·¥ä½œåŸç†â€¦ ğŸ˜ƒ</p><p>è¯·æ³¨æ„ï¼Œä¸Šé¢çš„ä»£ç ä»æ¥æ²¡æœ‰æ‰“å°è¿‡æˆ‘ä»¬çš„ <code>&quot;Hello, world!&quot;</code>ä¿¡æ¯ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä»æœªåœ¨coroutineå‡½æ•°ä¸­å®é™…æ‰§è¡Œè¿‡è¯­å¥â€”â€”æˆ‘ä»¬åªæ˜¯åˆ›å»ºäº†coroutineå¯¹è±¡ã€‚äº‹å®ä¸Šï¼Œå¦‚æœä½ åœ¨è§£é‡Šå™¨ä¸­å®é™…è¿è¡Œè¿™æ®µä»£ç ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªè­¦å‘Šï¼Œè¯´æ˜æˆ‘ä»¬çš„hello coroutineä»æœªå®Œæˆã€‚</p><p>å¦‚æœä½ æƒ³æ‰§è¡Œcoroutineå‡½æ•°ï¼Œä½ éœ€è¦ä»¥æŸç§æ–¹å¼å®‰æ’å®ƒã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†è°ƒç”¨<code>.send()</code>æ–¹æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'Hello, %s!'</span> % (name,))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>task = hello(<span class="string">'world'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>    task.send(<span class="keyword">None</span>)</span><br><span class="line"><span class="meta">... </span><span class="keyword">except</span> StopIteration:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line">Hello, world!</span><br></pre></td></tr></table></figure><p>å°±åƒç”Ÿæˆå™¨å¯¹è±¡ä¸€æ ·ï¼Œä¸€ä¸ªåç¨‹å¯¹è±¡çš„<code>.send()</code>æ–¹æ³•åœ¨åç¨‹ç»“æŸæ—¶å¼•å‘<code>StopIteration</code>äº‹ä»¶ã€‚</p><p>æˆ‘ä»¬å°†åœ¨åé¢çœ‹åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨.send()æ–¹æ³•åœ¨ç¬¬äºŒæ¬¡ã€ç¬¬ä¸‰æ¬¡æˆ–ç¬¬Næ¬¡è°ƒç”¨<code>.send()</code>æ–¹æ³•é‡æ–°å¼€å§‹æ—¶å°†ä¿¡æ¯ä¼ é€’ç»™coroutineã€‚</p><p>å¦‚æœè¯¥å¾ªç¯ç¨‹åºæ²¡æœ‰æ­£å¸¸è¿”å›ï¼Œè€Œæ˜¯å‡ºç°äº†å¼‚å¸¸ï¼Œé‚£ä¹ˆè¯¥å¼‚å¸¸å°†é€šè¿‡<code>.send()</code>ä¼ æ’­å›æ¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">HelloException</span><span class="params">(Exception)</span>:</span></span><br><span class="line"><span class="meta">... </span>   <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line"><span class="meta">... </span>       self._name = name</span><br><span class="line"><span class="meta">... </span>   <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>       <span class="keyword">return</span> <span class="string">'Hello, %s!'</span> % (self._name,)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">raise</span> HelloException(name)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>task = hello(<span class="string">'world'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>    task.send(<span class="keyword">None</span>)</span><br><span class="line"><span class="meta">... </span><span class="keyword">except</span> Exception <span class="keyword">as</span> error:</span><br><span class="line"><span class="meta">... </span>    <span class="comment"># NEW: exception will be propagated here!</span></span><br><span class="line"><span class="meta">... </span>    print(error)</span><br><span class="line">Hello, world!</span><br></pre></td></tr></table></figure><p>æˆ‘è¿˜æåˆ°äº†ä¸€ä¸ª<code>.throw()</code>æ–¹æ³•ã€‚å’Œ<code>.send()</code>ä¸€æ ·ï¼Œå®ƒæ¢å¤äº†åç¨‹ï¼Œä½†å®ƒä¸æ˜¯ä¼ é€’ä¸€ä¸ªå€¼ï¼Œè€Œæ˜¯åœ¨åç¨‹ä¸­çš„æš‚åœç‚¹å¼•å‘ä¸€ä¸ªå¼‚å¸¸ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Hello</span><span class="params">(Exception)</span>:</span></span><br><span class="line"><span class="meta">... </span>   <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line"><span class="meta">... </span>       self._name = name</span><br><span class="line"><span class="meta">... </span>   <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>       <span class="keyword">return</span> <span class="string">'Hello, %s!'</span> % (self._name,)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>task = hello()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="comment"># NEW: inject exception.</span></span><br><span class="line"><span class="meta">... </span>    task.throw(Hello(<span class="string">'world'</span>))</span><br><span class="line"><span class="meta">... </span><span class="keyword">except</span> Exception <span class="keyword">as</span> error:</span><br><span class="line"><span class="meta">... </span>    print(error)</span><br><span class="line">Hello, world!</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä½ åº”è¯¥å¯¹è¿™æ ·ä¸€ä¸ªäº‹å®æ„Ÿåˆ°æ»¡æ„ï¼šcoroutine å¯¹è±¡ä¸ç”Ÿæˆå™¨å¯¹è±¡éå¸¸éå¸¸ç›¸ä¼¼ï¼Œåè€…ä» Python 2.2 (<a href="https://www.python.org/dev/peps/pep-0255/" target="_blank" rel="noopener">PEP 255</a>) å¼€å§‹å°±å­˜åœ¨ï¼Œå¹¶ä¸”ä» Python 2.5 (<a href="https://www.python.org/dev/peps/pep-0342/" target="_blank" rel="noopener">PEP 342</a>) å¼€å§‹å°±æœ‰ <code>.send()</code>å’Œ <code>.throw()</code>æ–¹æ³•ã€‚</p><h2 id="ä¸äº‹ä»¶å¾ªç¯çš„å¯¹è¯"><a class="markdownIt-Anchor" href="#ä¸äº‹ä»¶å¾ªç¯çš„å¯¹è¯"></a> ä¸äº‹ä»¶å¾ªç¯çš„å¯¹è¯</h2><p>å¦‚æœä½ ä»”ç»†è§‚å¯Ÿï¼ˆæˆ–å°è¯•ï¼‰ï¼Œä½ ä¼šå‘ç°ï¼Œä¸ç”Ÿæˆå™¨å‡½æ•°ç›¸åï¼Œcoroutineå‡½æ•°ä¸èƒ½ä½¿ç”¨<code>yield</code>è¡¨è¾¾å¼ã€‚è¿™å°±æå‡ºäº†ï¼ˆè€Œä¸æ˜¯ <a href="http://grammarist.com/usage/begging-the-question-usage/" target="_blank" rel="noopener">begs</a>ï¼‰ä¸€ä¸ªé—®é¢˜ï¼šåˆ°åº•æ€æ ·æ‰èƒ½è®©coroutineå‡½æ•°å°†æ§åˆ¶æƒäº¤è¿˜ç»™è°ƒç”¨<code>.send()</code>çš„ä»£ç ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯åœ¨ä¸€ä¸ª<em>awaitalbe</em>å¯¹è±¡ä¸Šä½¿ç”¨<code>await</code>ã€‚å¯¹äºä¸€ä¸ªå¯¹è±¡æ¥è¯´ï¼Œå®ƒå¿…é¡»å®ç°ç‰¹æ®Šçš„<code>__await__()</code>æ–¹æ³•ï¼Œä»¥è¿”å›ä¸€ä¸ªiterableå¯¹è±¡ã€‚åœ¨å®è·µä¸­ï¼Œè¿™æœ‰ç‚¹å°´å°¬ï¼Œæ‰€ä»¥åœ¨æ ‡å‡†åº“ä¸­æœ‰ä¸€ä¸ª<code>@types.coroutine</code>è£…é¥°å™¨ï¼Œå…è®¸ä½ ä»¥ä¸€ç§ç±»ä¼¼<code>@contextlib.contextmanager</code>çš„é£æ ¼æ¥åˆ›å»ºawaitableå¯¹è±¡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> types <span class="keyword">import</span> coroutine</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># NEW: this is an awaitable object!</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@coroutine</span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">nice</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="comment"># NEW: this makes ``.send()`` return!</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">await</span> nice()</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'Hello, %s!'</span> % (name,))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>task = hello(<span class="string">'world'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># NEW: call send twice!</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>task.send(<span class="keyword">None</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>    task.send(<span class="keyword">None</span>)</span><br><span class="line"><span class="meta">... </span><span class="keyword">except</span> StopIteration:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line">Hello, world!</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œæˆ‘ä»¬çš„<code>nice()</code>å¯¹è±¡æ˜¯éå¸¸æ— ç”¨çš„ã€‚åˆ«ç€æ€¥ï¼Œæˆ‘ä»¬å¾ˆå¿«å°±ä¼šåšä¸€äº›æ›´æœ‰ç”¨çš„äº‹æƒ…ã€‚</p><h2 id="looping"><a class="markdownIt-Anchor" href="#looping"></a> Looping</h2><p>æˆ‘ä»¬å‰é¢çš„ä¾‹å­æ­£å¥½è°ƒç”¨<code>.send()</code>ä¸¤æ¬¡ï¼Œå› ä¸ºå®ƒçŸ¥é“<code>hello()</code>åªäº§ç”Ÿä¸€æ¬¡æ§åˆ¶ã€‚å½“æˆ‘ä»¬ä¸çŸ¥é“æ—¶ï¼ˆå¸¸è§çš„æƒ…å†µï¼‰ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒæ”¾åœ¨ä¸€ä¸ªå¾ªç¯ä¸­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> types <span class="keyword">import</span> coroutine</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@coroutine</span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">nice</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="comment"># NEW: yield many times!</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">await</span> nice()</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'Hello, %s!'</span> % (name,))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>task = hello(<span class="string">'world'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="comment"># NEW: loop!</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line"><span class="meta">... </span>        task.send(<span class="keyword">None</span>)</span><br><span class="line"><span class="meta">... </span><span class="keyword">except</span> StopIteration:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line">Hello, world!</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€æ¸å¼€å§‹å¾—åˆ°äº†ä¸€äº›æœ€ç®€å•çš„å®ç°ï¼Œå…¶ç±»ä¼¼äº<code>asyncio.get_event_loop().run_until_complete()</code>ã€‚æ‰€ä»¥æˆ‘ä»¬è®©å®ƒåœ¨è¯­æ³•ä¸Šæ›´åŠ ç›¸ä¼¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> types <span class="keyword">import</span> coroutine</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@coroutine</span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">nice</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">await</span> nice()</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'Hello, %s!'</span> % (name,))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># NEW: now a reusable function!</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">run_until_complete</span><span class="params">(task)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line"><span class="meta">... </span>            task.send(<span class="keyword">None</span>)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">except</span> StopIteration:</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">pass</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># NEW: call it as a function!</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>run_until_complete(hello(<span class="string">'world'</span>))</span><br><span class="line">Hello, world!</span><br></pre></td></tr></table></figure><h2 id="ç”Ÿæˆå­ä»»åŠ¡"><a class="markdownIt-Anchor" href="#ç”Ÿæˆå­ä»»åŠ¡"></a> ç”Ÿæˆå­ä»»åŠ¡</h2><p>ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªå¯ä»¥å®Œæˆå•ä¸ªä»»åŠ¡çš„äº‹ä»¶å¾ªç¯ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³å¼€å§‹åšä¸€äº›æœ‰ç”¨çš„äº‹æƒ…ã€‚æˆ‘ä»¬æœŸæœ›åšè®¸å¤šä¸åŒçš„äº‹æƒ…ï¼Œä½†ç”±äºè¿™æ˜¯å…³äºå¹¶å‘çš„ï¼Œè®©æˆ‘ä»¬ä»å…è®¸åˆ›å»ºå­ä»»åŠ¡å¼€å§‹ã€‚</p><p>æˆ‘ä»¬åœ¨è¿™é‡Œéœ€è¦åšçš„ä¸»è¦äº‹æƒ…æ˜¯å¼•å…¥ä¸€ä¸ªæ–°çš„åŸè¯­<code>spawn()</code>ï¼Œç”¨äºå®‰æ’æ–°çš„å­ä»»åŠ¡ã€‚ä¸€æ—¦ä»»åŠ¡è¢«å®‰æ’å¥½ï¼Œæˆ‘ä»¬è¦æŠŠæ§åˆ¶æƒè¿”å›ç»™çˆ¶ä»»åŠ¡ï¼Œè¿™æ ·å®ƒå°±å¯ä»¥ç»§ç»­å‰è¿›äº†ã€‚</p><p><strong>æ³¨æ„</strong>ï¼šè¿™ä¸ªä¾‹å­æ˜¯æ•…æ„ä¸å®Œæ•´çš„ã€‚æˆ‘ä»¬ä»¥åä¼šçœ‹åˆ°å¦‚ä½•joinä»»åŠ¡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> inspect <span class="keyword">import</span> iscoroutine</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> types <span class="keyword">import</span> coroutine</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># NEW: awaitable object that sends a request to launch a child task!</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@coroutine</span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">spawn</span><span class="params">(task)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span> task</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">await</span> nice()</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'Hello, %s!'</span> % (name,))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># NEW: parent task!</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>     <span class="comment"># NEW: create a child task!</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">await</span> spawn(hello(<span class="string">'world'</span>))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">run_until_complete</span><span class="params">(task)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="comment"># NEW: schedule the "root" task.</span></span><br><span class="line"><span class="meta">... </span>    tasks = [(task, <span class="keyword">None</span>)]</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">while</span> tasks:</span><br><span class="line"><span class="meta">... </span>        <span class="comment"># NEW: round-robin between a set tasks (we may now have more</span></span><br><span class="line"><span class="meta">... </span>        <span class="comment">#      than one and we'd like to be as "fair" as possible).</span></span><br><span class="line"><span class="meta">... </span>        queue, tasks = tasks, []</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">for</span> task, data <span class="keyword">in</span> queue:</span><br><span class="line"><span class="meta">... </span>            <span class="comment"># NEW: resume the task *once*.</span></span><br><span class="line"><span class="meta">... </span>            <span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>                data = task.send(data)</span><br><span class="line"><span class="meta">... </span>            <span class="keyword">except</span> StopIteration:</span><br><span class="line"><span class="meta">... </span>                <span class="keyword">pass</span></span><br><span class="line"><span class="meta">... </span>            <span class="keyword">except</span> Exception <span class="keyword">as</span> error:</span><br><span class="line"><span class="meta">... </span>                <span class="comment"># NEW: prevent crashed task from ending the loop.</span></span><br><span class="line"><span class="meta">... </span>                print(error)</span><br><span class="line"><span class="meta">... </span>            <span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>                <span class="comment"># NEW: schedule the child task.</span></span><br><span class="line"><span class="meta">... </span>                <span class="keyword">if</span> iscoroutine(data):</span><br><span class="line"><span class="meta">... </span>                    tasks.append((data, <span class="keyword">None</span>))</span><br><span class="line"><span class="meta">... </span>                <span class="comment"># NEW: reschedule the parent task.</span></span><br><span class="line"><span class="meta">... </span>                tasks.append((task, <span class="keyword">None</span>))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>run_until_complete(main())</span><br><span class="line">Hello, world!</span><br></pre></td></tr></table></figure><p><strong>å“‡</strong>! è¿™æ¯”æˆ‘ä»¬ä¹‹å‰ç‰ˆæœ¬çš„<code>run_until_complete()</code>è¦å¤æ‚å¾—å¤šã€‚è¿™äº›éƒ½æ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿ</p><p>å¥½å§â€¦ç°åœ¨æˆ‘ä»¬å¯ä»¥è¿è¡Œå¤šä¸ªä»»åŠ¡äº†ï¼Œæˆ‘ä»¬éœ€è¦æ‹…å¿ƒçš„äº‹æƒ…åŒ…æ‹¬:</p><ol><li>ç­‰å¾…æ‰€æœ‰çš„å­ä»»åŠ¡å®Œæˆï¼ˆé€’å½’ï¼‰ï¼Œå°½ç®¡ä»»ä½•ä»»åŠ¡éƒ½æœ‰é”™è¯¯</li><li>åœ¨ä»»åŠ¡ä¹‹é—´äº¤æ›¿è¿›è¡Œï¼Œè®©æ‰€æœ‰çš„ä»»åŠ¡åŒæ—¶å®Œæˆ</li></ol><p>æ³¨æ„ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªåµŒå¥—å¾ªç¯ã€‚</p><ul><li>å¤–å¾ªç¯è´Ÿè´£æ£€æŸ¥æˆ‘ä»¬æ˜¯å¦å®Œæˆäº†ä»»åŠ¡</li><li>å†…å¾ªç¯è´Ÿè´£å¤„ç†ä¸€æ¬¡è°ƒåº¦å™¨çš„ â€œtickâ€ï¼ˆå€’è®¡æ—¶å®Œæˆï¼‰ã€‚</li></ul><p>è¿˜æœ‰å…¶ä»–æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œè€Œä¸”æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è¿™æ ·åšå¯èƒ½ä¸æ˜¯å¾ˆæ˜æ˜¾ï¼Œä½†è¿™å¾ˆé‡è¦ï¼Œå› ä¸ºäº‹ä»¶å¾ªç¯ä¸­è¿˜ç¼ºå°‘ä¸¤ä¸ªå…³é”®éƒ¨åˆ†ï¼šå®šæ—¶å™¨å’ŒI/Oã€‚å½“æˆ‘ä»¬ä»¥åå¢åŠ å¯¹è¿™äº›çš„æ”¯æŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä»¥ä¸€ç§ &quot;å…¬å¹³ &quot;çš„æ–¹å¼æ¥å®‰æ’å†…éƒ¨æ£€æŸ¥ã€‚å¤–å¾ªç¯ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ£€æŸ¥è®¡æ—¶å™¨å’Œè½®è¯¢I/Oæ“ä½œçŠ¶æ€çš„æ–¹ä¾¿ä½ç½®ã€‚</p><ol><li>æ£€æŸ¥å®šæ—¶å™¨ï¼Œæ¢å¤å·²ç»è¿‡äº†å»¶è¿ŸæœŸçš„ç¡çœ ä»»åŠ¡ã€‚</li><li>æ£€æŸ¥I/Oæ“ä½œï¼Œå®‰æ’é‚£äº›å¾…å®šI/Oæ“ä½œå·²ç»å®Œæˆçš„ä»»åŠ¡ã€‚</li><li>æ‰§è¡Œä¸€æ¬¡è°ƒåº¦å™¨çš„&quot;tick&quot;ï¼Œä»¥æ¢å¤æˆ‘ä»¬åˆšåˆšè°ƒåº¦çš„æ‰€æœ‰ä»»åŠ¡ã€‚</li></ol><p>ç®€è€Œè¨€ä¹‹ï¼Œè¿™å°±æ˜¯åŸºäºcoroutineçš„è°ƒåº¦å™¨å¾ªç¯çš„è¦ç‚¹ã€‚</p><p><strong>ç„¶è€Œ</strong>ï¼Œåœ¨æˆ‘ä»¬è¿›å…¥æ›´å¤æ‚çš„å®šæ—¶å™¨å’ŒI/Oä¹‹å‰â€¦è¿˜è®°å¾—æˆ‘åœ¨å‰é¢æåˆ°è¿™ä¸ªä¾‹å­æ˜¯æ•…æ„ä¸å®Œæ•´çš„å—ï¼Ÿæˆ‘ä»¬çŸ¥é“å¦‚ä½•ç”Ÿæˆæ–°çš„å­ä»»åŠ¡ï¼Œä½†æˆ‘ä»¬è¿˜ä¸çŸ¥é“å¦‚ä½•ç­‰å¾…å®ƒä»¬å®Œæˆã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æœºä¼šæ¥å­¦ä¹ å¦‚ä½•æ‰©å±•ï¼Œç”±æˆ‘ä»¬çš„awaitableå¯¹è±¡å‘é€äº‹ä»¶å¾ªç¯ &quot;è¯·æ±‚&quot;çš„è¯æ±‡è¡¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> types <span class="keyword">import</span> coroutine</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@coroutine</span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">nice</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@coroutine</span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">spawn</span><span class="params">(task)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="comment"># NEW: recover the child task handle to pass it back to the parent.</span></span><br><span class="line"><span class="meta">... </span>    child = <span class="keyword">yield</span> (<span class="string">'spawn'</span>, task)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> child</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># NEW: awaitable object that sends a request to be notified when a</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment">#      concurrent task completes.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@coroutine</span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">join</span><span class="params">(task)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span> (<span class="string">'join'</span>, task)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">await</span> nice()</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'Hello, %s!'</span> % (name,))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="comment"># NEW: recover the child task handle.</span></span><br><span class="line"><span class="meta">... </span>    child = <span class="keyword">await</span> spawn(hello(<span class="string">'world'</span>))</span><br><span class="line"><span class="meta">... </span>    <span class="comment"># NEW: wait for the child task to complete.</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">await</span> join(child)</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'(after join)'</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">run_until_complete</span><span class="params">(task)</span>:</span></span><br><span class="line"><span class="meta">... </span>    tasks = [(task, <span class="keyword">None</span>)]</span><br><span class="line"><span class="meta">... </span>    <span class="comment"># NEW: keep track of tasks to resume when a task completes.</span></span><br><span class="line"><span class="meta">... </span>    watch = defaultdict(list)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">while</span> tasks:</span><br><span class="line"><span class="meta">... </span>        queue, tasks = tasks, []</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">for</span> task, data <span class="keyword">in</span> queue:</span><br><span class="line"><span class="meta">... </span>            <span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>                data = task.send(data)</span><br><span class="line"><span class="meta">... </span>            <span class="keyword">except</span> StopIteration:</span><br><span class="line"><span class="meta">... </span>                <span class="comment"># NEW: wait up tasks waiting on this one.</span></span><br><span class="line"><span class="meta">... </span>                tasks.extend((t, <span class="keyword">None</span>) <span class="keyword">for</span> t <span class="keyword">in</span> watch.pop(task, []))</span><br><span class="line"><span class="meta">... </span>            <span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>                <span class="comment"># NEW: dispatch request sent by awaitable object since</span></span><br><span class="line"><span class="meta">... </span>                <span class="comment">#      we now have 3 different types of requests.</span></span><br><span class="line"><span class="meta">... </span>                <span class="keyword">if</span> data <span class="keyword">and</span> data[<span class="number">0</span>] == <span class="string">'spawn'</span>:</span><br><span class="line"><span class="meta">... </span>                    tasks.append((data[<span class="number">1</span>], <span class="keyword">None</span>))</span><br><span class="line"><span class="meta">... </span>                    tasks.append((task, data[<span class="number">1</span>]))</span><br><span class="line"><span class="meta">... </span>                <span class="keyword">elif</span> data <span class="keyword">and</span> data[<span class="number">0</span>] == <span class="string">'join'</span>:</span><br><span class="line"><span class="meta">... </span>                    watch[data[<span class="number">1</span>]].append(task)</span><br><span class="line"><span class="meta">... </span>                <span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>                    tasks.append((task, <span class="keyword">None</span>))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>run_until_complete(main())</span><br><span class="line">Hello, world!</span><br><span class="line">(after join)</span><br></pre></td></tr></table></figure><p>ç”±äºå®é™…åŸå› ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›æœ‰æŸç§TaskåŒ…è£…å™¨ç”¨äºcoroutineå¯¹è±¡ã€‚è¿™å¯¹äºæš´éœ²cancleçš„APIå’Œå¤„ç†ä¸€äº›ç«äº‰æƒ…å†µæ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œæ¯”å¦‚å­ä»»åŠ¡åœ¨çˆ¶ä»»åŠ¡è¯•å›¾<code>join()</code>å®ƒä¹‹å‰å°±ç»“æŸäº†ï¼ˆä½ èƒ½å‘ç°è¿™ä¸ªbugå—ï¼Ÿï¼‰</p><p>å°†å­ä»»åŠ¡çš„è¿”å›å€¼ä½œä¸º<code>await join()</code> çš„ç»“æœä¼ å›ï¼Œå¹¶ä¼ æ’­ä½¿å­ä»»åŠ¡å´©æºƒçš„å¼‚å¸¸ï¼Œè¿™äº›éƒ½æ˜¯ç•™ç»™è¯»è€…çš„ç»ƒä¹ ã€‚</p><h2 id="sleeping-timers"><a class="markdownIt-Anchor" href="#sleeping-timers"></a> Sleeping &amp; timers</h2><p>ç°åœ¨æˆ‘ä»¬å·²ç»æ§åˆ¶äº†ä»»åŠ¡è°ƒåº¦ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹å¤„ç†ä¸€äº›æ›´é«˜çº§çš„ä¸œè¥¿ï¼Œæ¯”å¦‚å®šæ—¶å™¨å’ŒI/Oã€‚I/Oæ˜¯æœ€ç»ˆçš„ç›®æ ‡ï¼Œä½†å®ƒç‰µæ¶‰åˆ°å¾ˆå¤šæ–°çš„ä¸œè¥¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆçœ‹çœ‹å®šæ—¶å™¨ã€‚</p><p>å¦‚æœä½ éœ€è¦ä¼‘çœ Sleepï¼Œä½ ä¸èƒ½åªè°ƒç”¨<code>time.sleep()</code>ï¼Œå› ä¸ºä½ ä¼šé˜»å¡æ‰€æœ‰çš„ä»»åŠ¡ï¼Œè€Œä¸ä»…ä»…æ˜¯ä½ æƒ³æš‚åœçš„é‚£ä¸ªã€‚</p><p>ä½ ç°åœ¨å¯èƒ½å·²ç»å‘ç°äº†è¿™ä¸ªæ¨¡å¼ã€‚æˆ‘ä»¬å°†æ·»åŠ ä¸¤æ ·ä¸œè¥¿ã€‚</p><ol><li>ä¸€ç§æ–°çš„è¯·æ±‚ç±»å‹</li><li>ä¸€æ®µåŸºäº<code>task.send()</code>è¿”å›å€¼çš„è°ƒåº¦ä»£ç ã€‚</li></ol><p>æˆ‘ä»¬è¿˜å°†æ·»åŠ ä¸€äº›bookKeepingä»¥è·Ÿè¸ªé‚£äº›è¢«æš‚åœçš„ä»»åŠ¡ã€‚è¯·è®°ä½ï¼Œtasksæ˜¯ä¸€ä¸ªé¢„å®šåœ¨ä¸‹ä¸€ä¸ªtickä¸­è¿è¡Œçš„coroutineåˆ—è¡¨ï¼Œä½†æ²‰ç¡çš„ä»»åŠ¡åœ¨å‡†å¤‡å†æ¬¡è¿è¡Œä¹‹å‰å¯èƒ½ä¼šè·³è¿‡ä¸€ä¸ªæˆ–å¤šä¸ªtickã€‚</p><p>è¯·è®°ä½ï¼Œä¼‘çœ çš„ä»»åŠ¡ä¸å¤ªå¯èƒ½æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºé‡æ–°å®‰æ’ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€äº›æ›´è¿›åŒ–çš„ä¸œè¥¿ã€‚ç»´æŠ¤è®¡æ—¶å™¨ï¼Œæœ€å®ç”¨çš„æ–¹æ³•ï¼ˆç›´åˆ°ä½ å…è®¸å–æ¶ˆå®ƒä»¬ï¼‰æ˜¯ä½¿ç”¨ä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œæ„Ÿè°¢æ ‡å‡†åº“çš„ <a href="https://docs.python.org/3.5/library/heapq.html" target="_blank" rel="noopener">heapq</a> æ¨¡å—ä½¿ä¹‹è¶…çº§ç®€å•ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> heapq <span class="keyword">import</span> heappop, heappush</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> time <span class="keyword">import</span> sleep <span class="keyword">as</span> _sleep</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> timeit <span class="keyword">import</span> default_timer</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> types <span class="keyword">import</span> coroutine</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># NEW: we need to keep track of elapsed time.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>clock = default_timer</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># NEW: request that the event loop reschedule us "later".</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@coroutine</span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">sleep</span><span class="params">(seconds)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span> (<span class="string">'sleep'</span>, seconds)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># NEW: verify elapsed time matches our request.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></span><br><span class="line"><span class="meta">... </span>    ref = clock()</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">await</span> sleep(<span class="number">3.0</span>)</span><br><span class="line"><span class="meta">... </span>    now = clock()</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">assert</span> (now - ref) &gt;= <span class="number">3.0</span></span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'Hello, %s!'</span> % (name,))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">run_until_complete</span><span class="params">(task)</span>:</span></span><br><span class="line"><span class="meta">... </span>    tasks = [(task, <span class="keyword">None</span>)]</span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>    <span class="comment"># NEW: keep track of tasks that are sleeping.</span></span><br><span class="line"><span class="meta">... </span>    timers = []</span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>    <span class="comment"># NEW: watch out, all tasks might be suspended at the same time.</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">while</span> tasks <span class="keyword">or</span> timers:</span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>        <span class="comment"># NEW: if we have nothing to do for now, don't spin.</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">if</span> <span class="keyword">not</span> tasks:</span><br><span class="line"><span class="meta">... </span>            _sleep(max(<span class="number">0.0</span>, timers[<span class="number">0</span>][<span class="number">0</span>] - clock()))</span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>        <span class="comment"># NEW: schedule tasks when their timer has elapsed.</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">while</span> timers <span class="keyword">and</span> timers[<span class="number">0</span>][<span class="number">0</span>] &lt; clock():</span><br><span class="line"><span class="meta">... </span>            _, task = heappop(timers)</span><br><span class="line"><span class="meta">... </span>            tasks.append((task, <span class="keyword">None</span>))</span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>        queue, tasks = tasks, []</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">for</span> task, data <span class="keyword">in</span> queue:</span><br><span class="line"><span class="meta">... </span>            <span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>                data = task.send(data)</span><br><span class="line"><span class="meta">... </span>            <span class="keyword">except</span> StopIteration:</span><br><span class="line"><span class="meta">... </span>                <span class="keyword">pass</span></span><br><span class="line"><span class="meta">... </span>            <span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>                <span class="comment"># NEW: set a timer and don't reschedule right away.</span></span><br><span class="line"><span class="meta">... </span>                <span class="keyword">if</span> data <span class="keyword">and</span> data[<span class="number">0</span>] == <span class="string">'sleep'</span>:</span><br><span class="line"><span class="meta">... </span>                    heappush(timers, (clock() + data[<span class="number">1</span>], task))</span><br><span class="line"><span class="meta">... </span>                <span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>                    tasks.append((task, <span class="keyword">None</span>))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>run_until_complete(hello(<span class="string">'world'</span>))</span><br><span class="line">Hello, world!</span><br></pre></td></tr></table></figure><p>å“‡ï¼Œæˆ‘ä»¬çœŸçš„æŒæ¡äº†è¿™ä¸ªçªé—¨! ä¹Ÿè®¸è¿™ä¸ªå¼‚æ­¥çš„ä¸œè¥¿æ¯•ç«Ÿæ²¡æœ‰é‚£ä¹ˆéš¾ï¼Ÿ</p><p>è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬èƒ½ä¸ºI/Oåšä»€ä¹ˆ!</p><h2 id="å¤„ç†io"><a class="markdownIt-Anchor" href="#å¤„ç†io"></a> å¤„ç†I/O</h2><p>ç°åœ¨æˆ‘ä»¬å·²ç»ç»å†äº†æ‰€æœ‰å…¶ä»–çš„äº‹æƒ…ï¼Œæ˜¯æ—¶å€™è¿›è¡Œç»ˆæå¯¹å†³äº†ï¼šI/Oã€‚</p><p>å¯ä¼¸ç¼©çš„ I/O é€šå¸¸ä½¿ç”¨native Cçš„APIs æ¥å®ç° I/O çš„å¤ç”¨ã€‚é€šå¸¸ï¼Œè¿™æ˜¯ I/O åº“ä¸­æœ€å›°éš¾çš„éƒ¨åˆ†ï¼Œä½†å€¼å¾—åº†å¹¸çš„æ˜¯ï¼ŒPython çš„ <a href="https://docs.python.org/3/library/selectors.html" target="_blank" rel="noopener">selectors</a> æ¨¡å—ä½¿å…¶éå¸¸å®¹æ˜“å®ç°ã€‚</p><p>è‡³äºåˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬æ·»åŠ çš„æ‰€æœ‰å…¶ä»–æ“ä½œï¼Œæˆ‘ä»¬å°†åœ¨äº‹ä»¶å¾ªç¯ä¸­æ·»åŠ ä¸€äº›æ–°çš„I/Oè¯·æ±‚å’Œç›¸åº”çš„è¯·æ±‚å¤„ç†ç¨‹åºã€‚å¦å¤–ï¼Œåƒè®¡æ—¶å™¨ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸ªè°ƒåº¦å™¨çš„å¼€å§‹é˜¶æ®µåšä¸€äº›å†…éƒ¨æ£€æŸ¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> selectors <span class="keyword">import</span> (</span><br><span class="line"><span class="meta">... </span>    DefaultSelector,</span><br><span class="line"><span class="meta">... </span>    EVENT_READ,</span><br><span class="line"><span class="meta">... </span>    EVENT_WRITE,</span><br><span class="line"><span class="meta">... </span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> socket <span class="keyword">import</span> socketpair <span class="keyword">as</span> _socketpair</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> types <span class="keyword">import</span> coroutine</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># NEW: request that the event loop tell us when we can read.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@coroutine</span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">recv</span><span class="params">(stream, size)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span> (EVENT_READ, stream)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> stream.recv(size)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># NEW: request that the event loop tell us when we can write.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@coroutine</span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">send</span><span class="params">(stream, data)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">while</span> data:</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">yield</span> (EVENT_WRITE, stream)</span><br><span class="line"><span class="meta">... </span>        size = stream.send(data)</span><br><span class="line"><span class="meta">... </span>        data = data[size:]</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># NEW: connect sockets, make sure they never, ever block the loop.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@coroutine</span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">socketpair</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>    lhs, rhs = _socketpair()</span><br><span class="line"><span class="meta">... </span>    lhs.setblocking(<span class="keyword">False</span>)</span><br><span class="line"><span class="meta">... </span>    rhs.setblocking(<span class="keyword">False</span>)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> lhs, rhs</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># NEW: send a message through the socket pair.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></span><br><span class="line"><span class="meta">... </span>    lhs, rhs = <span class="keyword">await</span> socketpair()</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">await</span> send(lhs, <span class="string">'Hello, world!'</span>.encode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="meta">... </span>    data = <span class="keyword">await</span> recv(rhs, <span class="number">1024</span>)</span><br><span class="line"><span class="meta">... </span>    print(data.decode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="meta">... </span>    lhs.close()</span><br><span class="line"><span class="meta">... </span>    rhs.close()</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">run_until_complete</span><span class="params">(task)</span>:</span></span><br><span class="line"><span class="meta">... </span>    tasks = [(task, <span class="keyword">None</span>)]</span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>    <span class="comment"># NEW: prepare for I/O multiplexing.</span></span><br><span class="line"><span class="meta">... </span>    selector = DefaultSelector()</span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>    <span class="comment"># NEW: watch out, all tasks might be suspended at the same time.</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">while</span> tasks <span class="keyword">or</span> selector.get_map():</span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>        <span class="comment"># NEW: poll I/O operation status and resume tasks when ready.</span></span><br><span class="line"><span class="meta">... </span>        timeout = <span class="number">0.0</span> <span class="keyword">if</span> tasks <span class="keyword">else</span> <span class="keyword">None</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">for</span> key, events <span class="keyword">in</span> selector.select(timeout):</span><br><span class="line"><span class="meta">... </span>            tasks.append((key.data, <span class="keyword">None</span>))</span><br><span class="line"><span class="meta">... </span>            selector.unregister(key.fileobj)</span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>        queue, tasks = tasks, []</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">for</span> task, data <span class="keyword">in</span> queue:</span><br><span class="line"><span class="meta">... </span>            <span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>                data = task.send(data)</span><br><span class="line"><span class="meta">... </span>            <span class="keyword">except</span> StopIteration:</span><br><span class="line"><span class="meta">... </span>                <span class="keyword">pass</span></span><br><span class="line"><span class="meta">... </span>            <span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>                <span class="comment"># NEW: register for I/O and suspend the task.</span></span><br><span class="line"><span class="meta">... </span>                <span class="keyword">if</span> data <span class="keyword">and</span> data[<span class="number">0</span>] == EVENT_READ:</span><br><span class="line"><span class="meta">... </span>                    selector.register(data[<span class="number">1</span>], EVENT_READ, task)</span><br><span class="line"><span class="meta">... </span>                <span class="keyword">elif</span> data <span class="keyword">and</span> data[<span class="number">0</span>] == EVENT_WRITE:</span><br><span class="line"><span class="meta">... </span>                    selector.register(data[<span class="number">1</span>], EVENT_WRITE, task)</span><br><span class="line"><span class="meta">... </span>                <span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>                    tasks.append((task, <span class="keyword">None</span>))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>run_until_complete(hello(<span class="string">'world'</span>))</span><br><span class="line">Hello, world!</span><br></pre></td></tr></table></figure><h2 id="å–æ¶ˆä»»åŠ¡"><a class="markdownIt-Anchor" href="#å–æ¶ˆä»»åŠ¡"></a> å–æ¶ˆä»»åŠ¡</h2><p>æœ€åï¼Œä½†ä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€å—æ‹¼å›¾æ˜¯â€”â€”å–æ¶ˆä»»åŠ¡ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬åˆ©ç”¨coroutineå¯¹è±¡çš„<code>.throw()</code>æ–¹æ³•çš„åœ°æ–¹ã€‚</p><p>ç”±äºå–æ¶ˆä»»åŠ¡æœ‰ä¸€ä¸ªç«äº‰æ¡ä»¶ï¼ˆå®ƒå¯èƒ½ä¸å°è¯•å–æ¶ˆä»»åŠ¡åŒæ—¶å®Œæˆï¼‰ï¼Œæ‰€ä»¥éœ€è¦è·Ÿè¸ªæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ï¼Œä»¥äº†è§£å®ƒä»¬çš„ â€œçŠ¶æ€â€ã€‚</p><p>å¦åˆ™ï¼Œå®ƒå°±æ˜¯ä»»åŠ¡ç”Ÿæˆå’ŒåŠ å…¥çš„ç®€å•æ‰©å±•ã€‚</p><p><strong>æ³¨æ„</strong>ï¼šè¿™ä¸ªå®ç°æ˜¯æ•…æ„ä¸å®Œæ•´çš„ã€‚å®ƒæ²¡æœ‰æ­£ç¡®å¤„ç†å–æ¶ˆä¸€ä¸ªå·²ç»å®‰æ’åœ¨ä¸‹ä¸€ä¸ªtickä¸­è¿è¡Œçš„ä»»åŠ¡çš„å¯èƒ½æ€§ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> inspect <span class="keyword">import</span> iscoroutine</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> types <span class="keyword">import</span> coroutine</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@coroutine</span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">spawn</span><span class="params">(task)</span>:</span></span><br><span class="line"><span class="meta">... </span>    task = <span class="keyword">yield</span> (<span class="string">'spawn'</span>, task)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> task</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@coroutine</span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">join</span><span class="params">(task)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span> (<span class="string">'join'</span>, task)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># NEW: exception to be raised inside tasks when they are cancelled.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">CancelledError</span><span class="params">(Exception)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># NEW: request that CancelledError be raised inside the task.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@coroutine</span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">cancel</span><span class="params">(task)</span>:</span></span><br><span class="line"><span class="meta">... </span>    cancelled = <span class="keyword">yield</span> (<span class="string">'cancel'</span>, task, CancelledError())</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">assert</span> cancelled <span class="keyword">is</span> <span class="keyword">True</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># NEW: pause the task without plans to reschedule it (this is simply to</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment">#      guarantee execution order in this demo).</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@coroutine</span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">suspend</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span> (<span class="string">'suspend'</span>,)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">await</span> suspend()</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">except</span> CancelledError:</span><br><span class="line"><span class="meta">... </span>        print(<span class="string">'Hello, %s!'</span> % (name,))</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">raise</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># NEW: spawn a task and then cancel it.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>    child = <span class="keyword">await</span> spawn(hello(<span class="string">'world'</span>))</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">await</span> cancel(child)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">await</span> join(child)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">run_until_complete</span><span class="params">(task)</span>:</span></span><br><span class="line"><span class="meta">... </span>    tasks = [(task, <span class="keyword">None</span>)]</span><br><span class="line"><span class="meta">... </span>    watch = defaultdict(list)</span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>    <span class="comment"># NEW: keep track of all tasks in the tree.</span></span><br><span class="line"><span class="meta">... </span>    tree = &#123;task&#125;</span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">while</span> tasks:</span><br><span class="line"><span class="meta">... </span>        queue, tasks = tasks, []</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">for</span> task, data <span class="keyword">in</span> queue:</span><br><span class="line"><span class="meta">... </span>            <span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>                <span class="comment"># NEW: we may need to pass data or inject an exception.</span></span><br><span class="line"><span class="meta">... </span>                <span class="keyword">if</span> isinstance(data, Exception):</span><br><span class="line"><span class="meta">... </span>                    data = task.throw(data)</span><br><span class="line"><span class="meta">... </span>                <span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>                    data = task.send(data)</span><br><span class="line"><span class="meta">... </span>            <span class="keyword">except</span> (StopIteration, CancelledError):</span><br><span class="line"><span class="meta">... </span>                tasks.extend((t, <span class="keyword">None</span>) <span class="keyword">for</span> t <span class="keyword">in</span> watch.pop(task, []))</span><br><span class="line"><span class="meta">... </span>                <span class="comment"># NEW: update bookkeeping.</span></span><br><span class="line"><span class="meta">... </span>                tree.discard(task)</span><br><span class="line"><span class="meta">... </span>            <span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>                <span class="keyword">if</span> data <span class="keyword">and</span> data[<span class="number">0</span>] == <span class="string">'spawn'</span>:</span><br><span class="line"><span class="meta">... </span>                    tasks.append((data[<span class="number">1</span>], <span class="keyword">None</span>))</span><br><span class="line"><span class="meta">... </span>                    tasks.append((task, data[<span class="number">1</span>]))</span><br><span class="line"><span class="meta">... </span>                    <span class="comment"># NEW: update bookkeeping.</span></span><br><span class="line"><span class="meta">... </span>                    tree.add(data[<span class="number">1</span>])</span><br><span class="line"><span class="meta">... </span>                <span class="keyword">elif</span> data <span class="keyword">and</span> data[<span class="number">0</span>] == <span class="string">'join'</span>:</span><br><span class="line"><span class="meta">... </span>                    watch[data[<span class="number">1</span>]].append(task)</span><br><span class="line"><span class="meta">... </span>                <span class="keyword">elif</span> data <span class="keyword">and</span> data[<span class="number">0</span>] == <span class="string">'cancel'</span>:</span><br><span class="line"><span class="meta">... </span>                    <span class="comment"># NEW: schedule to raise the exception in the task.</span></span><br><span class="line"><span class="meta">... </span>                    <span class="keyword">if</span> data[<span class="number">1</span>] <span class="keyword">in</span> tree:</span><br><span class="line"><span class="meta">... </span>                        tasks.append((data[<span class="number">1</span>], data[<span class="number">2</span>]))</span><br><span class="line"><span class="meta">... </span>                        tasks.append((task, <span class="keyword">True</span>))</span><br><span class="line"><span class="meta">... </span>                    <span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>                        tasks.append((task, <span class="keyword">False</span>))</span><br><span class="line"><span class="meta">... </span>                <span class="keyword">elif</span> data <span class="keyword">and</span> data[<span class="number">0</span>] == <span class="string">'suspend'</span>:</span><br><span class="line"><span class="meta">... </span>                    <span class="keyword">pass</span></span><br><span class="line"><span class="meta">... </span>                <span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>                    tasks.append((task, <span class="keyword">None</span>))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>run_until_complete(main())</span><br><span class="line">Hello, world!</span><br></pre></td></tr></table></figure><h2 id="è®¸å¯è¯"><a class="markdownIt-Anchor" href="#è®¸å¯è¯"></a> è®¸å¯è¯</h2><p>æœ¬æ–‡ä»¶çš„ç‰ˆæƒå½’Andre Caron <a href="mailto:andre.l.caron@gmail.com" target="_blank" rel="noopener">andre.l.caron@gmail.com</a>æ‰€æœ‰ï¼Œå¹¶åœ¨çŸ¥è¯†å…±äº« <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode" target="_blank" rel="noopener">CC-BY-SA</a>  è®¸å¯ä¸‹å‘æ‚¨æä¾›ã€‚</p><h1 id="ä¸ªäººæ”¶è·"><a class="markdownIt-Anchor" href="#ä¸ªäººæ”¶è·"></a> ä¸ªäººæ”¶è·</h1><p>ä¸€ä¸ªå¼‚æ­¥æ¡†æ¶é€šå¸¸ä¸»è¦åŒ…æ‹¬äº‹ä»¶å¾ªç¯ã€<a href="https://www.zhihu.com/search?q=%E4%BA%8B%E4%BB%B6%E9%98%9F%E5%88%97&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A555273313%7D" target="_blank" rel="noopener">äº‹ä»¶é˜Ÿåˆ—</a>ã€pollingã€timeré˜Ÿåˆ—ï¼Œæ‰€æœ‰çš„å¼‚æ­¥æ¡†æ¶çš†ä¸ä¾‹å¤–ï¼Œasyncioä¹Ÿæ˜¯å¦‚æ­¤ã€‚æœ¬æ–‡çš„toy event loopä¹Ÿæ˜¯å¦‚æ­¤ï¼Œåœ¨è‡ªå·±å®ç°çš„æ—¶å€™å°±æ˜¯å…³æ³¨è¿™å‡ ä¸ªéƒ¨åˆ†ã€‚</p><p>æ–‡ä¸­çš„å®éªŒéƒ½è¡¨æ˜äº†ï¼Œåç¨‹çš„<code>send()</code>ã€<code>throw()</code>ã€<code>await</code>ä¸<code>send()</code>ã€<code>throw()</code>ã€<code>yield</code>ä½¿ç”¨éƒ½ç±»ä¼¼ã€‚</p><h1 id="ä¸ªäººå®éªŒ"><a class="markdownIt-Anchor" href="#ä¸ªäººå®éªŒ"></a> ä¸ªäººå®éªŒ</h1><p>é’ˆå¯¹<a href="#%E4%B8%8E%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E7%9A%84%E5%AF%B9%E8%AF%9D">ä¸äº‹ä»¶å¾ªç¯çš„å¯¹è¯</a>çš„å®éªŒä»£ç ï¼Œæˆ‘åˆå¢åŠ äº†ä¸€äº›å†…å®¹çœ‹æ•ˆæœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> types <span class="keyword">import</span> coroutine</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># NEW: this is an awaitable object!</span></span><br><span class="line"><span class="meta">@coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">nice</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'before yield'</span>)</span><br><span class="line">    <span class="keyword">yield</span></span><br><span class="line">    print(<span class="string">"after yield"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="comment"># NEW: this makes ``.send()`` return!</span></span><br><span class="line">    <span class="keyword">await</span> nice()</span><br><span class="line">    print(<span class="string">'Hello, %s!'</span> % (name,))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">task = hello(<span class="string">'world'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># NEW: call send twice!</span></span><br><span class="line">task.send(<span class="keyword">None</span>)</span><br><span class="line">print(<span class="string">"after first sned"</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    task.send(<span class="keyword">None</span>)</span><br><span class="line"><span class="keyword">except</span> StopIteration:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">before yield</span></span><br><span class="line"><span class="string">after first sned</span></span><br><span class="line"><span class="string">after yield</span></span><br><span class="line"><span class="string">Hello, world!</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡è¾“å‡ºæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ <code>task.send()</code>ä¼šåœ¨<code>nice()</code>çš„<code>yield</code>å¤„åœä¸‹æ¥ã€‚<code>@coroutine</code>çš„æ³¨è§£ï¼Œè®©<code>nice()</code>å‡½æ•°æˆä¸ºäº†awaitalbeå¯¹è±¡ï¼Œä»è€Œå¯ä»¥<code>await nice()</code>è°ƒç”¨ã€‚</p><p>é’ˆå¯¹<a href="#%E7%94%9F%E6%88%90%E5%AD%90%E4%BB%BB%E5%8A%A1">ç”Ÿæˆå­ä»»åŠ¡</a>ï¼Œå‘ç°mainåç¨‹ç»“æŸçš„æ¯”helloåç¨‹æ—©ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> inspect <span class="keyword">import</span> iscoroutine</span><br><span class="line"><span class="keyword">from</span> types <span class="keyword">import</span> coroutine</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">nice</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"before nice"</span>)</span><br><span class="line">    <span class="keyword">yield</span></span><br><span class="line">    print(<span class="string">"after nice"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># NEW: awaitable object that sends a request to launch a child task!</span></span><br><span class="line"><span class="meta">@coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">spawn</span><span class="params">(task)</span>:</span></span><br><span class="line">    print(<span class="string">"before spawn"</span>)</span><br><span class="line">    <span class="keyword">yield</span> task</span><br><span class="line">    print(<span class="string">"after spawn"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(<span class="string">"hello: before await"</span>)</span><br><span class="line">    <span class="keyword">await</span> nice()</span><br><span class="line">    print(<span class="string">'Hello, %s!'</span> % (name,))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># NEW: parent task!</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"main: before"</span>)</span><br><span class="line">    <span class="comment"># NEW: create a child task!</span></span><br><span class="line">    <span class="keyword">await</span> spawn(hello(<span class="string">'world'</span>))</span><br><span class="line">    print(<span class="string">"main: after"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_until_complete</span><span class="params">(task)</span>:</span></span><br><span class="line">    <span class="comment"># NEW: schedule the "root" task.</span></span><br><span class="line">    tasks = [(task, <span class="keyword">None</span>)]</span><br><span class="line">    <span class="keyword">while</span> tasks:</span><br><span class="line">        <span class="comment"># NEW: round-robin between a set tasks (we may now have more than one and we'd like to be as "fair" as possible).</span></span><br><span class="line">        <span class="comment"># æ–°ï¼šä¸€ç»„ä»»åŠ¡ä¹‹é—´çš„å¾ªç¯ï¼ˆæˆ‘ä»¬ç°åœ¨å¯èƒ½æœ‰å¤šä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬å¸Œæœ›å°½å¯èƒ½â€œå…¬å¹³â€ï¼‰ã€‚</span></span><br><span class="line">        queue, tasks = tasks, []</span><br><span class="line">        <span class="keyword">for</span> task, data <span class="keyword">in</span> queue:</span><br><span class="line">            <span class="comment"># NEW: resume the task *once*.</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                data = task.send(data)</span><br><span class="line">            <span class="keyword">except</span> StopIteration:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> error:</span><br><span class="line">                <span class="comment"># NEW: prevent crashed task from ending the loop.</span></span><br><span class="line">                print(error)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># NEW: schedule the child task.</span></span><br><span class="line">                <span class="keyword">if</span> iscoroutine(data):</span><br><span class="line">                    tasks.append((data, <span class="keyword">None</span>))</span><br><span class="line">                <span class="comment"># NEW: reschedule the parent task.</span></span><br><span class="line">                tasks.append((task, <span class="keyword">None</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">run_until_complete(main())</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">main: before</span></span><br><span class="line"><span class="string">before spawn</span></span><br><span class="line"><span class="string">hello: before await</span></span><br><span class="line"><span class="string">before nice</span></span><br><span class="line"><span class="string">after spawn</span></span><br><span class="line"><span class="string">main: after</span></span><br><span class="line"><span class="string">after nice</span></span><br><span class="line"><span class="string">Hello, world!</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><p>ç­‰å¾…å­ä»»åŠ¡join</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="keyword">from</span> types <span class="keyword">import</span> coroutine</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">nice</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"nice: before yield"</span>)</span><br><span class="line">    <span class="keyword">yield</span></span><br><span class="line">    print(<span class="string">"nice: after yield"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">spawn</span><span class="params">(task)</span>:</span></span><br><span class="line">    <span class="comment"># NEW: recover the child task handle to pass it back to the parent.</span></span><br><span class="line">    print(<span class="string">"spawn: before yield"</span>)</span><br><span class="line">    child = <span class="keyword">yield</span> (<span class="string">'spawn'</span>, task)</span><br><span class="line">    print(<span class="string">"spawn: after yield"</span>)</span><br><span class="line">    <span class="keyword">return</span> child</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># NEW: awaitable object that sends a request to be notified when a</span></span><br><span class="line"><span class="comment">#      concurrent task completes.</span></span><br><span class="line"><span class="meta">@coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">join</span><span class="params">(task)</span>:</span></span><br><span class="line">    print(<span class="string">"join: before yield"</span>)</span><br><span class="line">    <span class="keyword">yield</span> (<span class="string">'join'</span>, task)</span><br><span class="line">    print(<span class="string">"join: after yield"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(<span class="string">"hello: before nice()"</span>)</span><br><span class="line">    <span class="keyword">await</span> nice()</span><br><span class="line">    print(<span class="string">'Hello, %s!'</span> % (name,))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># NEW: recover the child task handle.</span></span><br><span class="line">    child = <span class="keyword">await</span> spawn(hello(<span class="string">'world'</span>))</span><br><span class="line">    print(<span class="string">"main: after spawn and before join()"</span>)</span><br><span class="line">    <span class="comment"># NEW: wait for the child task to complete.</span></span><br><span class="line">    <span class="comment"># ç­‰å¾…å­åç¨‹å®Œæˆ</span></span><br><span class="line">    <span class="keyword">await</span> join(child)</span><br><span class="line">    print(<span class="string">'(after join)'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_until_complete</span><span class="params">(task)</span>:</span></span><br><span class="line">    tasks = [(task, <span class="keyword">None</span>)]</span><br><span class="line">    <span class="comment"># NEW: keep track of tasks to resume when a task completes.</span></span><br><span class="line">    watch = defaultdict(list)</span><br><span class="line">    <span class="keyword">while</span> tasks:</span><br><span class="line">        queue, tasks = tasks, []</span><br><span class="line">        <span class="keyword">for</span> task, data <span class="keyword">in</span> queue:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                data = task.send(data)</span><br><span class="line">            <span class="keyword">except</span> StopIteration:</span><br><span class="line">                <span class="comment"># NEW: wait up tasks waiting on this one.</span></span><br><span class="line">                <span class="comment"># å­åç¨‹é€€å‡ºæ—¶, å”¤é†’è¢«joiné˜»å¡çš„çˆ¶åç¨‹</span></span><br><span class="line">                <span class="comment"># å¯¹watchä¸­çš„taskè¿›è¡Œpop, å¦‚æœæ²¡æœ‰åˆ™è¿”å›[]</span></span><br><span class="line">                tasks.extend((t, <span class="keyword">None</span>) <span class="keyword">for</span> t <span class="keyword">in</span> watch.pop(task, []))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># NEW: dispatch request sent by awaitable object since we now have 3 different types of requests.</span></span><br><span class="line">                <span class="comment"># NEW: ç”±ç­‰å¾…å¯¹è±¡å‘é€çš„è°ƒåº¦è¯·æ±‚ï¼Œå› ä¸ºæˆ‘ä»¬ç°åœ¨æœ‰ 3 ç§ä¸åŒç±»å‹çš„è¯·æ±‚</span></span><br><span class="line">                <span class="comment"># 1. å¦‚æœæ˜¯ä¼šäº§ç”Ÿæ–°åç¨‹çš„æ“ä½œ</span></span><br><span class="line">                <span class="keyword">if</span> data <span class="keyword">and</span> data[<span class="number">0</span>] == <span class="string">'spawn'</span>:</span><br><span class="line">                    <span class="comment"># å°†æ–°åç¨‹åŠ å…¥</span></span><br><span class="line">                    tasks.append((data[<span class="number">1</span>], <span class="keyword">None</span>))</span><br><span class="line">                    <span class="comment"># å°†çˆ¶åç¨‹å’Œæ–°åç¨‹å†™å…¥, åœ¨task.send(data)ä¸­å¯ä»¥ä½¿å¾—çˆ¶åç¨‹ä¸­èµ‹å€¼child=yield epxä¸ºå­åç¨‹å€¼</span></span><br><span class="line">                    tasks.append((task, data[<span class="number">1</span>]))</span><br><span class="line">                <span class="keyword">elif</span> data <span class="keyword">and</span> data[<span class="number">0</span>] == <span class="string">'join'</span>:</span><br><span class="line">                    <span class="comment"># å¦‚æœçˆ¶åç¨‹æ‰§è¡Œçš„å¿«, é‚£ä¹ˆæŠŠå­åç¨‹ä¸çˆ¶åç¨‹çš„ç»‘å®šå…³ç³»è®°å½•ä¸‹æ¥</span></span><br><span class="line">                    watch[data[<span class="number">1</span>]].append(task)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># æ­£å¸¸åç¨‹æ‰§è¡Œç»“æœ</span></span><br><span class="line">                    tasks.append((task, <span class="keyword">None</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">run_until_complete(main())</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">spawn: before yield</span></span><br><span class="line"><span class="string">hello: before nice()</span></span><br><span class="line"><span class="string">nice: before yield</span></span><br><span class="line"><span class="string">spawn: after yield</span></span><br><span class="line"><span class="string">main: after spawn and before join()</span></span><br><span class="line"><span class="string">--- æ­¤æ—¶mainæ‰§è¡Œå®Œæˆ, joinç­‰å¾…nice()è¢«æ‰§è¡Œ</span></span><br><span class="line"><span class="string">join: before yield</span></span><br><span class="line"><span class="string">nice: after yield</span></span><br><span class="line"><span class="string">--- niceæ‰§è¡Œå®Œæˆ</span></span><br><span class="line"><span class="string">Hello, world!</span></span><br><span class="line"><span class="string">--- helloæ‰§è¡Œå®Œæˆ</span></span><br><span class="line"><span class="string">join: after yield</span></span><br><span class="line"><span class="string">--- joinç»“æŸ</span></span><br><span class="line"><span class="string">(after join)</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><p>å¤šäº†ä¸¤æ ·ä¸œè¥¿ï¼š</p><ul><li>æ–°çš„è¯·æ±‚ç±»å‹:<ul><li><code>spawn</code></li><li><code>join</code></li><li><code>push</code></li></ul></li><li>åŸºäº<code>task.send()</code>è¿”å›å€¼çš„è°ƒåº¦ä»£ç ã€‚</li></ul><p>é’ˆå¯¹[Sleeping &amp; timers](#Sleeping &amp; timers)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> heapq <span class="keyword">import</span> heappop, heappush</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep <span class="keyword">as</span> _sleep</span><br><span class="line"><span class="keyword">from</span> timeit <span class="keyword">import</span> default_timer</span><br><span class="line"><span class="keyword">from</span> types <span class="keyword">import</span> coroutine</span><br><span class="line"></span><br><span class="line"><span class="comment"># NEW: we need to keep track of elapsed time.</span></span><br><span class="line">clock = default_timer</span><br><span class="line"></span><br><span class="line"><span class="comment"># NEW: request that the event loop reschedule us "later".</span></span><br><span class="line"><span class="meta">@coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sleep</span><span class="params">(seconds)</span>:</span></span><br><span class="line">    <span class="keyword">yield</span> (<span class="string">'sleep'</span>, seconds)</span><br><span class="line"></span><br><span class="line"><span class="comment"># NEW: verify elapsed time matches our request.</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></span><br><span class="line">    ref = clock()</span><br><span class="line">    <span class="keyword">await</span> sleep(<span class="number">3.0</span>)</span><br><span class="line">    now = clock()</span><br><span class="line">    <span class="keyword">assert</span> (now - ref) &gt;= <span class="number">3.0</span></span><br><span class="line">    print(<span class="string">'Hello, %s!'</span> % (name,))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_until_complete</span><span class="params">(task)</span>:</span></span><br><span class="line">    tasks = [(task, <span class="keyword">None</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># NEW: keep track of tasks that are sleeping.</span></span><br><span class="line">    timers = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># NEW: watch out, all tasks might be suspended at the same time.</span></span><br><span class="line">    <span class="keyword">while</span> tasks <span class="keyword">or</span> timers:</span><br><span class="line"></span><br><span class="line">        <span class="comment"># NEW: if we have nothing to do for now, don't spin.</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> tasks:</span><br><span class="line">            _sleep(max(<span class="number">0.0</span>, timers[<span class="number">0</span>][<span class="number">0</span>] - clock()))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># NEW: schedule tasks when their timer has elapsed.</span></span><br><span class="line">        <span class="comment"># å¦‚æœtimesé˜Ÿåˆ—ä¸­æœ‰ä»»åŠ¡, ä¸”æœ€è¿‘çš„æ—¶é—´å·²ç»åˆ°äº†, åˆ™å–å‡ºä»»åŠ¡</span></span><br><span class="line">        <span class="keyword">while</span> timers <span class="keyword">and</span> timers[<span class="number">0</span>][<span class="number">0</span>] &lt; clock():</span><br><span class="line">            _, task = heappop(timers)</span><br><span class="line">            tasks.append((task, <span class="keyword">None</span>))</span><br><span class="line"></span><br><span class="line">        queue, tasks = tasks, []</span><br><span class="line">        <span class="keyword">for</span> task, data <span class="keyword">in</span> queue:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                data = task.send(data)</span><br><span class="line">            <span class="keyword">except</span> StopIteration:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># NEW: set a timer and don't reschedule right away.</span></span><br><span class="line">                <span class="keyword">if</span> data <span class="keyword">and</span> data[<span class="number">0</span>] == <span class="string">'sleep'</span>:</span><br><span class="line">                    <span class="comment"># å¾€å †é‡Œé¢æ·»åŠ ä»»åŠ¡, é»˜è®¤ä»¥æ—¶é—´æœ€è¿‘çš„åœ¨ä¸Š(æœ€å°å †)</span></span><br><span class="line">                    heappush(timers, (clock() + data[<span class="number">1</span>], task))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># é€’å½’æ·»åŠ ä¸‹ä¸€æ¬¡è¦åšçš„åç¨‹ä»»åŠ¡</span></span><br><span class="line">                    tasks.append((task, <span class="keyword">None</span>))</span><br><span class="line"></span><br><span class="line">run_until_complete(hello(<span class="string">'world'</span>))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selectors <span class="keyword">import</span> (</span><br><span class="line">    DefaultSelector,</span><br><span class="line">    EVENT_READ,</span><br><span class="line">    EVENT_WRITE,</span><br><span class="line">)</span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> socketpair <span class="keyword">as</span> _socketpair</span><br><span class="line"><span class="keyword">from</span> types <span class="keyword">import</span> coroutine</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># NEW: request that the event loop tell us when we can read.</span></span><br><span class="line"><span class="meta">@coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recv</span><span class="params">(stream, size)</span>:</span></span><br><span class="line">    <span class="keyword">yield</span> (EVENT_READ, stream)</span><br><span class="line">    <span class="keyword">return</span> stream.recv(size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># NEW: request that the event loop tell us when we can write.</span></span><br><span class="line"><span class="meta">@coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send</span><span class="params">(stream, data)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> data:</span><br><span class="line">        <span class="keyword">yield</span> (EVENT_WRITE, stream)</span><br><span class="line">        size = stream.send(data)</span><br><span class="line">        data = data[size:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># NEW: connect sockets, make sure they never, ever block the loop.</span></span><br><span class="line"><span class="meta">@coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">socketpair</span><span class="params">()</span>:</span></span><br><span class="line">    lhs, rhs = _socketpair()</span><br><span class="line">    lhs.setblocking(<span class="keyword">False</span>)</span><br><span class="line">    rhs.setblocking(<span class="keyword">False</span>)</span><br><span class="line">    <span class="keyword">yield</span></span><br><span class="line">    <span class="keyword">return</span> lhs, rhs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># NEW: send a message through the socket pair.</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></span><br><span class="line">    lhs, rhs = <span class="keyword">await</span> socketpair()</span><br><span class="line">    <span class="keyword">await</span> send(lhs, <span class="string">'Hello, world!'</span>.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    data = <span class="keyword">await</span> recv(rhs, <span class="number">1024</span>)</span><br><span class="line">    print(data.decode(<span class="string">'utf-8'</span>))</span><br><span class="line">    lhs.close()</span><br><span class="line">    rhs.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_until_complete</span><span class="params">(task)</span>:</span></span><br><span class="line">    tasks = [(task, <span class="keyword">None</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># NEW: prepare for I/O multiplexing.</span></span><br><span class="line">    selector = DefaultSelector()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># NEW: watch out, all tasks might be suspended at the same time.</span></span><br><span class="line">    <span class="keyword">while</span> tasks <span class="keyword">or</span> selector.get_map():</span><br><span class="line"></span><br><span class="line">        <span class="comment"># NEW: poll I/O operation status and resume tasks when ready.</span></span><br><span class="line">        timeout = <span class="number">0.0</span> <span class="keyword">if</span> tasks <span class="keyword">else</span> <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">for</span> key, events <span class="keyword">in</span> selector.select(timeout):</span><br><span class="line">            tasks.append((key.data, <span class="keyword">None</span>))</span><br><span class="line">            selector.unregister(key.fileobj)</span><br><span class="line"></span><br><span class="line">        queue, tasks = tasks, []</span><br><span class="line">        <span class="keyword">for</span> task, data <span class="keyword">in</span> queue:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                data = task.send(data)</span><br><span class="line">            <span class="keyword">except</span> StopIteration:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># NEW: register for I/O and suspend the task.</span></span><br><span class="line">                <span class="keyword">if</span> data <span class="keyword">and</span> data[<span class="number">0</span>] == EVENT_READ:</span><br><span class="line">                    selector.register(data[<span class="number">1</span>], EVENT_READ, task)</span><br><span class="line">                <span class="keyword">elif</span> data <span class="keyword">and</span> data[<span class="number">0</span>] == EVENT_WRITE:</span><br><span class="line">                    selector.register(data[<span class="number">1</span>], EVENT_WRITE, task)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    tasks.append((task, <span class="keyword">None</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">run_until_complete(hello(<span class="string">'world'</span>))</span><br></pre></td></tr></table></figure><p>Q: socketpairæ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li><code>socket.socketpair()</code>å‡½æ•°ä»…è¿”å›ä¸¤ä¸ªå·²ç»è¿æ¥çš„å¥—æ¥å­—å¯¹è±¡ï¼Œå‚æ•°å’Œsocket.socket()é‡Œçš„å‚æ•°ä¸€æ ·çš„ç”¨æ³•ã€‚</li><li><code>socket.socketpair()</code>å¯ä»¥ç†è§£ä¸º åˆ›å»ºäº†ä¸¤ä¸ªsocket, æ¯”å–»ä¸ºä¸€ä¸ªserverçš„ socketï¼Œä¸€ä¸ªclientçš„socketï¼Œè¿™ä¸¤ä¸ªsocketæ˜¯å·²ç»connectedè¿æ¥çŠ¶æ€</li><li>socket.socketpair()`æ˜¯å…¨åŒå·¥æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªsocketéƒ½èƒ½æ”¶å‘ï¼Œæ¯”å–»ä¸º\server.sendâ€”&gt;client.recv,å’Œ client.sendâ€”&gt;server.recv</li><li>socket.socketpair()`é»˜è®¤æ˜¯åˆ›å»ºunixå¥—æ¥å­—</li></ul><p>æ€»ç»“ï¼š</p><ul><li>å‡½æ•°åŠ ä¸Š<code>async def</code>å˜æˆäº†<code>coroutine object</code></li><li>å‡½æ•°åŠ ä¸Š<code>@types.coroutine</code>å˜æˆäº†<code>awaitable</code>çš„function</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;äº‹ä»¶å¾ªç¯çš„ä¸€ä¸ªå°æ•…äº‹&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#äº‹ä»¶å¾ªç¯çš„ä¸€ä¸ªå°æ•…äº‹&quot;&gt;&lt;/a&gt; äº‹ä»¶å¾ªç¯çš„ä¸€ä¸ªå°æ•…äº‹&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;Translated from: &lt;a href=&quot;https://g
      
    
    </summary>
    
    
      <category term="Python" scheme="https://nymrli.top/tags/Python/"/>
    
      <category term="ç¿»è¯‘" scheme="https://nymrli.top/tags/%E7%BF%BB%E8%AF%91/"/>
    
      <category term="å¹¶å‘" scheme="https://nymrli.top/tags/%E5%B9%B6%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>seleniumä¸è¡Œçš„å·¥ä½œ,pyppeteerä¸Š</title>
    <link href="https://nymrli.top/2022/05/05/selenium%E4%B8%8D%E8%A1%8C%E7%9A%84%E5%B7%A5%E4%BD%9C-pyppeteer%E4%B8%8A/"/>
    <id>https://nymrli.top/2022/05/05/seleniumä¸è¡Œçš„å·¥ä½œ-pyppeteerä¸Š/</id>
    <published>2022-05-05T12:31:39.000Z</published>
    <updated>2022-05-07T08:33:12.577Z</updated>
    
    <content type="html"><![CDATA[<h2 id="éªŒè¯ç é—®é¢˜"><a class="markdownIt-Anchor" href="#éªŒè¯ç é—®é¢˜"></a> éªŒè¯ç é—®é¢˜</h2><p>è¯¥ç½‘ç«™å¯¹é¢‘ç‡æ£€æµ‹ååˆ†æ•æ„Ÿï¼Œå¾ˆå¿«å°±ä¼šå‡ºç°&quot;æŒ‰ä½&quot;éªŒè¯ç ï¼Œæ¨¡æ‹ŸæŒ‰ä½å€’ä¸éš¾ï¼Œä½†æ˜¯æŒ‰å®Œä»¥åæœ‰æ—¶å¹¶ä¸èƒ½è§£å†³éªŒè¯â€¦</p><p>ä½†æ˜¯æ„å¤–å‘ç°ï¼Œåœ¨â€œæ— ç—•æ¨¡å¼â€ä¸‹è¿›è¡Œé‡æ–°ç™»å½•åï¼Œå°±å¯ä»¥è§£å†³éªŒè¯â€¦ä½†æ˜¯é€šè¿‡requestsè¿›è¡Œæ¨¡æ‹Ÿç™»å½•åcookiesè¿˜æ˜¯æ— æ•ˆã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><blockquote><p>æ—¢ç„¶æ¨¡æ‹Ÿä¸è¡Œï¼Œé‚£ä¹ˆå°±æ‰‹åŠ¨ï¼Œå› æ­¤æƒ³ç”¨seleniumæ¥æ¨¡æ‹Ÿç‚¹å‡»ç™»é™†ã€‚ä½†æ˜¯å› ä¸ºä¿„ç½—æ–¯çš„é—®é¢˜ï¼Œæ— æ³•ç™»é™†ã€‚</p></blockquote><p><img src="/2022/05/05/seleniumä¸è¡Œçš„å·¥ä½œ-pyppeteerä¸Š/selenium%E4%B8%8D%E8%A1%8C%E7%9A%84%E5%B7%A5%E4%BD%9C-pyppeteer%E4%B8%8A%5C%E8%A2%AB%E5%B0%81.jpg" alt="è¢«å°"></p><p>äºæ˜¯åªå¥½æ›´æ¢seleniumä¸ºpyppeteerã€‚ä¹‹å‰å°±å¬è¯´äº†pyppeteeræ˜¯å¯ä»¥ä»£æ›¿seleniumçš„æ¨¡æ‹Ÿç¥å™¨ï¼Œç›¸æ¯”Selenium ä¸å¤ªæ–¹ä¾¿çš„åœ°æ–¹ï¼šæ¯”å¦‚é€Ÿåº¦å¤ªæ…¢ã€å¯¹ç‰ˆæœ¬é…ç½®è¦æ±‚ä¸¥è‹›ï¼Œæœ€éº»çƒ¦æ˜¯ç»å¸¸è¦æ›´æ–°å¯¹åº”çš„é©±åŠ¨ï¼Œè¿˜æœ‰äº›ç½‘é¡µæ˜¯å¯ä»¥æ£€æµ‹åˆ°æ˜¯å¦ä½¿ç”¨äº†Selenium ï¼Œpyppeteeréƒ½æœ‰æå‡ï¼Œè¿™æ¬¡ä¹Ÿå€Ÿæœºä¼šå­¦ä¹ ä¸€ä¸‹ã€‚</p><blockquote><p>å®‰è£…ï¼š<code>pip install pyppeteer</code>, éœ€è¦Python3.6ä»¥ä¸Šï¼ˆå› ä¸ºç”¨äº†asyncï¼‰</p></blockquote><h3 id="pyppeteer"><a class="markdownIt-Anchor" href="#pyppeteer"></a> pyppeteer</h3><p>æœ€ç®€å•demoï¼šæ‰“å¼€ç½‘é¡µï¼Œå¹¶æˆªå›¾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> pyppeteer <span class="keyword">import</span> launch</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># å¯åŠ¨æµè§ˆå™¨</span></span><br><span class="line">    browser = <span class="keyword">await</span> launch(headless=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment"># æ‰“å¼€å¹¶è·³è½¬é¡µé¢</span></span><br><span class="line">    page = <span class="keyword">await</span> browser.newPage()</span><br><span class="line">    <span class="keyword">await</span> page.goto(<span class="string">'https://example.com'</span>)</span><br><span class="line">    <span class="comment"># æˆªå›¾</span></span><br><span class="line">    <span class="keyword">await</span> page.screenshot(&#123;<span class="string">'path'</span>: <span class="string">'example.png'</span>&#125;)</span><br><span class="line">    <span class="keyword">await</span> browser.close()</span><br><span class="line"></span><br><span class="line">asyncio.get_event_loop().run_until_complete(main())</span><br></pre></td></tr></table></figure><p>æ‰§è¡ŒJSï¼Œç›¸å½“äºrequests-htmlä¸­çš„render</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dimensions = <span class="keyword">await</span> page.evaluate(<span class="string">'''() =&gt; &#123;</span></span><br><span class="line"><span class="string">    return &#123;</span></span><br><span class="line"><span class="string">        width: document.documentElement.clientWidth,</span></span><br><span class="line"><span class="string">        height: document.documentElement.clientHeight,</span></span><br><span class="line"><span class="string">        deviceScaleFactor: window.devicePixelRatio,</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;'''</span>)</span><br><span class="line"></span><br><span class="line">print(dimensions)</span><br><span class="line"><span class="comment"># &gt;&gt;&gt; &#123;'width': 800, 'height': 600, 'deviceScaleFactor': 1&#125;</span></span><br><span class="line"><span class="keyword">await</span> browser.close()</span><br></pre></td></tr></table></figure><p><strong>å…ƒç´ é€‰æ‹©å™¨</strong>ï¼š</p><p><code>Page.querySelector()</code>/<code>Page.querySelectorAll()</code>/<code>Page.xpath()</code>ç¼©å†™ä¸º<code>Page.J()</code>, <code>Page.JJ()</code>, and <code>Page.Jx()</code>.</p><p>xpathè¿›é˜¶ï¼š</p><ul><li>starts-with é¡¾åæ€ä¹‰ï¼ŒåŒ¹é…ä¸€ä¸ªå±æ€§å¼€å§‹ä½ç½®çš„å…³é”®å­—</li><li>contains åŒ¹é…ä¸€ä¸ªå±æ€§å€¼ä¸­åŒ…å«çš„<a href="https://so.csdn.net/so/search?q=%E5%AD%97%E7%AC%A6%E4%B8%B2&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener">å­—ç¬¦ä¸²</a></li><li><code>text()</code> åŒ¹é…çš„æ˜¯æ˜¾ç¤ºæ–‡æœ¬ä¿¡æ¯ï¼š <code>//a[contains(text(), &quot;ç™¾åº¦æœç´¢&quot;)]</code></li></ul><p><a href="https://blog.csdn.net/weixin_48615832/article/details/107319268" target="_blank" rel="noopener">xpathçš„containsç”¨æ³•</a></p><p><strong>å…ƒç´ æ“ä½œï¼šç‚¹å‡»ã€è¾“å…¥</strong></p><ul><li><code>pyppeteer.input.Mouse</code><ul><li><code>click(x: float*, y: float, options: dict = None*, ***kwargs)</code><ul><li><code>button</code> (str): <code>left</code>, <code>right</code>, or <code>middle</code>, defaults to <code>left</code>ï¼š<ul><li>å³é”®ç‚¹å‡»ï¼š<code>await page.click('a#cccccc',{&quot;button&quot;: &quot;right&quot;})</code></li></ul></li><li><code>clickCount</code> (int): defaults to 1.</li><li><code>delay</code> (int|float): Time to wait between <code>mousedown</code> and <code>mouseup</code> in milliseconds. Defaults to 0.</li></ul></li><li><code>down</code>(options: dict = None, *<em>kwargs</em>) `<ul><li><code>button</code> (str): <code>left</code>, <code>right</code>, or <code>middle</code>, defaults to <code>left</code>.</li><li><code>clickCount</code> (int): defaults to 1.</li></ul></li><li><code>move(x: float, y: float, options: dict = None, **kwargs*)</code></li><li><code>p(options: dict = None, **kwargs*)</code></li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨xpath</span></span><br><span class="line"><span class="keyword">await</span> page.waitForXPath(<span class="string">'//input[contains(@id, "mat-input")]'</span>)</span><br><span class="line"><span class="keyword">await</span> asyncio.sleep(<span class="number">10</span>)</span><br><span class="line">inputs = <span class="keyword">await</span> page.xpath(<span class="string">'//input[contains(@id, "mat-input")]'</span>)</span><br><span class="line">print(len(inputs))</span><br><span class="line"><span class="keyword">await</span> inputs[<span class="number">1</span>].type(<span class="string">'janetgao@indiana.edu'</span>)</span><br><span class="line"><span class="keyword">await</span> inputs[<span class="number">2</span>].type(<span class="string">'KAProject2021'</span>)</span><br><span class="line"><span class="comment"># ä½¿ç”¨selector</span></span><br><span class="line"><span class="keyword">await</span> page.waitForSelector(<span class="string">'#mat-input-1'</span>)</span><br><span class="line"><span class="keyword">await</span> page.type(<span class="string">'#mat-input-1'</span>, <span class="string">'janetgao@indiana.edu'</span>)</span><br><span class="line"><span class="keyword">await</span> page.type(<span class="string">'#mat-input-2'</span>, <span class="string">'KAProject2021'</span>)</span><br></pre></td></tr></table></figure><p><strong>launch</strong></p><ul><li><p><code>headless</code>ï¼šæ— ç•Œé¢æ¨¡å¼</p></li><li><p><code>devtools</code> ï¼šå¯ç”¨å¼€å‘è€…åŠ©æ‰‹</p></li><li><p><code>userDataDir='./userdata'</code>ï¼š è®°å½•äº›ç”¨æˆ·ä¿¡æ¯ï¼Œæ¯”å¦‚cookies</p></li><li><p><code>dumpio=True</code> é˜²æ­¢æµè§ˆå™¨å¼€å¤šä¸ªé¡µé¢è€Œå¡æ­»</p></li><li><p><code>executablePath</code>: æŒ‡å®šè‡ªå®šä¹‰çš„chromeè·¯å¾„</p></li><li><p>å‚æ•°argsè®¾ç½®ï¼Œå¯ä»¥ç±»æ¯”selenium</p><ul><li><p><code>--start-maximized</code>: é¡µé¢å…¨å±</p></li><li><p><code>--window-size={width},{height}</code>ï¼šè®¾ç½®çª—å£å¤§å°ï¼ŒåŒºåˆ«äºé¡µé¢çš„<code>page.setViewport({'width': 1366, 'height': 768})</code></p></li><li><p><code>--disable-infobars</code>:ä¸æ˜¾ç¤ºä¿¡æ¯æ   æ¯”å¦‚ chromeæ­£åœ¨å—åˆ°è‡ªåŠ¨æµ‹è¯•è½¯ä»¶çš„æ§åˆ¶</p></li><li><p><code>--incognito</code>ï¼šç™¾åº¦æœåˆ°çš„chrome.exeæ— ç—•å‘½ä»¤(seleniumæ˜¯å¦‚æ­¤ï¼Œpyppeteerä¸æ¨è)</p></li><li><p><code>--user-agent</code>ï¼š æ¯”å¦‚<code>'--user-agent=Mozilla/5.0'</code></p></li><li><p><code>--proxy-server={proxy}</code>: æµè§ˆå™¨ä»£ç† é…åˆæŸäº›ä¸­é—´äººä»£ç†ä½¿ç”¨</p></li><li><p><code>--no-sandbox</code>,  # å–æ¶ˆæ²™ç›’æ¨¡å¼ æ²™ç›’æ¨¡å¼ä¸‹æƒé™å¤ªå°</p></li><li><p><code>'--log-level=3'</code></p></li><li><p><code>'--load-extension={}'.format(chrome_extension)</code>ã€<code>'--disable-extensions-except={}'.format(chrome_extension)</code> # åŠ è½½æ’ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chrome_extension_path = <span class="string">"æ’ä»¶æ‰€åœ¨ç›®å½•"</span></span><br><span class="line">args = [</span><br><span class="line">    <span class="string">"--load-extension=&#123;&#125;"</span>.format(chrome_extension_path),</span><br><span class="line">    <span class="string">"--disable-extensions-except=&#123;&#125;"</span>.format(chrome_extension_path),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><a href="https://www.cnblogs.com/dyfblog/p/12225796.html" target="_blank" rel="noopener">pyppeteeræ§åˆ¶Chromiumåœ¨éšèº«æ¨¡å¼ä¸‹å¯ç”¨æ’ä»¶ </a></p></li></ul></li><li><p>more: <a href="https://blog.csdn.net/Coding_CLearLove/article/details/110265509" target="_blank" rel="noopener">launchå‚æ•°è¯´æ˜</a></p></li></ul><p>æ‰§è¡ŒJSï¼š</p><ul><li><p><code>page.evaluate('window.scrollBy(100, document.body.scrollHeight)')</code></p></li><li><p><code>await page.evaluate('alert(&quot;åœ¨æµè§ˆå™¨æ‰§è¡Œjsè„šæœ¬!&quot;)')</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›¸å½“äºæ‹¿åˆ°äº†domå¯¹è±¡</span></span><br><span class="line">element = <span class="keyword">await</span> page.J(<span class="string">'#ul&gt;a[name="tj_trtieba"]'</span>)</span><br><span class="line">print(<span class="keyword">await</span> page.evaluate(<span class="string">'el =&gt; el.innerHTML'</span>, element))</span><br></pre></td></tr></table></figure></li><li><p>page.evaluateOnNewDocument(pageFunction[, â€¦args]), æŒ‡å®šçš„å‡½æ•°åœ¨æ‰€å±çš„é¡µé¢è¢«åˆ›å»ºå¹¶ä¸”æ‰€å±é¡µé¢çš„ä»»æ„scriptæ‰§è¡Œä¹‹å‰è¢«è°ƒç”¨ã€‚å¸¸ç”¨äºä¿®æ”¹é¡µé¢JSç¯å¢ƒã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">page = <span class="keyword">await</span> browser.newPage()</span><br><span class="line"><span class="keyword">await</span> page.setViewPort(&#123;<span class="string">'width'</span>: <span class="number">1366</span>, <span class="string">'height'</span>: <span class="number">768</span>&#125;)</span><br><span class="line"><span class="keyword">await</span> page.evaluateOnNewDocument(<span class="string">'''() =&gt; &#123;</span></span><br><span class="line"><span class="string">        Object.defineProperty(navigator, 'webdriver', &#123;get: () =&gt; false &#125;);</span></span><br></pre></td></tr></table></figure><p>é™„â€”ElementHandleå…ƒç´ æ“ä½œï¼š</p><ol><li>è·å–å…ƒç´ è¾¹ç•Œæ¡†åæ ‡ï¼šboundingBox()ï¼Œè¿”å›å…ƒç´ çš„è¾¹ç•Œæ¡†ï¼ˆç›¸å¯¹äºä¸»æ¡†æ¶ï¼‰=&gt; x åæ ‡ã€ y åæ ‡ã€widthã€height</li><li>å…ƒç´ æ˜¯å¦å¯è§ï¼šisIntersectingViewport()</li><li>ä¸Šä¼ æ–‡ä»¶ï¼šuploadFile(*filpaths)</li><li>ElementHandle ç±» è½¬ Frameç±»ï¼šcontentFrame()ï¼Œå¦‚æœå¥æŸ„æœªå¼•ç”¨iframeï¼Œåˆ™è¿”å›Noneã€‚</li><li>èšç„¦è¯¥å…ƒç´ ï¼šfocus()</li><li>ä¸é¼ æ ‡ç›¸å…³ï¼šhover () ï¼Œå°†é¼ æ ‡æ‚¬åœåˆ°å…ƒç´ ä¸Šé¢</li><li>ä¸é”®ç›˜ç›¸å…³ï¼špress (key[, options])ï¼ŒæŒ‰é”®ï¼Œkey è¡¨ç¤ºæŒ‰é”®çš„åç§°ï¼Œoptionå¯é…ç½®:<ul><li>text (string) - å¦‚æœæŒ‡å®šï¼Œåˆ™ä½¿ç”¨æ­¤æ–‡æœ¬ç”Ÿæˆè¾“å…¥äº‹ä»¶</li><li>delay (number) - keydown å’Œ keyup ä¹‹é—´ç­‰å¾…çš„æ—¶é—´ã€‚é»˜è®¤æ˜¯ 0</li><li><code>page.keyboard.down('Shift')</code>ï¼šæŒ‰ä¸‹shift</li></ul></li></ol><p>more: <a href="https://blog.csdn.net/weizhen11/article/details/102509230" target="_blank" rel="noopener">é¡µé¢å…ƒç´ æ“ä½œ</a></p></li></ul><p><strong>å®‰å…¨æ€§ï¼š</strong></p><ol><li>åœ¨ä½¿ç”¨ Pyppeteer ä»ç„¶ä¼šé‡åˆ°æ— å¤´æµè§ˆå™¨æ£€æµ‹ï¼Œè¿™é‡Œå®‰åˆ©ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ã€Œpyppeteer-stealthã€ï¼Œã€Œpuppeteer-extra-plugin-stealthã€å¼•ç”¨Githubä¸Šçš„è¯´æ˜ã€ŒApplies various evasion techniques to make detection of headless puppeteer harder.ã€ã€ŒA plugin for puppeteer-extra to prevent detection.ã€ï¼ˆGithubåœ°å€ï¼š<a href="https://github.com/berstend/puppeteer-extra/tree/master/packages/puppeteer-extra-plugin-stealth" target="_blank" rel="noopener">https://github.com/berstend/puppeteer-extra/tree/master/packages/puppeteer-extra-plugin-stealth</a> ï¼‰ã€‚å¯è§ï¼Œã€Œpyppeteer-stealthã€ä¹Ÿæ˜¯ç”¨äºé˜²æ­¢æœºå™¨äººæ£€æµ‹çš„ã€‚ç”¨æ³•ä¹Ÿå¾ˆç®€å•ï¼Œç»™pageåŠ ä¸Šstealth</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> pyppeteer <span class="keyword">import</span> launch</span><br><span class="line"><span class="keyword">from</span> pyppeteer_stealth <span class="keyword">import</span> stealth</span><br><span class="line"> </span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    browser = <span class="keyword">await</span> launch(headless=<span class="keyword">True</span>)</span><br><span class="line">    page = <span class="keyword">await</span> browser.newPage()</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">await</span> stealth(page)  <span class="comment"># &lt;-- Here</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">await</span> page.goto(<span class="string">"https://bot.sannysoft.com/"</span>)</span><br><span class="line">    <span class="keyword">await</span> browser.close()</span><br><span class="line">asyncio.get_event_loop().run_until_complete(main())</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥çœå»éšè—WebDriverç­‰æ“ä½œï¼Œå¯è°“çœæ—¶çœåŠ›çœå¿ƒã€‚</p><ol start="2"><li><code>await page.evaluateOnNewDocument('Object.defineProperty(navigator,&quot;webdriver&quot;,{get:()=&gt;undefined})')</code></li><li><code>stealth.min.js</code><a href="https://cloud.tencent.com/developer/article/1755513" target="_blank" rel="noopener">æœ€å®Œç¾æ–¹æ¡ˆï¼æ¨¡æ‹Ÿæµè§ˆå™¨å¦‚ä½•æ­£ç¡®éšè—ç‰¹å¾</a></li></ol><p><strong>æ— ç—•éšèº«æ¨¡å¼è®¿é—®</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">start_browser</span><span class="params">()</span>:</span></span><br><span class="line">    browser = <span class="keyword">await</span> launch(**&#123;<span class="string">"headless"</span>: <span class="keyword">False</span>&#125;)</span><br><span class="line">    <span class="comment"># åˆ›å»ºéšèº«ä¸Šä¸‹æ–‡</span></span><br><span class="line">    browser_context = <span class="keyword">await</span> browser.createIncognitoBrowserContext()</span><br><span class="line">    page = <span class="keyword">await</span> browser_context.newPage()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> page.goto(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line">    <span class="keyword">await</span> browser.close()</span><br><span class="line">    <span class="keyword">return</span></span><br></pre></td></tr></table></figure><p>è¾ƒå…¨çš„APIè¯´æ˜ï¼š<a href="https://blog.csdn.net/Qwertyuiop2016/article/details/92667875" target="_blank" rel="noopener">pyppeteerçš„åŸºæœ¬ä½¿ç”¨</a>ã€<a href="https://blog.csdn.net/weizhen11/article/details/102497647" target="_blank" rel="noopener">é¡µé¢ä¿¡æ¯ã€è®¾ç½®</a></p><h3 id="é—®é¢˜æŒ‰é’®ä¸ç”Ÿæ•ˆ"><a class="markdownIt-Anchor" href="#é—®é¢˜æŒ‰é’®ä¸ç”Ÿæ•ˆ"></a> é—®é¢˜ï¼šæŒ‰é’®ä¸ç”Ÿæ•ˆ</h3><p>ç½‘é¡µè¾“å…¥è´¦å·å’Œå¯†ç ä¹‹å‰ï¼ŒæŒ‰é’®çŠ¶æ€ä¸º<code>disable=true</code>ï¼Œä¸¤ä¸ªéƒ½è¾“å…¥åæ‰èƒ½æŒ‰ä¸‹ï¼Œè€Œä½¿ç”¨pyppeteeræ—¶ï¼Œå‘ç°æ— è®ºæ€ä¹ˆå°è¯•éƒ½ä¸èƒ½ä½¿å¾—å…¶disableå˜åŒ–ï¼ˆç”¨å¼€å‘è€…åŠ©æ‰‹ä¿®æ”¹åï¼Œæ— æ³•ç”Ÿæˆæ­£ç¡®çš„æäº¤è¯·æ±‚ï¼‰ã€‚çªç„¶å·§åˆä¹‹ä¸­ï¼Œæƒ³åˆ°äº†æ˜¯ä¸æ˜¯å…ƒç´ æ²¡åŠ è½½æˆåŠŸï¼Œäºæ˜¯ç¡®å®åœ¨å¼€å‘è€…åŠ©æ‰‹çš„<code>console</code>ä¸­çœ‹åˆ°æœ‰å¾ˆå¤šä¸æ”¯æŒçš„ï¼Œæ¯”å¦‚angularã€bootstrapâ€¦â€¦</p><p>äºæ˜¯ç™¾åº¦é—®é¢˜ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯ä»€ä¹ˆè®¾ç½®æ²¡å¼€ï¼Œä½†éƒ½æ²¡æ‰¾åˆ°ã€‚åæ¥æƒ³åˆ°å‡çº§ä¸‹pyppeteerç‰ˆæœ¬ä¼šä¸ä¼šå¥½ä¸€ç‚¹ï¼Œå‘ç°è‡ªå·±çš„ç‰ˆæœ¬ä¸º1.0.2ï¼Œå·²ç»æ˜¯æœ€æ–°çš„äº†(<a href="https://github.com/miyakogi/pyppeteer/issues/306" target="_blank" rel="noopener">https://github.com/miyakogi/pyppeteer/issues/306</a>)ã€‚ç”±äºä¸é€šè¿‡ç¨‹åºç›´æ¥é€šè¿‡æµè§ˆå™¨è¿›å…¥ç¨‹åºä¹Ÿå‡ºç°äº†æ— æ³•ç‚¹å‡»çš„é—®é¢˜ã€‚å†åŠ ä¸Šä¸‹é¢æœ‰äººæå‡ºchromiumæœ‰ç‚¹éš¾ä¸‹è½½ï¼Œå¹¶é€šè¿‡æºç æ‰¾é“äº†é»˜è®¤çš„é…ç½®å’Œè®¾ç½®ï¼Œäºæ˜¯ç»è¿‡ä¸€é˜µçš„æŠ˜è…¾è¿‡åï¼Œæˆ‘å‘ç°**â€œæŒ‰é’®æ— æ³•ç‚¹å‡»â€çš„é—®é¢˜å°±åœ¨äºchromiumç‰ˆæœ¬è¿‡ä½**ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pyppeteer.chromium_downloader</span><br><span class="line">print(<span class="string">'é»˜è®¤ç‰ˆæœ¬æ˜¯ï¼š&#123;&#125;'</span>.format(pyppeteer.__chromium_revision__))</span><br><span class="line">print(<span class="string">'å¯æ‰§è¡Œæ–‡ä»¶é»˜è®¤è·¯å¾„ï¼š&#123;&#125;'</span>.format(pyppeteer.chromium_downloader.chromiumExecutable.get(<span class="string">'win64'</span>)))</span><br><span class="line">print(<span class="string">'win64å¹³å°ä¸‹è½½é“¾æ¥ä¸ºï¼š&#123;&#125;'</span>.format(pyppeteer.chromium_downloader.downloadURLs.get(<span class="string">'win64'</span>)))</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">é»˜è®¤ç‰ˆæœ¬æ˜¯ï¼š588429</span></span><br><span class="line"><span class="string">å¯æ‰§è¡Œæ–‡ä»¶é»˜è®¤è·¯å¾„ï¼šC:\Users\mrli\AppData\Local\pyppeteer\pyppeteer\local-chromium\588429\chrome-win32\chrome.exe</span></span><br><span class="line"><span class="string">win64å¹³å°ä¸‹è½½é“¾æ¥ä¸ºï¼šhttps://storage.googleapis.com/chromium-browser-snapshots/Win_x64/588429/chrome-win32.zip</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><p>ç™»å½•è¿™ä¸ªstorageçš„ç½‘ç«™å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢æ‰€è®°å½•çš„chromiumå…¨éƒ½æ˜¯2013å¹´çš„ç‰ˆæœ¬ï¼Œå¿…ç„¶ç‰ˆæœ¬è½åäº†ã€‚äºæ˜¯ä¸‹è½½æœ€æ–°çš„chromiumè¦†ç›–<code>C:\Users\mrli\AppData\Local\pyppeteer\pyppeteer\local-chromium\588429\chrome-win32</code>ç›®å½•åå†è¿è¡Œï¼ŒæŒ‰é’®ä¸èƒ½ç‚¹å‡»çš„é—®é¢˜å°±æ¶ˆå¤±äº†!~ğŸ˜„</p><p>chromiumä¸‹è½½åœ°å€ï¼š<a href="https://registry.npmmirror.com/binary.html?path=chromium-browser-snapshots/Win_x64/%EF%BC%8C%E6%B3%A8%EF%BC%9Achromium%E8%B7%9Fchromedriver%E4%B8%8D%E4%B8%80%E6%A0%B7%EF%BC%8C%E4%BB%96%E8%B7%9F%E8%87%AA%E5%B7%B1%E5%B7%B2%E7%BB%8F%E5%AE%89%E8%A3%85%E7%9A%84chrome%E5%B9%B6%E6%B2%A1%E6%9C%89%E5%85%B3%E8%81%94%E3%80%82chromium%E8%87%AA%E5%B8%A6%E6%B5%8F%E8%A7%88%E5%99%A8%E5%BC%95%E6%93%8E%E6%A0%B8%E5%BF%83%EF%BC%8C%E6%89%80%E4%BB%A5%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BD%E6%9C%80%E6%96%B0%E7%9A%84%E7%89%88%E6%9C%AC%E5%8D%B3%E5%8F%AF%EF%BC%8C%E6%AF%94%E5%A6%82%E6%88%91%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BD%E7%9A%84%E5%B0%B1%E6%98%AF999303%E3%80%82" target="_blank" rel="noopener">https://registry.npmmirror.com/binary.html?path=chromium-browser-snapshots/Win_x64/ï¼Œæ³¨ï¼šchromiumè·Ÿchromedriverä¸ä¸€æ ·ï¼Œä»–è·Ÿè‡ªå·±å·²ç»å®‰è£…çš„chromeå¹¶æ²¡æœ‰å…³è”ã€‚chromiumè‡ªå¸¦æµè§ˆå™¨å¼•æ“æ ¸å¿ƒï¼Œæ‰€ä»¥ç›´æ¥ä¸‹è½½æœ€æ–°çš„ç‰ˆæœ¬å³å¯ï¼Œæ¯”å¦‚æˆ‘ç›´æ¥ä¸‹è½½çš„å°±æ˜¯999303ã€‚</a></p><p>å¯å‘äºï¼š<a href="https://cloud.tencent.com/developer/article/1731720" target="_blank" rel="noopener">ä½¿ç”¨pyppeteer ä¸‹è½½chromium æŠ¥é”™ æˆ–é€Ÿåº¦æ…¢</a>ã€<a href="https://www.cnblogs.com/Summer-skr--blog/p/12020207.html" target="_blank" rel="noopener">pyppeteerä½¿ç”¨æ—¶å¸¸è§çš„bugåŠè§£å†³åŠæ³•ã€è½¬è½½ã€‘ </a></p><ul><li>ğŸ“–pyppeteerå®æˆ˜æ¡ˆä¾‹ï¼š<a href="https://blog.csdn.net/weixin_44826986/article/details/124114130" target="_blank" rel="noopener">Pyppeteerçš„ä½¿ç”¨â€”â€”çˆ¬å–äº¬ä¸œ</a>â€”â€”æ¶ˆé™¤æŒ‡çº¹ã€é¡µé¢æ»‘åŠ¨äº‹ä»¶ã€è·å–æ•°æ®ï¼Œè·å–åˆ°çš„æ˜¯Jsonæ•°æ®ï¼š<code>(await a[0].getProperty(&quot;textContent&quot;)).jsonValue()</code></li><li>ğŸ“–å®˜æ–¹APIï¼š <a href="https://pyppeteer.github.io/pyppeteer/reference.html#pyppeteer.page.Page.xpath%E3%80%81" target="_blank" rel="noopener">https://pyppeteer.github.io/pyppeteer/reference.html#pyppeteer.page.Page.xpathã€</a><a href="https://learnku.com/docs/puppeteer/3.1.0/class-mouse/8549" target="_blank" rel="noopener">puppeteerä¸­æ–‡æ‰‹å†Œ</a></li><li><a href="https://www.pythonheidong.com/blog/article/1133668/afc4477523a740d64a23/" target="_blank" rel="noopener">setViewportå…¨å±</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;éªŒè¯ç é—®é¢˜&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#éªŒè¯ç é—®é¢˜&quot;&gt;&lt;/a&gt; éªŒè¯ç é—®é¢˜&lt;/h2&gt;
&lt;p&gt;è¯¥ç½‘ç«™å¯¹é¢‘ç‡æ£€æµ‹ååˆ†æ•æ„Ÿï¼Œå¾ˆå¿«å°±ä¼šå‡ºç°&amp;quot;æŒ‰ä½&amp;quot;éªŒè¯ç ï¼Œæ¨¡æ‹ŸæŒ‰ä½å€’ä¸éš¾ï¼Œä½†æ˜¯æŒ‰å®Œä»¥åæœ‰æ—¶å¹¶ä¸èƒ½è§£å†³éªŒè¯â€¦&lt;/
      
    
    </summary>
    
    
      <category term="çˆ¬è™«" scheme="https://nymrli.top/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="Python" scheme="https://nymrli.top/tags/Python/"/>
    
      <category term="ç¯å¢ƒé…ç½®" scheme="https://nymrli.top/tags/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    
  </entry>
  
  <entry>
    <title>2022å¹´5æœˆåŠ³åŠ¨èŠ‚çˆ¬è™«é¡¹ç›®è®°å½•</title>
    <link href="https://nymrli.top/2022/05/02/2022%E5%B9%B45%E6%9C%88%E5%8A%B3%E5%8A%A8%E8%8A%82%E7%88%AC%E8%99%AB%E9%A1%B9%E7%9B%AE%E8%AE%B0%E5%BD%95/"/>
    <id>https://nymrli.top/2022/05/02/2022å¹´5æœˆåŠ³åŠ¨èŠ‚çˆ¬è™«é¡¹ç›®è®°å½•/</id>
    <published>2022-05-02T05:23:11.000Z</published>
    <updated>2022-05-07T09:01:50.250Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é±¼"><a class="markdownIt-Anchor" href="#é±¼"></a> é±¼</h1><h2 id="retryæ¨¡å—"><a class="markdownIt-Anchor" href="#retryæ¨¡å—"></a> retryæ¨¡å—</h2><p>retryæ˜¯ä¸€ä¸ªç”¨äºé”™è¯¯å¤„ç†çš„æ¨¡å—ï¼ŒåŠŸèƒ½ç±»ä¼¼try-exceptï¼Œä½†å¯ä»¥æ›´åŠ å¿«æ·æ–¹ä¾¿çš„è®¾ç½®é‡è¯•çš„æ¬¡æ•°ï¼Œä»¥åŠæ¯æ¬¡é‡è¯•ä¹‹é—´ç›¸éš”çš„æ—¶é—´ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@retry()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_trouble</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">'''Retry until succeed'''</span></span><br><span class="line">    <span class="keyword">print</span> (<span class="string">'retrying...'</span>)</span><br></pre></td></tr></table></figure><ul><li><p>exceptionsï¼šä¼ å…¥æŒ‡å®šçš„é”™è¯¯ç±»å‹ï¼Œé»˜è®¤ä¸ºExceptionï¼Œå³æ•è·æ‰€æœ‰ç±»å‹çš„é”™è¯¯ï¼Œä¹Ÿå¯ä¼ å…¥<strong>å…ƒç»„å½¢å¼çš„å¤šç§æŒ‡å®šé”™è¯¯ç±»å‹</strong>ã€‚</p></li><li><p>triesï¼šå®šä¹‰æ•è·é”™è¯¯ä¹‹åé‡å¤è¿è¡Œæ¬¡æ•°ï¼Œé»˜è®¤ä¸º-1ï¼Œå³ä¸ºæ— æ•°æ¬¡ã€‚</p></li><li><p>delayï¼šå®šä¹‰æ¯æ¬¡é‡å¤è¿è¡Œä¹‹é—´çš„åœé¡¿æ—¶é•¿ï¼Œå•ä½ç§’ï¼Œé»˜è®¤ä¸º0ï¼Œå³æ— åœé¡¿ã€‚</p></li><li><p>backoffï¼šå‘ˆæŒ‡æ•°å¢é•¿çš„æ¯æ¬¡é‡å¤è¿è¡Œä¹‹é—´çš„åœé¡¿æ—¶é•¿ï¼Œéœ€è¦é…åˆdelayæ¥ä½¿ç”¨ï¼Œè­¬å¦‚delayè®¾ç½®ä¸º3ï¼Œbackoffè®¾ç½®ä¸º2ï¼Œåˆ™ç¬¬ä¸€æ¬¡é—´éš”ä¸º<code>3*2^0=3</code>ç§’ï¼Œç¬¬äºŒæ¬¡<code>3*2^1=6</code>ç§’ï¼Œç¬¬ä¸‰æ¬¡<code>3*2^2</code>=12ç§’ï¼Œä»¥æ­¤ç±»æ¨ï¼Œé»˜è®¤ä¸º1ã€‚</p></li><li><p>max_delayï¼šå®šä¹‰backoffå’Œdelayé…åˆä¸‹å‡ºç°çš„æœ€å¤§ç­‰å¾…æ—¶é—´ä¸Šé™ï¼Œå½“</p><p><code>delay*backoff**n</code>å¤§äºmax_delayæ—¶ï¼Œç­‰å¾…é—´éš”å›ºå®šä¸ºè¯¥å€¼è€Œä¸å†å¢é•¿ã€‚</p></li></ul><h2 id="é¡¹ç›®ç»“æ„"><a class="markdownIt-Anchor" href="#é¡¹ç›®ç»“æ„"></a> é¡¹ç›®ç»“æ„</h2><blockquote><p>å…³äºé¡¹ç›®ç»“æ„ç»„ç»‡ã€‚ç”±äºPythonåœ¨æ‰§è¡Œç¨‹åºæ—¶ï¼Œä¼šè‡ªåŠ¨å°†<code>.</code>å³å½“å‰è·¯å¾„åŠ å…¥åˆ°åº“æœç´¢è·¯å¾„ï¼Œæ‰€ä»¥å½“ä¸‹è·¯å¾„ä¸‹çš„åŒ…ï¼ˆæ–‡ä»¶å¤¹ä¸‹æœ‰<code>__init__.py</code>ï¼‰éƒ½èƒ½è¢«æ£€æµ‹åˆ°ä½¿ç”¨ï¼Œå¦‚ä¸‹é¢çš„handlerã€helperéƒ½å¯ä»¥ç›´æ¥åœ¨å…¶ä»–æ–‡ä»¶é‡Œé€šè¿‡<code>helper.xxx</code>æ¥è°ƒç”¨ï¼Œä½†æ˜¯é¡¶å±‚çš„<code>settings.py</code>ä¸èƒ½é€šè¿‡<code>feiyu_shoot.settings</code>æ¥è°ƒç”¨ï¼Œå³ä½¿feiyu_shootå·¥ç¨‹ä¸‹ä¹Ÿæœ‰<code>__init__.py</code>ï¼Œå› ä¸ºé¡¹ç›®å·¥ç¨‹çš„ä¸Šå±‚ç›®å½•å¹¶æ²¡æœ‰åŠ å…¥åˆ°Pythonç¯å¢ƒæœç´¢ä¸­ï¼Œæ‰€ä»¥ä»–å®é™…ä¸çŸ¥é“è°æ˜¯<code>feiyu_shoot</code></p><p>å› æ­¤ï¼Œæ ¹æ®è¿™ç§è®¾è®¡ï¼Œå¯ä»¥å°†é¡¹ç›®ç»“æ„ç»„ç»‡æˆä¸¤ç§</p></blockquote><ol><li><p>ä¸ä¾èµ–å­æ¨¡å—çš„æ”¾åœ¨rootç›®å½•çš„topæ¥å£ï¼šéœ€è¦è¢«å…¶ä»–æ–‡ä»¶å¼•ç”¨çš„åˆ—å…¥æ–‡ä»¶å¤¹ä¸­ä½œä¸ºåº“ä½¿ç”¨ï¼Œä¸éœ€è¦è¢«å¼•ç”¨çš„å¯ä»¥ç›´æ¥æ”¾é¡¶å±‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># helper/runner.py</span></span><br><span class="line"><span class="comment"># handler/ åœ¨.ä¸‹ä½œä¸ºåŒ…å¯¼å…¥</span></span><br><span class="line"><span class="keyword">from</span> handler imoprt ConfigHandler</span><br><span class="line"><span class="comment"># settings.py åœ¨.ä¸‹ä½œä¸ºæ¨¡å—å¯¼å…¥</span></span><br><span class="line"><span class="keyword">from</span> settings <span class="keyword">import</span> USER_AGENT</span><br></pre></td></tr></table></figure><p><img src="/2022/05/02/2022å¹´5æœˆåŠ³åŠ¨èŠ‚çˆ¬è™«é¡¹ç›®è®°å½•/F:%5CaDevelopment%5CPython%5CpythonGitProject%5Cfeiyu_shoot%5Cdebugs%5CtopFile.jpg" alt="topFile"></p></li><li><p>â˜…å°†å…¥å£æ”¾åœ¨æœ€å¤–å±‚ï¼Œæ ¸å¿ƒå†…å®¹ä½œä¸ºå•ç‹¬ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ˆæ¨¡å—ï¼‰ï¼šç”±äºfeiyuæ˜¯ä¸ªæ•´ä½“çš„åŒ…ï¼Œæ‰€ä»¥åœ¨feiyuä¸‹çš„ä»»æ„Pythonæ–‡ä»¶ä¸­éƒ½å¯ä»¥é€šè¿‡<code>from feiyu.xxx import yyy</code>æ¥å¯¼å…¥ã€‚</p></li></ol><p><img src="/2022/05/02/2022å¹´5æœˆåŠ³åŠ¨èŠ‚çˆ¬è™«é¡¹ç›®è®°å½•/F:%5CaDevelopment%5CPython%5CpythonGitProject%5Cfeiyu_shoot%5Cdebugs%5ConeEntry.jpg" alt="oneEntry"></p><p>æ ¹æ®<a href="https://www.jianshu.com/p/e33b4f0373bc" target="_blank" rel="noopener">Pythonæ‰“åŒ…åˆ©å™¨ï¼šauto-py-to-exe</a>ä¸­æ‰“åŒ…è®¡ç®—æœºç¨‹åºçš„æ–¹å¼ï¼Œæ›´æ¨èç¬¬äºŒç§ï¼Œè¿™æ ·ä»£ç èµ„æºæ–‡ä»¶ä½ç½®æ›´ç»Ÿä¸€ï¼Œä¹Ÿæ›´åŠ æ¸…æ™°ä¸€äº›ã€‚</p><p>moreï¼š [Pythonä¸­æ¨¡å—ã€åŒ…ã€åº“å®šä¹‰](</p><h2 id="pyinstaller"><a class="markdownIt-Anchor" href="#pyinstaller"></a> pyinstaller</h2><blockquote><p>è‡ªæˆ‘å­¦Pythonä»¥æ¥æ¨èçš„å°±æ˜¯è¿™ä¸ªï¼Œç»è¿‡æ—¶å…‰å˜è¿ï¼Œè¿™ä¸ªä»ç„¶æ˜¯ä¸»æµã€‚</p><ul><li>PyInstalleræ˜¯<strong>ä¸€ä¸ªè·¨å¹³å°</strong>çš„Pythonåº”ç”¨æ‰“åŒ…å·¥å…·ï¼Œæ”¯æŒ Windows/Linux/MacOSä¸‰å¤§ä¸»æµå¹³å°ï¼Œèƒ½å¤ŸæŠŠ Python è„šæœ¬åŠå…¶æ‰€åœ¨çš„ Python è§£é‡Šå™¨æ‰“åŒ…æˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä»è€Œå…è®¸æœ€ç»ˆç”¨æˆ·åœ¨æ— éœ€å®‰è£… Python çš„æƒ…å†µä¸‹æ‰§è¡Œåº”ç”¨ç¨‹åºã€‚</li><li>PyInstaller åˆ¶ä½œå‡ºæ¥çš„<strong>æ‰§è¡Œæ–‡ä»¶å¹¶ä¸æ˜¯è·¨å¹³å°çš„</strong>ï¼Œå¦‚æœéœ€è¦ä¸ºä¸åŒå¹³å°æ‰“åŒ…ï¼Œå°±è¦åœ¨ç›¸åº”å¹³å°ä¸Šè¿è¡ŒPyInstallerè¿›è¡Œæ‰“åŒ…ã€‚</li><li>PyInstalleræ‰“åŒ…çš„æµç¨‹ï¼šè¯»å–ç¼–å†™å¥½çš„Pythoné¡¹ç›®â€“&gt;åˆ†æå…¶ä¸­æ¡ç”¨çš„æ¨¡å—å’Œåº“ï¼Œå¹¶æ”¶é›†å…¶æ–‡ä»¶å‰¯æœ¬ï¼ˆåŒ…æ‹¬Pythonçš„è§£é‡Šå™¨ï¼‰â€“&gt;å°†å‰¯æœ¬å’ŒPythoné¡¹ç›®æ–‡ä»¶ï¼ˆæ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹//å°è£…åœ¨ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼‰ä¸­ã€‚</li></ul></blockquote><p>å®‰è£…å°±ä¸ç»†è¯´äº†ï¼Œä¸»è¦è®²ç”¨æ³•ï¼š</p><ul><li><p>é€šè¿‡å‘½ä»¤è¡Œå‘½ä»¤æ‰“åŒ…<code>pyinstaller -F main.py</code>ï¼Œå¸¸ç”¨å‚æ•°</p><ul><li>-Fï¼š è¡¨ç¤ºç”Ÿæˆå•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼›å¯¹åº”çš„æ˜¯-Dï¼š ç”Ÿæˆæ–‡ä»¶å¤¹å½¢å¼çš„å¯æ‰§è¡Œç¨‹åºï¼ˆé»˜è®¤ï¼‰</li><li>-wï¼š è¡¨ç¤ºå»æ‰æ§åˆ¶å°çª—å£ï¼Œè¿™åœ¨GUIç•Œé¢æ—¶éå¸¸æœ‰ç”¨ã€‚ä¸è¿‡å¦‚æœæ˜¯å‘½ä»¤è¡Œç¨‹åºçš„è¯é‚£å°±æŠŠè¿™ä¸ªé€‰é¡¹åˆ é™¤å§ï¼</li><li>-pï¼š è¡¨ç¤ºä½ è‡ªå·±è‡ªå®šä¹‰éœ€è¦åŠ è½½çš„åº“è·¯å¾„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ç”¨ä¸åˆ°</li><li>-iï¼š è¡¨ç¤ºå¯æ‰§è¡Œæ–‡ä»¶çš„å›¾æ ‡</li></ul></li><li><p>é€šè¿‡<code>.spec</code>æ‰“åŒ…å®šä¹‰æ–‡ä»¶æ¥æ‰“åŒ…ï¼Œå¯¹åº”å‘½ä»¤è¡Œçš„å‚æ•°ï¼Œ<code>.spec</code>æ–‡ä»¶éƒ½ä¼šæœ‰å¯¹åº”çš„ç”Ÿæˆå†…å®¹ã€‚</p><blockquote><p>é¦–å…ˆæ ¹æ®mainæ–‡ä»¶ç”Ÿæˆspecæ–‡ä»¶: <code>pyi-makespec -D main.py</code>ã€å¡«å†™å¥½åå†<code>pyinstaller main.spec</code></p></blockquote><ul><li>-Dæ˜¯è®©specä¸­å¤šä¸€ä¸ªcollçš„å®ä¾‹ï¼Œä»è€Œå˜æˆæ–‡ä»¶å¤¹</li><li><code>-i</code>ç›¸å½“äº<code>.spec</code>ä¸­EXEä¸­<code>icon=&quot;.\\debugs\\favicon.ico&quot;</code></li><li>â€¦(æ›´å¤šspecæ–‡ä»¶å‚æ•°é€‰æ‹©è§ï¼š<a href="https://blog.csdn.net/tangfreeze/article/details/112240342" target="_blank" rel="noopener">https://blog.csdn.net/tangfreeze/article/details/112240342</a>)</li><li>-p: ç›¸å½“äºAnalysiså®ä¾‹ä¸­çš„<code>pathex</code>ï¼Œå°±æ˜¯å¡«å…¥è‡ªå·±çš„æ¨¡å—</li><li>â€“hiden-import: ç›¸å½“äºAnalysiså®ä¾‹ä¸­çš„hiddenimports</li></ul></li></ul><p>å®é™…ä¸Šï¼Œæ ¹æ®å‘½ä»¤è¡Œçš„å‚æ•°ä¼šç”Ÿæˆå¯¹åº”çš„<code>.spec</code>æ–‡ä»¶ã€‚</p><p>æ³¨ï¼šå¯ä»¥çœ‹åˆ°æ— è®ºæ˜¯<code>pyinstaller</code>ã€<code>pyi-makespec</code>åé¢éƒ½æ˜¯<code>main.py</code>ï¼Œå› ä¸ºå…¶æ˜¯mainå‡½æ•°å…¥å£æ–‡ä»¶</p><p>é™„ï¼šæ ¹æ®feiyuï¼Œåœ¨æ­¤åˆ—ä¸¤ä¸ªå¯è¡Œçš„ï¼š</p><ul><li><p><code>F:\aDevelopment\Python\ShowYourCode\env\Scripts\pyinstaller.exe main.py --add-data=&quot;feiyu\push_config.ini;.\feiyu&quot; --add-data=&quot;feiyu\user_config.toml;.\feiyu&quot; -i debugs\favicon.ico</code></p></li><li><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- mode: python ; coding: utf-8 -*-</span></span><br><span class="line">block_cipher = <span class="keyword">None</span> <span class="comment"># æ­¤å¤„åœ¨ä½¿ç”¨--key= ä¼šæœ‰å˜åŒ–</span></span><br><span class="line"></span><br><span class="line">a = Analysis([<span class="string">'ai\\main.py'</span>],</span><br><span class="line">             pathex=[<span class="string">'C:\\Users\\Admin\\Downloads\\marsai-master'</span>],</span><br><span class="line">             binaries=[],</span><br><span class="line">             datas=[],<span class="comment"># æ­¤å¤„å¯ä»¥æ·»åŠ é™æ€èµ„æºï¼Œä¾‹å¦‚ä½ æœ‰ä¸ªå›¾ç‰‡æ–‡ä»¶å¤¹imgsï¼Œå¯ä»¥è¿™æ ·å†™[('imgs','imgs'),('test.txt','.')]ï¼Œæ‰“åŒ…ä»¥åä¼šæœ‰ä¸€ä¸ªä¸€æ ·çš„æ–‡ä»¶å¤¹ï¼Œç‚¹è¡¨ç¤ºå½“å‰æ–‡ä»¶å¤¹ã€‚</span></span><br><span class="line">             hiddenimports=[],</span><br><span class="line">             hookspath=[],</span><br><span class="line">             runtime_hooks=[],</span><br><span class="line">             excludes=[],</span><br><span class="line">             win_no_prefer_redirects=<span class="keyword">False</span>,</span><br><span class="line">             win_private_assemblies=<span class="keyword">False</span>,</span><br><span class="line">             cipher=block_cipher,</span><br><span class="line">             noarchive=<span class="keyword">False</span>)</span><br><span class="line">pyz = PYZ(a.pure, a.zipped_data,</span><br><span class="line">             cipher=block_cipher)</span><br><span class="line">exe = EXE(pyz,</span><br><span class="line">          a.scripts,</span><br><span class="line">          [],</span><br><span class="line">          exclude_binaries=<span class="keyword">True</span>,</span><br><span class="line">          name=<span class="string">'main'</span>, <span class="comment"># ç”Ÿæˆçš„exeçš„åå­—</span></span><br><span class="line">          debug=<span class="keyword">False</span>,</span><br><span class="line">          bootloader_ignore_signals=<span class="keyword">False</span>,</span><br><span class="line">          strip=<span class="keyword">False</span>,</span><br><span class="line">          upx=<span class="keyword">True</span>, <span class="comment"># æ‰“åŒ…çš„æ—¶å€™è¿›è¡Œå‹ç¼©ï¼ŒFalseè¡¨ç¤ºä¸å‹ç¼©</span></span><br><span class="line">          console=<span class="keyword">True</span> <span class="comment"># æ˜¯å¦æ˜¾ç¤ºé»‘çª—å£ï¼Œåˆšå¼€å§‹æ‰“åŒ…çš„æ—¶å€™ä¸€èˆ¬éƒ½ä¼šæœ‰é—®é¢˜ï¼Œå»ºè®®è®¾ä¸ºTrueï¼Œè§£å†³æ‰€æœ‰é—®é¢˜åå¯ä»¥è®¾ç½®ä¸ºFalse)</span></span><br><span class="line">coll = COLLECT(exe,</span><br><span class="line">               a.binaries,</span><br><span class="line">               a.zipfiles,</span><br><span class="line">               a.datas,</span><br><span class="line">               strip=<span class="keyword">False</span>,</span><br><span class="line">               upx=<span class="keyword">True</span>,</span><br><span class="line">               upx_exclude=[],</span><br><span class="line">               name=<span class="string">'main'</span> <span class="comment"># æ–‡ä»¶å¤¹çš„åå­—)</span></span><br></pre></td></tr></table></figure></li></ul><p>pyinstallerå…¨éƒ½æ˜¯æ§åˆ¶å°çš„å‘½ä»¤ï¼Œå› æ­¤æ²¡é‚£ä¹ˆç›´è§‚ï¼Œæœ‰äººåšäº†GUIç›¸å¯¹ç›´ç™½ã€ç®€å•äº›ï¼Œè§<a href="https://www.jianshu.com/p/e33b4f0373bc" target="_blank" rel="noopener">Pythonæ‰“åŒ…åˆ©å™¨ï¼šauto-py-to-exe</a>ï¼Œå…¶å…³äºè®¡ç®—å™¨ç¨‹åºä¸<code>Additional Files</code>çš„ä½¿ç”¨ä¼šè®©äººå¯¹é¡¹ç›®è¯¥å¦‚æœå¸ƒç½®ç»“æ„å’Œä½¿ç”¨<code>-p</code>å‚æ•°æœ‰ä¸ªæ›´ç¡®ä¿¡çš„è®¤è¯†ï¼ˆå¯¼å…¥è‡ªå·±äº›çš„æ¨¡å—ï¼‰ã€‚</p><h2 id="dataclass"><a class="markdownIt-Anchor" href="#dataclass"></a> dataclass</h2><h4 id="dataclassesåµŒå¥—"><a class="markdownIt-Anchor" href="#dataclassesåµŒå¥—"></a> dataclassesåµŒå¥—</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">nested_dataclass</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(cls)</span>:</span></span><br><span class="line">        cls = dataclass(cls, **kwargs)</span><br><span class="line">        original_init = cls.__init__</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">            <span class="keyword">for</span> name, value <span class="keyword">in</span> kwargs.items():</span><br><span class="line">                <span class="comment"># æ³¨æ„__annotations__å±æ€§</span></span><br><span class="line">                field_type = cls.__annotations__.get(name, <span class="keyword">None</span>)</span><br><span class="line">                <span class="keyword">if</span> is_dataclass(field_type) <span class="keyword">and</span> isinstance(value, dict):</span><br><span class="line">                    new_obj = field_type(**value)</span><br><span class="line">                    kwargs[name] = new_obj</span><br><span class="line">                <span class="keyword">if</span> isinstance(value, list) <span class="keyword">and</span> is_dataclass(field_type[<span class="number">0</span>]):</span><br><span class="line">                    res = []</span><br><span class="line">                    <span class="keyword">for</span> c <span class="keyword">in</span> value:</span><br><span class="line">                        new_obj = field_type[<span class="number">0</span>](**c)</span><br><span class="line">                        res.append(new_obj)</span><br><span class="line">                    kwargs[name] = res</span><br><span class="line">            original_init(self, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">        cls.__init__ = __init__</span><br><span class="line">        <span class="keyword">return</span> cls</span><br><span class="line">    <span class="keyword">return</span> wrapper(args[<span class="number">0</span>]) <span class="keyword">if</span> args <span class="keyword">else</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨</span></span><br><span class="line"><span class="meta">@nested_dataclass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TagResult</span>:</span></span><br><span class="line">    <span class="string">"""æ‹å–å±•ç¤ºçš„åˆ†é¡µç»“æœ"""</span></span><br><span class="line">    <span class="comment"># å½“å‰é¡µä¸‹å…·ä½“å•†å“çš„ä¿¡æ¯</span></span><br><span class="line">    content: [Content]</span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure><p><code>**</code>è§£åŒ…å¾—åˆ°çš„é¢å¤–ä¿¡æ¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment"># é¢å¤–ä¿¡æ¯</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_kwargs</span><span class="params">(cls, **kwargs)</span>:</span></span><br><span class="line">        <span class="comment"># split the kwargs into native ones and new ones</span></span><br><span class="line">        native_args, new_args = &#123;&#125;, &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> name, val <span class="keyword">in</span> kwargs.items():</span><br><span class="line">            <span class="keyword">if</span> name <span class="keyword">in</span> cls.__annotations__:</span><br><span class="line">                native_args[name] = val</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                new_args[name] = val</span><br><span class="line"></span><br><span class="line">        <span class="comment"># use the native ones to create the class ...</span></span><br><span class="line">        ret = cls(**native_args)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ... and add the new ones by hand</span></span><br><span class="line">        <span class="keyword">for</span> new_name, new_val <span class="keyword">in</span> new_args.items():</span><br><span class="line">            setattr(ret, new_name, new_val)</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">return</span> Goods.from_kwargs(**resp) <span class="keyword">if</span> resp <span class="keyword">else</span> <span class="keyword">None</span></span><br></pre></td></tr></table></figure><p><code>pydantic.dataclasses.dataclass</code>æ˜¯<code>dataclasses.dataclass with validation</code>çš„æ›¿ä»£å“, è€Œä¸æ˜¯<code>pydantic.BaseModel</code> çš„æ›¿ä»£å“ï¼ˆåœ¨åˆå§‹åŒ–æŒ‚é’©çš„å·¥ä½œæ–¹å¼ä¸Šæœ‰ä¸€ç‚¹ä¸åŒï¼‰ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå°†<code>pydanticis.BaseModel</code>å­ç±»åŒ–æ˜¯æ›´å¥½çš„é€‰æ‹©.</p><h2 id="tomlè¯­æ³•å­¦ä¹ "><a class="markdownIt-Anchor" href="#tomlè¯­æ³•å­¦ä¹ "></a> tomlè¯­æ³•å­¦ä¹ </h2><blockquote><p>TOMLæ˜¯å‰GitHub CEOï¼Œ Tom Preston-Wernerï¼Œäº2013å¹´åˆ›å»ºçš„è¯­è¨€ï¼Œå…¶ç›®æ ‡æ˜¯æˆä¸ºä¸€ä¸ªå°è§„æ¨¡çš„æ˜“äºä½¿ç”¨çš„è¯­ä¹‰åŒ–é…ç½®æ–‡ä»¶æ ¼å¼.TOMLæ˜¯å¤§å°å†™æ•æ„Ÿçš„ï¼Œå¿…é¡»æ˜¯UTF-8ç¼–ç ã€‚</p></blockquote><h3 id="tomlå¯¹è±¡"><a class="markdownIt-Anchor" href="#tomlå¯¹è±¡"></a> tomlå¯¹è±¡</h3><p><strong>å­—ç¬¦ä¸²</strong>ï¼šè·Ÿpythonä¸­ä¸€æ ·ï¼Œ<code>&quot;&quot;&quot;</code>ã€<code>&quot;</code>ã€<code>'</code>ã€<code>'''</code></p><p><strong>æ³¨é‡Š</strong>ï¼š<code>#</code></p><p><strong>æ•°ç»„</strong>ï¼šæ•°ç»„ä½¿ç”¨æ–¹æ‹¬å·åŒ…è£¹ã€‚ç©ºæ ¼ä¼šè¢«å¿½ç•¥ï¼ŒåŒ…æ‹¬æ¢è¡Œç¬¦ã€‚å…ƒç´ ä½¿ç”¨é€—å·åˆ†éš”ã€‚</p><p><strong>æ—¥æœŸæ—¶é—´</strong>ï¼štomlä¸­æ—¥æœŸæ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œè·Ÿæ•°ç»„ä¸€æ ·</p><p><strong>é”®å€¼å¯¹</strong></p><blockquote><p>TOML æ–‡æ¡£çš„ä¸»è¦æ„å»ºå—</p></blockquote><ul><li><strong>é”®</strong>å¯ä»¥æ˜¯è£¸éœ²çš„<strong>è£¸é”®</strong>ï¼Œä¹Ÿå¯ä»¥æ˜¯è¢«åŒ…è£¹åœ¨ä¸€å¯¹ <code>&quot;</code> çš„å†…éƒ¨çš„<strong>å¼•ç”¨é”®</strong>ã€‚<strong>è£¸é”®</strong>åªèƒ½å­˜åœ¨å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œç ´æŠ˜å·ï¼ˆ<code>a-zã€A-Zã€0-9ã€-</code>ï¼‰ã€‚æ³¨æ„ï¼Œ<strong>è£¸é”®</strong>å¯ä»¥åªç”±æ•°å­—ç»„æˆï¼Œä¾‹å¦‚ <code>1234</code>ï¼Œä½†å®ƒæ€»æ˜¯è¢«è§£æä¸ºå­—ç¬¦ä¸²ã€‚<strong>å¼•ç”¨é”®</strong>éµå¾ªä¸<strong>åŸºæœ¬å­—ç¬¦ä¸²</strong>æˆ–<strong>å­—é¢å­—ç¬¦ä¸²</strong>å®Œå…¨ç›¸åŒçš„è§„èŒƒï¼Œå¹¶å…è®¸ä½¿ç”¨æ›´å¹¿æ³›çš„é”®åç§°ã€‚æœ€å¥½çš„åšæ³•æ˜¯ä½¿ç”¨<strong>è£¸é”®</strong>ï¼Œé™¤éå¿…è¦æƒ…å†µã€‚</li><li><em>å€¼<strong>å¯ä»¥æ˜¯ä»¥ä¸‹ç±»å‹ï¼š<strong>å­—ç¬¦ä¸²</strong>ã€<strong>æ•´æ•°</strong>ã€<strong>æµ®ç‚¹æ•°</strong>ã€<strong>å¸ƒå°”å€¼</strong>ã€<strong>æ—¶é—´</strong>ã€<strong>æ•°ç»„</strong>æˆ–</strong>å†…è”è¡¨</em>*ã€‚æœªç¡®å®šçš„å€¼æ˜¯éæ³•çš„ã€‚</li><li>æ³¨ï¼š<strong>é”®</strong>å’Œ<strong>å€¼</strong>å‘¨å›´çš„ç©ºç™½ç¬¦å¿½ç•¥ä¸è®¡ï¼Œ<strong>é”®</strong>ã€<code>=</code> å’Œ<strong>å€¼</strong>å¿…é¡»ä½äºåŒä¸€è¡Œ</li></ul><p><strong>è¡¨æ ¼</strong></p><ul><li><p>ç©ºè¡¨æ˜¯å…è®¸çš„ï¼Œåªè¦é‡Œé¢æ²¡æœ‰é”®å€¼å¯¹å°±è¡Œäº†ã€‚</p></li><li><p><strong>è¡¨ä¸èƒ½å®šä¹‰å¤šäºä¸€æ¬¡</strong>ï¼Œä¸å…è®¸ä½¿ç”¨ <code>[table]</code> å¤´é‡å®šä¹‰è¿™æ ·çš„è¡¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># ä¸è¦è¿™æ ·åš</span><br><span class="line"></span><br><span class="line">[fruit]</span><br><span class="line">apple = &quot;çº¢&quot;</span><br><span class="line"></span><br><span class="line">[fruit]</span><br><span class="line">orange = &quot;æ©™&quot;</span><br></pre></td></tr></table></figure></li><li><p>åŒæ ·åœ°ï¼Œä½¿ç”¨ç‚¹åˆ†éš”é”®æ¥é‡å®šä¹‰å·²ç»ä»¥ <code>[table]</code> å½¢å¼å®šä¹‰è¿‡çš„è¡¨ä¹Ÿæ˜¯ä¸å…è®¸çš„ã€‚</p></li><li><p>ä¸è¿‡ï¼Œ<code>[table]</code> å½¢å¼å¯ä»¥è¢«ç”¨æ¥å®šä¹‰é€šè¿‡ç‚¹åˆ†éš”é”®å®šä¹‰çš„è¡¨ä¸­çš„<strong>å­è¡¨</strong>ã€‚</p></li><li><p>ä¸é¼“åŠ±æ— åºåœ°å®šä¹‰è¡¨ï¼Œå³åŒçº§åˆ«å­è¡¨å»ºè®®æ”¾åœ¨ä¸€èµ·å®šä¹‰</p></li></ul><p><strong>å†…è”è¡¨</strong>ï¼š</p><blockquote><p>å†…è”è¡¨æä¾›äº†ä¸€ç§æ›´ä¸º<strong>ç´§å‡‘çš„è¯­æ³•</strong>æ¥è¡¨ç¤ºè¡¨ã€‚</p><p>å†…è”è¡¨è¢«å®Œæ•´åœ°å®šä¹‰åœ¨èŠ±æ‹¬å·ä¹‹ä¸­ï¼š<code>{</code> å’Œ <code>}</code>ã€‚ æ‹¬å·ä¸­ï¼Œå¯ä»¥å‡ºç°é›¶æˆ–æ›´å¤šä¸ªä»¥é€—å·åˆ†éš”çš„é”®å€¼å¯¹ã€‚</p></blockquote><ul><li>å†…è”è¡¨å¾—å‡ºç°åœ¨åŒä¸€è¡Œå†…ã€‚</li><li>å†…è”è¡¨ä¸­ï¼Œæœ€åä¸€å¯¹é”®å€¼å¯¹å<strong>ä¸å…è®¸ç»ˆé€—å·</strong>ï¼ˆä¹Ÿç§°ä¸ºå°¾é€—å·ï¼‰ã€‚</li><li>ä¸å…è®¸èŠ±æ‹¬å·ä¸­å‡ºç°ä»»ä½•æ¢è¡Œï¼Œé™¤éåœ¨å€¼ä¸­å®ƒä»¬åˆæ³•ã€‚</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name</span> = &#123; first = <span class="string">"Tom"</span>, last = <span class="string">"Preston-Werner"</span> &#125;</span><br><span class="line"><span class="attr">point</span> = &#123; x = <span class="number">1</span>, y = <span class="number">2</span> &#125;</span><br><span class="line"><span class="attr">animal</span> = &#123; type.name = <span class="string">"pug"</span> &#125;</span><br><span class="line"><span class="comment"># ç­‰ä»·äº</span></span><br><span class="line"><span class="section">[name]</span></span><br><span class="line"><span class="attr">first</span> = <span class="string">"Tom"</span></span><br><span class="line"><span class="attr">last</span> = <span class="string">"Preston-Werner"</span></span><br><span class="line"><span class="section">[point]</span></span><br><span class="line"><span class="attr">x</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">y</span> = <span class="number">2</span></span><br><span class="line"><span class="section">[animal]</span></span><br><span class="line">type.name = "pug"</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šå°±æ˜¯è¡¨çš„å¦ä¸€ç§ç´§å‡‘å†™æ³•ï¼Œå®šä¹‰çš„è¿˜æ˜¯è¡¨</p><p><strong><a href="https://toml.io/cn/v1.0.0#%E8%A1%A8%E6%95%B0%E7%BB%84" target="_blank" rel="noopener">è¡¨æ•°ç»„</a></strong></p><blockquote><p>è¡¨å¤´çš„ç¬¬ä¸€ä¾‹å®šä¹‰äº†è¿™ä¸ªæ•°ç»„åŠå…¶é¦–ä¸ªè¡¨å…ƒç´ ï¼Œè€Œåç»­çš„æ¯ä¸ªåˆ™åœ¨è¯¥æ•°ç»„ä¸­åˆ›å»ºå¹¶å®šä¹‰ä¸€ä¸ªæ–°çš„è¡¨å…ƒç´ ã€‚<br>è¿™äº›è¡¨æŒ‰å‡ºç°é¡ºåºæ’å…¥è¯¥æ•°ç»„ã€‚</p><p>é¦–å…ˆæ˜¯ä¸ªæ•°ç»„ï¼›å…¶æ¬¡ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ ä¸ºè¡¨å†…å®¹ã€‚</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[[products]]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">"Hammer"</span></span><br><span class="line"><span class="attr">sku</span> = <span class="number">738594937</span></span><br><span class="line"><span class="section">[[products]]</span>  <span class="comment"># æ•°ç»„é‡Œçš„ç©ºè¡¨</span></span><br><span class="line"><span class="section">[[products]]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">"Nail"</span></span><br><span class="line"><span class="attr">sku</span> = <span class="number">284758393</span></span><br><span class="line"><span class="attr">color</span> = <span class="string">"gray"</span></span><br><span class="line"><span class="comment"># ç­‰ä»·äº JSON çš„å¦‚ä¸‹ç»“æ„ã€‚</span></span><br><span class="line">&#123;</span><br><span class="line">  "products": [</span><br><span class="line">    &#123; "name": "Hammer", "sku": 738594937 &#125;,</span><br><span class="line">    &#123; &#125;,</span><br><span class="line">    &#123; "name": "Nail", "sku": 284758393, "color": "gray" &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ğŸ“–<a href="https://toml.io/cn/v1.0.0#%E8%A1%A8" target="_blank" rel="noopener">Tom çš„ï¼ˆè¯­ä¹‰ï¼‰æ˜æ˜¾ã€ï¼ˆé…ç½®ï¼‰æœ€å°åŒ–çš„è¯­è¨€â€”â€”ä¸­æ–‡æ‰‹å†Œ</a></p><p>åº“ï¼š</p><ul><li><p>Pythonï¼štoml</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> toml</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserConfigHandler</span><span class="params">(metaclass=Singleton)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">with</span> open(USER_PARAM_FILE, <span class="string">'r'</span>, encoding=<span class="string">"utf8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">            self.r = toml.load(f)</span><br></pre></td></tr></table></figure></li><li><p>Go: <code>go get github.com/BurntSushi/toml</code></p></li></ul><h2 id="è‡ªç”¨æŠ¢è´­å°è¯•"><a class="markdownIt-Anchor" href="#è‡ªç”¨æŠ¢è´­å°è¯•"></a> è‡ªç”¨æŠ¢è´­å°è¯•</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">order_auction_goods</span><span class="params">(self, goodsId: int, goodsName: str = <span class="string">""</span>, by_fail_time=False)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    ç«‹åˆ»æŠ¢æ‹, æä¾›â‘ æŒ‡å®šå°è¯•æ¬¡æ•°; â‘¡ç›´åˆ°æ²¡æŠ¢åˆ°ä¸ºæ­¢ ä¸¤ç§ç­–ç•¥</span></span><br><span class="line"><span class="string">    @param by_fail_time: å¤±è´¥æ¬¡æ•°é‡è¯• or ä¸æ–­é‡è¯•</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    tryTimes = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> by_fail_time:</span><br><span class="line">        resp = <span class="keyword">None</span></span><br><span class="line">        <span class="comment"># 3æ¬¡é‡è¯•</span></span><br><span class="line">        <span class="keyword">while</span> tryTimes &lt; self.config.userConfig.maxFailCount:</span><br><span class="line">            data = &#123;</span><br><span class="line">                <span class="string">'goodsId'</span>: str(goodsId),</span><br><span class="line">            &#125;</span><br><span class="line">            resp = self._post(self.URL.orderAuctionGoods, data=data, timeout=self.config.timeoutTime)</span><br><span class="line">            <span class="keyword">if</span> resp.get(<span class="string">"code"</span>) != <span class="number">0</span>:</span><br><span class="line">                tryTimes += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># æŠ¢è´­æˆåŠŸè¯´æ˜æœ‰</span></span><br><span class="line">                resp.update(&#123;<span class="string">"goodsId"</span>: str(goodsId), <span class="string">"goodsName"</span>: str(goodsName)&#125;)</span><br><span class="line">                <span class="keyword">return</span> resp</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        resp = &#123;&#125;</span><br><span class="line">        <span class="comment"># 3æ¬¡é‡è¯•</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> resp.get(<span class="string">"msg"</span>) <span class="keyword">or</span> <span class="string">"è§„å®šæ—¶é—´å†…æŠ¢æ‹"</span> <span class="keyword">in</span> resp.get(<span class="string">"msg"</span>):</span><br><span class="line">            data = &#123;</span><br><span class="line">                <span class="string">'goodsId'</span>: str(goodsId),</span><br><span class="line">            &#125;</span><br><span class="line">            resp = self._post(self.URL.orderAuctionGoods, data=data, timeout=self.config.timeoutTime)</span><br><span class="line">            tryTimes += <span class="number">1</span></span><br><span class="line">            <span class="comment"># æŠ¢è´­æˆåŠŸ resp.get("result") == true</span></span><br><span class="line">            <span class="keyword">if</span> resp.get(<span class="string">"result"</span>):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    resp.update(&#123;<span class="string">"goodsId"</span>: goodsId, <span class="string">"goodsName"</span>: goodsName&#125;)</span><br><span class="line">    <span class="keyword">return</span> resp, tryTimes</span><br></pre></td></tr></table></figure><h1 id="baseæ•°æ®åº“"><a class="markdownIt-Anchor" href="#baseæ•°æ®åº“"></a> baseæ•°æ®åº“</h1><h2 id="åˆ¤æ–­é‡å®šå‘"><a class="markdownIt-Anchor" href="#åˆ¤æ–­é‡å®šå‘"></a> åˆ¤æ–­é‡å®šå‘</h2><blockquote><p>ç”±äºæœ‰ä¸ªéœ€æ±‚æ˜¯ï¼Œæ²¡æœ‰investorå°±ä¸è¿›è¡Œçˆ¬å–ï¼Œè€Œæ˜¯å¦æœ‰investorå¯ä»¥é€šè¿‡<code>https://xxxx.com/company_finance/investors</code>ä¼šä¸ä¼šè¿›è¡Œé‡å®šå‘è¿›è¡Œåˆ¤æ–­</p></blockquote><p>é‚£ä¹ˆå¦‚ä½•åˆ¤æ–­æ˜¯å¦å‘ç”Ÿé‡å®šå‘å‘¢ï¼Ÿä¸¤ç§</p><ol><li>ç¦æ­¢<code>requests.get</code>çš„<code>allow_redirect</code>å±æ€§<br>1.</li><li>è¿è¡Œ<code>allow_redirect</code>ï¼Œç„¶åé€šè¿‡é‡å®šå‘historyæŸ¥çœ‹</li></ol><h2 id="å›¾ç‰‡æ‡’åŠ è½½"><a class="markdownIt-Anchor" href="#å›¾ç‰‡æ‡’åŠ è½½"></a> å›¾ç‰‡æ‡’åŠ è½½</h2><blockquote><p>å›¾ç‰‡æ‡’åŠ è½½æ˜¯ä¸€ç§ç½‘é¡µä¼˜åŒ–æŠ€æœ¯ã€‚å›¾ç‰‡ä½œä¸ºä¸€ç§ç½‘ç»œèµ„æºï¼Œåœ¨è¢«è¯·æ±‚æ—¶ä¹Ÿä¸æ™®é€šé™æ€èµ„æºä¸€æ ·ï¼Œå°†å ç”¨ç½‘ç»œèµ„æºï¼Œè€Œä¸€æ¬¡æ€§å°†æ•´ä¸ªé¡µé¢çš„æ‰€æœ‰å›¾ç‰‡åŠ è½½å®Œï¼Œå°†å¤§å¤§å¢åŠ <strong>é¡µé¢çš„é¦–å±åŠ è½½æ—¶é—´</strong>ã€‚ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œé€šè¿‡å‰åç«¯é…åˆï¼Œä½¿å›¾ç‰‡ä»…åœ¨æµè§ˆå™¨å½“å‰è§†çª—å†…å‡ºç°æ—¶æ‰åŠ è½½è¯¥å›¾ç‰‡ï¼Œè¾¾åˆ°å‡å°‘é¦–å±å›¾ç‰‡è¯·æ±‚æ•°çš„æŠ€æœ¯å°±è¢«ç§°ä¸ºâ€œå›¾ç‰‡æ‡’åŠ è½½â€â€”â€”ä¼˜å…ˆåŠ è½½ç½‘é¡µç»“æ„ï¼Œä»¥åŠé€»è¾‘è„šæœ¬ï¼Œç­‰é‡è¦å†…å®¹å…¨éƒ¨åŠ è½½å®Œæˆä¹‹åå†åŠ è½½é‡è¦ä¼˜å…ˆçº§ä½ä¸€äº›çš„å›¾ç‰‡èµ„æºï¼ˆåŒæ—¶ä¹Ÿæ¯”è¾ƒè€—ç½‘ç»œèµ„æºï¼‰ï¼Œæ˜¯ä¸€ä¸ªä»ç”¨æˆ·ä½“éªŒä¸Šè¿›è¡Œåˆ†å±‚çš„æŠ€æœ¯ã€‚</p></blockquote><p><strong>ç½‘ç«™ä¸€èˆ¬å¦‚ä½•å®ç°å›¾ç‰‡æ‡’åŠ è½½æŠ€æœ¯å‘¢ï¼Ÿ</strong></p><p>åœ¨ç½‘é¡µæºç ä¸­ï¼Œåœ¨imgæ ‡ç­¾ä¸­é¦–å…ˆä¼šä½¿ç”¨ä¸€ä¸ªâ€œ<code>ä¼ªå±æ€§</code>â€ï¼ˆé€šå¸¸ä½¿ç”¨<code>src2</code>ã€<code>origin</code>â€¦â€¦ï¼‰å»å­˜æ”¾çœŸæ­£çš„å›¾ç‰‡é“¾æ¥è€Œå¹¶éæ˜¯ç›´æ¥å­˜æ”¾åœ¨srcå±æ€§ä¸­ã€‚å½“å›¾ç‰‡å‡ºç°åˆ°é¡µé¢çš„å¯è§†åŒ–åŒºåŸŸä¸­ï¼Œä¼šåŠ¨æ€å°†ä¼ªå±æ€§æ›¿æ¢æˆsrcå±æ€§ï¼Œå®Œæˆå›¾ç‰‡çš„åŠ è½½ã€‚</p><p>æ¯”å¦‚ï¼š<a href="https://blog.csdn.net/weixin_38507813/article/details/100010232" target="_blank" rel="noopener">ç«™é•¿ç´ ææ¡ˆä¾‹åç»­åˆ†æ</a>ï¼šé€šè¿‡ç»†è‡´è§‚å¯Ÿé¡µé¢çš„ç»“æ„åå‘ç°ï¼Œç½‘é¡µä¸­å›¾ç‰‡çš„é“¾æ¥æ˜¯å­˜å‚¨åœ¨äº†src2è¿™ä¸ªä¼ªå±æ€§ä¸­ã€‚</p><p>å› æ­¤é’ˆå¯¹çˆ¬å–è¿™ç±»å›¾ç‰‡è€Œè¨€ï¼Œå¯ä»¥</p><ol><li>æ‰¾åˆ°è¦çˆ¬å–å›¾ç‰‡çš„ä½ç½®ï¼ˆç½‘é¡µä¸Šçš„ä½ç½®ï¼‰</li><li>æŸ¥çœ‹è¯¥ç½‘å€çš„é“¾æ¥img_url</li><li>æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼ŒCtrl+Fåæ–‡æœ¬æœç´¢è¯¥å›¾ç‰‡é“¾æ¥img_url</li><li>å¦‚æœ3æ²¡æœ‰åˆ™åœ¨å¼€å‘è€…å·¥å…·ä¸­Ctrl+Fæœç´¢å¸¦img_urlçš„èµ„æº</li><li>å¦‚æœæ˜¯3ï¼Œåˆ™é€šè¿‡æ‰¾åˆ°çš„çœŸæ­£çš„xpathè·¯å¾„è·å–ï¼Œæˆ–è€…reæå–ï¼›å¦‚æœæ˜¯4åˆ™æ¨¡ä»¿æ¥å£å»è¯·æ±‚å›¾ç‰‡</li></ol><h3 id="æœ¬é¡¹ç›®æ¡ˆä¾‹"><a class="markdownIt-Anchor" href="#æœ¬é¡¹ç›®æ¡ˆä¾‹"></a> æœ¬é¡¹ç›®æ¡ˆä¾‹</h3><h2 id="pathlibåº“ä½¿ç”¨"><a class="markdownIt-Anchor" href="#pathlibåº“ä½¿ç”¨"></a> pathlibåº“ä½¿ç”¨</h2><ul><li><p>è·å¾—å½“å‰è„šæœ¬çš„ç»å¯¹è·¯å¾„:<code>Path(__file__).resolve()</code></p></li><li><p>è·å¾—å½“å‰è„šæœ¬æ‰€åœ¨ç›®å½•çš„ç»å¯¹è·¯å¾„: <code>Path(__file__).resolve().parent</code></p></li><li><p>æ ¹æ®è·¯å¾„åˆ›å»ºæ–‡ä»¶å¤¹: <code>LOG_PATH = Path(__file__).resolve().with(&quot;logs&quot;)</code>â€“&gt;<code>./logs/</code>ï¼Œ<code>LOG_PATH.mkdir(parents=True, exist_ok=True)</code>ï¼Œ</p><ul><li>parents:å¦‚æœçˆ¶ç›®å½•ä¸å­˜åœ¨ï¼Œæ˜¯å¦åˆ›å»ºçˆ¶ç›®å½•ï¼Œå³æ”¯æŒé€’å½’åˆ›å»º</li><li>exist_okï¼šåªæœ‰åœ¨ç›®å½•ä¸å­˜åœ¨æ—¶åˆ›å»ºç›®å½•ï¼Œç›®å½•å·²å­˜åœ¨æ—¶ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li></ul></li><li><p>è·å¾—å½“å‰è·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶(éå†æ–‡ä»¶å¤¹): <code>[path for path in example_path.iterdir()]</code></p></li><li><p>è¿”å›ç›®å½•ä¸­æœ€åä¸€ä¸ªéƒ¨åˆ†çš„æ‰©å±•åï¼š<code>Path('/Users/Anders/Documents/abc.gif').suffix</code></p></li><li><p>è¿”å›ç›®å½•ä¸­å¤šä¸ªæ‰©å±•ååˆ—è¡¨ï¼š <code>Path('/Users/Anders/Documents/abc.tar.gz').suffixes</code></p></li><li><p>è¿”å›ç›®å½•ä¸­æœ€åä¸€ä¸ªéƒ¨åˆ†çš„æ–‡ä»¶å: <code>Path('/Users/Anders/Documents/abc.gif').name</code></p></li><li><p>è¿”å›ç›®å½•ä¸­æœ€åä¸€ä¸ªéƒ¨åˆ†çš„æ–‡ä»¶åï¼ˆä½†æ˜¯ä¸åŒ…å«åç¼€ï¼‰: <code>Path('/Users/Anders/Documents/abc.gif').stem</code></p></li><li><p><strong>æ–‡ä»¶æ“ä½œ</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">example_path = Path(<span class="string">'/Users/Anders/Documents/information/JH.txt'</span>)</span><br><span class="line"><span class="comment"># ä»¥opençš„å½¢å¼</span></span><br><span class="line"><span class="keyword">with</span> example_path.open(encoding = <span class="string">'GB2312'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    print(f.read())</span><br><span class="line"><span class="comment"># æˆ–è€…ç›´æ¥ç”¨pathlibæä¾›çš„è·å–å†…å®¹çš„æ–¹å¼</span></span><br><span class="line">example_path = Path(<span class="string">'/Users/Anders/Documents/information/JH.txt'</span>)</span><br><span class="line">example_path.read_text(encoding=<span class="string">'GB2312'</span>)</span><br></pre></td></tr></table></figure><ul><li><p>.read_text(): ä»¥æ–‡æœ¬æ¨¡å¼æ‰“å¼€è·¯å¾„å¹¶å¹¶ä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›å†…å®¹ã€‚</p></li><li><p>.read_bytes(): ä»¥äºŒè¿›åˆ¶/å­—èŠ‚æ¨¡å¼æ‰“å¼€è·¯å¾„å¹¶ä»¥å­—èŠ‚ä¸²çš„å½¢å¼è¿”å›å†…å®¹ã€‚</p></li><li><p>.write_text(): æ‰“å¼€è·¯å¾„å¹¶å‘å…¶å†™å…¥å­—ç¬¦ä¸²æ•°æ®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">path = Path(<span class="string">'data.json'</span>)</span><br><span class="line">path.write_text(<span class="string">'&#123;"id": 123, "name": "James"&#125;'</span>)</span><br></pre></td></tr></table></figure></li><li><p>.write_bytes(): ä»¥äºŒè¿›åˆ¶/å­—èŠ‚æ¨¡å¼æ‰“å¼€è·¯å¾„å¹¶å‘å…¶å†™å…¥æ•°æ®ã€‚</p></li></ul></li></ul><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/itanders/article/details/88754606" target="_blank" rel="noopener">https://blog.csdn.net/itanders/article/details/88754606</a></p><h2 id="æŒ‰ä½éªŒè¯ç "><a class="markdownIt-Anchor" href="#æŒ‰ä½éªŒè¯ç "></a> æŒ‰ä½éªŒè¯ç </h2><p>è¯¥ç½‘ç«™å¯¹é¢‘ç‡æ£€æµ‹ååˆ†æ•æ„Ÿï¼Œå¾ˆå¿«å°±ä¼šå‡ºç°&quot;æŒ‰ä½&quot;éªŒè¯ç ï¼Œæ¨¡æ‹ŸæŒ‰ä½å€’ä¸éš¾ï¼Œä½†æ˜¯æŒ‰å®Œä»¥åæœ‰æ—¶å¹¶ä¸èƒ½è§£å†³éªŒè¯â€¦</p><p>ä½†æ˜¯æ„å¤–å‘ç°ï¼Œåœ¨â€œæ— ç—•æ¨¡å¼â€ä¸‹è¿›è¡Œé‡æ–°ç™»å½•åï¼Œå°±å¯ä»¥è§£å†³éªŒè¯â€¦ä½†æ˜¯é€šè¿‡requestsè¿›è¡Œæ¨¡æ‹Ÿç™»å½•åcookiesè¿˜æ˜¯æ— æ•ˆã€‚</p><p>ğŸŒŸè®°å½•ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼Œä¹‹åçœ‹çœ‹æœ‰æ²¡æœ‰æ—¶é—´å¼„æ¸…æ¥šè¿™ä¸ªé—®é¢˜ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><blockquote><p>æ—¢ç„¶æ¨¡æ‹Ÿä¸è¡Œï¼Œé‚£ä¹ˆå°±æ‰‹åŠ¨ï¼Œå› æ­¤æƒ³ç”¨seleniumæ¥æ¨¡æ‹Ÿç‚¹å‡»ç™»é™†ã€‚ä½†æ˜¯å› ä¸ºä¿„ç½—æ–¯çš„é—®é¢˜ï¼Œæ— æ³•ç™»é™†ã€‚</p></blockquote><p><img src="/2022/05/02/2022å¹´5æœˆåŠ³åŠ¨èŠ‚çˆ¬è™«é¡¹ç›®è®°å½•/E:%5Chexo%5Csource_posts%5C2022%E5%B9%B45%E6%9C%88%E5%8A%B3%E5%8A%A8%E8%8A%82%E7%88%AC%E8%99%AB%E9%A1%B9%E7%9B%AE%E8%AE%B0%E5%BD%95%5C%E8%A2%AB%E5%B0%81.jpg" alt="è¢«å°"></p><p>äºæ˜¯åªå¥½æ›´æ¢seleniumä¸ºpyppeteerã€‚ä¹‹å‰å°±å¬è¯´äº†pyppeteeræ˜¯å¯ä»¥ä»£æ›¿seleniumçš„æ¨¡æ‹Ÿç¥å™¨ï¼Œç›¸æ¯”Selenium ä¸å¤ªæ–¹ä¾¿çš„åœ°æ–¹ï¼šæ¯”å¦‚é€Ÿåº¦å¤ªæ…¢ã€å¯¹ç‰ˆæœ¬é…ç½®è¦æ±‚ä¸¥è‹›ï¼Œæœ€éº»çƒ¦æ˜¯ç»å¸¸è¦æ›´æ–°å¯¹åº”çš„é©±åŠ¨ï¼Œè¿˜æœ‰äº›ç½‘é¡µæ˜¯å¯ä»¥æ£€æµ‹åˆ°æ˜¯å¦ä½¿ç”¨äº†Selenium ï¼Œpyppeteeréƒ½æœ‰æå‡ï¼Œè¿™æ¬¡ä¹Ÿå€Ÿæœºä¼šå­¦ä¹ ä¸€ä¸‹ã€‚</p><blockquote><p>å®‰è£…ï¼š<code>pip install pyppeteer</code>, éœ€è¦Python3.6ä»¥ä¸Šï¼ˆå› ä¸ºç”¨äº†asyncï¼‰</p></blockquote><h3 id="pyppeteer"><a class="markdownIt-Anchor" href="#pyppeteer"></a> pyppeteer</h3><p>æœ€ç®€å•demoï¼šæ‰“å¼€ç½‘é¡µï¼Œå¹¶æˆªå›¾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> pyppeteer <span class="keyword">import</span> launch</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># å¯åŠ¨æµè§ˆå™¨</span></span><br><span class="line">    browser = <span class="keyword">await</span> launch(headless=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment"># æ‰“å¼€å¹¶è·³è½¬é¡µé¢</span></span><br><span class="line">    page = <span class="keyword">await</span> browser.newPage()</span><br><span class="line">    <span class="keyword">await</span> page.goto(<span class="string">'https://example.com'</span>)</span><br><span class="line">    <span class="comment"># æˆªå›¾</span></span><br><span class="line">    <span class="keyword">await</span> page.screenshot(&#123;<span class="string">'path'</span>: <span class="string">'example.png'</span>&#125;)</span><br><span class="line">    <span class="keyword">await</span> browser.close()</span><br><span class="line"></span><br><span class="line">asyncio.get_event_loop().run_until_complete(main())</span><br></pre></td></tr></table></figure><p>æ‰§è¡ŒJSï¼Œç›¸å½“äºrequests-htmlä¸­çš„render</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">dimensions = <span class="keyword">await</span> page.evaluate(<span class="string">'''() =&gt; &#123;</span></span><br><span class="line"><span class="string">    return &#123;</span></span><br><span class="line"><span class="string">        width: document.documentElement.clientWidth,</span></span><br><span class="line"><span class="string">        height: document.documentElement.clientHeight,</span></span><br><span class="line"><span class="string">        deviceScaleFactor: window.devicePixelRatio,</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;'''</span>)</span><br><span class="line"></span><br><span class="line">print(dimensions)</span><br><span class="line"><span class="comment"># &gt;&gt;&gt; &#123;'width': 800, 'height': 600, 'deviceScaleFactor': 1&#125;</span></span><br><span class="line"><span class="keyword">await</span> browser.close()</span><br></pre></td></tr></table></figure><p><strong>å…ƒç´ é€‰æ‹©å™¨</strong>ï¼š</p><p><code>Page.querySelector()</code>/<code>Page.querySelectorAll()</code>/<code>Page.xpath()</code>ç¼©å†™ä¸º<code>Page.J()</code>, <code>Page.JJ()</code>, and <code>Page.Jx()</code>.</p><p>xpathè¿›é˜¶ï¼š</p><ul><li>starts-with é¡¾åæ€ä¹‰ï¼ŒåŒ¹é…ä¸€ä¸ªå±æ€§å¼€å§‹ä½ç½®çš„å…³é”®å­—</li><li>contains åŒ¹é…ä¸€ä¸ªå±æ€§å€¼ä¸­åŒ…å«çš„<a href="https://so.csdn.net/so/search?q=%E5%AD%97%E7%AC%A6%E4%B8%B2&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener">å­—ç¬¦ä¸²</a></li><li><code>text()</code> åŒ¹é…çš„æ˜¯æ˜¾ç¤ºæ–‡æœ¬ä¿¡æ¯ï¼š <code>//a[contains(text(), &quot;ç™¾åº¦æœç´¢&quot;)]</code></li></ul><p><a href="https://blog.csdn.net/weixin_48615832/article/details/107319268" target="_blank" rel="noopener">xpathçš„containsç”¨æ³•</a></p><p><strong>å…ƒç´ æ“ä½œï¼šç‚¹å‡»ã€è¾“å…¥</strong></p><ul><li><code>pyppeteer.input.Mouse</code><ul><li><code>click(x: float*, y: float, options: dict = None*, ***kwargs)</code><ul><li><code>button</code> (str): <code>left</code>, <code>right</code>, or <code>middle</code>, defaults to <code>left</code>ï¼š<ul><li>å³é”®ç‚¹å‡»ï¼š<code>await page.click('a#cccccc',{&quot;button&quot;: &quot;right&quot;})</code></li></ul></li><li><code>clickCount</code> (int): defaults to 1.</li><li><code>delay</code> (int|float): Time to wait between <code>mousedown</code> and <code>mouseup</code> in milliseconds. Defaults to 0.</li></ul></li><li><code>down</code>(options: dict = None, *<em>kwargs</em>) `</li><li><code>button</code> (str): <code>left</code>, <code>right</code>, or <code>middle</code>, defaults to <code>left</code>.</li><li><code>clickCount</code> (int): defaults to 1.</li><li><code>move(x: float, y: float, options: dict = None, **kwargs*)</code></li><li><code>p(options: dict = None, **kwargs*)</code></li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨xpath</span></span><br><span class="line"><span class="keyword">await</span> page.waitForXPath(<span class="string">'//input[contains(@id, "mat-input")]'</span>)</span><br><span class="line"><span class="keyword">await</span> asyncio.sleep(<span class="number">10</span>)</span><br><span class="line">inputs = <span class="keyword">await</span> page.xpath(<span class="string">'//input[contains(@id, "mat-input")]'</span>)</span><br><span class="line">print(len(inputs))</span><br><span class="line"><span class="keyword">await</span> inputs[<span class="number">1</span>].type(<span class="string">'janetgao@indiana.edu'</span>)</span><br><span class="line"><span class="keyword">await</span> inputs[<span class="number">2</span>].type(<span class="string">'KAProject2021'</span>)</span><br><span class="line"><span class="comment"># ä½¿ç”¨selector</span></span><br><span class="line"><span class="keyword">await</span> page.waitForSelector(<span class="string">'#mat-input-1'</span>)</span><br><span class="line"><span class="keyword">await</span> page.type(<span class="string">'#mat-input-1'</span>, <span class="string">'janetgao@indiana.edu'</span>)</span><br><span class="line"><span class="keyword">await</span> page.type(<span class="string">'#mat-input-2'</span>, <span class="string">'KAProject2021'</span>)</span><br></pre></td></tr></table></figure><p><strong>launch</strong></p><ul><li><p><code>headless</code>ï¼šæ— ç•Œé¢æ¨¡å¼</p></li><li><p><code>devtools</code> ï¼šå¯ç”¨å¼€å‘è€…åŠ©æ‰‹</p></li><li><p><code>userDataDir='./userdata'</code>ï¼š è®°å½•äº›ç”¨æˆ·ä¿¡æ¯ï¼Œæ¯”å¦‚cookies</p></li><li><p><code>dumpio=True</code> é˜²æ­¢æµè§ˆå™¨å¼€å¤šä¸ªé¡µé¢è€Œå¡æ­»</p></li><li><p><code>executablePath</code>: æŒ‡å®šè‡ªå®šä¹‰çš„chromeè·¯å¾„</p></li><li><p>å‚æ•°argsè®¾ç½®ï¼Œå¯ä»¥ç±»æ¯”selenium</p><ul><li><p><code>--start-maximized</code>: é¡µé¢å…¨å±</p></li><li><p><code>--window-size={width},{height}</code>ï¼šè®¾ç½®çª—å£å¤§å°ï¼ŒåŒºåˆ«äºé¡µé¢çš„<code>page.setViewport({'width': 1366, 'height': 768})</code></p></li><li><p><code>--disable-infobars</code>:ä¸æ˜¾ç¤ºä¿¡æ¯æ   æ¯”å¦‚ chromeæ­£åœ¨å—åˆ°è‡ªåŠ¨æµ‹è¯•è½¯ä»¶çš„æ§åˆ¶</p></li><li><p><code>--incognito</code>ï¼šç™¾åº¦æœåˆ°çš„chrome.exeæ— ç—•å‘½ä»¤(seleniumæ˜¯å¦‚æ­¤ï¼Œpyppeteerä¸æ¨è)</p></li><li><p><code>--user-agent</code>ï¼š æ¯”å¦‚<code>'--user-agent=Mozilla/5.0'</code></p></li><li><p><code>--proxy-server={proxy}</code>: æµè§ˆå™¨ä»£ç† é…åˆæŸäº›ä¸­é—´äººä»£ç†ä½¿ç”¨</p></li><li><p><code>--no-sandbox</code>,  # å–æ¶ˆæ²™ç›’æ¨¡å¼ æ²™ç›’æ¨¡å¼ä¸‹æƒé™å¤ªå°</p></li><li><p><code>'--log-level=3'</code></p></li><li><p><code>'--load-extension={}'.format(chrome_extension)</code>ã€<code>'--disable-extensions-except={}'.format(chrome_extension)</code> # åŠ è½½æ’ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chrome_extension_path = <span class="string">"æ’ä»¶æ‰€åœ¨ç›®å½•"</span></span><br><span class="line">args = [</span><br><span class="line">    <span class="string">"--load-extension=&#123;&#125;"</span>.format(chrome_extension_path),</span><br><span class="line">    <span class="string">"--disable-extensions-except=&#123;&#125;"</span>.format(chrome_extension_path),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><a href="https://www.cnblogs.com/dyfblog/p/12225796.html" target="_blank" rel="noopener">pyppeteeræ§åˆ¶Chromiumåœ¨éšèº«æ¨¡å¼ä¸‹å¯ç”¨æ’ä»¶ </a></p></li></ul></li><li><p>more: <a href="https://blog.csdn.net/Coding_CLearLove/article/details/110265509" target="_blank" rel="noopener">launchå‚æ•°è¯´æ˜</a></p></li></ul><p>æ‰§è¡ŒJSï¼š</p><ul><li><p><code>page.evaluate('window.scrollBy(100, document.body.scrollHeight)')</code></p></li><li><p><code>await page.evaluate('alert(&quot;åœ¨æµè§ˆå™¨æ‰§è¡Œjsè„šæœ¬!&quot;)')</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›¸å½“äºæ‹¿åˆ°äº†domå¯¹è±¡</span></span><br><span class="line">element = <span class="keyword">await</span> page.J(<span class="string">'#ul&gt;a[name="tj_trtieba"]'</span>)</span><br><span class="line">print(<span class="keyword">await</span> page.evaluate(<span class="string">'el =&gt; el.innerHTML'</span>, element))</span><br></pre></td></tr></table></figure></li><li><p>page.evaluateOnNewDocument(pageFunction[, â€¦args]), æŒ‡å®šçš„å‡½æ•°åœ¨æ‰€å±çš„é¡µé¢è¢«åˆ›å»ºå¹¶ä¸”æ‰€å±é¡µé¢çš„ä»»æ„scriptæ‰§è¡Œä¹‹å‰è¢«è°ƒç”¨ã€‚å¸¸ç”¨äºä¿®æ”¹é¡µé¢JSç¯å¢ƒã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">page = <span class="keyword">await</span> browser.newPage()</span><br><span class="line"><span class="keyword">await</span> page.setViewPort(&#123;<span class="string">'width'</span>: <span class="number">1366</span>, <span class="string">'height'</span>: <span class="number">768</span>&#125;)</span><br><span class="line"><span class="keyword">await</span> page.evaluateOnNewDocument(<span class="string">'''() =&gt; &#123;</span></span><br><span class="line"><span class="string">        Object.defineProperty(navigator, 'webdriver', &#123;get: () =&gt; false &#125;);</span></span><br></pre></td></tr></table></figure><p>é™„â€”ElementHandleå…ƒç´ æ“ä½œï¼š</p><ol><li>è·å–å…ƒç´ è¾¹ç•Œæ¡†åæ ‡ï¼šboundingBox()ï¼Œè¿”å›å…ƒç´ çš„è¾¹ç•Œæ¡†ï¼ˆç›¸å¯¹äºä¸»æ¡†æ¶ï¼‰=&gt; x åæ ‡ã€ y åæ ‡ã€widthã€height</li><li>å…ƒç´ æ˜¯å¦å¯è§ï¼šisIntersectingViewport()</li><li>ä¸Šä¼ æ–‡ä»¶ï¼šuploadFile(*filpaths)</li><li>ElementHandle ç±» è½¬ Frameç±»ï¼šcontentFrame()ï¼Œå¦‚æœå¥æŸ„æœªå¼•ç”¨iframeï¼Œåˆ™è¿”å›Noneã€‚</li><li>èšç„¦è¯¥å…ƒç´ ï¼šfocus()</li><li>ä¸é¼ æ ‡ç›¸å…³ï¼šhover () ï¼Œå°†é¼ æ ‡æ‚¬åœåˆ°å…ƒç´ ä¸Šé¢</li><li>ä¸é”®ç›˜ç›¸å…³ï¼špress (key[, options])ï¼ŒæŒ‰é”®ï¼Œkey è¡¨ç¤ºæŒ‰é”®çš„åç§°ï¼Œoptionå¯é…ç½®:<ul><li>text (string) - å¦‚æœæŒ‡å®šï¼Œåˆ™ä½¿ç”¨æ­¤æ–‡æœ¬ç”Ÿæˆè¾“å…¥äº‹ä»¶</li><li>delay (number) - keydown å’Œ keyup ä¹‹é—´ç­‰å¾…çš„æ—¶é—´ã€‚é»˜è®¤æ˜¯ 0</li><li><code>page.keyboard.down('Shift')</code>ï¼šæŒ‰ä¸‹shift</li></ul></li></ol><p>more: <a href="https://blog.csdn.net/weizhen11/article/details/102509230" target="_blank" rel="noopener">é¡µé¢å…ƒç´ æ“ä½œ</a></p></li></ul><p><strong>å®‰å…¨æ€§ï¼š</strong></p><ol><li>åœ¨ä½¿ç”¨ Pyppeteer ä»ç„¶ä¼šé‡åˆ°æ— å¤´æµè§ˆå™¨æ£€æµ‹ï¼Œè¿™é‡Œå®‰åˆ©ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ã€Œpyppeteer-stealthã€ï¼Œã€Œpuppeteer-extra-plugin-stealthã€å¼•ç”¨Githubä¸Šçš„è¯´æ˜ã€ŒApplies various evasion techniques to make detection of headless puppeteer harder.ã€ã€ŒA plugin for puppeteer-extra to prevent detection.ã€ï¼ˆGithubåœ°å€ï¼š<a href="https://github.com/berstend/puppeteer-extra/tree/master/packages/puppeteer-extra-plugin-stealth" target="_blank" rel="noopener">https://github.com/berstend/puppeteer-extra/tree/master/packages/puppeteer-extra-plugin-stealth</a> ï¼‰ã€‚å¯è§ï¼Œã€Œpyppeteer-stealthã€ä¹Ÿæ˜¯ç”¨äºé˜²æ­¢æœºå™¨äººæ£€æµ‹çš„ã€‚ç”¨æ³•ä¹Ÿå¾ˆç®€å•ï¼Œç»™pageåŠ ä¸Šstealth</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> pyppeteer <span class="keyword">import</span> launch</span><br><span class="line"><span class="keyword">from</span> pyppeteer_stealth <span class="keyword">import</span> stealth</span><br><span class="line"> </span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    browser = <span class="keyword">await</span> launch(headless=<span class="keyword">True</span>)</span><br><span class="line">    page = <span class="keyword">await</span> browser.newPage()</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">await</span> stealth(page)  <span class="comment"># &lt;-- Here</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">await</span> page.goto(<span class="string">"https://bot.sannysoft.com/"</span>)</span><br><span class="line">    <span class="keyword">await</span> browser.close()</span><br><span class="line">asyncio.get_event_loop().run_until_complete(main())</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥çœå»éšè—WebDriverç­‰æ“ä½œï¼Œå¯è°“çœæ—¶çœåŠ›çœå¿ƒã€‚</p><ol start="2"><li><code>await page.evaluateOnNewDocument('Object.defineProperty(navigator,&quot;webdriver&quot;,{get:()=&gt;undefined})')</code></li><li><code>stealth.min.js</code><a href="https://cloud.tencent.com/developer/article/1755513" target="_blank" rel="noopener">æœ€å®Œç¾æ–¹æ¡ˆï¼æ¨¡æ‹Ÿæµè§ˆå™¨å¦‚ä½•æ­£ç¡®éšè—ç‰¹å¾</a></li></ol><p><strong>æ— ç—•éšèº«æ¨¡å¼è®¿é—®</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">start_browser</span><span class="params">()</span>:</span></span><br><span class="line">    browser = <span class="keyword">await</span> launch(**&#123;<span class="string">"headless"</span>: <span class="keyword">False</span>&#125;)</span><br><span class="line">    <span class="comment"># åˆ›å»ºéšèº«ä¸Šä¸‹æ–‡</span></span><br><span class="line">    browser_context = <span class="keyword">await</span> browser.createIncognitoBrowserContext()</span><br><span class="line">    page = <span class="keyword">await</span> browser_context.newPage()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> page.goto(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line">    <span class="keyword">await</span> browser.close()</span><br><span class="line">    <span class="keyword">return</span></span><br></pre></td></tr></table></figure><p>è¾ƒå…¨çš„APIè¯´æ˜ï¼š<a href="https://blog.csdn.net/Qwertyuiop2016/article/details/92667875" target="_blank" rel="noopener">pyppeteerçš„åŸºæœ¬ä½¿ç”¨</a>ã€<a href="https://blog.csdn.net/weizhen11/article/details/102497647" target="_blank" rel="noopener">é¡µé¢ä¿¡æ¯ã€è®¾ç½®</a></p><h3 id="é—®é¢˜æŒ‰é’®ä¸ç”Ÿæ•ˆ"><a class="markdownIt-Anchor" href="#é—®é¢˜æŒ‰é’®ä¸ç”Ÿæ•ˆ"></a> é—®é¢˜ï¼šæŒ‰é’®ä¸ç”Ÿæ•ˆ</h3><p>ç½‘é¡µè¾“å…¥è´¦å·å’Œå¯†ç ä¹‹å‰ï¼ŒæŒ‰é’®çŠ¶æ€ä¸º<code>disable=true</code>ï¼Œä¸¤ä¸ªéƒ½è¾“å…¥åæ‰èƒ½æŒ‰ä¸‹ï¼Œè€Œä½¿ç”¨pyppeteeræ—¶ï¼Œå‘ç°æ— è®ºæ€ä¹ˆå°è¯•éƒ½ä¸èƒ½ä½¿å¾—å…¶disableå˜åŒ–ï¼ˆç”¨å¼€å‘è€…åŠ©æ‰‹ä¿®æ”¹åï¼Œæ— æ³•ç”Ÿæˆæ­£ç¡®çš„æäº¤è¯·æ±‚ï¼‰ã€‚çªç„¶å·§åˆä¹‹ä¸­ï¼Œæƒ³åˆ°äº†æ˜¯ä¸æ˜¯å…ƒç´ æ²¡åŠ è½½æˆåŠŸï¼Œäºæ˜¯ç¡®å®åœ¨å¼€å‘è€…åŠ©æ‰‹çš„<code>console</code>ä¸­çœ‹åˆ°æœ‰å¾ˆå¤šä¸æ”¯æŒçš„ï¼Œæ¯”å¦‚angularã€bootstrapâ€¦â€¦</p><p>äºæ˜¯ç™¾åº¦é—®é¢˜ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯ä»€ä¹ˆè®¾ç½®æ²¡å¼€ï¼Œä½†éƒ½æ²¡æ‰¾åˆ°ã€‚åæ¥æƒ³åˆ°å‡çº§ä¸‹pyppeteerç‰ˆæœ¬ä¼šä¸ä¼šå¥½ä¸€ç‚¹ï¼Œå‘ç°è‡ªå·±çš„ç‰ˆæœ¬ä¸º1.0.2ï¼Œå·²ç»æ˜¯æœ€æ–°çš„äº†(<a href="https://github.com/miyakogi/pyppeteer/issues/306" target="_blank" rel="noopener">https://github.com/miyakogi/pyppeteer/issues/306</a>)ã€‚ç”±äºä¸é€šè¿‡ç¨‹åºç›´æ¥é€šè¿‡æµè§ˆå™¨è¿›å…¥ç¨‹åºä¹Ÿå‡ºç°äº†æ— æ³•ç‚¹å‡»çš„é—®é¢˜ã€‚å†åŠ ä¸Šä¸‹é¢æœ‰äººæå‡ºchromiumæœ‰ç‚¹éš¾ä¸‹è½½ï¼Œå¹¶é€šè¿‡æºç æ‰¾é“äº†é»˜è®¤çš„é…ç½®å’Œè®¾ç½®ï¼Œäºæ˜¯ç»è¿‡ä¸€é˜µçš„æŠ˜è…¾è¿‡åï¼Œæˆ‘å‘ç°**â€œæŒ‰é’®æ— æ³•ç‚¹å‡»â€çš„é—®é¢˜å°±åœ¨äºchromiumç‰ˆæœ¬è¿‡ä½**ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pyppeteer.chromium_downloader</span><br><span class="line">print(<span class="string">'é»˜è®¤ç‰ˆæœ¬æ˜¯ï¼š&#123;&#125;'</span>.format(pyppeteer.__chromium_revision__))</span><br><span class="line">print(<span class="string">'å¯æ‰§è¡Œæ–‡ä»¶é»˜è®¤è·¯å¾„ï¼š&#123;&#125;'</span>.format(pyppeteer.chromium_downloader.chromiumExecutable.get(<span class="string">'win64'</span>)))</span><br><span class="line">print(<span class="string">'win64å¹³å°ä¸‹è½½é“¾æ¥ä¸ºï¼š&#123;&#125;'</span>.format(pyppeteer.chromium_downloader.downloadURLs.get(<span class="string">'win64'</span>)))</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">é»˜è®¤ç‰ˆæœ¬æ˜¯ï¼š588429</span></span><br><span class="line"><span class="string">å¯æ‰§è¡Œæ–‡ä»¶é»˜è®¤è·¯å¾„ï¼šC:\Users\mrli\AppData\Local\pyppeteer\pyppeteer\local-chromium\588429\chrome-win32\chrome.exe</span></span><br><span class="line"><span class="string">win64å¹³å°ä¸‹è½½é“¾æ¥ä¸ºï¼šhttps://storage.googleapis.com/chromium-browser-snapshots/Win_x64/588429/chrome-win32.zip</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><p>ç™»å½•è¿™ä¸ªstorageçš„ç½‘ç«™å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢æ‰€è®°å½•çš„chromiumå…¨éƒ½æ˜¯2013å¹´çš„ç‰ˆæœ¬ï¼Œå¿…ç„¶ç‰ˆæœ¬è½åäº†ã€‚äºæ˜¯ä¸‹è½½æœ€æ–°çš„chromiumè¦†ç›–<code>C:\Users\mrli\AppData\Local\pyppeteer\pyppeteer\local-chromium\588429\chrome-win32</code>ç›®å½•åå†è¿è¡Œï¼ŒæŒ‰é’®ä¸èƒ½ç‚¹å‡»çš„é—®é¢˜å°±æ¶ˆå¤±äº†!~ğŸ˜„</p><p>chromiumä¸‹è½½åœ°å€ï¼š<a href="https://registry.npmmirror.com/binary.html?path=chromium-browser-snapshots/Win_x64/%EF%BC%8C%E6%B3%A8%EF%BC%9Achromium%E8%B7%9Fchromedriver%E4%B8%8D%E4%B8%80%E6%A0%B7%EF%BC%8C%E4%BB%96%E8%B7%9F%E8%87%AA%E5%B7%B1%E5%B7%B2%E7%BB%8F%E5%AE%89%E8%A3%85%E7%9A%84chrome%E5%B9%B6%E6%B2%A1%E6%9C%89%E5%85%B3%E8%81%94%E3%80%82chromium%E8%87%AA%E5%B8%A6%E6%B5%8F%E8%A7%88%E5%99%A8%E5%BC%95%E6%93%8E%E6%A0%B8%E5%BF%83%EF%BC%8C%E6%89%80%E4%BB%A5%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BD%E6%9C%80%E6%96%B0%E7%9A%84%E7%89%88%E6%9C%AC%E5%8D%B3%E5%8F%AF%EF%BC%8C%E6%AF%94%E5%A6%82%E6%88%91%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BD%E7%9A%84%E5%B0%B1%E6%98%AF999303%E3%80%82" target="_blank" rel="noopener">https://registry.npmmirror.com/binary.html?path=chromium-browser-snapshots/Win_x64/ï¼Œæ³¨ï¼šchromiumè·Ÿchromedriverä¸ä¸€æ ·ï¼Œä»–è·Ÿè‡ªå·±å·²ç»å®‰è£…çš„chromeå¹¶æ²¡æœ‰å…³è”ã€‚chromiumè‡ªå¸¦æµè§ˆå™¨å¼•æ“æ ¸å¿ƒï¼Œæ‰€ä»¥ç›´æ¥ä¸‹è½½æœ€æ–°çš„ç‰ˆæœ¬å³å¯ï¼Œæ¯”å¦‚æˆ‘ç›´æ¥ä¸‹è½½çš„å°±æ˜¯999303ã€‚</a></p><p>å¯å‘äºï¼š<a href="https://cloud.tencent.com/developer/article/1731720" target="_blank" rel="noopener">ä½¿ç”¨pyppeteer ä¸‹è½½chromium æŠ¥é”™ æˆ–é€Ÿåº¦æ…¢</a>ã€<a href="https://www.cnblogs.com/Summer-skr--blog/p/12020207.html" target="_blank" rel="noopener">pyppeteerä½¿ç”¨æ—¶å¸¸è§çš„bugåŠè§£å†³åŠæ³•ã€è½¬è½½ã€‘ </a></p><ul><li>ğŸ“–pyppeteerå®æˆ˜æ¡ˆä¾‹ï¼š<a href="https://blog.csdn.net/weixin_44826986/article/details/124114130" target="_blank" rel="noopener">Pyppeteerçš„ä½¿ç”¨â€”â€”çˆ¬å–äº¬ä¸œ</a>â€”â€”æ¶ˆé™¤æŒ‡çº¹ã€é¡µé¢æ»‘åŠ¨äº‹ä»¶ã€è·å–æ•°æ®ï¼Œè·å–åˆ°çš„æ˜¯Jsonæ•°æ®ï¼š<code>(await a[0].getProperty(&quot;textContent&quot;)).jsonValue()</code></li><li>ğŸ“–å®˜æ–¹APIï¼š <a href="https://pyppeteer.github.io/pyppeteer/reference.html#pyppeteer.page.Page.xpath%E3%80%81" target="_blank" rel="noopener">https://pyppeteer.github.io/pyppeteer/reference.html#pyppeteer.page.Page.xpathã€</a><a href="https://learnku.com/docs/puppeteer/3.1.0/class-mouse/8549" target="_blank" rel="noopener">puppeteerä¸­æ–‡æ‰‹å†Œ</a></li><li><a href="https://www.pythonheidong.com/blog/article/1133668/afc4477523a740d64a23/" target="_blank" rel="noopener">setViewportå…¨å±</a></li></ul><h1 id="zsxq"><a class="markdownIt-Anchor" href="#zsxq"></a> zsxq</h1><h2 id="æ“ä½œworddocx"><a class="markdownIt-Anchor" href="#æ“ä½œworddocx"></a> æ“ä½œwordâ€”â€”docx</h2><blockquote><p>å®‰è£…: <code>pip install python-docx</code></p></blockquote><ul><li>æ’å…¥å›¾ç‰‡</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">doc = Document()</span><br><span class="line"><span class="comment"># å¢åŠ æ ‡é¢˜</span></span><br><span class="line">doc.add_heading(<span class="string">'python-docx åŸºç¡€è®²è§£ï¼ˆäºŒï¼‰'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨æ–‡æ¡£ä¸­å¢åŠ å›¾ç‰‡,å¹¶å¯¹è®¾ç½®å›¾ç‰‡å¤§å°</span></span><br><span class="line"><span class="comment"># å½“åªè®¾ç½®ä¸€ä¸ªæ–¹å‘çš„é•¿åº¦ï¼ˆå®½æˆ–é«˜ï¼‰æ—¶ï¼Œå¦ä¸€æ–¹å‘ä¼šè‡ªåŠ¨ç¼©æ”¾</span></span><br><span class="line">doc.add_picture(<span class="string">'1.png'</span>,width=shared.Inches(<span class="number">1</span>))  <span class="comment"># æŒ‰è‹±å¯¸è®¾ç½®</span></span><br><span class="line">doc.add_picture(<span class="string">'1.png'</span>,height=shared.Cm(<span class="number">2</span>))  <span class="comment"># æŒ‰å˜ç±³è®¾ç½®</span></span><br></pre></td></tr></table></figure><ul><li>æ’å…¥èŠ‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">add_heading(text=<span class="string">u''</span>, level=<span class="number">1</span>)        <span class="comment"># å†™å…¥æ ‡é¢˜æ®µè½</span></span><br><span class="line">add_paragraph(text =<span class="string">u''</span>,style=<span class="keyword">None</span>)<span class="comment"># å†™å…¥æ™®é€šæ®µè½</span></span><br><span class="line">add_picture(image_path_or_streamï¼Œwidth = <span class="keyword">None</span>ï¼Œheight = <span class="keyword">None</span> )<span class="comment">#æ’å…¥æŒ‡å®šå›¾ç‰‡</span></span><br><span class="line">add_table(rows, cols)<span class="comment"># æ’å…¥æŒ‡å®šè¡Œæ•°ã€åˆ—æ•°çš„è¡¨æ ¼</span></span><br><span class="line">add_section(self, start_type=<span class="number">2</span>)      <span class="comment"># æ·»åŠ èŠ‚ï¼›</span></span><br><span class="line">add_page_break(self)                <span class="comment"># åˆ†é¡µç¬¦ï¼›</span></span><br><span class="line">add_paragraph(self, text=<span class="string">''</span>, style=<span class="keyword">None</span>)      <span class="comment"># æ·»åŠ æ®µè½ï¼›</span></span><br></pre></td></tr></table></figure><ul><li>æ·»åŠ é¡µçœ‰</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>document = Document()</span><br><span class="line"><span class="comment"># æ¯ä¸ªèŠ‚sectionéƒ½æœ‰å…¶é¡µçœ‰header</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>section = document.sections[<span class="number">0</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>header = section.header</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>paragraph = header.paragraphs[<span class="number">0</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>paragraph.text = <span class="string">"Title of my document"</span></span><br><span class="line"><span class="comment"># è®¾ç½®é¡µçœ‰æ˜¯å¦è¿æ¥ä¸Šä¸€èŠ‚</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>header.is_linked_to_previous = <span class="keyword">True</span></span><br></pre></td></tr></table></figure><p>æ³¨ï¼šâ€œé¡µçœ‰ä¹Ÿæ˜¯ä¸€ä¸ªå—çº§å¯¹è±¡ï¼Œé‡Œé¢ä¹ŸåŒ…å«äº† Paragraph å¯¹è±¡,â€ â€œæ‰€ä»¥å¯¹é½æ–¹å¼ï¼Œæ–‡å­—æ ¼å¼è®¾ç½®æ–¹å¼å’Œå‰æ–‡ä»‹ç»ä¸€è‡´ã€‚â€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">head_par = head.paragraphs[<span class="number">0</span>]</span><br><span class="line">head_par.add_run(<span class="string">'é¡µçœ‰'</span>)</span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹é¡µè„š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">font0 = sec0.footer  <span class="comment"># è¿”å›é¡µè„šå¯¹è±¡</span></span><br><span class="line"><span class="comment"># è®¾ç½®é¡µè„š</span></span><br><span class="line">font0_par = font0.paragraphs[<span class="number">0</span>]</span><br><span class="line">font0_par.add_run(<span class="string">'é¡µè„š'</span>)</span><br><span class="line"><span class="comment"># æ³¨: è®¾ç½®é¡µè„šæŒ‰åºåˆ—å¢åŠ çš„æ–¹å¼æš‚æœªæ‰¾åˆ°</span></span><br></pre></td></tr></table></figure><ul><li>æ·»åŠ è¡¨æ ¼</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">table1 = doc.add_table(<span class="number">2</span>,<span class="number">3</span>,style =<span class="string">'Table Grid'</span> )</span><br><span class="line"><span class="comment"># è¡¨æ ¼è®¾ç½®è‡ªåŠ¨è°ƒæ•´åˆ—å®½ï¼Œï¼ˆé»˜è®¤ä¹Ÿä¸ºçœŸï¼‰</span></span><br><span class="line">table1.autofit = <span class="keyword">True</span></span><br><span class="line"><span class="comment"># ä¸ºè¡¨æ ¼å¯¹è±¡å¢åŠ åˆ—</span></span><br><span class="line">table1.add_column(shared.Inches(<span class="number">3</span>)) <span class="comment"># éœ€æŒ‡å®šå®½åº¦</span></span><br><span class="line"><span class="comment"># ä¸ºè¡¨æ ¼å¯¹è±¡å¢åŠ è¡Œ</span></span><br><span class="line">table1.add_row() <span class="comment"># åªèƒ½é€è¡Œæ·»åŠ </span></span><br><span class="line"><span class="comment"># è·å–è¡Œå¯¹è±¡</span></span><br><span class="line">row0 = table1.rows[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># è·å–åˆ—å¯¹è±¡</span></span><br><span class="line">col0 = table1.columns[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># è®¾ç½®å•å…ƒæ ¼å¯¹é½æ–¹å¼: å‚ç›´å¯¹é½æ–¹å¼</span></span><br><span class="line"><span class="keyword">from</span> docx.enum.table <span class="keyword">import</span> WD_ALIGN_VERTICAL</span><br><span class="line">table1.cell(<span class="number">0</span>,<span class="number">0</span>).vertical_alignment = WD_ALIGN_VERTICAL.TOP</span><br><span class="line"><span class="comment"># åˆå¹¶å•å…ƒæ ¼</span></span><br><span class="line">cell_new = table1.cell(<span class="number">2</span>,<span class="number">0</span>).merge(table1.cell(<span class="number">2</span>,<span class="number">1</span>))</span><br></pre></td></tr></table></figure><p>æ³¨: å•å…ƒæ ¼å†…å…¶å®ä¹Ÿæ˜¯æœ‰ paragraph å¯¹è±¡çš„ï¼Œå³å¯¹å•å…ƒæ ¼å†…å­—ä½“è®¾ç½®æ–¹å¼ï¼Œå’Œå¯¹æ®µè½ä¸­æ–‡å­—æ ¼å¼è®¾ç½®æ–¹æ³•ä¸€æ ·ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cell_par = cell_new.paragraphs[<span class="number">0</span>] <span class="comment"># è·å–åˆ°å¯¹è±¡</span></span><br><span class="line"><span class="comment"># è®¾ç½®å¯¹é½æ–¹å¼</span></span><br><span class="line"><span class="keyword">from</span> docx.enum.text <span class="keyword">import</span> WD_ALIGN_PARAGRAPH</span><br><span class="line">cell_par.paragraph_format.alignment = WD_ALIGN_PARAGRAPH.CENTER</span><br><span class="line"><span class="comment"># è·å– run å¯¹è±¡</span></span><br><span class="line">cell_run = cell_new.paragraphs[<span class="number">0</span>].runs[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># è®¾ç½®å­—ä½“</span></span><br><span class="line">cell_run.font.name = <span class="string">'Times New Roman'</span></span><br><span class="line"><span class="keyword">from</span> docx.oxml.ns <span class="keyword">import</span> qn</span><br><span class="line">cell_run.font.element.rPr.rFonts.set(qn(<span class="string">'w:eastAsia'</span>),<span class="string">'æ¥·ä½“'</span>)</span><br><span class="line"><span class="comment"># è®¾ç½®å­—ä½“é¢œè‰²</span></span><br><span class="line"><span class="keyword">from</span> docx.shared <span class="keyword">import</span> RGBColor</span><br><span class="line">cell_run.font.color.rgb = RGBColor(<span class="number">255</span>,<span class="number">55</span>,<span class="number">55</span>) <span class="comment"># çº¢è‰²</span></span><br></pre></td></tr></table></figure><ul><li>æ®µè½è®¾ç½®</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®æ®µè½ç¼©è¿›</span></span><br><span class="line"><span class="keyword">from</span> docx.shared <span class="keyword">import</span> Inches</span><br><span class="line">paragraph = document.add_paragraph(<span class="string">"ä½ è¯´å•¥"</span>)</span><br><span class="line">paragraph_format = paragraph.paragraph_format</span><br><span class="line">paragraph_format.left_indent = Inches(<span class="number">0.5</span>)</span><br><span class="line"><span class="comment"># é¦–è¡Œç¼©è¿›</span></span><br><span class="line">paragraph_format.first_line_indent = Inches(<span class="number">-0.25</span>)</span><br><span class="line"><span class="comment"># æ®µè½è¡Œè·</span></span><br><span class="line"><span class="keyword">from</span> docx.shared <span class="keyword">import</span> Length</span><br><span class="line"></span><br><span class="line">paragraph.line_spacing_rule = WD_LINE_SPACING.EXACTLY <span class="comment">#å›ºå®šå€¼</span></span><br><span class="line">paragraph_format.line_spacing = Pt(<span class="number">18</span>) <span class="comment"># å›ºå®šå€¼18ç£…</span></span><br><span class="line">paragraph.line_spacing_rule = WD_LINE_SPACING.MULTIPLE <span class="comment">#å¤šå€è¡Œè·</span></span><br><span class="line">paragraph_format.line_spacing = <span class="number">1.75</span> <span class="comment"># 1.75å€è¡Œé—´è·</span></span><br></pre></td></tr></table></figure><p>æ›´å¤šæ“ä½œæ ·å¼è§ï¼š</p><ul><li>â˜…<a href="https://blog.csdn.net/lly1122334/article/details/109669667" target="_blank" rel="noopener">Pythonæ“çºµWordç¥å™¨â€”â€”python-docxå¤§å…¨ï¼ˆå«æ’å…¥pptxå›¾è¡¨ï¼‰</a></li><li><a href="https://blog.csdn.net/zhouz92/article/details/107066709" target="_blank" rel="noopener">Python-docx è¯»å†™ Word æ–‡æ¡£ï¼šæ’å…¥å›¾ç‰‡ã€è¡¨æ ¼ï¼Œè®¾ç½®è¡¨æ ¼æ ·å¼ï¼Œç« èŠ‚ï¼Œé¡µçœ‰é¡µè„šç­‰</a>â€”â€”è¡¨æ ¼ã€é¡µçœ‰é¡µè„š</li><li><a href="https://zhuanlan.zhihu.com/p/61340025" target="_blank" rel="noopener">python-docxå¤„ç†wordæ–‡æ¡£</a>â€”â€”æ®µè½æ“ä½œï¼ˆå­—ä½“å±æ€§å¯é€‰é¡¹ï¼‰</li></ul><h3 id="saveåæ“ä½œdocumentå¯¹è±¡å†saveä¼šè¦†ç›–"><a class="markdownIt-Anchor" href="#saveåæ“ä½œdocumentå¯¹è±¡å†saveä¼šè¦†ç›–"></a> Saveåæ“ä½œDocumentå¯¹è±¡å†saveä¼šè¦†ç›–</h3><p>Documentå¯¹è±¡åœ¨saveä¹‹åï¼Œå¯¹å…¶æ“ä½œä»ç„¶æœ‰æ•ˆï¼Œåç»­çš„æ“ä½œåœ¨æ–°çš„saveä¸­ä¼šä¿ç•™ä¸Šæ¬¡saveçš„è®°å½•ï¼Œç„¶åå†æ·»åŠ æ–°çš„ï¼ˆå®åˆ™æ˜¯è¦†ç›–ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">d = Document()</span><br><span class="line">resp = requests.get(<span class="string">"https://images.zsxq.com/FodneHQIMESZXJWe4SahoZ_J_vGs?imageMogr2/auto-orient/quality/100!/ignore-error/1&amp;e=1656604799&amp;token=kIxbL07-8jAj8w1n4s9zv64FuZZNEATmlU_Vm6zD:onEkC9y8uloYeHTrEIpYk4dstaw="</span>)</span><br><span class="line">bf = BytesIO()</span><br><span class="line">bf.write(resp.content)</span><br><span class="line">d.add_picture(bf)</span><br><span class="line">bf.close()</span><br><span class="line">d.save(<span class="string">"test.docx"</span>)</span><br><span class="line"><span class="comment"># saveä¹‹åå¯ä»¥ç»§ç»­ **æ’å…¥**, ç„¶åå†ä¿å­˜</span></span><br><span class="line">d.add_paragraph(<span class="string">"he"</span>)</span><br><span class="line">d.save(<span class="string">"test.docx"</span>)</span><br></pre></td></tr></table></figure><h3 id="ç¼–è¾‘å·²å­˜åœ¨çš„wordæ–‡æ¡£"><a class="markdownIt-Anchor" href="#ç¼–è¾‘å·²å­˜åœ¨çš„wordæ–‡æ¡£"></a> ç¼–è¾‘å·²å­˜åœ¨çš„wordæ–‡æ¡£</h3><p><a href="https://link.zhihu.com/?target=https%3A//python-docx.readthedocs.io/en/latest/" target="_blank" rel="noopener">python-docx</a> ä¸ä»…å¯ä»¥åˆ›å»ºwordæ–‡æ¡£ï¼Œè¿˜å¯ä»¥ç¼–è¾‘å·²å­˜åœ¨çš„wordæ–‡æ¡£ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> docx <span class="keyword">import</span> Document</span><br><span class="line"></span><br><span class="line">document = Document(<span class="string">'existing-document-file.docx'</span>)</span><br><span class="line"><span class="comment"># å¯ä»¥å°† å·²å­˜åœ¨ docxçš„å†…å®¹ä¿å­˜åˆ°æ–°çš„docxä¸­</span></span><br><span class="line">document.save(<span class="string">'new-file-name.docx'</span>)</span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥ è¦†ç›–å½“å‰docx æˆæ–°çš„docx</span></span><br></pre></td></tr></table></figure><p>ä½†å…¶å®å§ï¼Œè¿™ç©æ„å„¿<strong>åªèƒ½ç¼–è¾‘å·²å­˜åœ¨çš„wordæ–‡æ¡£</strong>ï¼Œä¹‹æ‰€ä»¥æœ‰ä¸ªâ€œåˆ›å»ºç©ºç™½æ–‡æ¡£â€çš„åŠŸèƒ½ï¼Œåªä¸è¿‡æ˜¯æ‹·è´ä¸€ä»½ç©ºç™½wordæ–‡æ¡£åˆ°å·¥ä½œåŒºé—´ï¼Œå†åœ¨ç©ºç™½æ–‡æ¡£ä¸Šç¼–è¾‘ï¼Œçœ‹èµ·æ¥ä¼¼ä¹æ˜¯â€œåˆ›å»ºç©ºç™½æ–‡æ¡£â€ç½¢äº†ã€‚æœ¬è´¨ä¸Šè¿˜æ˜¯ç¼–è¾‘å·²å­˜åœ¨çš„wordæ–‡æ¡£â€¦</p><p>æ‰“å¼€ä¸€ä¸ªwordæ–‡æ¡£ï¼Œç¼–è¾‘å®Œåï¼Œä¸€å®šè¦è®°å¾—ä¿å­˜ã€‚å¦‚æœä¿å­˜æ–‡ä»¶åå’ŒåŸæ–‡ä»¶åä¸ä¸€æ ·ï¼Œåˆ™ä¼šå¦å­˜ä¸ºä¸€ä»½wordæ–‡æ¡£ï¼›è‹¥æ–‡ä»¶åä¸€æ ·ï¼Œåˆ™ä¼šä¸åŠ æç¤ºçš„ä¿å­˜ä¿®æ”¹å†…å®¹ã€‚</p><h2 id="__slots__ä½œç”¨"><a class="markdownIt-Anchor" href="#__slots__ä½œç”¨"></a> <code>__slots__</code>ä½œç”¨</h2><p>ç”¨äºéœ€è¦ç»´æŠ¤ä¸¤ä¸ªSaver, å› æ­¤ä¸­é—´æ ¹æ®è¿”å›å€¼æ¥è·å¾—äº†æšä¸¾ç¡®å®šsaverå¯¹è±¡, ä½†æ˜¯saverå¯¹è±¡æœ‰ä¸ªsaver_nameçš„å±æ€§å¹¶æ²¡æœ‰ç»‘å®šèµ·æ¥, å› æ­¤æƒ³åˆ°<br>é€šè¿‡<code>setattr</code>æ¥æ·»åŠ å±æ€§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="comment"># ä½¿ç”¨__slots__åæ·»åŠ ageå±æ€§æŠ¥é”™: AttributeError: 'A' object has no attribute 'age'</span></span><br><span class="line">    __slots__ = (<span class="string">"name"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name=<span class="string">"cl"</span>)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">a = A()</span><br><span class="line">setattr(a, <span class="string">"age"</span>, <span class="number">18</span>)</span><br><span class="line">print(a)</span><br><span class="line">print(a.__dict__)</span><br><span class="line">print(a.age)</span><br></pre></td></tr></table></figure><p>ä½†ä¸å¹¸çš„æ˜¯Documentä¸­ä¹Ÿæ— æ³•é€šè¿‡<code>setattr</code>æ·»åŠ å±æ€§, åŸå› åº”è¯¥æ˜¯Documentç±»ä¹Ÿå®šä¹‰äº†<code>__slots__</code>ã€‚</p><p>åœ¨æ­¤, ä¹Ÿæ˜ç¡®ä¸‹<code>__slots__</code>çš„ç‰¹ç‚¹ï¼š</p><ul><li><code>__slots__</code>æ•°æ®ç±»å‹ä¸ºå…ƒç»„</li><li><code>__slots__</code>åªå¯¹å½“å‰ç±»ç”Ÿæ•ˆï¼Œå¯¹å…¶å­ç±»ä¸ç”Ÿæ•ˆ</li></ul><h2 id="bytesioä½¿ç”¨"><a class="markdownIt-Anchor" href="#bytesioä½¿ç”¨"></a> BytesIOä½¿ç”¨</h2><p>è¯´èµ·IOï¼Œå¾ˆå¤šäººé¦–å…ˆæƒ³åˆ°çš„æ˜¯ç£ç›˜ä¸­çš„æ–‡ä»¶ï¼Œå°†ç£ç›˜ä¸­çš„æ–‡ä»¶è¯»åˆ°<a href="https://so.csdn.net/so/search?q=%E5%86%85%E5%AD%98&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener">å†…å­˜</a>ä»¥åŠå†…å­˜å†…å®¹å†™å…¥æ–‡ä»¶ï¼Œæ˜¾ç„¶è¿™ç§æ–‡ä»¶ä¸å†…å­˜çš„File-IOæ˜¯ç§éå¸¸å…¸å‹çš„IOã€‚ç„¶è€Œå…¶å®è¿˜å­˜åœ¨ä¸€ç§å†…å­˜å’Œå†…å­˜ä¹‹é—´çš„IOï¼Œå«ç±»æ–‡ä»¶å¯¹è±¡ï¼ˆfile-like objectï¼Œåœ¨å†…å­˜ä¸­åˆ›å»ºï¼Œå¯ä»¥åƒæ–‡ä»¶ä¸€æ ·è¢«æ“ä½œï¼‰ã€‚PythonåŸç”Ÿæä¾›ä¸¤ä¸ªç±»æ–‡ä»¶å¯¹è±¡ï¼šStringIOå’ŒBytesIOã€‚</p><p>Qé—®é¢˜ä¸€ï¼šä¸ºä»€ä¹ˆè¦æœ‰å†…å­˜çº§åˆ«çš„IOï¼Ÿ</p><p>Aï¼šç£ç›˜ä¸Šçš„æ–‡ä»¶ï¼Œå°±æ˜¯å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜çš„ä¸€å—åŒºåŸŸï¼Œä¾›åé¢é‡å¤ä½¿ç”¨ã€‚å…¶ä¼˜ç‚¹å°±æ˜¯æŒä¹…åŒ–ç¨³å®šä¸ä¸¢å¤±ï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯æ¯æ¬¡è¦ä½¿ç”¨éƒ½è¦ä»ç£ç›˜è¯»å…¥ï¼Œç›¸å¯¹å†…å­˜è€Œè¨€å¾ˆç¼“æ…¢ï¼›å¦‚æœåªæ˜¯çŸ­æ—¶é—´çš„é‡å¤åˆ©ç”¨ï¼Œå¹¶ä¸å¸Œæœ›é•¿æœŸæŒä¹…åŒ–ï¼Œè€Œä¸”å¯¹é€Ÿåº¦çš„è¦æ±‚æ¯”è¾ƒé«˜ï¼Œè¿™æ—¶å€™å°±å¯ä»¥è€ƒè™‘ç¼“å­˜ã€‚è¯´åˆ°ç¼“å­˜ï¼Œå¾ˆå¤šæœ‹å‹å°±æƒ³åˆ°redisï¼Œç†Ÿæ‚‰pythonçš„æœ‹å‹è¿˜ä¼šæƒ³åˆ°è£…é¥°å™¨å’Œé—­åŒ…å‡½æ•°ã€‚ä¸è¿‡pythonå·²ç»åŸç”Ÿä¸ºæˆ‘ä»¬å‡†å¤‡å¥½äº†ç±»æ–‡ä»¶å¯¹è±¡ï¼šStringIOå’ŒBytesIOï¼Œç”¨äºä¸´æ—¶ç¼“å†²</p><p>Qé—®é¢˜äºŒï¼šStringIOå’ŒBytesIOåŒºåˆ«ï¼Ÿ</p><p>A:StringIOåªèƒ½å­˜å‚¨å­—ç¬¦ä¸²ï¼Œé‡åˆ°ä»ç½‘ç»œä¸‹è½½çš„å›¾ç‰‡è§†é¢‘ç­‰Bytesç±»å‹çš„å†…å®¹å°±ä¸è¡Œäº†ï¼Œéœ€è¦ç”¨åˆ°ä¸“é—¨å­˜å‚¨Bytesç±»å‹çš„BytesIOå¯¹è±¡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> io <span class="keyword">import</span> BytesIO           </span><br><span class="line">In [<span class="number">2</span>]: b=BytesIO()         </span><br><span class="line">In [<span class="number">3</span>]: b.write(<span class="string">'å°ä»˜'</span>.encode(<span class="string">'utf-8'</span>))    </span><br><span class="line">Out[<span class="number">3</span>]: <span class="number">6</span></span><br><span class="line">In [<span class="number">4</span>]: b.getvalue()                          </span><br><span class="line">Out[<span class="number">4</span>]: <span class="string">b'\xe5\xb0\x8f\xe4\xbb\x98'</span></span><br></pre></td></tr></table></figure><p>Qé—®é¢˜ä¸‰ï¼šé‚£ä¹ˆè¿™ä¸¤ä¸ªIOæœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ</p><p>A: BytesIOçœŸæ­£å®ç”¨çš„åœ°æ–¹è¿˜æ˜¯åœ¨äºå­˜å‚¨å›¾ç‰‡è§†é¢‘ç­‰æ•°æ®ï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚äº†ä¸€ä¸ªå›¾ç‰‡ï¼Œæ‹¿åˆ°äº†<code>resp.content</code>çš„å­—èŠ‚æµï¼Œç„¶åéœ€è¦æ‰“å¼€å±•ç¤ºå›¾ç‰‡ï¼Œä½†â‘ pillowåº“æ‰“å¼€çš„éƒ½æ˜¯æ–‡ä»¶IOå¯¹è±¡ï¼Œæ— æ³•ç›´æ¥é€šè¿‡å­—èŠ‚æµå±•ç¤ºï¼›â‘¡ä¿å­˜åˆ°æœ¬åœ°ä½œä¸ºæ–‡ä»¶æ‰“å¼€åˆæ²¡å¿…è¦ï¼Œæ—¢å ç”¨å­˜å‚¨ç©ºé—´ï¼Œæ•ˆç‡åˆä½â€“&gt;æ­¤æ—¶å°±å¯ä»¥å†™å…¥åˆ°å†…å­˜ä¸­çš„IO(BytesIO)ä¸­</p><p>Qé—®é¢˜å››ï¼šé‚£ä¹ˆStringIOå’ŒBytesIOè·Ÿæ™®é€šç”¨çš„<code>f = open()</code>çš„FileIOæœ‰ä»€ä¹ˆç›¸åŒç‚¹å‘¢</p><p>A:StringIOå’ŒBytesIOä»ç„¶ä¸ºIOï¼Œä½†æ‹¥æœ‰å’Œè¯»å†™æ–‡ä»¶å…·æœ‰ä¸€è‡´çš„æ¥å£ï¼Œå…¶æœ¬è´¨æ˜¯å°†å†…å­˜ä½œä¸ºä¸€ä¸ªæ–‡ä»¶çœ‹å¾…ï¼Œåªæ˜¯åœ¨å†…å­˜ä¸­æ“ä½œstrå’Œbytesã€‚</p><h3 id="æœ¬é¡¹ç›®æ¡ˆä¾‹-2"><a class="markdownIt-Anchor" href="#æœ¬é¡¹ç›®æ¡ˆä¾‹-2"></a> æœ¬é¡¹ç›®æ¡ˆä¾‹ï¼š</h3><blockquote><p><code>python-docx</code>åº“ä¸­Documentå¯¹è±¡å¯ä»¥é€šè¿‡<code>add_picture()</code>æ–¹æ³•æ’å…¥å›¾ç‰‡åˆ°wordä¸­ï¼Œä½†æ˜¯<code>add_picture</code>çš„å‚æ•°ä¸º<code>img_path</code>æˆ–è€…<code>stream</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªStreamæµæŒ‡çš„è‚¯å®šæ˜¯å›¾ç‰‡çš„å­—èŠ‚æµï¼Œä½†æ˜¯ç›´æ¥é€šè¿‡bytesæ•°æ®è‚¯å®šæ˜¯æ²¡åŠæ³•ä¼ å…¥çš„ï¼Œå› æ­¤å¯ä»¥<strong>å°†å…¶å†™å…¥åˆ°BytesIOä¸­ï¼Œä¾›å…¶è¯»å–</strong></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> d = Document()</span><br><span class="line">   resp = requests.get(</span><br><span class="line">       <span class="string">"https://images.zsxq.com/FodneHQIMESZXJWe4SahoZ_J_vGs?imageMogr2/auto-orient/quality/100!/ignore-error/1&amp;e=1656604799&amp;token=kIxbL07-8jAj8w1n4s9zv64FuZZNEATmlU_Vm6zD:onEkC9y8uloYeHTrEIpYk4dstaw="</span>)</span><br><span class="line">   bf = BytesIO()</span><br><span class="line">   bf.write(resp.content)</span><br><span class="line">   d.add_picture(bf)</span><br><span class="line">   <span class="comment"># ä¸€å¼ å›¾ç‰‡</span></span><br><span class="line">   bf.close()</span><br><span class="line">   d.save(<span class="string">"test.docx"</span>)</span><br><span class="line">   <span class="comment"># saveä¹‹åå¯ä»¥ç»§ç»­ **æ’å…¥**, ç„¶åå†ä¿å­˜</span></span><br><span class="line">   d.add_paragraph(<span class="string">"he"</span>)</span><br><span class="line">   d.save(<span class="string">"test.docx"</span>)</span><br><span class="line"><span class="comment"># ä¸€å¼ å›¾ç‰‡ï¼Œç”Ÿæˆä¸€ä¸ªBytesIO</span></span><br><span class="line">   bf = BytesIO()</span><br><span class="line">   resp = requests.get(</span><br><span class="line">       <span class="string">"https://images.zsxq.com/FrqnoTw_W2Pqhn1107HLd3jveuSz?e=1656604799&amp;token=kIxbL07-8jAj8w1n4s9zv64FuZZNEATmlU_Vm6zD:MJuNvGjp8XcfDNLPB5eLcouRFRg="</span>)</span><br><span class="line">   bf.write(resp.content)</span><br><span class="line">   d.add_picture(bf)</span><br><span class="line">   d.save(<span class="string">"test.docx"</span>)</span><br><span class="line">   bf.close()</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šé€šè¿‡bf.flush()æ— æ³•æ¸…ç©ºå†…å®¹, å¿…é¡»close(), å¦åˆ™<code>bf.write(æ–°å›¾ç‰‡)</code>ç„¶åå†æ·»åŠ æ—¶ç¬¬äºŒå¼ å›¾ç‰‡å†…å®¹ä»ç„¶ä¸ºç¬¬ä¸€å¼ ã€‚</p><p>â˜… --&gt; ç½‘ä¸Šæ²¡èƒ½æ‰¾åˆ°æ¸…é™¤BytesIOå·²æœ‰å†…å®¹ï¼Œå› æ­¤ç»“è®ºä¸ºï¼šä¸€ä¸ªbyteså†…å®¹å ç”¨ä¸€ä¸ªBytesIOï¼Œç”¨å®Œå°±å…³é—­</p><h2 id="loguru"><a class="markdownIt-Anchor" href="#loguru"></a> loguru</h2><blockquote><p>loguruä¸­æä¾›å…¨å±€çš„logger, å¯ä»¥ç›´æ¥é€šè¿‡ <code>from loguru import logger</code> æ¥è·å¾— logger, ä½†æ˜¯è¿™å°±æ„å‘³ç€, è¿™æ ·è·å¾—çš„éƒ½æ˜¯éƒ½ä¸€ä¸ªlogger<br>å¯¹è±¡, å› æ­¤ä¸å¤ªæ–¹ä¾¿ç”¨äºåˆ†æ¨¡å—çš„æ—¥å¿—ç®¡ç†, è€Œæ˜¯å…¨å±€çš„æ—¥å¿—ç®¡ç†ã€‚</p></blockquote><p>loguruçš„ä¾¿æ·ä½“ç°åœ¨å…¶<strong>å¼€ç®±å³ç”¨</strong>(å°‘é…ç½®)çš„ç‰¹ç‚¹, ä¸‹é¢ä¸¤è¡Œä»£ç å°±èƒ½è¾“å‡ºç¾è§‚çš„æ—¥å¿—è¾“å‡º</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line">logger.info(<span class="string">"hello"</span>)</span><br></pre></td></tr></table></figure><p>å…¶æ¬¡, logurué…ç½®æ—¥å¿—æ–‡ä»¶ä¹Ÿéå¸¸æ–¹ä¾¿, ä»–æå‡ºå±äºä¸º**â€œæ²‰é‡â€**<code>sink</code><br><code>logger.add(sink='log.txt', format=&quot;{time} {level} {message}&quot;, filter=&quot;my_module&quot;, level=&quot;INFO&quot;)</code><br>å°†ä¸Šé¢ä¸¤ä¸ªåŠŸèƒ½åˆèµ·æ¥ï¼Œå°±èƒ½å®ç°æœ€åŸºæœ¬çš„æ—¥å¿—åŠŸèƒ½äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line">logger.add(sink=<span class="string">'log.log'</span>, format=<span class="string">"&#123;time&#125; - &#123;level&#125; - &#123;message&#125;"</span>, level=<span class="string">"INFO"</span>)</span><br><span class="line">logger.info(<span class="string">"That's it, beautiful and simple logging!"</span>)</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç”¨rotationã€retentionã€compressionè¿›è¡Œæ—¥å¿—çª—å£ã€æ›´æ–°ã€å‹ç¼©ç®¡ç†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">logger.add(<span class="string">"file_1.log"</span>, rotation=<span class="string">"500 MB"</span>)    <span class="comment"># æ—¥å¿—æ–‡ä»¶çš„çª—å£å¤§å°æ˜¯500M</span></span><br><span class="line">logger.add(<span class="string">"file_2.log"</span>, rotation=<span class="string">"12:00"</span>)     <span class="comment"># æ¯å¤©ä¸­åˆ12ç‚¹åˆ›å»ºæ–°æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">logger.add(<span class="string">"file_3.log"</span>, rotation=<span class="string">"1 week"</span>)    <span class="comment"># è‡ªåŠ¨æ›´æ–°æ—§æ–‡ä»¶</span></span><br><span class="line">logger.add(<span class="string">"file_X.log"</span>, retention=<span class="string">"10 days"</span>)  <span class="comment"># æ¸…ç†æ—§æ–‡ä»¶</span></span><br><span class="line">logger.add(<span class="string">"file_Y.log"</span>, compression=<span class="string">"zip"</span>)    <span class="comment"># å‹ç¼©æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><p>more:</p><ul><li>ä¿®æ”¹æ—¥å¿—æ–‡å­—çš„é¢œè‰²<br><code>logger.add(sys.stdout, colorize=True, format=&quot;&lt;green&gt;{time}&lt;/green&gt; &lt;level&gt;{message}&lt;/level&gt;&quot;)</code></li><li>ä½¿ç”¨enqueueï¼Œå¯ä»¥ä¿è¯å¤šçº¿ç¨‹å®‰å…¨ã€å¤šè¿›ç¨‹å®‰å…¨<br><code>logger.add(&quot;somefile.log&quot;, enqueue=True)</code><br>å‚è€ƒ: <a href="https://www.jianshu.com/p/0c27ac960546" target="_blank" rel="noopener">Loguruï¼šä¼˜é›…çš„Pythonç¨‹åºæ—¥å¿—</a></li></ul><h3 id="æœ¬é¡¹ç›®è‡ªç”¨logurué…ç½®"><a class="markdownIt-Anchor" href="#æœ¬é¡¹ç›®è‡ªç”¨logurué…ç½®"></a> æœ¬é¡¹ç›®è‡ªç”¨logurué…ç½®</h3><ol><li><code>settings.py</code>ä¸­æ‰¾åˆ°é¡¹ç›®ç»å¯¹è·¯å¾„: <code>basedir = Path(__file__).resolve().parent.parent</code></li><li>å°†loguruä¸­çš„loggeræ³¨å†Œä¸ºå…¨å±€LOG, æš´éœ²ç»™å…¶ä»–æ¨¡å—ä½¿ç”¨</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"><span class="keyword">from</span> helper.settings <span class="keyword">import</span> basedir</span><br><span class="line"></span><br><span class="line">log_folder_path = Path(basedir, <span class="string">'logs'</span>)</span><br><span class="line">log_path = Path(log_folder_path, time.strftime(<span class="string">"%F"</span>))  <span class="comment"># æ—¥å¿—æ ¹ç›®å½• ../logs/yyyy-mm-dd/</span></span><br><span class="line"><span class="comment"># åˆ›å»ºæ—¥å¿—æ–‡ä»¶å¤¹</span></span><br><span class="line">log_path.mkdir(parents=<span class="keyword">True</span>, exist_ok=<span class="keyword">True</span>)</span><br><span class="line"><span class="comment"># è®¾ç½®logger</span></span><br><span class="line">logger.add(sink=Path(log_path, <span class="string">"log.txt"</span>), format=<span class="string">"&#123;time&#125; &#123;level&#125; &#123;message&#125;"</span>, level=<span class="string">"INFO"</span>)</span><br><span class="line"><span class="comment"># æš´éœ²LOGç»™å…¶ä»–æ¨¡å—ä½¿ç”¨</span></span><br><span class="line">LOG = logger</span><br></pre></td></tr></table></figure><h2 id="retryæ¨¡å—-2"><a class="markdownIt-Anchor" href="#retryæ¨¡å—-2"></a> retryæ¨¡å—</h2><blockquote><p>â–²æœ¬é¡¹ç›®ä¸­ä¸çŸ¥ä¸ºä½•åŸå› ï¼Œoptions+getä¹‹åæ€»ä¼šå‡ºç°<code>{'succeeded': False, 'code': 1059, 'info': '', 'resp_data': {}}</code>çš„æ•°æ®ï¼Œä½†æ˜¯è¿›è¡Œé‡è¯•å‘é€è¯·æ±‚ååˆèƒ½è§£å†³ï¼Œå› æ­¤retryæ¨¡å—åœ¨è¿™ä¸ªé¡¹ç›®ä¸­å‘æŒ¥ä¸­è¾ƒå¤§çš„ä½œç”¨ã€‚</p></blockquote><p>retryæ˜¯ä¸€ä¸ªç”¨äºé”™è¯¯å¤„ç†çš„æ¨¡å—ï¼ŒåŠŸèƒ½ç±»ä¼¼try-exceptï¼Œä½†å¯ä»¥æ›´åŠ å¿«æ·æ–¹ä¾¿çš„è®¾ç½®é‡è¯•çš„æ¬¡æ•°ï¼Œä»¥åŠæ¯æ¬¡é‡è¯•ä¹‹é—´ç›¸éš”çš„æ—¶é—´ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@retry()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_trouble</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">'''Retry until succeed'''</span></span><br><span class="line">    <span class="keyword">print</span> (<span class="string">'retrying...'</span>)</span><br></pre></td></tr></table></figure><ul><li><p>exceptionsï¼šä¼ å…¥æŒ‡å®šçš„é”™è¯¯ç±»å‹ï¼Œé»˜è®¤ä¸ºExceptionï¼Œå³æ•è·æ‰€æœ‰ç±»å‹çš„é”™è¯¯ï¼Œä¹Ÿå¯ä¼ å…¥<strong>å…ƒç»„å½¢å¼çš„å¤šç§æŒ‡å®šé”™è¯¯ç±»å‹</strong>ã€‚</p></li><li><p>triesï¼šå®šä¹‰æ•è·é”™è¯¯ä¹‹åé‡å¤è¿è¡Œæ¬¡æ•°ï¼Œé»˜è®¤ä¸º-1ï¼Œå³ä¸ºæ— æ•°æ¬¡ã€‚</p></li><li><p>delayï¼šå®šä¹‰æ¯æ¬¡é‡å¤è¿è¡Œä¹‹é—´çš„åœé¡¿æ—¶é•¿ï¼Œå•ä½ç§’ï¼Œé»˜è®¤ä¸º0ï¼Œå³æ— åœé¡¿ã€‚</p></li><li><p>backoffï¼šå‘ˆæŒ‡æ•°å¢é•¿çš„æ¯æ¬¡é‡å¤è¿è¡Œä¹‹é—´çš„åœé¡¿æ—¶é•¿ï¼Œéœ€è¦é…åˆdelayæ¥ä½¿ç”¨ï¼Œè­¬å¦‚delayè®¾ç½®ä¸º3ï¼Œbackoffè®¾ç½®ä¸º2ï¼Œåˆ™ç¬¬ä¸€æ¬¡é—´éš”ä¸º<code>3*2^0=3</code>ç§’ï¼Œç¬¬äºŒæ¬¡<code>3*2^1=6</code>ç§’ï¼Œç¬¬ä¸‰æ¬¡<code>3*2^2</code>=12ç§’ï¼Œä»¥æ­¤ç±»æ¨ï¼Œé»˜è®¤ä¸º1ã€‚</p></li><li><p>max_delayï¼šå®šä¹‰backoffå’Œdelayé…åˆä¸‹å‡ºç°çš„æœ€å¤§ç­‰å¾…æ—¶é—´ä¸Šé™ï¼Œå½“</p><p><code>delay*backoff**n</code>å¤§äºmax_delayæ—¶ï¼Œç­‰å¾…é—´éš”å›ºå®šä¸ºè¯¥å€¼è€Œä¸å†å¢é•¿ã€‚</p></li></ul><h1 id="qkl"><a class="markdownIt-Anchor" href="#qkl"></a> qkl</h1><h2 id="requests-html"><a class="markdownIt-Anchor" href="#requests-html"></a> requests-html</h2><blockquote><p>å®‰è£…: <code>pip install requests-html</code>ï¼Œåªæ”¯æŒpython3.6åŠä»¥ä¸Š</p></blockquote><p>ç”±äºå…¶ç”¨äº†<code>nuxt</code>æ¡†æ¶ï¼Œå› æ­¤æœ‰äº›è·¯ç”±æ•°æ®ä¿å­˜åœ¨<code>windows.__NUXT__.data</code>ä¸­ï¼Œè€Œè¿™äº›æ•°æ®éƒ½æ˜¯å˜é‡ï¼Œæ— æ³•ç›´æ¥é€šè¿‡æ­£åˆ™æå–å‡ºæ¥ï¼Œä½†æ˜¯å› ä¸ºå…¶å¯ä»¥åœ¨æ§åˆ¶å°è¾“å‡ºå·²ç»æ¸²æŸ“ç”Ÿæˆå¥½çš„<code>windows.__NUXT__.data</code>æ•°æ®ï¼Œå› æ­¤è€ƒè™‘åˆ°ç”¨chromiumåæ‰§è¡Œæ¸²æŸ“è„šæœ¬åº”è¯¥å¯ä»¥å®ç°ã€‚ä½†ä¹‹å‰æœ‰äº†è§£è¿‡requets-htmlï¼Œå…¶ç›¸å¯¹äºè¦å¼€æµè§ˆå™¨è€Œè¨€æ›´åŠ ä¾¿æ·ä¸€äº›ï¼Œäºæ˜¯æœ¬æ¬¡ä½¿ç”¨çš„æ˜¯requests-htmlã€‚</p><p><strong>å¿«é€Ÿä¸Šæ‰‹ï¼š</strong></p><p>ç”±äºä¸requestsåº“å‡ºäºåŒä¸€ä½œè€…ï¼Œå› æ­¤APIå’Œ<code>requestsåº“</code>éƒ½å·®ä¸å¤šï¼Œä¸»è¦çš„åŒºåˆ«åœ¨äº<code>resp.html</code>è¿™ä¸ªå±æ€§,å®ƒæ˜¯æ•´ä¸ª<code>requests_htmlåº“</code>ä¸­æœ€æ ¸å¿ƒçš„ä¸€ä¸ªç±»ï¼Œè´Ÿè´£å¯¹HTMLè¿›è¡Œè§£æã€‚æ¯”å¦‚åˆ†é¡µã€æ¸²æŸ“ç­‰åŠŸèƒ½éƒ½æ˜¯ç”±è¯¥å¯¹è±¡æä¾›çš„ã€‚</p><p>ç›¸æ¯”requestsçš„æ–°åŠŸèƒ½æœ‰ï¼š</p><ul><li>æ”¯æŒJavaScript</li><li>æ”¯æŒé¡µé¢è§£æï¼šCSSé€‰æ‹©å™¨ï¼ˆåˆåjQueryé£æ ¼, æ„Ÿè°¢PyQueryï¼‰ã€æ”¯æŒXpathé€‰æ‹©å™¨</li><li>å¯è‡ªå®šä¹‰æ¨¡æ‹ŸUser-Agentï¼ˆæ¨¡æ‹Ÿå¾—æ›´åƒçœŸæ­£çš„webæµè§ˆå™¨ï¼‰</li><li>è‡ªåŠ¨è¿½è¸ªé‡å®šå‘</li><li>è¿æ¥æ± ä¸cookieæŒä¹…åŒ–</li><li>æ”¯æŒå¼‚æ­¥è¯·æ±‚</li><li>æ™ºèƒ½å¤šé¡µ</li></ul><p><strong>è·å–é“¾æ¥</strong></p><p>linkså’Œabsolute_linksä¸¤ä¸ªå±æ€§åˆ†åˆ«è¿”å›HTMLå¯¹è±¡(URL)æ‰€åŒ…å«çš„æ‰€æœ‰é“¾æ¥å’Œç»å¯¹é“¾æ¥ï¼ˆå‡ä¸åŒ…å«é”šç‚¹ï¼‰ï¼ˆå·²ç»è‡ªåŠ¨å»æ‰äº†htmlæ ‡ç­¾ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–å“åº”é¡µé¢ä¸‹çš„æ‰€æœ‰é“¾æ¥</span></span><br><span class="line">print(r.html.links)</span><br><span class="line">print(r.html.absolute_links)</span><br></pre></td></tr></table></figure><p><strong>è·å–å…ƒç´ </strong></p><p>request-htmlæ”¯æŒCSSé€‰æ‹©å™¨(å€ŸåŠ©PyQuery)å’ŒXPATH(å€ŸåŠ©lxml)ä¸¤ç§è¯­æ³•æ¥é€‰å–HTMLå…ƒç´ ï¼Œæˆ‘ä¸€èˆ¬ç”¨xpathæ¯”è¾ƒå¤šï¼Œå› æ­¤å°±ä»‹ç»xpathäº†ï¼Œselectorçš„ç”¨æ³•æ˜¯ç±»ä¼¼çš„ã€‚</p><p>XPATè¯­æ³•ï¼Œéœ€è¦å¦ä¸€ä¸ªå‡½æ•°xpathçš„æ”¯æŒï¼Œå®ƒæœ‰4ä¸ªå‚æ•°ï¼š</p><ul><li>selectorï¼Œè¦ç”¨çš„XPATHé€‰æ‹©å™¨ï¼›</li><li>cleanï¼Œå¸ƒå°”å€¼ï¼Œå¦‚æœä¸ºçœŸä¼šå¿½ç•¥HTMLä¸­styleå’Œscriptæ ‡ç­¾é€ æˆçš„å½±å“ï¼ˆåŸæ–‡æ˜¯sanitizeï¼Œå¤§æ¦‚è¿™ä¹ˆç†è§£ï¼‰;</li><li>firstï¼Œå¸ƒå°”å€¼ï¼Œå¦‚æœä¸ºçœŸä¼šè¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦åˆ™ä¼šè¿”å›æ»¡è¶³æ¡ä»¶çš„å…ƒç´ åˆ—è¡¨ï¼›</li><li><code>_encoding</code>ï¼Œç¼–ç æ ¼å¼ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(r.html.xpath(<span class="string">"//div[@id='menu']"</span>, first=<span class="keyword">True</span>).text)</span><br><span class="line">print(r.html.xpath(<span class="string">"//div[@id='menu']/a"</span>))</span><br><span class="line"><span class="comment"># å¦‚æœXPATHä¸­åŒ…å«text()æˆ–@hrefè¿™æ ·çš„å­å±æ€§ï¼Œé‚£ä¹ˆç»“æœç›¸åº”çš„ä¼šå˜æˆç®€å•çš„å­—ç¬¦ä¸²ç±»å‹ï¼Œè€Œä¸æ˜¯HTMLå…ƒç´ ã€‚</span></span><br><span class="line">print(r.html.xpath(<span class="string">"//div[@class='content']/span/text()"</span>))</span><br></pre></td></tr></table></figure><p><strong>å…ƒç´ å†…å®¹</strong></p><p>è¦æœç´¢å…ƒç´ çš„æ–‡æœ¬å†…å®¹ï¼Œç”¨searchå‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(e.search(<span class="string">'è¿˜æ˜¯&#123;&#125;æ²¡å¤´è„‘'</span>)[<span class="number">0</span>])</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸ºï¼š é‚£ä¸ª</span></span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªé“¾æ¥å±æ€§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(e.links) <span class="comment"># ç›¸å¯¹è·¯å¾„ </span></span><br><span class="line">print(e.absolute_links) <span class="comment"># ç»å¯¹è·¯å¾„</span></span><br></pre></td></tr></table></figure><p><strong>JavaScriptæ”¯æŒ</strong></p><p>æœ‰äº›ç½‘ç«™æ˜¯ä½¿ç”¨JavaScriptæ¸²æŸ“çš„ï¼Œç›´æ¥çˆ¬å–é¡µé¢ç»“æ„æˆ–è€…æ˜¯æ¥å£è·å¾—æ•°æ®å¯èƒ½ä¸æ˜¯æƒ³è¦çš„æ•°æ®ï¼Œè¿™æ ·çš„ç½‘ç«™requests-htmlä¹Ÿå¯ä»¥å¤„ç†JSæ¸²æŸ“ã€‚å…³é”®ä¸€æ­¥å°±æ˜¯åœ¨HTMLç»“æœä¸Šè°ƒç”¨ä¸€ä¸‹renderå‡½æ•°ï¼Œå®ƒä¼šåœ¨ç”¨æˆ·ç›®å½•ï¼ˆé»˜è®¤æ˜¯~/.pyppeteer/ï¼‰ä¸­ä¸‹è½½ä¸€ä¸ªchromiumï¼Œç„¶åç”¨å®ƒæ¥æ‰§è¡ŒJSä»£ç ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">h = session.get(<span class="string">'http://python-requests.org/'</span>) </span><br><span class="line">h.html.render()</span><br><span class="line">r.html.search(<span class="string">'Python 2 will retire in only &#123;months&#125; months!'</span>)[<span class="string">'months'</span>] <span class="string">'&lt;time&gt;25&lt;/time&gt;'</span></span><br></pre></td></tr></table></figure><p>renderå‡½æ•°è¿˜æœ‰ä¸€äº›å‚æ•°ï¼š</p><ul><li>retries: åŠ è½½é¡µé¢å¤±è´¥çš„æ¬¡æ•°</li><li>script: é¡µé¢ä¸Šéœ€è¦æ‰§è¡Œçš„JSè„šæœ¬ï¼ˆå¯é€‰ï¼‰</li><li>wait: åŠ è½½é¡µé¢å‰çš„ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé˜²æ­¢è¶…æ—¶ï¼ˆå¯é€‰ï¼‰</li><li>scrolldown: é¡µé¢å‘ä¸‹æ»šåŠ¨çš„æ¬¡æ•°</li><li>sleep: åœ¨é¡µé¢åˆæ¬¡æ¸²æŸ“ä¹‹åçš„ç­‰å¾…æ—¶é—´</li><li>reload: å¦‚æœä¸ºå‡ï¼Œé‚£ä¹ˆé¡µé¢ä¸ä¼šä»æµè§ˆå™¨ä¸­åŠ è½½ï¼Œè€Œæ˜¯ä»å†…å­˜ä¸­åŠ è½½</li><li>keep_page: å¦‚æœä¸ºçœŸï¼Œå…è®¸ä½ ç”¨r.html.pageè®¿é—®é¡µé¢</li></ul><p><strong>æ™ºèƒ½åˆ†é¡µ</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rq = session.get(<span class="string">"https://reddit.com"</span>) </span><br><span class="line"><span class="keyword">for</span> html <span class="keyword">in</span> rq.html:</span><br><span class="line">print(html)</span><br></pre></td></tr></table></figure><p><strong>ç›´æ¥ä½¿ç”¨HTML</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests_html </span><br><span class="line"><span class="keyword">import</span> HTML doc = <span class="string">"&lt;a href='https://httpbin.org'&gt;"</span> </span><br><span class="line">html = HTML(html=doc) </span><br><span class="line">print(html.links) &#123;<span class="string">'https://httpbin.org'</span>&#125;</span><br></pre></td></tr></table></figure><p><strong>ç›´æ¥æ¸²æŸ“JSä»£ç </strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">script = <span class="string">""" </span></span><br><span class="line"><span class="string">() =&gt; &#123; </span></span><br><span class="line"><span class="string">return &#123; </span></span><br><span class="line"><span class="string">width: document.documentElement.clientWidth, height: document.documentElement.clientHeight, deviceScaleFactor: window.devicePixelRatio, </span></span><br><span class="line"><span class="string">&#125; </span></span><br><span class="line"><span class="string">&#125; </span></span><br><span class="line"><span class="string">"""</span> </span><br><span class="line">val= html.render(script=script,reload=<span class="keyword">False</span>) </span><br><span class="line">print(val) print(html.html)</span><br></pre></td></tr></table></figure><h3 id="rhtmlpageä¸æµè§ˆå™¨äº¤äº’"><a class="markdownIt-Anchor" href="#rhtmlpageä¸æµè§ˆå™¨äº¤äº’"></a> r.html.pageä¸æµè§ˆå™¨äº¤äº’</h3><blockquote><p>requests-htmlå°†å¯¹chromiumçš„é”®ç›˜å’Œé¼ æ ‡APIæ“ä½œèšåˆåœ¨äº†<code>r.html.page</code>å¯¹è±¡ä¸‹</p></blockquote><p><strong>é”®ç›˜äº‹ä»¶</strong></p><ul><li>keyboard.down(â€˜é”®ç›˜åç§°â€™):æŒ‰ä¸‹é”®ç›˜ä¸å¼¹èµ·(ä¸é”®ç›˜æœ‰ç‚¹ä¸å¤ªdown(â€˜hâ€™)åªä¼šå‡ºç°ä¸€ä¸ªhè€Œä¸æ˜¯hhhhhhhâ€¦)</li><li>keyboard.up(â€˜é”®ç›˜åç§°â€™):æŠ¬èµ·æŒ‰é”®</li><li>keyboard.press(â€˜é”®ç›˜åç§°â€™):æŒ‰ä¸‹+å¼¹èµ·</li><li>keyboard.type(â€˜è¾“å…¥çš„å­—ç¬¦ä¸²å†…å®¹â€™ï¼Œ{â€˜delayâ€™:100}) delayä¸ºæ¯ä¸ªå­è¾“å…¥åå»¶è¿Ÿæ—¶é—´å•ä½ä¸º<code>ms</code></li></ul><p><strong>é¼ æ ‡äº‹ä»¶</strong></p><p><strong>ç‚¹å‡»</strong></p><ul><li>click(â€˜cssé€‰æ‹©å™¨â€™,{ â€˜buttonâ€™ï¼šâ€˜leftâ€™, â€˜clickCountâ€™:1,â€˜delayâ€™:0})<ul><li>buttonä¸ºé¼ æ ‡çš„æŒ‰é”®<code>left</code>, <code>right</code>, or <code>middle</code>,</li><li>clickCount:ç‚¹å‡»æ¬¡æ•°é»˜è®¤æ¬¡æ•°ä¸º1</li><li>delay:ç‚¹å‡»å»¶è¿Ÿæ—¶é—´,å•ä½æ˜¯æ¯«ç§’</li></ul></li><li>mouse.click(x, y,{ â€˜buttonâ€™ï¼šâ€˜leftâ€™, â€˜clickCountâ€™:1,â€˜delayâ€™:0})<ul><li>x,y:muberæ•°æ®ç±»å‹,ä»£è¡¨ç‚¹å‡»å¯¹è±¡çš„åæ ‡</li></ul></li></ul><p><strong>ç‚¹ä¸‹å»ä¸æŠ¬èµ·</strong></p><ul><li>mouse.down({â€˜buttonâ€™:xxx,clickCount:xxx})</li></ul><p><strong>æŠ¬èµ·é¼ æ ‡</strong></p><ul><li>mouse.up({â€˜buttonâ€™:xxx,clickCount:xxx})</li></ul><p><strong>ç­‰å¾…</strong></p><ul><li>waitFor(â€˜é€‰æ‹©å™¨, æ–¹æ³• æˆ–è€… è¶…æ—¶æ—¶é—´â€™)<ul><li>é€‰æ‹©å™¨: css é€‰æ‹©å™¨æˆ–è€…ä¸€ä¸ªxpath æ ¹æ®æ˜¯ä¸æ˜¯<code>//</code>å¼€å¤´</li><li>æ–¹æ³•:æ—¶å€™æ­¤æ–¹æ³•æ˜¯<a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/#?product=Puppeteer&amp;version=v1.19.0&amp;show=api-pagewaitforfunctionpagefunction-options-args" target="_blank" rel="noopener">page.waitForFunction()</a>çš„ç®€å†™</li><li>è¶…æ—¶æ—¶é—´:å•ä½æ¯«ç§’</li></ul></li></ul><p><strong>ç­‰å¾…å…ƒç´ åŠ è½½</strong>: <code>waitForSelector('cssé€‰æ‹©å™¨')</code></p><p><strong>è·å–x,yåæ ‡</strong></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mydic =await r.html.page.evaluate(<span class="string">''</span><span class="string">'() =&gt;&#123; </span></span><br><span class="line"><span class="string">       var a = document.querySelector('</span><span class="comment">#kw')   #å¯¹è±¡çš„cssé€‰æ‹©å™¨</span></span><br><span class="line">       var b = a.getBoundingClientRect()</span><br><span class="line">       <span class="keyword">return</span> &#123;<span class="string">'x'</span><span class="symbol">:b</span>.x,<span class="string">'y'</span><span class="symbol">:b</span>.y , <span class="string">'width'</span><span class="symbol">:b</span>.width , <span class="string">'height'</span><span class="symbol">:b</span>.height &#125;</span><br><span class="line">       &#125;<span class="string">''</span><span class="string">')</span></span><br></pre></td></tr></table></figure><p>ğŸ“–</p><ul><li><a href="https://blog.csdn.net/weixin_52182640/article/details/119741570" target="_blank" rel="noopener">pythonè‡ªå­¦çˆ¬è™«ä¹‹requests-html</a>â€”â€”æ•´ä½“APIä»‹ç»</li><li><a href="https://www.cnblogs.com/guapitomjoy/p/12153557.html" target="_blank" rel="noopener">requests-htmlåº“renderæ–¹æ³•çš„ä½¿ç”¨ </a>â€”â€”ä¸æµè§ˆå™¨äº¤äº’æ“ä½œ</li></ul><h2 id="request-htmlå¼‚æ­¥"><a class="markdownIt-Anchor" href="#request-htmlå¼‚æ­¥"></a> request-htmlå¼‚æ­¥</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests_html <span class="keyword">import</span> AsyncHTMLSession</span><br><span class="line">asession = AsyncHTMLSession()</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">get_pyclock</span><span class="params">(index)</span>:</span></span><br><span class="line">    r = <span class="keyword">await</span> asession.get(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">    <span class="keyword">await</span> r.html.arender()</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line">results = asession.run(get_pyclock, get_pyclock,</span><br><span class="line">                       get_pyclock)  <span class="comment"># è¿™é‡Œä½œè€…å°†åŒä¸€ä¸ªé¡µé¢ä½¿ç”¨å¼‚æ­¥æ–¹å¼è¿›è¡Œäº†3æ¬¡æ¸²æŸ“ï¼Œä½†æ˜¯å®é™…ä¸Šä½¿ç”¨çš„æ—¶é—´å¹¶ä¸æ˜¯å¹³æ—¶çš„3å€ï¼å¯èƒ½åªæ˜¯æ¯”å¹³æ—¶æ¸²æŸ“ä¸€ä¸ªé¡µé¢å¤šèŠ±äº†ä¸€ç‚¹æ—¶é—´è€Œå·²ï¼è¿™å°±æ˜¯å¼‚æ­¥çš„å¥½å¤„ï¼</span></span><br><span class="line">print(results)</span><br></pre></td></tr></table></figure><p>and:<a href="https://cloud.tencent.com/developer/article/1575104" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1575104</a></p><ul><li>ğŸ“–asession.runæ— æ³•ä¼ å‚çš„é—®é¢˜â€”â€”<a href="https://www.cnblogs.com/angelyan/p/13913926.html" target="_blank" rel="noopener">ä¿®æ”¹requests_html.AsyncHTMLSessionsä½¿å¾—æ”¯æŒurlå‚æ•°</a></li></ul><h2 id="charlesvpnæ— æ³•å…±ç”¨è§£å†³æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#charlesvpnæ— æ³•å…±ç”¨è§£å†³æ–¹æ¡ˆ"></a> charles+VPNæ— æ³•å…±ç”¨â€”â€”è§£å†³æ–¹æ¡ˆ</h2><blockquote><p>ç”±äºä¸¤ä¸ªéƒ½æ˜¯ä»£ç†å‹çš„è½¯ä»¶ï¼Œå› æ­¤å¾€å¾€é»˜è®¤éƒ½æŒ‡å®šäº†ä¸€ä¸ªç«¯å£ï¼Œå¯¼è‡´å¦ä¸€ä¸ªå¤±æ•ˆï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡è®¾ç½®è®©ä»–ä»¬ç«¯å£äº’çŸ¥ã€‚</p></blockquote><p>æœ€è¿‘éœ€è¦æŠ“ä¸€ä¸ªéœ€è¦ç¿»å¢™æ‰èƒ½è®¿é—®çš„ç½‘é¡µçš„åŒ…ï¼Œå‘ç°VPNç›´è¿æ—¶ä¼šå¯¼è‡´ Fiddler å’Œ Charles æŠ“åŒ…å·¥å…·æ— æ³•æ­£å¸¸è¿›è¡ŒæŠ“åŒ…ï¼Œç½‘ä¸Šæ‰¾äº†ä»¥åå‘ç°äº†ä¸€äº›è§£å†³æ–¹æ¡ˆï¼š<a href="https://github.com/mopduan/team/issues/13" target="_blank" rel="noopener">Github:VPNç›´è¿ï¼Œå¯¼è‡´ Fiddler å’Œ Charles æŠ“åŒ…å·¥å…·æ— æ³•æ­£å¸¸è¿›è¡ŒæŠ“åŒ…è§£å†³æ–¹æ¡ˆ </a>â€”â€”è¯•äº†è²Œä¼¼æ²¡ç”¨ã€<a href="https://www.jianshu.com/p/651ee335f97f?from=singlemessage" target="_blank" rel="noopener">windowsä¸‹ï¼Œå®ç°vpnè®¿é—®ä¸‹çš„charlesæŠ“åŒ…è®¾ç½®ä¸­æ— ç½‘ç»œé—®é¢˜çš„è§£å†³</a>â€”â€”æ”¶æ­¤å¯å‘æŒ‡å¯¼äº†åœ¨charlesçš„<code>Proxy-&gt;external proxy</code>å…è®¸å…¶ä»–ç«¯å£ä»£ç†</p><p><strong>1.æ‰¾åˆ°VPNè½¯ä»¶çš„ä»£ç†ç«¯å£proxy port</strong></p><p>æˆ‘è¿™è¾¹ä½¿ç”¨çš„æ˜¯vmessï¼Œå¯ä»¥åœ¨<code>é€‰é¡¹-&gt;å‚æ•°è®¾ç½®</code>ä¸­æŸ¥çœ‹ï¼Œéœ€è¦æ˜ç¡®çš„å‚æ•°æ˜¯ç«¯å£å’Œåè®®ï¼Œæˆ‘è¿™è¾¹æ˜¯10808å’Œsocksåè®®</p><p><img src="/2022/05/02/2022å¹´5æœˆåŠ³åŠ¨èŠ‚çˆ¬è™«é¡¹ç›®è®°å½•/.%5C2022%E5%B9%B45%E6%9C%88%E5%8A%B3%E5%8A%A8%E8%8A%82%E7%88%AC%E8%99%AB%E9%A1%B9%E7%9B%AE%E8%AE%B0%E5%BD%95%5Cvmess%E5%8F%82%E6%95%B0.jpg" alt="vmesså‚æ•°"></p><p><strong>2.è®¾ç½®charlesï¼š</strong></p><p><code>Proxy-&gt;external proxy</code>, é¦–å…ˆå…è®¸å…¶ä»–proxyï¼Œç„¶åæ ¹æ®åˆšåˆšæŸ¥çœ‹åˆ°çš„vmessç«¯å£å’Œåè®®è¿›è¡Œå¡«å†™</p><p><img src="/2022/05/02/2022å¹´5æœˆåŠ³åŠ¨èŠ‚çˆ¬è™«é¡¹ç›®è®°å½•/.%5C2022%E5%B9%B45%E6%9C%88%E5%8A%B3%E5%8A%A8%E8%8A%82%E7%88%AC%E8%99%AB%E9%A1%B9%E7%9B%AE%E8%AE%B0%E5%BD%95%5Ccharles.jpg" alt="charles"></p><p><strong>3.è®¾ç½®å®Œæˆï¼Œå¼€å§‹æŠ“åŒ…</strong></p><p>å®Œç»“æ’’èŠ±~</p><h3 id="requestsä½¿ç”¨ä»£ç†"><a class="markdownIt-Anchor" href="#requestsä½¿ç”¨ä»£ç†"></a> requestsä½¿ç”¨ä»£ç†</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'authority'</span>: <span class="string">'cn.v2ex.com'</span>,</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="string">'user-agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.60 Safari/537.36'</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># æ ¸å¿ƒæ˜¯è¦é…ç½®ä¸‹é¢çš„ä»£ç†</span></span><br><span class="line">http_proxy = <span class="string">"socks5h://127.0.0.1:10808"</span></span><br><span class="line">https_proxy = <span class="string">"socks5h://127.0.0.1:10808"</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">"https"</span>: https_proxy,</span><br><span class="line">    <span class="string">"http"</span>: http_proxy</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">'https://cn.v2ex.com/about'</span>, cookies=cookies, headers=headers, proxies=proxies)</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šä¸€å¼€å§‹åœ¨Sublimeé‡Œè¿è¡Œçš„ï¼Œç»“æœä¸€ç›´åœ¨<code>response.text</code>æ—¶æŠ¥ç¼–ç é”™è¯¯ï¼Œä½†æ˜¯é€šè¿‡ç½‘é¡µçš„content-typeå’Œmeta charsetè¿›è¡Œç¡®è®¤è¿‡æ²¡é—®é¢˜ï¼Œåæ¥ç»è¿‡ä¸€ä¸ªå¯å‘æƒ³åˆ°ä¼šä¸ä¼šæ˜¯æ§åˆ¶å°æœ‰ç¼–ç æ˜¾ç¤ºä¸äº†ï¼Œäºæ˜¯åœ¨Pycharmä¸­è¿è¡Œï¼ŒæˆåŠŸ!</p><h3 id="aiohttpä½¿ç”¨socksä»£ç†"><a class="markdownIt-Anchor" href="#aiohttpä½¿ç”¨socksä»£ç†"></a> aiohttpä½¿ç”¨socksä»£ç†</h3><blockquote><p>from: <a href="https://pypi.org/project/aiohttp-socks/%E3%80%81https://www.cnblogs.com/john-xiong/p/13812567.html" target="_blank" rel="noopener">https://pypi.org/project/aiohttp-socks/ã€https://www.cnblogs.com/john-xiong/p/13812567.html</a></p></blockquote><ol><li><p><code>pip install aiohttp_socks</code></p></li><li><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">connector = ProxyConnector.from_url(<span class="string">'socks5://127.0.0.1:10808'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">getDataByChromeDriver</span><span class="params">(url)</span>:</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession(connector=connector) <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> session.get(url) <span class="keyword">as</span> response:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">await</span> response.text()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">        loop.run_until_complete(asyncio.wait([getDataByChromeDriver(index) <span class="keyword">for</span> title, index <span class="keyword">in</span> title_list.items()]))</span><br></pre></td></tr></table></figure></li><li><p>è¿è¡Œå³å¯</p></li></ol><h3 id="request-htmlä½¿ç”¨ä»£ç†"><a class="markdownIt-Anchor" href="#request-htmlä½¿ç”¨ä»£ç†"></a> request-htmlä½¿ç”¨ä»£ç†</h3><blockquote><p><a href="https://baijiahao.baidu.com/s?id=1701142223076604985&amp;wfr=spider&amp;for=pc" target="_blank" rel="noopener">Pythonçˆ¬è™«ä¸€ä¸ªrequests_htmlæ¨¡å—è¶³çŸ£ï¼ï¼ˆæ”¯æŒJSåŠ è½½&amp;å¼‚æ­¥è¯·æ±‚ï¼‰</a></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests_html <span class="keyword">import</span> AsyncHTMLSession</span><br><span class="line"></span><br><span class="line">http_proxy = <span class="string">"socks5h://127.0.0.1:10808"</span></span><br><span class="line">https_proxy = <span class="string">"socks5h://127.0.0.1:10808"</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">"https"</span>: https_proxy,</span><br><span class="line">    <span class="string">"http"</span>: http_proxy</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">session = AsyncHTMLSession()</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">getDataByChromeDriver</span><span class="params">(index: Union[int, str])</span>:</span></span><br><span class="line">response = <span class="keyword">await</span> session.get(<span class="string">'https://www.qkl123.com/sector/&#123;&#125;'</span>.format(index), headers=headers, proxies=proxies)</span><br><span class="line">    <span class="comment"># ...</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;é±¼&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#é±¼&quot;&gt;&lt;/a&gt; é±¼&lt;/h1&gt;
&lt;h2 id=&quot;retryæ¨¡å—&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#retryæ¨¡å—&quot;&gt;&lt;/a&gt; retryæ¨¡å—&lt;/h2
      
    
    </summary>
    
    
      <category term="çˆ¬è™«" scheme="https://nymrli.top/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="Python" scheme="https://nymrli.top/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>mitmproxyæ‹¦æˆªä»£ç†â€”â€”PCç‰ˆHttpCanary</title>
    <link href="https://nymrli.top/2022/04/29/mitmproxy%E6%8B%A6%E6%88%AA%E4%BB%A3%E7%90%86%E2%80%94%E2%80%94PC%E7%89%88HttpCanary/"/>
    <id>https://nymrli.top/2022/04/29/mitmproxyæ‹¦æˆªä»£ç†â€”â€”PCç‰ˆHttpCanary/</id>
    <published>2022-04-29T12:52:09.000Z</published>
    <updated>2022-05-23T14:13:56.515Z</updated>
    
    <content type="html"><![CDATA[<h2 id="httpcanary"><a class="markdownIt-Anchor" href="#httpcanary"></a> HttpCanary</h2><p>HttpCanaryæ˜¯Androidç³»ç»Ÿä¸‹åŠŸèƒ½æœ€å¼ºå¤§çš„ç½‘ç»œåˆ†æå·¥å…·(IOSçš„æ˜¯Thro)ï¼Œæ”¯æŒTCP/UDP/HTTP/HTTPS/<u>WebSocket</u>ç­‰å¤šç§åè®®ï¼Œå¯ä»¥è§†ä¸ºAndroidå¹³å°ä¸‹çš„Fiddlerå’ŒCharlesã€‚</p><p><strong>â˜…å¼ºå¤§çš„è°ƒè¯•åŠŸèƒ½</strong></p><ul><li>æ–­ç‚¹æŒ‡å®šè¯·æ±‚ï¼Œæ”¯æŒä¿®æ”¹æ•°æ®å†æäº¤ã€‚</li><li>æ³¨å…¥å™¨æ”¯æŒï¼Œåˆ›å»ºè‡ªå®šä¹‰è§„åˆ™ä¿®æ”¹è¿”å›æ•°æ®åŒ…ï¼ˆâ˜…é™æ€æ³¨å…¥ï¼‰ã€‚</li><li>æ”¯æŒå¯¹ç½‘ç»œè¯·æ±‚é‡å‘ã€ç¼–è¾‘é‡å‘ã€æ‰¹é‡é‡å‘ç­‰æ“ä½œã€‚</li><li>é…ç½®é»‘åå•æˆ–è€…ç™½åå•ï¼Œè‡ªç”±æŒ‡å®šç›®æ ‡æŠ“åŒ…ã€‚</li><li>æ”¯æŒæ•°æ®åŒ…å±è”½ï¼Œæ¯”å¦‚å±è”½å®¢æˆ·ç«¯å‘å‘æœåŠ¡å™¨çš„æŒ‡å®šæ•°æ®åŒ…ã€‚</li></ul><h2 id="mitmproxy"><a class="markdownIt-Anchor" href="#mitmproxy"></a> mitmproxy</h2><p>é¡¾åæ€ä¹‰ï¼Œmitmproxy å°±æ˜¯ç”¨äº MITM çš„ proxyï¼ŒMITM å³<a href="https://zh.wikipedia.org/wiki/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB" target="_blank" rel="noopener">ä¸­é—´äººæ”»å‡»</a>ï¼ˆMan-in-the-middle attackï¼‰ã€‚ç”¨äºä¸­é—´äººæ”»å‡»çš„<strong>ä»£ç†</strong>é¦–å…ˆä¼šåƒæ­£å¸¸çš„ä»£ç†ä¸€æ ·è½¬å‘è¯·æ±‚ï¼Œä¿éšœ<strong>æœåŠ¡ç«¯</strong>ä¸<strong>å®¢æˆ·ç«¯</strong>çš„é€šä¿¡ï¼Œå…¶æ¬¡ï¼Œä¼šé€‚æ—¶çš„æŸ¥ã€è®°å½•å…¶æˆªè·çš„æ•°æ®ï¼Œæˆ–ç¯¡æ”¹æ•°æ®ï¼Œå¼•å‘æœåŠ¡ç«¯æˆ–å®¢æˆ·ç«¯ç‰¹å®šçš„è¡Œä¸ºã€‚ä¸åŒäº fiddler æˆ– wireshark ç­‰æŠ“åŒ…å·¥å…·ï¼Œmitmproxy ä¸ä»…å¯ä»¥<strong>æˆªè·è¯·æ±‚</strong>å¸®åŠ©å¼€å‘è€…æŸ¥çœ‹ã€åˆ†æï¼Œæ›´å¯ä»¥é€šè¿‡è‡ªå®šä¹‰è„šæœ¬è¿›è¡ŒäºŒæ¬¡å¼€å‘ã€‚</p><p>æ³¨ï¼šmitmproxyæœ€å¤§çš„ç‰¹ç‚¹è·ŸhttpCanaryä¸€æ ·ï¼Œå…¶æ‹¥æœ‰ä¿®æ”¹å“åº”çš„èƒ½åŠ›ï¼Œå®ç°å¦‚ä¸‹åŠŸèƒ½ï¼šï¼šâ€œæˆªè·å¯¹æµè§ˆå™¨å¯¹è¯¥ url çš„è¯·æ±‚ï¼Œå°†è¿”å›å†…å®¹ç½®ç©ºï¼Œå¹¶å°†çœŸå®çš„è¿”å›å†…å®¹å­˜åˆ°æŸä¸ªæ•°æ®åº“ï¼Œå‡ºç°å¼‚å¸¸æ—¶å‘å‡ºé‚®ä»¶é€šçŸ¥â€ï¼Œè¿™äº›éƒ½</p><p>ä½† mitmproxy å¹¶ä¸ä¼šçœŸçš„å¯¹æ— è¾œçš„äººå‘èµ·ä¸­é—´äººæ”»å‡»ï¼Œç”±äº mitmproxy å·¥ä½œåœ¨ HTTP å±‚ï¼Œè€Œå½“å‰ HTTPS çš„æ™®åŠè®©å®¢æˆ·ç«¯æ‹¥æœ‰äº†æ£€æµ‹å¹¶è§„é¿ä¸­é—´äººæ”»å‡»çš„èƒ½åŠ›ï¼Œæ‰€ä»¥è¦è®© mitmproxy èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œå¿…é¡»è¦è®©<strong>å®¢æˆ·ç«¯ï¼ˆAPP æˆ–æµè§ˆå™¨ï¼‰ä¸»åŠ¨ä¿¡ä»» mitmproxy çš„ SSL è¯ä¹¦</strong>ï¼Œæˆ–å¿½ç•¥è¯ä¹¦å¼‚å¸¸ï¼Œâ˜…<strong>è¿™ä¹Ÿå°±æ„å‘³ç€ APP æˆ–æµè§ˆå™¨æ˜¯å±äºå¼€å‘è€…æœ¬äººçš„</strong>â˜…â€”â€”æ˜¾è€Œæ˜“è§ï¼Œè¿™ä¸æ˜¯åœ¨åšé»‘äº§ï¼Œè€Œæ˜¯åœ¨åšå¼€å‘æˆ–æµ‹è¯•ã€‚</p><p><strong>ç‰¹æ€§</strong></p><ul><li>æ‹¦æˆªHTTPå’ŒHTTPSè¯·æ±‚å’Œå“åº”å¹¶å³æ—¶ä¿®æ”¹å®ƒä»¬</li><li>ä¿å­˜å®Œæ•´çš„HTTPå¯¹è¯ä»¥ä¾›ä»¥ä¹‹åé‡å‘å’Œåˆ†æ</li><li>é‡å‘HTTPå¯¹è¯çš„å®¢æˆ·ç«¯</li><li>é‡å‘å…ˆå‰è®°å½•çš„æœåŠ¡çš„HTTPå“åº”</li><li>åå‘ä»£ç†æ¨¡å¼å°†æµé‡è½¬å‘åˆ°æŒ‡å®šçš„æœåŠ¡å™¨</li><li>åœ¨macOSå’ŒLinuxä¸Šå®ç°é€æ˜ä»£ç†æ¨¡å¼</li><li>ä½¿ç”¨Pythonå¯¹HTTPæµé‡è¿›è¡Œè„šæœ¬åŒ–ä¿®æ”¹</li><li>å®æ—¶ç”Ÿæˆç”¨äºæ‹¦æˆªçš„SSL / TLSè¯ä¹¦</li></ul><h3 id="å®‰è£…"><a class="markdownIt-Anchor" href="#å®‰è£…"></a> å®‰è£…</h3><p>â€œå®‰è£… mitmproxyâ€è¿™å¥è¯æ˜¯æœ‰æ­§ä¹‰çš„ï¼Œæ—¢å¯ä»¥æŒ‡â‘ â€œå®‰è£… mitmproxy å·¥å…·â€ï¼Œä¹Ÿå¯ä»¥æŒ‡â‘¡â€œå®‰è£… python çš„ mitmproxy åŒ…â€ï¼Œæ³¨æ„åè€…æ˜¯åŒ…å«å‰è€…çš„ã€‚å³å®‰è£… python çš„ mitmproxy åŒ…é™¤äº†ä¼šå¾—åˆ° mitmproxy å·¥å…·å¤–ï¼Œè¿˜ä¼šå¾—åˆ°å¼€å‘å®šåˆ¶è„šæœ¬æ‰€éœ€è¦çš„åŒ…ä¾èµ–ï¼Œå…¶å®‰è£…è¿‡ç¨‹å¹¶ä¸å¤æ‚ã€‚</p><p>å¦‚æœåªæ˜¯æ‹¿ mitmproxy åšä¸€ä¸ªæ›¿ä»£ fiddler çš„å·¥å…·ï¼Œæ²¡æœ‰ä»€ä¹ˆå®šåˆ¶åŒ–çš„éœ€æ±‚ï¼ˆä¿®æ”¹å“åº”ç­‰åŠŸèƒ½ï¼‰ï¼Œé‚£å®Œå…¨åªéœ€è¦â€œå®‰è£… mitmproxy å·¥å…·â€å³å¯ï¼Œå» <a href="https://mitmproxy.org/" target="_blank" rel="noopener">mitmproxy å®˜ç½‘</a> ä¸Šä¸‹è½½ä¸€ä¸ª installer ä¾¿å¯å¼€ç®±å³ç”¨ï¼Œä¸éœ€è¦æå‰å‡†å¤‡å¥½ python å¼€å‘ç¯å¢ƒã€‚ä½†æ˜¾ç„¶ï¼Œè¿™ä¸æ˜¯è¿™é‡Œè¦è®¨è®ºçš„ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯â€œå®‰è£… python çš„ mitmproxy åŒ…â€ã€‚</p><p>å®‰è£…å‘½ä»¤ï¼š<code>pip install mitmproxy</code></p><p>å®Œæˆåï¼Œç³»ç»Ÿå°†æ‹¥æœ‰ <code>mitmproxy</code>ï¼ˆwindowsä¸­ä¸æ”¯æŒï¼‰ã€<code>mitmdump</code>ã€<code>mitmweb</code> ä¸‰ä¸ªå‘½ä»¤ï¼Œå¯ä»¥æ‹¿ <code>mitmdump</code> æµ‹è¯•ä¸€ä¸‹å®‰è£…æ˜¯å¦æˆåŠŸï¼Œæ‰§è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mitmdump --version</span><br></pre></td></tr></table></figure><p>åº”å½“å¯ä»¥çœ‹åˆ°ç±»ä¼¼äºè¿™æ ·çš„è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Mitmproxy: 4.0.1</span><br><span class="line">Python:    3.6.5</span><br><span class="line">OpenSSL:   OpenSSL 1.1.0h  27 Mar 2018</span><br><span class="line">Platform:  Windows-10-10.0.16299-SP0</span><br></pre></td></tr></table></figure><h3 id="è¿è¡Œ"><a class="markdownIt-Anchor" href="#è¿è¡Œ"></a> è¿è¡Œ</h3><p>è¦å¯åŠ¨ mitmproxy ç”¨ <code>mitmproxy</code>ã€<code>mitmdump</code>ã€<code>mitmweb</code> è¿™ä¸‰ä¸ªå‘½ä»¤ä¸­çš„ä»»æ„ä¸€ä¸ªå³å¯ï¼Œè¿™ä¸‰ä¸ªå‘½ä»¤åŠŸèƒ½ä¸€è‡´ï¼Œä¸”éƒ½å¯ä»¥åŠ è½½è‡ªå®šä¹‰è„šæœ¬ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯äº¤äº’ç•Œé¢çš„ä¸åŒã€‚</p><ul><li><code>mitmproxy</code> å‘½ä»¤å¯åŠ¨åï¼Œä¼šæä¾›ä¸€ä¸ªå‘½ä»¤è¡Œç•Œé¢ï¼Œç”¨æˆ·å¯ä»¥å®æ—¶çœ‹åˆ°å‘ç”Ÿçš„è¯·æ±‚ï¼Œå¹¶é€šè¿‡å‘½ä»¤è¿‡æ»¤è¯·æ±‚ï¼ŒæŸ¥çœ‹è¯·æ±‚æ•°æ®ã€‚</li><li><code>mitmweb</code> å‘½ä»¤å¯åŠ¨åï¼Œä¼šæä¾›ä¸€ä¸ª web ç•Œé¢ï¼Œç”¨æˆ·å¯ä»¥å®æ—¶çœ‹åˆ°å‘ç”Ÿçš„è¯·æ±‚ï¼Œå¹¶é€šè¿‡ GUI äº¤äº’æ¥è¿‡æ»¤è¯·æ±‚ï¼ŒæŸ¥çœ‹è¯·æ±‚æ•°æ®ã€‚</li><li><code>mitmdump</code> å‘½ä»¤å¯åŠ¨åâ€”â€”æ²¡æœ‰ç•Œé¢ï¼Œç¨‹åºé»˜é»˜è¿è¡Œï¼Œæ‰€ä»¥ mitmdump æ— æ³•æä¾›è¿‡æ»¤è¯·æ±‚ã€æŸ¥çœ‹æ•°æ®çš„åŠŸèƒ½ï¼Œåªèƒ½ç»“åˆè‡ªå®šä¹‰è„šæœ¬ï¼Œé»˜é»˜å·¥ä½œã€‚</li></ul><p>ç”±äº <code>mitmproxy</code> å‘½ä»¤çš„äº¤äº’æ“ä½œç¨æ˜¾ç¹æ‚ä¸”ä¸æ”¯æŒ windows ç³»ç»Ÿï¼Œè€Œæˆ‘ä»¬ä¸»è¦çš„ä½¿ç”¨æ–¹å¼åˆæ˜¯è½½å…¥è‡ªå®šä¹‰è„šæœ¬ï¼Œå¹¶ä¸éœ€è¦äº¤äº’ï¼Œæ‰€ä»¥åŸåˆ™ä¸Šè¯´åªéœ€è¦ <code>mitmdump</code> å³å¯ï¼Œä½†è€ƒè™‘åˆ°æœ‰äº¤äº’ç•Œé¢å¯ä»¥æ›´æ–¹ä¾¿æ’æŸ¥é”™è¯¯ï¼Œæ‰€ä»¥è¿™é‡Œä»¥ <code>mitmweb</code> å‘½ä»¤ä¸ºä¾‹ã€‚å®é™…ä½¿ç”¨ä¸­å¯ä»¥æ ¹æ®æƒ…å†µé€‰æ‹©ä»»ä½•ä¸€ä¸ªå‘½ä»¤ã€‚</p><h4 id="mitmweb"><a class="markdownIt-Anchor" href="#mitmweb"></a> mitmweb</h4><p>mitmproxy ç»‘å®šäº† <code>*:8080</code> ä½œä¸ºä»£ç†ç«¯å£ï¼Œå¹¶æä¾›äº†ä¸€ä¸ª web äº¤äº’ç•Œé¢åœ¨ <code>127.0.0.1:8081</code>ã€‚</p><p>ç°åœ¨å¯ä»¥æµ‹è¯•ä¸€ä¸‹ä»£ç†ï¼Œè®© Chrome ä»¥ mitmproxy ä¸ºä»£ç†å¹¶å¿½ç•¥è¯ä¹¦é”™è¯¯ã€‚ä¸ºäº†ä¸å½±å“å¹³æ—¶æ­£å¸¸ä½¿ç”¨ï¼Œæˆ‘ä»¬ä¸å»æ”¹ Chrome çš„é…ç½®ï¼Œè€Œæ˜¯é€šè¿‡å‘½ä»¤è¡Œå¸¦å‚æ•°èµ·ä¸€ä¸ª Chromeã€‚å¦‚æœä½ ä¸ä½¿ç”¨ Chrome è€Œæ˜¯å…¶ä»–æµè§ˆå™¨ï¼Œä¹Ÿå¯ä»¥æœä¸€ä¸‹å¯¹åº”çš„å¯åŠ¨å‚æ•°æ˜¯ä»€ä¹ˆï¼Œåº”è¯¥ä¸ä¼šæœ‰ä»€ä¹ˆå‘ã€‚æ­¤å¤–ç¤ºä¾‹ä»…ä»¥ windows ç³»ç»Ÿä¸ºä¾‹ï¼Œå› ä¸ºä½¿ç”¨ linux æˆ– mac å¼€å‘çš„åŒå­¦åº”è¯¥æ›´ç†Ÿæ‚‰å‘½ä»¤è¡Œçš„ä½¿ç”¨æ‰å¯¹ï¼Œåº”å½“èƒ½è‡ªè¡Œæ¨å¯¼å‡ºåœ¨å„è‡ªç¯å¢ƒä¸­å¯¹åº”çš„æ“ä½œã€‚</p><p>æ¥ä¸‹æ¥å…³é—­æ‰€æœ‰ Chrome çª—å£ï¼Œå¦åˆ™å‘½ä»¤è¡Œå¯åŠ¨æ—¶çš„é™„åŠ å‚æ•°å°†å¤±æ•ˆã€‚æ‰“å¼€ cmdï¼Œæ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‰é¢é‚£ä¸€é•¿ä¸²æ˜¯ Chrome çš„çš„å®‰è£…è·¯å¾„ï¼Œåº”å½“æ ¹æ®ç³»ç»Ÿå®é™…æƒ…å†µä¿®æ”¹ï¼Œåé¢ä¸¤å‚æ•°è®¾ç½®äº†ä»£ç†åœ°å€å¹¶å¼ºåˆ¶å¿½ç•¥æ‰è¯ä¹¦é”™è¯¯ã€‚</span></span><br><span class="line">$ <span class="string">"C:\Program Files (x86)\Google\Chrome\Application\chrome.exe"</span> --proxy-server=127.0.0.1:8080 --ignore-certificate-errors</span><br></pre></td></tr></table></figure><p>â–²æ¨èå…ˆä½¿ç”¨<code>mitmdump</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mitmdump </span><br><span class="line">Proxy server listening at http://*:8080</span><br><span class="line"><span class="comment"># ç„¶åwindowsè®¾ç½® -&gt; ä»£ç† -&gt; 127.0.0.1 8080 -&gt; ä¿å­˜</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœæ²¡å®‰è£…httpsè¯ä¹¦çš„è¯ï¼Œæ˜¯æŠ“å–ä¸äº†httpsæ•°æ®çš„ï¼Œå› æ­¤éœ€è¦å®‰è£…è¯ä¹¦ã€‚</p><h3 id="è¯ä¹¦å®‰è£…"><a class="markdownIt-Anchor" href="#è¯ä¹¦å®‰è£…"></a> è¯ä¹¦å®‰è£…</h3><h4 id="pc"><a class="markdownIt-Anchor" href="#pc"></a> PC</h4><p>å®˜ç½‘ä»‹ç»<a href="https://docs.mitmproxy.org/stable/concepts-certificates/" target="_blank" rel="noopener">About Certificates</a></p><p>ä½¿ç”¨<code>mitmdump</code>ä¹‹åä¸‹é¢çš„æ–‡ä»¶å°±ä¼šè¢«åˆ›å»ºï¼Œä½äº<code>C:\Users\mrli\.mitmproxy</code></p><table><thead><tr><th style="text-align:left">Filename</th><th style="text-align:left">Contents</th></tr></thead><tbody><tr><td style="text-align:left">mitmproxy-ca.pem</td><td style="text-align:left">The certificate <strong>and the private key</strong> in PEM format.</td></tr><tr><td style="text-align:left">mitmproxy-ca-cert.pem</td><td style="text-align:left">The certificate in PEM format. Use this to distribute on most non-Windows platforms.</td></tr><tr><td style="text-align:left">mitmproxy-ca-cert.p12</td><td style="text-align:left">The certificate in PKCS12 format. <strong>For use on Windows.</strong></td></tr><tr><td style="text-align:left">mitmproxy-ca-cert.cer</td><td style="text-align:left">Same file as .pem, but with an extension expected by some Android devices.</td></tr></tbody></table><p>åŒå‡»<code>mitmproxy-ca-cert.p12</code>å®‰è£…ï¼Œâ€œæœ¬åœ°è®¡ç®—æœºâ€-&gt;<code>ä¸‹ä¸€é¡µ</code>-&gt;<code>ä¸‹ä¸€é¡µ</code>-&gt;<code>å°†æ‰€æœ‰çš„è¯ä¹¦éƒ½æ”¾å…¥ä¸‹åˆ—å­˜å‚¨</code>(å—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å¸ƒæœºæ„)ç„¶åä¸‹ä¸€é¡µï¼Œå³å¯å®Œæ•´è¯ä¹¦å®‰è£…</p><h4 id="æ‰‹æœº"><a class="markdownIt-Anchor" href="#æ‰‹æœº"></a> æ‰‹æœº</h4><p>WIFIä¸­è®¾ç½®ä»£ç†ï¼Œipéœ€è¦åœ¨ç”µè„‘ä¸Šé€šè¿‡<code>ipconfig</code>æŸ¥çœ‹ï¼Œè€Œportå‚æ•°è·Ÿä¸Šé¢ä¸€æ ·ï¼Œé€šè¿‡<code>mitmdump</code>å¯ä»¥çœ‹åˆ°ä¾¦å¬çš„ç«¯å£å…·ä½“ä¸ºå¤šå°‘ï¼Œé»˜è®¤ä¸º8080ã€‚</p><p>è¯ä¹¦å®‰è£…ï¼šè¿›å…¥ç½‘å€<code>mitm.it</code>ï¼Œæ ¹æ®OSé€‰æ‹©å®‰è£…è¯ä¹¦</p><p>è¯¦æƒ…è§: <a href="https://www.bilibili.com/video/BV1UC4y1t7EL?p=1" target="_blank" rel="noopener">mitmproxyæŠ“åŒ…å·¥å…·ï¼ï¼ï¼ ä»å®‰è£…åˆ°ç®€å•ä½¿ç”¨</a></p><h3 id="è„šæœ¬"><a class="markdownIt-Anchor" href="#è„šæœ¬"></a> â˜…è„šæœ¬</h3><p>æ¥ä¸‹æ¥å¼€å§‹å¼€å‘è‡ªå®šä¹‰è„šæœ¬ï¼Œè¿™æ‰æ˜¯ mitmproxy çœŸæ­£å¼ºå¤§çš„åœ°æ–¹ï¼ˆå¯ä»¥åœ¨pythonä»£ç ä¸­ç›´æ¥å¤„ç†æ•°æ®åŒ…ï¼‰ã€‚</p><p>æ€»å…±æœ‰ä¸¤ç§å†™æ³•ï¼š</p><ol><li>å®šä¹‰ä¸€äº›æ¥å—æŒ‡å®šå‚æ•°çš„å‡½æ•°</li></ol><blockquote><p>ç¼–å†™ä¸€ä¸ª py æ–‡ä»¶ä¾› mitmproxy åŠ è½½ï¼Œæ–‡ä»¶ä¸­å®šä¹‰äº†è‹¥å¹²å‡½æ•°ï¼Œè¿™äº›å‡½æ•°å®ç°äº†æŸäº› mitmproxy æä¾›çš„äº‹ä»¶ï¼Œmitmproxy ä¼šåœ¨æŸä¸ªäº‹ä»¶å‘ç”Ÿæ—¶è°ƒç”¨å¯¹åº”çš„å‡½æ•°ï¼Œå½¢å¦‚ï¼š</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mitmproxy.http</span><br><span class="line"><span class="keyword">from</span> mitmproxy <span class="keyword">import</span> ctx</span><br><span class="line"></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">request</span><span class="params">(flow: mitmproxy.http.HTTPFlow)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    num = num + <span class="number">1</span></span><br><span class="line">    ctx.log.info(<span class="string">"We've seen %d flows"</span> % num)</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒä¸ªæ˜¯ï¼Œç¼–å†™ä¸€ä¸ª py æ–‡ä»¶ä¾› mitmproxy åŠ è½½ï¼Œæ–‡ä»¶å®šä¹‰äº†å˜é‡ addonsï¼Œaddons æ˜¯ä¸ªæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªç±»å®ä¾‹ï¼Œè¿™äº›ç±»æœ‰è‹¥å¹²æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å®ç°äº†æŸäº› mitmproxy æä¾›çš„äº‹ä»¶ï¼Œmitmproxy ä¼šåœ¨æŸä¸ªäº‹ä»¶å‘ç”Ÿæ—¶è°ƒç”¨å¯¹åº”çš„æ–¹æ³•ã€‚è¿™äº›ç±»ï¼Œç§°ä¸ºä¸€ä¸ªä¸ª <code>addon</code>ï¼Œæ¯”å¦‚ä¸€ä¸ªå« Counter çš„ addon(æ’ä»¶)ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mitmproxy.http</span><br><span class="line"><span class="keyword">from</span> mitmproxy <span class="keyword">import</span> ctx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.num = <span class="number">0</span></span><br><span class="line"><span class="comment"># é‡å†™æŒ‡å®šæ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">request</span><span class="params">(self, flow: mitmproxy.http.HTTPFlow)</span>:</span></span><br><span class="line">        self.num = self.num + <span class="number">1</span></span><br><span class="line">        ctx.log.info(<span class="string">"We've seen %d flows"</span> % self.num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">addons = [</span><br><span class="line">    Counter()</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>â­ï¸è¿™é‡Œå¼ºçƒˆå»ºè®®ä½¿ç”¨ç¬¬äºŒç§å¥—è·¯ï¼Œç›´è§‰ä¸Šå°±ä¼šæ„Ÿè§‰ç¬¬äºŒç§å¥—è·¯æ›´ä¸ºå…ˆè¿›ï¼Œä½¿ç”¨ä¼šæ›´æ–¹ä¾¿ä¹Ÿæ›´å®¹æ˜“ç®¡ç†å’Œæ‹“å±•ã€‚å†µä¸”è¿™ä¹Ÿæ˜¯<a href="https://github.com/mitmproxy/mitmproxy/tree/master/mitmproxy/addons" target="_blank" rel="noopener">å®˜æ–¹å†…ç½®çš„ä¸€äº› addon</a> çš„å®ç°æ–¹å¼ã€‚</p><p>æˆ‘ä»¬å°†ä¸Šé¢ç¬¬äºŒç§å¥—è·¯çš„ç¤ºä¾‹ä»£ç å­˜ä¸º <a href="http://addons.py" target="_blank" rel="noopener">addons.py</a>ï¼Œå†é‡æ–°å¯åŠ¨ mitmproxyï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mitmweb -s addons.py</span><br></pre></td></tr></table></figure><p>å½“æµè§ˆå™¨ä½¿ç”¨ä»£ç†è¿›è¡Œè®¿é—®æ—¶ï¼Œå°±åº”è¯¥èƒ½çœ‹åˆ°æ§åˆ¶å°é‡Œæœ‰ç±»ä¼¼è¿™æ ·çš„æ—¥å¿—ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Web server listening at http://127.0.0.1:8081/</span><br><span class="line">Loading script addons.py</span><br><span class="line">Proxy server listening at http://*:8080</span><br><span class="line">We&apos;ve seen 1 flows</span><br><span class="line">â€¦â€¦</span><br></pre></td></tr></table></figure><p>è¿™å°±è¯´æ˜è‡ªå®šä¹‰è„šæœ¬ç”Ÿæ•ˆäº†ã€‚</p><p>æ€»ç»“ï¼šè‡ªå®šä¹‰è„šæœ¬å¯ä»¥å®ç°æ‹¦æˆªè¯·æ±‚ï¼Œä»è€Œå¯¹è¯·æ±‚å¤´ã€è¯·æ±‚ã€å“åº”å¤´ã€å“åº”å¤´è¿›è¡Œä¿®æ”¹çš„æ•ˆæœâ€”â€”å½“äººæ“ä½œæ—¶ï¼Œå°±èƒ½åœ¨æ‹¦æˆªè¯·æ±‚è¿›è¡Œå¤„ç†çš„æ—¶å€™è¿›è¡Œæ•°æ®å¤„ç†ã€‚æ‰€ä»¥å¯ä»¥mitmproxy+appniumæˆ–è€…seleniumå®ç°æ¨¡æ‹Ÿç‚¹å‡»+æŠ“æ•°æ®åŒ…çš„æ–¹å¼ã€‚</p><h3 id="äº‹ä»¶"><a class="markdownIt-Anchor" href="#äº‹ä»¶"></a> äº‹ä»¶</h3><p>ä¸Šè¿°å½“ request æ—¶é—´å‘ç”Ÿæ—¶ï¼Œè®¡æ•°å™¨åŠ ä¸€ï¼Œå¹¶æ‰“å°æ—¥å¿—ã€‚è¿™é‡Œå¯¹åº”çš„æ˜¯ request äº‹ä»¶ï¼Œé‚£ä¹ˆmitmproxyä¸­ä¸€å…±æœ‰å“ªäº›äº‹ä»¶å‘¢ï¼Ÿ</p><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/grandlulu/p/9525417.html" target="_blank" rel="noopener">ä½¿ç”¨ mitmproxy + python åšæ‹¦æˆªä»£ç†</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;httpcanary&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#httpcanary&quot;&gt;&lt;/a&gt; HttpCanary&lt;/h2&gt;
&lt;p&gt;HttpCanaryæ˜¯Androidç³»ç»Ÿä¸‹åŠŸèƒ½æœ€å¼ºå¤§çš„ç½‘ç»œåˆ†æå·¥å…·(IOSçš„æ˜¯Thro)ï¼Œæ”¯æŒT
      
    
    </summary>
    
    
      <category term="çˆ¬è™«" scheme="https://nymrli.top/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨Pythonè½¬ä¹‰å®ç°å‰ç«¯åŠ å¯†ç®—æ³•-è®°å½•ç¬”è®°</title>
    <link href="https://nymrli.top/2022/04/29/%E4%BD%BF%E7%94%A8Python%E8%BD%AC%E4%B9%89%E5%AE%9E%E7%8E%B0%E5%89%8D%E7%AB%AF%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95-%E8%AE%B0%E5%BD%95%E7%AC%94%E8%AE%B0/"/>
    <id>https://nymrli.top/2022/04/29/ä½¿ç”¨Pythonè½¬ä¹‰å®ç°å‰ç«¯åŠ å¯†ç®—æ³•-è®°å½•ç¬”è®°/</id>
    <published>2022-04-29T01:22:28.000Z</published>
    <updated>2022-04-29T04:36:04.026Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç¯å¢ƒå®‰è£…"><a class="markdownIt-Anchor" href="#ç¯å¢ƒå®‰è£…"></a> ç¯å¢ƒå®‰è£…</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip uninstall crypto</span><br><span class="line">pip uninstall pycryptodome</span><br><span class="line">pip install pycryptodome</span><br></pre></td></tr></table></figure><p>å‰é¢ä¸¤ä¸ªå¸è½½å‘½ä»¤æ˜¯ä¸ºäº†é˜²æ­¢ä¸€äº›å®‰è£…ç¯å¢ƒé—®é¢˜ï¼Œå…·ä½“è¯·çœ‹<a href="https://blog.csdn.net/chouzhou9701/article/details/106432497/" target="_blank" rel="noopener">æ–‡ç« </a></p><h1 id="pycryptodome"><a class="markdownIt-Anchor" href="#pycryptodome"></a> pycryptodome</h1><h2 id="aesåŠ å¯†"><a class="markdownIt-Anchor" href="#aesåŠ å¯†"></a> AESåŠ å¯†</h2><p><strong>åŠ å¯†æ¨¡å¼</strong></p><p>AES åŠ å¯†æœ€å¸¸ç”¨çš„æ¨¡å¼å°±æ˜¯ ECBæ¨¡å¼ å’Œ CBC æ¨¡å¼ï¼Œå½“ç„¶è¿˜æœ‰å¾ˆå¤šå…¶å®ƒæ¨¡å¼ï¼Œä»–ä»¬éƒ½å±äºAESåŠ å¯†ã€‚ECBæ¨¡å¼å’ŒCBC æ¨¡å¼ä¿©è€…åŒºåˆ«å°±æ˜¯ ECB ä¸éœ€è¦ ivåç§»é‡ï¼Œè€ŒCBCéœ€è¦ã€‚</p><p><strong>AESåŠ å¯†ä½¿ç”¨å‚æ•°</strong></p><p>ä»¥ä¸‹å‚æ•°éƒ½æ˜¯åœ¨pythonä¸­ä½¿ç”¨çš„ã€‚</p><p>å‚æ•°ä½œç”¨åŠæ•°æ®ç±»å‹<br>ç§˜é’¥åŠ å¯†çš„æ—¶å€™ç”¨ç§˜é’¥ï¼Œè§£å¯†çš„æ—¶å€™éœ€è¦åŒæ ·çš„ç§˜é’¥æ‰èƒ½è§£å‡ºæ¥; æ•°æ®ç±»å‹ä¸ºbytes<br>æ˜æ–‡éœ€è¦åŠ å¯†çš„å‚æ•°; æ•°æ®ç±»å‹ä¸ºbytes<br>æ¨¡å¼aes åŠ å¯†å¸¸ç”¨çš„æœ‰ ECB å’Œ CBC æ¨¡å¼ï¼ˆæˆ‘åªç”¨äº†è¿™ä¸¤ä¸ªæ¨¡å¼ï¼Œè¿˜æœ‰å…¶ä»–æ¨¡å¼ï¼‰;æ•°æ®ç±»å‹ä¸ºaesç±»å†…éƒ¨çš„æšä¸¾é‡<br>iv åç§»é‡è¿™ä¸ªå‚æ•°åœ¨ ECB æ¨¡å¼ä¸‹ä¸éœ€è¦ï¼Œåœ¨ CBC æ¨¡å¼ä¸‹éœ€è¦ï¼›æ•°æ®ç±»å‹ä¸ºbytes</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ECBæ¨¡å¼åŠ å¯†è§£å¯†</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">password = <span class="string">b'1234567812345678'</span> <span class="comment">#ç§˜é’¥ï¼Œbå°±æ˜¯è¡¨ç¤ºä¸ºbytesç±»å‹</span></span><br><span class="line">text = <span class="string">b'abcdefghijklmnhi'</span> <span class="comment">#éœ€è¦åŠ å¯†çš„å†…å®¹ï¼Œbytesç±»å‹</span></span><br><span class="line">aes = AES.new(password,AES.MODE_ECB) <span class="comment">#åˆ›å»ºä¸€ä¸ªaeså¯¹è±¡</span></span><br><span class="line"><span class="comment"># AES.MODE_ECB è¡¨ç¤ºæ¨¡å¼æ˜¯ECBæ¨¡å¼</span></span><br><span class="line">en_text = aes.encrypt(text) <span class="comment">#åŠ å¯†æ˜æ–‡</span></span><br><span class="line">print(<span class="string">"å¯†æ–‡ï¼š"</span>,en_text) <span class="comment">#åŠ å¯†æ˜æ–‡ï¼Œbytesç±»å‹</span></span><br><span class="line"></span><br><span class="line">den_text = aes.decrypt(en_text) <span class="comment"># è§£å¯†å¯†æ–‡</span></span><br><span class="line">print(<span class="string">"æ˜æ–‡ï¼š"</span>,den_text)</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæ˜¯é’ˆå¯¹ECBæ¨¡å¼çš„åŠ å¯†è§£å¯†ï¼Œä»è¿™ä¸ªä¾‹å­ä¸­å¯ä»¥çœ‹å‡ºå‚æ•°ä¸­æœ‰å‡ ä¸ªé™åˆ¶ã€‚</p><ol><li>ç§˜é’¥å¿…é¡»ä¸º16å­—èŠ‚æˆ–è€…16å­—èŠ‚çš„å€æ•°çš„å­—èŠ‚å‹æ•°æ®ã€‚</li><li>æ˜æ–‡å¿…é¡»ä¸º16å­—èŠ‚æˆ–è€…16å­—èŠ‚çš„å€æ•°çš„å­—èŠ‚å‹æ•°æ®ï¼Œå¦‚æœä¸å¤Ÿ16å­—èŠ‚éœ€è¦è¿›è¡Œè¡¥å…¨ï¼Œå…³äºè¡¥å…¨è§„åˆ™ï¼Œåé¢ä¼šåœ¨è¡¥å…¨æ¨¡å¼ä¸­å…·ä½“ä»‹ç»ã€‚</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CBC</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">password = <span class="string">b'1234567812345678'</span> <span class="comment">#ç§˜é’¥ï¼Œbå°±æ˜¯è¡¨ç¤ºä¸ºbytesç±»å‹</span></span><br><span class="line">iv = <span class="string">b'1234567812345678'</span> <span class="comment"># ivåç§»é‡ï¼Œbytesç±»å‹</span></span><br><span class="line">text = <span class="string">b'abcdefghijklmnhi'</span> <span class="comment">#éœ€è¦åŠ å¯†çš„å†…å®¹ï¼Œbytesç±»å‹</span></span><br><span class="line">aes = AES.new(password,AES.MODE_CBC,iv) <span class="comment">#åˆ›å»ºä¸€ä¸ªaeså¯¹è±¡</span></span><br><span class="line"><span class="comment"># AES.MODE_CBC è¡¨ç¤ºæ¨¡å¼æ˜¯CBCæ¨¡å¼</span></span><br><span class="line">en_text = aes.encrypt(text) </span><br><span class="line">print(<span class="string">"å¯†æ–‡ï¼š"</span>,en_text) <span class="comment">#åŠ å¯†æ˜æ–‡ï¼Œbytesç±»å‹</span></span><br><span class="line"></span><br><span class="line">aes = AES.new(password,AES.MODE_CBC,iv) <span class="comment">#CBCæ¨¡å¼ä¸‹è§£å¯†éœ€è¦é‡æ–°åˆ›å»ºä¸€ä¸ªaeså¯¹è±¡</span></span><br><span class="line">den_text = aes.decrypt(en_text)</span><br><span class="line">print(<span class="string">"æ˜æ–‡ï¼š"</span>,den_text)</span><br></pre></td></tr></table></figure><h1 id="hashlib"><a class="markdownIt-Anchor" href="#hashlib"></a> hashlib</h1><h2 id="md5"><a class="markdownIt-Anchor" href="#md5"></a> MD5</h2><blockquote><p>hashlibæ¨¡å—ä¸‹çš„&quot;åŠ å¯†&quot;</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">string=<span class="string">'ä»»æ€§çš„90åboy'</span></span><br><span class="line">md5 = hashlib.md5()</span><br><span class="line">md5.update(string.encode(<span class="string">'utf-8'</span>))<span class="comment">#è½¬ç ï¼Œupdateé‡Œçš„å¿…é¡»æ˜¯å­—èŠ‚å‹</span></span><br><span class="line"><span class="comment"># é»˜è®¤æ˜¯32ä½å°å†™</span></span><br><span class="line">res = md5.hexdigest() <span class="comment">#è¿”å›å­—ç¬¦å‹æ‘˜è¦ä¿¡æ¯print(md5.digest())#è¿”å›å­—èŠ‚å‹çš„æ‘˜è¦ä¿¡æ¯</span></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°16ä½å¤§å†™</span></span><br><span class="line"><span class="comment"># res=md5.hexdigest()[8:-8]</span></span><br><span class="line">print(<span class="string">"md5åŠ å¯†ç»“æœ:"</span>,res)</span><br></pre></td></tr></table></figure><h2 id="sha256"><a class="markdownIt-Anchor" href="#sha256"></a> Sha256</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">string=<span class="string">'ä»»æ€§çš„90åboy'</span></span><br><span class="line">sha256 = hashlib.sha256()</span><br><span class="line">sha256.update(string.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">res = sha256.hexdigest()</span><br><span class="line">print(<span class="string">"sha256åŠ å¯†ç»“æœ:"</span>,res)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ç¯å¢ƒå®‰è£…&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#ç¯å¢ƒå®‰è£…&quot;&gt;&lt;/a&gt; ç¯å¢ƒå®‰è£…&lt;/h2&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;s
      
    
    </summary>
    
    
      <category term="çˆ¬è™«" scheme="https://nymrli.top/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="Python" scheme="https://nymrli.top/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>V-P-N(Vmess)ä¸Charlesæ— æ³•å…±ç”¨é—®é¢˜è§£å†³</title>
    <link href="https://nymrli.top/2022/04/27/V-P-N%E4%B8%8ECharles%E6%97%A0%E6%B3%95%E5%85%B1%E7%94%A8%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/"/>
    <id>https://nymrli.top/2022/04/27/V-P-Nä¸Charlesæ— æ³•å…±ç”¨é—®é¢˜è§£å†³/</id>
    <published>2022-04-27T13:30:51.000Z</published>
    <updated>2022-05-07T02:06:15.361Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘éœ€è¦æŠ“ä¸€ä¸ªéœ€è¦ç¿»å¢™æ‰èƒ½è®¿é—®çš„ç½‘é¡µçš„åŒ…ï¼Œå‘ç°VPNç›´è¿æ—¶ä¼šå¯¼è‡´ Fiddler å’Œ Charles æŠ“åŒ…å·¥å…·æ— æ³•æ­£å¸¸è¿›è¡ŒæŠ“åŒ…ï¼Œç½‘ä¸Šæ‰¾äº†ä»¥åå‘ç°äº†ä¸€äº›è§£å†³æ–¹æ¡ˆï¼š<a href="https://github.com/mopduan/team/issues/13" target="_blank" rel="noopener">Github:VPNç›´è¿ï¼Œå¯¼è‡´ Fiddler å’Œ Charles æŠ“åŒ…å·¥å…·æ— æ³•æ­£å¸¸è¿›è¡ŒæŠ“åŒ…è§£å†³æ–¹æ¡ˆ </a>â€”â€”è¯•äº†è²Œä¼¼æ²¡ç”¨ã€<a href="https://www.jianshu.com/p/651ee335f97f?from=singlemessage" target="_blank" rel="noopener">windowsä¸‹ï¼Œå®ç°vpnè®¿é—®ä¸‹çš„charlesæŠ“åŒ…è®¾ç½®ä¸­æ— ç½‘ç»œé—®é¢˜çš„è§£å†³</a>â€”â€”æ”¶æ­¤å¯å‘æŒ‡å¯¼äº†åœ¨charlesçš„<code>Proxy-&gt;external proxy</code>å…è®¸å…¶ä»–ç«¯å£ä»£ç†</p><h2 id="1æ‰¾åˆ°vpnè½¯ä»¶çš„ä»£ç†ç«¯å£proxy-port"><a class="markdownIt-Anchor" href="#1æ‰¾åˆ°vpnè½¯ä»¶çš„ä»£ç†ç«¯å£proxy-port"></a> 1.æ‰¾åˆ°VPNè½¯ä»¶çš„ä»£ç†ç«¯å£proxy port</h2><p>æˆ‘è¿™è¾¹ä½¿ç”¨çš„æ˜¯vmessï¼Œå¯ä»¥åœ¨<code>é€‰é¡¹-&gt;å‚æ•°è®¾ç½®</code>ä¸­æŸ¥çœ‹ï¼Œéœ€è¦æ˜ç¡®çš„å‚æ•°æ˜¯ç«¯å£å’Œåè®®ï¼Œæˆ‘è¿™è¾¹æ˜¯10808å’Œsocksåè®®</p><p><img src="/2022/04/27/V-P-Nä¸Charlesæ— æ³•å…±ç”¨é—®é¢˜è§£å†³/.%5CV-P-N%E4%B8%8ECharles%E6%97%A0%E6%B3%95%E5%85%B1%E7%94%A8%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%5Cvmess%E5%8F%82%E6%95%B0.jpg" alt="vmesså‚æ•°"></p><h2 id="2è®¾ç½®charles"><a class="markdownIt-Anchor" href="#2è®¾ç½®charles"></a> 2.è®¾ç½®charlesï¼š</h2><p><code>Proxy-&gt;external proxy</code>, é¦–å…ˆå…è®¸å…¶ä»–proxyï¼Œç„¶åæ ¹æ®åˆšåˆšæŸ¥çœ‹åˆ°çš„vmessç«¯å£å’Œåè®®è¿›è¡Œå¡«å†™</p><p><img src="/2022/04/27/V-P-Nä¸Charlesæ— æ³•å…±ç”¨é—®é¢˜è§£å†³/.%5CV-P-N%E4%B8%8ECharles%E6%97%A0%E6%B3%95%E5%85%B1%E7%94%A8%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%5Ccharles.jpg" alt="charles"></p><h2 id="3è®¾ç½®å®Œæˆå¼€å§‹æŠ“åŒ…"><a class="markdownIt-Anchor" href="#3è®¾ç½®å®Œæˆå¼€å§‹æŠ“åŒ…"></a> 3.è®¾ç½®å®Œæˆï¼Œå¼€å§‹æŠ“åŒ…</h2><p>å®Œç»“æ’’èŠ±~</p><h1 id="é™„å½•"><a class="markdownIt-Anchor" href="#é™„å½•"></a> é™„å½•ï¼š</h1><h2 id="requestsä½¿ç”¨ä»£ç†"><a class="markdownIt-Anchor" href="#requestsä½¿ç”¨ä»£ç†"></a> requestsä½¿ç”¨ä»£ç†</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="string">'PB3_SESSION'</span>: <span class="string">'"2|1:0|10:1650810241|11:PB3_SESSION|40:djJleDo1Mi4xNDAuMjAxLjIxMTo1OTQ4NjM0Mg==|f661892137fd704b91fa09d8c58fd641a15ab9e83f94c69981dbeed7980fc9e4"'</span>,</span><br><span class="line">    <span class="string">'V2EX_LANG'</span>: <span class="string">'zhcn'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'authority'</span>: <span class="string">'cn.v2ex.com'</span>,</span><br><span class="line">    <span class="string">'accept'</span>: <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9'</span>,</span><br><span class="line">    <span class="string">'accept-language'</span>: <span class="string">'zh-CN,zh;q=0.9,en;q=0.8'</span>,</span><br><span class="line">    <span class="string">'cache-control'</span>: <span class="string">'no-cache'</span>,</span><br><span class="line">    <span class="string">'pragma'</span>: <span class="string">'no-cache'</span>,</span><br><span class="line">    <span class="string">'sec-ch-ua'</span>: <span class="string">'" Not A;Brand";v="99", "Chromium";v="100", "Google Chrome";v="100"'</span>,</span><br><span class="line">    <span class="string">'sec-ch-ua-mobile'</span>: <span class="string">'?0'</span>,</span><br><span class="line">    <span class="string">'sec-ch-ua-platform'</span>: <span class="string">'"Windows"'</span>,</span><br><span class="line">    <span class="string">'sec-fetch-dest'</span>: <span class="string">'document'</span>,</span><br><span class="line">    <span class="string">'sec-fetch-mode'</span>: <span class="string">'navigate'</span>,</span><br><span class="line">    <span class="string">'sec-fetch-site'</span>: <span class="string">'none'</span>,</span><br><span class="line">    <span class="string">'sec-fetch-user'</span>: <span class="string">'?1'</span>,</span><br><span class="line">    <span class="string">'upgrade-insecure-requests'</span>: <span class="string">'1'</span>,</span><br><span class="line">    <span class="string">'user-agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.60 Safari/537.36'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http_proxy = <span class="string">"socks5h://127.0.0.1:10808"</span></span><br><span class="line">https_proxy = <span class="string">"socks5h://127.0.0.1:10808"</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">"https"</span>: https_proxy,</span><br><span class="line">    <span class="string">"http"</span>: http_proxy</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">'https://cn.v2ex.com/about'</span>, cookies=cookies, headers=headers, proxies=proxies)</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šä¸€å¼€å§‹åœ¨Sublimeé‡Œè¿è¡Œçš„ï¼Œç»“æœä¸€ç›´åœ¨<code>response.text</code>æ—¶æŠ¥ç¼–ç é”™è¯¯ï¼Œä½†æ˜¯é€šè¿‡ç½‘é¡µçš„content-typeå’Œmeta charsetè¿›è¡Œç¡®è®¤è¿‡æ²¡é—®é¢˜ï¼Œåæ¥ç»è¿‡ä¸€ä¸ªå¯å‘æƒ³åˆ°ä¼šä¸ä¼šæ˜¯æ§åˆ¶å°æœ‰ç¼–ç æ˜¾ç¤ºä¸äº†ï¼Œäºæ˜¯åœ¨Pycharmä¸­è¿è¡Œï¼ŒæˆåŠŸ!</p><h2 id="aiohttpä½¿ç”¨socksä»£ç†"><a class="markdownIt-Anchor" href="#aiohttpä½¿ç”¨socksä»£ç†"></a> aiohttpä½¿ç”¨socksä»£ç†</h2><blockquote><p>from: <a href="https://pypi.org/project/aiohttp-socks/%E3%80%81https://www.cnblogs.com/john-xiong/p/13812567.html" target="_blank" rel="noopener">https://pypi.org/project/aiohttp-socks/ã€https://www.cnblogs.com/john-xiong/p/13812567.html</a></p></blockquote><ol><li><p><code>pip install aiohttp_socks</code></p></li><li><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">connector = ProxyConnector.from_url(<span class="string">'socks5://127.0.0.1:10808'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">getDataByChromeDriver</span><span class="params">(url)</span>:</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession(connector=connector) <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> session.get(url) <span class="keyword">as</span> response:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">await</span> response.text()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">        loop.run_until_complete(asyncio.wait([getDataByChromeDriver(index) <span class="keyword">for</span> title, index <span class="keyword">in</span> title_list.items()]))</span><br></pre></td></tr></table></figure></li><li><p>è¿è¡Œå³å¯</p></li></ol><h2 id="request-htmlä½¿ç”¨ä»£ç†"><a class="markdownIt-Anchor" href="#request-htmlä½¿ç”¨ä»£ç†"></a> request-htmlä½¿ç”¨ä»£ç†</h2><blockquote><p><a href="https://baijiahao.baidu.com/s?id=1701142223076604985&amp;wfr=spider&amp;for=pc" target="_blank" rel="noopener">Pythonçˆ¬è™«ä¸€ä¸ªrequests_htmlæ¨¡å—è¶³çŸ£ï¼ï¼ˆæ”¯æŒJSåŠ è½½&amp;å¼‚æ­¥è¯·æ±‚ï¼‰</a></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests_html <span class="keyword">import</span> AsyncHTMLSession</span><br><span class="line"></span><br><span class="line">http_proxy = <span class="string">"socks5h://127.0.0.1:10808"</span></span><br><span class="line">https_proxy = <span class="string">"socks5h://127.0.0.1:10808"</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">"https"</span>: https_proxy,</span><br><span class="line">    <span class="string">"http"</span>: http_proxy</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">session = AsyncHTMLSession()</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">getDataByChromeDriver</span><span class="params">(index: Union[int, str])</span>:</span></span><br><span class="line">response = <span class="keyword">await</span> session.get(<span class="string">'https://www.qkl123.com/sector/&#123;&#125;'</span>.format(index), headers=headers, proxies=proxies)</span><br><span class="line">    <span class="comment"># ...</span></span><br></pre></td></tr></table></figure><h2 id="request-htmlå¼‚æ­¥"><a class="markdownIt-Anchor" href="#request-htmlå¼‚æ­¥"></a> request-htmlå¼‚æ­¥</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests_html <span class="keyword">import</span> AsyncHTMLSession</span><br><span class="line">asession = AsyncHTMLSession()</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">get_pyclock</span><span class="params">(index)</span>:</span></span><br><span class="line">    r = <span class="keyword">await</span> asession.get(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">    <span class="keyword">await</span> r.html.arender()</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line">results = asession.run(get_pyclock, get_pyclock,</span><br><span class="line">                       get_pyclock)  <span class="comment"># è¿™é‡Œä½œè€…å°†åŒä¸€ä¸ªé¡µé¢ä½¿ç”¨å¼‚æ­¥æ–¹å¼è¿›è¡Œäº†3æ¬¡æ¸²æŸ“ï¼Œä½†æ˜¯å®é™…ä¸Šä½¿ç”¨çš„æ—¶é—´å¹¶ä¸æ˜¯å¹³æ—¶çš„3å€ï¼å¯èƒ½åªæ˜¯æ¯”å¹³æ—¶æ¸²æŸ“ä¸€ä¸ªé¡µé¢å¤šèŠ±äº†ä¸€ç‚¹æ—¶é—´è€Œå·²ï¼è¿™å°±æ˜¯å¼‚æ­¥çš„å¥½å¤„ï¼</span></span><br><span class="line">print(results)</span><br></pre></td></tr></table></figure><p>and:<a href="https://cloud.tencent.com/developer/article/1575104" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1575104</a></p><h3 id="asessionrunæ— æ³•ä¼ å‚çš„é—®é¢˜"><a class="markdownIt-Anchor" href="#asessionrunæ— æ³•ä¼ å‚çš„é—®é¢˜"></a> asession.runæ— æ³•ä¼ å‚çš„é—®é¢˜</h3><p><a href="https://www.cnblogs.com/angelyan/p/13913926.html" target="_blank" rel="noopener">ä¿®æ”¹requests_html.AsyncHTMLSessionsä½¿å¾—æ”¯æŒurlå‚æ•°</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘éœ€è¦æŠ“ä¸€ä¸ªéœ€è¦ç¿»å¢™æ‰èƒ½è®¿é—®çš„ç½‘é¡µçš„åŒ…ï¼Œå‘ç°VPNç›´è¿æ—¶ä¼šå¯¼è‡´ Fiddler å’Œ Charles æŠ“åŒ…å·¥å…·æ— æ³•æ­£å¸¸è¿›è¡ŒæŠ“åŒ…ï¼Œç½‘ä¸Šæ‰¾äº†ä»¥åå‘ç°äº†ä¸€äº›è§£å†³æ–¹æ¡ˆï¼š&lt;a href=&quot;https://github.com/mopduan/team/issues/13&quot; targe
      
    
    </summary>
    
    
      <category term="çˆ¬è™«" scheme="https://nymrli.top/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>æ€»å¾—å­¦ç‚¹Elasticsearchå§</title>
    <link href="https://nymrli.top/2022/04/11/%E6%80%BB%E5%BE%97%E5%AD%A6%E7%82%B9Elasticsearch%E5%90%A7/"/>
    <id>https://nymrli.top/2022/04/11/æ€»å¾—å­¦ç‚¹Elasticsearchå§/</id>
    <published>2022-04-11T14:18:04.000Z</published>
    <updated>2022-04-12T14:29:28.958Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å€’æ’ç´¢å¼•"><a class="markdownIt-Anchor" href="#å€’æ’ç´¢å¼•"></a> å€’æ’ç´¢å¼•</h2><p>åå‘ç´¢å¼•ï¼ˆinverted indexï¼‰æ›´ç†Ÿæ‚‰çš„åå­—æ˜¯å€’æ’ç´¢å¼•ã€‚</p><p>ä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼•: å€’æ’ç´¢å¼•ä¹Ÿå«åå‘ç´¢å¼•ï¼Œé€šä¿—æ¥è®²æ­£å‘ç´¢å¼•æ˜¯é€šè¿‡keyæ‰¾valueï¼Œåå‘ç´¢å¼•åˆ™æ˜¯é€šè¿‡valueæ‰¾keyã€‚</p><p>ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ï¼šæˆ‘ä»¬ä¸€èˆ¬æ˜¯é€šè¿‡<strong>æ ‡é¢˜</strong>æ¥æ‰¾<strong>æ–‡ç« å†…å®¹</strong>ï¼Œå³é€šè¿‡ç›®å½•ï¼ˆæ­£å‘ç´¢å¼•ï¼‰ï¼›è€Œåå‘ç´¢å¼•çš„è¿ç”¨åœºæ™¯å°±æ˜¯é€šè¿‡<strong>å†…å®¹</strong>æ¥æ‰¾åˆ°æ˜¯<strong>å“ªä¸€ç¯‡æ–‡ç« </strong>ï¼ˆæ ‡é¢˜ï¼Œä½œè€…â€¦â€¦ï¼‰ï¼Œè€Œæ€ä¹ˆå»ºç«‹åå‘ç´¢å¼•å‘¢ï¼Ÿæ€ä¹ˆæ›´å¿«æ›´å¥½åœ°æ‰¾åˆ°ç»“æœå‘¢ï¼Ÿè¿™ä¸ªå°±æ˜¯<strong>æœç´¢å¼•æ“</strong>åšçš„äº‹äº†ã€</p><p>æ­£å‘ç´¢å¼•ï¼šä¾‹å¦‚ä¸€ä¸ªâ€œæ–‡æ¡£1â€ç»è¿‡åˆ†è¯ï¼Œæå–äº†20ä¸ªå…³é”®è¯ï¼Œæ¯ä¸ªå…³é”®è¯éƒ½ä¼šè®°å½•å®ƒåœ¨æ–‡æ¡£ä¸­çš„å‡ºç°æ¬¡æ•°å’Œå‡ºç°ä½ç½®ã€‚é‚£æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥é€šè¿‡å¯¹&quot;æ–‡æ¡£1&quot;Documentè¿™ä¸ªç»“æ„è¿›è¡Œè§£æï¼Œä»è€Œå¾—åˆ°æ¯ä¸ªå…³é”®è¯çš„ä¿¡æ¯ã€‚</p><p>åå‘ç´¢å¼•ï¼šé‚£ä¹ˆæˆ‘ä»¬å¸Œæœ›é€šè¿‡å…³é”®è¯æ¥æ‰¾åˆ°å®ƒåœ¨å“ªå‡ ç¯‡â€œæ–‡æ¡£â€ä¸­å‡ºç°æ€ä¹ˆåŠå‘¢ï¼Ÿé‚£ä¹ˆå…¶å®åœ¨éå†æ–‡ç« çš„æ—¶å€™ï¼Œå¦‚æœå½“å‰æ–‡ç« å‡ºç°äº†keywordï¼Œåˆ™å¯¹Keywordçš„ç»“æ„ï¼ˆç®€å•ç‚¹å¯ä»¥æƒ³æˆæ˜¯ä¸€ä¸ªhashmapï¼‰æ·»åŠ ä¸Šè¿™ç¯‡æ–‡ç« çš„ä¿¡æ¯</p><p>å†ä¸¾ä¸ªç”Ÿæ´»ä¾‹å­ï¼š å½“ç”¨æˆ·åœ¨ä¸»é¡µä¸Šæœç´¢å…³é”®è¯â€œ<u>åä¸ºæ‰‹æœº</u>â€æ—¶ï¼Œå‡è®¾åªå­˜åœ¨æ­£å‘ç´¢å¼•ï¼ˆforward indexï¼‰ï¼Œé‚£ä¹ˆå°±éœ€è¦<strong>å®æ—¶æ‰«æå®Œç´¢å¼•åº“ä¸­çš„æ‰€æœ‰æ–‡æ¡£</strong>ï¼Œæ‰¾å‡ºæ‰€æœ‰åŒ…å«å…³é”®è¯â€œåä¸ºæ‰‹æœºâ€çš„æ–‡æ¡£ï¼Œå†æ ¹æ®æ‰“åˆ†æ¨¡å‹è¿›è¡Œæ‰“åˆ†ï¼Œæ’å‡ºåæ¬¡åå‘ˆç°ç»™ç”¨æˆ·ã€‚å› ä¸ºäº’è”ç½‘ä¸Šæ”¶å½•åœ¨æœç´¢å¼•æ“ä¸­çš„æ–‡æ¡£çš„æ•°ç›®æ˜¯ä¸ªå¤©æ–‡æ•°å­—ï¼Œè¿™æ ·çš„ç´¢å¼•ç»“æ„æ ¹æœ¬æ— æ³•æ»¡è¶³<strong>å®æ—¶</strong>è¿”å›æ’åç»“æœçš„è¦æ±‚ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>æœç´¢å¼•æ“</strong>ä¼šå°†æ­£å‘ç´¢å¼•<strong>é‡æ–°æ„å»º</strong>ä¸ºå€’æ’ç´¢å¼•ï¼Œå³æŠŠ<strong>æ–‡ä»¶ID</strong>å¯¹åº”åˆ°<strong>å…³é”®è¯</strong>çš„æ˜ å°„è½¬æ¢ä¸º<strong>å…³é”®è¯åˆ°æ–‡ä»¶IDçš„æ˜ å°„</strong>ï¼Œæ¯ä¸ªå…³é”®è¯éƒ½å¯¹åº”ç€ä¸€ç³»åˆ—çš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶ä¸­éƒ½å‡ºç°è¿™ä¸ªå…³é”®è¯ã€‚ä»è€Œå¤§å¤§å‡å°‘äº†éå†çš„å¤§å°ï¼ŒåŠ å¿«äº†æ£€ç´¢çš„é€Ÿåº¦ã€‚</p><p><strong>æœ¬è´¨ä¸Šæ˜¯é€šè¿‡è®¾è®¡æ•°æ®ç»“æ„ï¼Œå¹¶èŠ±äº†é¢å¤–çš„ç©ºé—´å»æ¢æ£€ç´¢æ—¶çš„æ—¶é—´ã€‚</strong></p><p>è®ºæ–‡æŸ¥é‡å°±æ˜¯è¿™ç§çš„å…¸å‹åº”ç”¨ï¼š<a href="https://www.bilibili.com/video/BV1iK4y1M7XR?spm_id_from=444.41.0.0" target="_blank" rel="noopener">Bç«™è§†é¢‘â€”â€”è®ºæ–‡æŸ¥é‡æ˜¯å¦‚ä½•å®ç°çš„</a>â€”â€”å°†æ®µè½é€šè¿‡æ ‡ç‚¹ç¬¦å·åˆ†éš”æˆä¸€ä¸ªä¸ªå¥å­ï¼Œå†å°†å¥å­æ¯æ¯7ä¸ªåˆ†éš”æˆä¸€ä¸ªä¸ªsectionï¼Œæ¯”å¦‚é•¿åº¦ä¸º9çš„å¥å­åˆ™å¯ä»¥åˆ†æˆ3ä¸ªsectionï¼Œé¢„å¤„ç†åˆ›å»º<code>preDict={&quot;section1&quot;: [doc1, ], &quot;section2&quot;: [doc1, ], &quot;section&quot;3: [doc1, ]}</code>çš„å€’æ’ç´¢å¼•ï¼Œå½“è¿›è¡ŒæŸ¥é‡æ—¶ï¼Œä¹Ÿæ˜¯åˆ†éš”æˆå¥å­åæ¯æ¯7ä¸ªå­—è¿›è¡Œæ£€æŸ¥æ˜¯å¦åœ¨preDictä¸­ï¼Œå¦‚æœåœ¨åˆ™æ˜¯çŸ¥é“äº†åœ¨å“ªäº›æ–‡ç« ä¸­å‡ºç°ï¼ˆæœ€ç®€å•ç‰ˆï¼‰ã€‚è§†é¢‘ååˆæå‡ºäº†å¢åŠ LCSæœ€é•¿å…¬å…±å­ä¸²çš„å¢å¼ºï¼Œæœ‰æ•ˆåœ°æ£€éªŒå‡ºäº†æ·»åŠ â€œçš„â€å­—orè°ƒæ•´å­—ä½ç½®çš„å·é¸¡æ–¹æ³•â€”â€”å»ºç«‹4å­—å€’æ’ï¼Œå¦‚æœ4ä¸ªå­—å·²ç»å‡ºç°åœ¨äº†åˆ«çš„æ–‡ç« Aé‡Œï¼Œåˆ™æŠŠå½“å‰å¥å­S1ä¸æ–‡ç« Aä¸­çš„å¥å­S2è¿›è¡ŒLCSï¼Œå¦‚æœå…¬å…±å­ä¸²é•¿åº¦å¤§äº7åˆ™åˆ¤å®šä¸ºé‡å¤ã€‚</p><h2 id="æœç´¢å¼•æ“elasticsearch"><a class="markdownIt-Anchor" href="#æœç´¢å¼•æ“elasticsearch"></a> æœç´¢å¼•æ“â€”â€”Elasticsearch</h2><p>Elastic Stack å¦‚æœä½ æ²¡æœ‰å¬è¿‡ï¼Œé‚£ä¹ˆ ELK ä¸€å®šå¬è¿‡ã€‚ELK æ˜¯ä¸‰æ¬¾è½¯ä»¶çš„ç®€ç§°ï¼Œåˆ†åˆ«æ˜¯ <code>Elasticsearch</code>ã€<code>Logstash</code>ã€<code>Kibana</code> ç»„æˆã€‚é‚£ä»€ä¹ˆæ˜¯ Elasticsearchå‘¢ï¼Ÿâ€”â€”å…¨æ–‡æœç´¢æ˜¯å¾ˆå¤šç½‘ç«™å¸¸è§åŠŸèƒ½ï¼Œæ¯”å¦‚ GitHub ç«™å†…æœç´¢ã€JD å•†å“æœç´¢ã€B ç«™è§†é¢‘æœç´¢ã€‚<code>Elasticsearch</code> æ˜¯å½“ä»Šæœ€ç«çš„<strong>æœç´¢å¼•æ“</strong>ä¹‹ä¸€ï¼Œå®ƒçš„åº•å±‚åŸºäºå¦å¤–ä¸€ä¸ª <code>java</code> å¼€æºæœç´¢å¼•æ“ <code>Lucene</code>ï¼Œæ˜¯ä¸€æ¬¾å¼€æºåˆ†å¸ƒå¼æœç´¢å¼•æ“ï¼Œå¹¶ä¸”æä¾›äº†ä¸€ç³»åˆ— <code>REST API</code> æ“ä½œæ¥å£ã€‚</p><h2 id="esçš„æ ¸å¿ƒæ¦‚å¿µ"><a class="markdownIt-Anchor" href="#esçš„æ ¸å¿ƒæ¦‚å¿µ"></a> ESçš„æ ¸å¿ƒæ¦‚å¿µ</h2><ol><li>ç´¢å¼•ï¼ˆIndexï¼‰ï¼šESå°†æ•°æ®å­˜å‚¨äºä¸€ä¸ªæˆ–å¤šä¸ªç´¢å¼•ä¸­ã€‚ç±»æ¯”ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é¢†åŸŸæ¥è¯´ï¼Œç´¢å¼•ç›¸å½“äºSQLä¸­çš„ä¸€ä¸ªæ•°æ®åº“ï¼Œæˆ–è€…ä¸€ä¸ªæ•°æ®å­˜å‚¨æ–¹æ¡ˆï¼ˆschemaï¼‰ã€‚ç´¢å¼•ç”±å…¶åç§°ï¼ˆå¿…é¡»ä¸ºå…¨å°å†™å­—ç¬¦ï¼‰è¿›è¡Œæ ‡è¯†ã€‚ä¸€ä¸ªESé›†ç¾¤ä¸­å¯ä»¥æŒ‰éœ€åˆ›å»ºä»»æ„æ•°ç›®çš„ç´¢å¼•ã€‚</li><li>ç±»å‹ï¼ˆtypeï¼‰ï¼šç±»å‹æ˜¯ç´¢å¼•å†…éƒ¨çš„é€»è¾‘åˆ†åŒºï¼ˆcategory/partitionï¼‰ï¼Œä¸€ä¸ªç´¢å¼•å†…éƒ¨å¯å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªç±»å‹ï¼ˆtypeï¼‰ã€‚ç±»æ¯”ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é¢†åŸŸæ¥è¯´ï¼Œç±»å‹ç›¸å½“äºâ€œè¡¨â€ã€‚</li><li>æ–‡æ¡£ï¼ˆDocumentï¼‰ï¼šæ–‡æ¡£æ˜¯ç´¢å¼•å’Œæœç´¢çš„åŸå­å•ä½ï¼Œå®ƒæ˜¯åŒ…å«äº†ä¸€ä¸ªæˆ–å¤šä¸ªåŸŸï¼ˆFildï¼‰çš„å®¹å™¨ï¼Œæ¯ä¸ªåŸŸæ‹¥æœ‰ä¸€ä¸ªåå­—åŠä¸€ä¸ªæˆ–å¤šä¸ªå€¼ï¼Œæœ‰å¤šä¸ªå€¼çš„åŸŸé€šå¸¸ç§°ä¸ºâ€œå¤šå€¼åŸŸâ€ï¼Œæ–‡æ¡£åŸºäºJSONæ ¼å¼è¿›è¡Œè¡¨ç¤ºã€‚æ¯ä¸ªæ–‡æ¡£å¯ä»¥å­˜å‚¨ä¸åŒçš„åŸŸé›†ï¼Œä½†åŒä¸€ç±»å‹ä¸‹çš„æ–‡æ¡£è‡³åº”è¯¥æœ‰æŸç§ç¨‹åº¦ä¸Šçš„ç›¸ä¼¼ä¹‹å¤„ã€‚</li><li>é›†ç¾¤ï¼ˆClusterï¼‰ï¼šä¸€ä¸ªæˆ–è€…å¤šä¸ªæ‹¥æœ‰ç›¸åŒclusterâ€¦nameé…ç½®çš„èŠ‚ç‚¹ç»„æˆï¼Œå®ƒä»¬å…±åŒæ‰¿æ‹…æ•°æ®å’Œè´Ÿè½½çš„å‹åŠ›ã€‚</li><li>èŠ‚ç‚¹ï¼ˆNodeï¼‰ï¼šä¸€ä¸ªè¿è¡Œä¸­çš„Elasticsearchå®ä¾‹ç§°ä¸ºä¸€ä¸ªèŠ‚ç‚¹ã€‚<br>ESé›†ç¾¤ä¸­çš„èŠ‚ç‚¹æœ‰ä¸‰ç§ä¸åŒçš„ç±»å‹ï¼š<ul><li>ä¸»èŠ‚ç‚¹ï¼šè´Ÿè´£ç®¡ç†é›†ç¾¤èŒƒå›´å†…çš„æ‰€æœ‰å˜æ›´ï¼Œä¾‹å¦‚å¢åŠ ã€åˆ é™¤ç´¢å¼•ï¼Œæˆ–è€…å¢åŠ ã€åˆ é™¤èŠ‚ç‚¹ç­‰ã€‚ä¸»èŠ‚ç‚¹å¹¶ä¸éœ€è¦æ¶‰åŠåˆ°æ–‡æ¡£çº§åˆ«çš„å˜æ›´å’Œæœç´¢ç­‰æ“ä½œã€‚å¯ä»¥é€šè¿‡å±æ€§node.masteriè¿›è¡Œè®¾ç½®ã€‚</li><li>æ•°æ®èŠ‚ç‚¹ï¼šå­˜å‚¨æ•°æ®å’Œå…¶å¯¹åº”çš„å€’æ’ç´¢å¼•ã€‚é»˜è®¤æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯æ•°æ®èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬ä¸»èŠ‚ç‚¹ï¼‰ï¼Œå¯ä»¥é€šè¿‡ode.dataå±æ€§è¿›è¡Œè®¾ç½®ã€‚</li><li>åè°ƒèŠ‚ç‚¹ï¼šå¦‚æœnode.masterå’Œnode.dataå±æ€§å‡ä¸ºfalseï¼Œåˆ™æ­¤èŠ‚ç‚¹ç§°ä¸ºåè°ƒèŠ‚ç‚¹ï¼Œç”¨æ¥å“åº”å®¢æˆ·è¯·æ±‚ï¼Œå‡è¡¡æ¯ä¸ªèŠ‚ç‚¹çš„è´Ÿè½½ã€‚</li></ul></li></ol><h2 id="pythonæ“ä½œelasticsearch"><a class="markdownIt-Anchor" href="#pythonæ“ä½œelasticsearch"></a> Pythonæ“ä½œElasticsearch</h2><p>å®‰è£…esåº“<code>pip install Elasticsearch</code></p><p>å‚è€ƒï¼š</p><ul><li><a href="https://www.bilibili.com/video/BV1CJ411L7uV?from=search&amp;seid=16833887069453710612&amp;spm_id_from=333.337.0.0" target="_blank" rel="noopener"><em>python</em>æ“ä½œ<em>ElasticSearch</em>-åˆ›å»ºã€æ’å…¥ã€æ£€ç´¢</a></li><li><a href="https://www.bilibili.com/video/BV1Nk4y1R7Hf?p=5&amp;spm_id_from=pageDriver" target="_blank" rel="noopener">ã€ç‹‚ç¥è¯´Javaã€‘ElasticSearchæœç´¢å®æˆ˜ä»¿äº¬ä¸œæœç´¢</a>â€”â€”Javaæ“ä½œES+ä»¿äº¬ä¸œæœç´¢+vueä¸thymeleftå•é¡µé¢å®ç°å‰ç«¯</li></ul><h1 id="é™„å½•"><a class="markdownIt-Anchor" href="#é™„å½•"></a> é™„å½•</h1><h2 id="docker-è¿è¡Œ-elasticsearch"><a class="markdownIt-Anchor" href="#docker-è¿è¡Œ-elasticsearch"></a> docker è¿è¡Œ Elasticsearch</h2><blockquote><p>æ ¹æ®å®˜ç½‘æ¨èï¼ŒESé…å¥— Kibana åªèƒ½å®‰è£… <a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.elastic.co%2Fguide%2Fen%2Fkibana%2F6.8%2Fdocker.html" target="_blank" rel="noopener">6.8.19</a>ï¼Œ æ‰€ä»¥å®‰è£…</p></blockquote><ol><li><p>æ‹‰å–é•œåƒ:<code>docker pull docker.io/elasticsearch:7.17.2</code>ï¼Œæ‹‰å–å…¶ä»–ç‰ˆæœ¬å¯è§<a href="#%E6%9F%A5%E7%9C%8B%E9%95%9C%E5%83%8F%E7%89%88%E6%9C%AC%EF%BC%9Adocker-search-tag">æŸ¥çœ‹é•œåƒç‰ˆæœ¬ï¼šdocker-search-tag</a></p></li><li><p>esé…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /home/apollo3d/cl/dockerdata/elasticsearch/config </span><br><span class="line">mkdir -p /home/apollo3d/cl/dockerdata/elasticsearch/data</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"http.host: 0.0.0.0"</span> &gt;&gt; /home/apollo3d/cl/dockerdata/elasticsearch/config/elasticsearch.yml</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨å®¹å™¨:<code>docker run --name es -p 9200:9200 -p 9300:9300 \ -e &quot;discovery.type=single-node&quot; \ -e ES_JAVA_OPTS=&quot;-Xms64m -Xmx512m&quot; \ -v /home/apollo3d/dockerdata/elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml \ -v /home/apollo3d/dockerdata/elasticsearch/data:/usr/share/elasticsearch/data \ -v /home/apollo3d/dockerdata/elasticsearch/plugins:/usr/share/elasticsearch/plugins \ -d docker.io/elasticsearch:7.17.2</code>ï¼Œæ³¨ï¼š<code>&lt;image_id&gt;</code>å¯ä»¥é€šè¿‡<code>docker images</code>æŸ¥çœ‹åˆšåˆšpullä¸‹æ¥çš„é•œåƒï¼›éœ€è¦å»ESCä¸Šæ‰“å¼€é˜²ç«å¢™çš„æŒ‡å®šç«¯å£ï¼›</p></li><li><p>æµ‹è¯•ï¼šæµè§ˆå™¨è®¿é—® Elasticsearch åœ°å€ï¼š<code>ECS_IP:9200</code>ï¼Œ å¦‚æœè¿”å›JSONæ•°æ®åˆ™<strong>å¯åŠ¨æ­£ç¡®</strong></p></li><li><p>å®‰è£… ik åˆ†è¯å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥eså®¹å™¨</span></span><br><span class="line">$ docker <span class="built_in">exec</span> -it es bash</span><br><span class="line"><span class="comment"># ä¸‹è½½ikåˆ†è¯å™¨</span></span><br><span class="line">$ ./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.1.1/elasticsearch-analysis-ik-7.1.1.zip</span><br><span class="line"><span class="comment"># é€€å‡ºå®¹å™¨</span></span><br><span class="line">$ <span class="built_in">exit</span></span><br></pre></td></tr></table></figure></li><li><p>å®‰è£… ik åˆ†è¯å™¨åé‡å¯ Elasticsearchï¼š<code>docker restart es</code></p></li><li><p>postman æµ‹è¯• ik åˆ†è¯å™¨ï¼ˆæ³¨æ„ï¼šæŠŠ Content-Type è®¾ç½®ä¸º application/json ï¼‰</p></li></ol><h2 id="å¯åŠ¨-es-head-å¯è§†åŒ–ç•Œé¢"><a class="markdownIt-Anchor" href="#å¯åŠ¨-es-head-å¯è§†åŒ–ç•Œé¢"></a> å¯åŠ¨ es-head (å¯è§†åŒ–ç•Œé¢):</h2><blockquote><p>Elasticsearch 5.xåä¸æ”¯æŒæ’ä»¶ï¼Œheadä½œä¸ºå•ç‹¬æœåŠ¡ç‹¬ç«‹è¿è¡Œã€‚</p></blockquote><ol><li><p>æ‹‰å–é•œåƒï¼š<code>docker pull mobz/elasticsearch-head:5</code></p></li><li><p>å¯åŠ¨å®¹å™¨ï¼š<code>docker run -d -p 9100:9100 --name esh elasticsearch-head</code></p></li><li><p>è®¿é—® es-headï¼š<code>ECS_IP:9100</code></p><p>å½“ä½ è¾“å…¥ <a href="https://link.zhihu.com/?target=http%3A//192.168.232.128%3A9200/" target="_blank" rel="noopener">http://192.168.232.128:9200/</a> ç‚¹å‡»è¿æ¥æ—¶ï¼Œä¼šå‘ç°æ— æ³•è¿æ¥ã€‚æ˜¯å› ä¸ºå‰åç«¯åˆ†ç¦»å¼€å‘ï¼Œå­˜åœ¨è·¨åŸŸé—®é¢˜ï¼Œéœ€è¦åœ¨æœåŠ¡ç«¯åš CORS çš„é…ç½®ã€‚æˆ‘ä»¬å†æ¬¡è¿›å…¥ Elasticsearch å®¹å™¨å†…éƒ¨ï¼Œä¿®æ”¹ <code>elasticsearch.yml</code> é…ç½®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥å®¹å™¨</span></span><br><span class="line">$ docker <span class="built_in">exec</span> -it es /bin/bash</span><br><span class="line">[root@7f213e9fb6bb elasticsearch]<span class="comment"># vi config/elasticsearch.yml</span></span><br><span class="line"><span class="comment"># æ·»åŠ å¦‚ä¸‹ä¸¤æ¡é…ç½®ï¼Œæ³¨æ„å†’å·åé¢æœ‰ç©ºæ ¼ï¼Œä¿å­˜å¹¶é€€å‡ºã€‚</span></span><br><span class="line">http.cors.enabled: <span class="literal">true</span> </span><br><span class="line">http.cors.allow-origin: <span class="string">"*"</span></span><br></pre></td></tr></table></figure></li><li><p>æœ€åé€€å‡ºå®¹å™¨ï¼Œå¹¶é‡å¯ Elasticsearch: <code>docker restart esh</code></p></li><li><p>å†æ¬¡è®¿é—® es-headï¼Œå°±èƒ½çœ‹åˆ°å¯è§†åŒ–çš„ç•Œé¢äº†ã€‚</p></li></ol><h2 id="å¯åŠ¨-kibanaå¯è§†åŒ–ç•Œé¢"><a class="markdownIt-Anchor" href="#å¯åŠ¨-kibanaå¯è§†åŒ–ç•Œé¢"></a> â˜…å¯åŠ¨ kibanaï¼ˆå¯è§†åŒ–ç•Œé¢ï¼‰</h2><blockquote><p>Kibana æ˜¯ä¸º <a href="https://so.csdn.net/so/search?q=Elasticsearch&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener">Elasticsearch</a>è®¾è®¡çš„å¼€æºåˆ†æå’Œå¯è§†åŒ–å¹³å°ã€‚å¯ä»¥ä½¿ç”¨ Kibana æ¥æœç´¢ï¼ŒæŸ¥çœ‹å­˜å‚¨åœ¨ Elasticsearch ç´¢å¼•ä¸­çš„æ•°æ®å¹¶ä¸ä¹‹äº¤äº’ã€‚ä½ å¯ä»¥å¾ˆå®¹æ˜“å®ç°é«˜çº§çš„æ•°æ®åˆ†æå’Œå¯è§†åŒ–ï¼Œå¹¶ä¸”ä»¥<u>å›¾è¡¨çš„å½¢å¼</u>å±•ç°å‡ºæ¥ã€‚</p><p>æ˜¯ELKæŠ€æœ¯æ ˆä¸­çš„Kï¼Œä¹Ÿæ˜¯ESæ¯”è¾ƒä¸»æµçš„å¯è§†åŒ–ç•Œé¢ï¼Œä¹Ÿæ˜¯å®˜æ–¹æ¨èçš„</p><p>Elasticsearch 5.xåä¸æ”¯æŒæ’ä»¶ï¼Œè·ŸElasticsearch  headä¸€æ ·ï¼Œkibanaéœ€è¦ä½œä¸ºå•ç‹¬æœåŠ¡ç‹¬ç«‹è¿è¡Œã€‚</p></blockquote><ol><li><p>æ‹‰å–é•œåƒï¼š<code>docker pull docker.io/kibana:7.17.2</code></p></li><li><p>é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/dockerdata/elk7/kibana/config/</span><br><span class="line">vi ~/dockerdata/elk7/kibana/config/kibana.yml</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ** THIS IS AN AUTO-GENERATED FILE **</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Default Kibana configuration for docker target</span></span><br><span class="line"></span><br><span class="line">server.name: kibana</span><br><span class="line">server.host: <span class="string">"0"</span> <span class="comment"># å¯¹å¤–è®¿é—®kibanaçš„åœ°å€</span></span><br><span class="line">elasticsearch.hosts: [ <span class="string">"http://127.0.0.1:9200"</span> ]<span class="comment"># elasticsearchçš„åœ°å€</span></span><br><span class="line">xpack.monitoring.ui.container.elasticsearch.enabled: <span class="literal">true</span></span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨å®¹å™¨: <code>docker run -d --name=kibana --restart=always -p 5601:5601 -v ~/dockerdata/elk7/kibana/config/kibana.yml:/usr/share/kibana/config/kibana.yml kibana:7.17.2</code></p></li><li><p>æŸ¥çœ‹æ—¥å¿—: <code>docker logs -f kibana</code></p></li><li><p>ç­‰å¾…30ç§’ï¼Œå¦‚æœå‡ºç°ä»¥ä¸‹ä¿¡æ¯ï¼Œè¯´æ˜å¯åŠ¨æˆåŠŸäº†ï¼š<code>{&quot;type&quot;:&quot;log&quot;,&quot;@timestamp&quot;:&quot;2020-08-27T03:00:28Z&quot;,&quot;tags&quot;:[&quot;listening&quot;,&quot;info&quot;],&quot;pid&quot;:6,&quot;message&quot;:&quot;Server running at http://0:5601&quot;}</code></p></li><li><p>è®¿é—®é¡µé¢ï¼š<code>ECS_IP:5601</code>å°±å¯ä»¥çœ‹åˆ°Welcome to Kibanaå•¦~</p></li></ol><p>Kibana server is not ready yeté—®é¢˜ï¼š</p><ul><li><a href="https://blog.csdn.net/fbvukn/article/details/107289027?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1.pc_relevant_antiscanv2&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1.pc_relevant_antiscanv2&amp;utm_relevant_index=2" target="_blank" rel="noopener">kibanaè§£å†³Kibana server is not ready yeté—®é¢˜</a></li><li><a href="https://blog.csdn.net/whatday/article/details/107879989" target="_blank" rel="noopener">kibana æŠ¥é”™ server is not ready yet å¯èƒ½çš„åŸå› </a></li></ul><h2 id="docker-compose"><a class="markdownIt-Anchor" href="#docker-compose"></a> docker-compose:</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3'</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">    elasticsearch:</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">docker.io/elasticsearch:7.17.2</span></span><br><span class="line"><span class="attr">        container_name:</span> <span class="string">es2</span></span><br><span class="line"><span class="attr">        environment:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">discovery.type=single-node</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="bullet">           -</span> <span class="string">"9200:9200"</span></span><br><span class="line"><span class="bullet">           -</span> <span class="string">"9300:9300"</span></span><br><span class="line"><span class="attr">    kinaba:</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">docker.io/kibana:7.17.2</span></span><br><span class="line"><span class="attr">        container_name:</span> <span class="string">kibana2</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">"5601:5601"</span></span><br><span class="line"><span class="attr">        volumes:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/home/apollo3d/cl/dockerdata/elk7/kibana/config/kibana.yml:/usr/share/kibana/config/kibana.yml</span></span><br><span class="line"><span class="attr">        depends_on:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">elasticsearch</span></span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹é•œåƒç‰ˆæœ¬docker-search-tag"><a class="markdownIt-Anchor" href="#æŸ¥çœ‹é•œåƒç‰ˆæœ¬docker-search-tag"></a> æŸ¥çœ‹é•œåƒç‰ˆæœ¬ï¼šdocker-search-tag</h2><p><a href="http://xn--docker-show-repo-tag-2x06a431biq1j2e4clo2cqoe.sh" target="_blank" rel="noopener">ä½¿ç”¨è‡ªåˆ¶è„šæœ¬docker-show-repo-tag.sh</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Simple script that will display docker repository tags.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Usage:</span></span><br><span class="line"><span class="comment">#   $ docker-show-repo-tags.sh ubuntu centos</span></span><br><span class="line"><span class="keyword">for</span> Repo <span class="keyword">in</span> $* ; <span class="keyword">do</span></span><br><span class="line">  curl -s -S <span class="string">"https://registry.hub.docker.com/v2/repositories/library/<span class="variable">$Repo</span>/tags/"</span> | \</span><br><span class="line">    sed -e <span class="string">'s/,/,\n/g'</span> -e <span class="string">'s/\[/\[\n/g'</span> | \</span><br><span class="line">    grep <span class="string">'"name"'</span> | \</span><br><span class="line">    awk -F\<span class="string">" '&#123;print <span class="variable">$4</span>;&#125;' | \</span></span><br><span class="line"><span class="string">    sort -fu | \</span></span><br><span class="line"><span class="string">    sed -e "</span>s/^/<span class="variable">$&#123;Repo&#125;</span>:/<span class="string">"</span></span><br><span class="line"><span class="string">done</span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ç»ˆç«¯è¿è¡Œ<code>$ ./docker-show-repo-tags.sh elasticsearch</code>å³å¯è·å¾—ç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">elasticsearch:8.0.1</span><br><span class="line">elasticsearch:8.1.0</span><br><span class="line">elasticsearch:8.1.1</span><br><span class="line">elasticsearch:8.1.2</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å€’æ’ç´¢å¼•&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#å€’æ’ç´¢å¼•&quot;&gt;&lt;/a&gt; å€’æ’ç´¢å¼•&lt;/h2&gt;
&lt;p&gt;åå‘ç´¢å¼•ï¼ˆinverted indexï¼‰æ›´ç†Ÿæ‚‰çš„åå­—æ˜¯å€’æ’ç´¢å¼•ã€‚&lt;/p&gt;
&lt;p&gt;ä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼•: å€’æ’ç´¢å¼•ä¹Ÿå«åå‘ç´¢å¼•ï¼Œé€šä¿—æ¥è®²æ­£å‘
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ç®—æ³•ä¸æ•°æ®ç»“æ„â€”â€”æ»‘åŠ¨çª—å£ã€å°ºå–æ³•</title>
    <link href="https://nymrli.top/2022/04/10/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E2%80%94%E2%80%94%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3/"/>
    <id>https://nymrli.top/2022/04/10/ç®—æ³•ä¸æ•°æ®ç»“æ„â€”â€”æ»‘åŠ¨çª—å£/</id>
    <published>2022-04-10T03:14:53.000Z</published>
    <updated>2022-04-11T08:35:58.656Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Sliding window algorithm is used to perform required operation on specific window size of given large buffer or array.æ»‘åŠ¨çª—å£ç®—æ³•æ˜¯åœ¨ç»™å®š<strong>ç‰¹å®šçª—å£å¤§å°</strong>çš„<u>æ•°ç»„æˆ–å­—ç¬¦ä¸²</u>ä¸Šæ‰§è¡Œè¦æ±‚çš„æ“ä½œã€‚</p><p>This technique shows how a nested for loop in few problems can be converted to single for loop and hence reducing the time complexity.è¯¥æŠ€æœ¯å¯ä»¥å°†ä¸€éƒ¨åˆ†é—®é¢˜ä¸­çš„åµŒå¥—å¾ªç¯è½¬å˜ä¸ºä¸€ä¸ªå•å¾ªç¯ï¼Œå› æ­¤å®ƒå¯ä»¥å‡å°‘æ—¶é—´å¤æ‚åº¦ã€‚</p></blockquote><h2 id="åŸºæœ¬æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#åŸºæœ¬æ¦‚å¿µ"></a> åŸºæœ¬æ¦‚å¿µ</h2><p>æ»‘åŠ¨çª—å£æ˜¯ä¸€ç§åŸºäºåŒæŒ‡é’ˆçš„ä¸€ç§æ€æƒ³ï¼Œä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å…ƒç´ ä¹‹é—´å½¢æˆä¸€ä¸ªçª—å£ï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸€ç§åŒæŒ‡é’ˆæ–¹æ³•çš„ç‰¹ä¾‹ã€‚</p><p>çª—å£çš„åšæ³•åˆ†ä¸ºå®šé•¿çª—å£å’Œä¸å®šé•¿çª—å£ï¼Œæœ‰äº›äººæŠŠæ¶‰åŠçª—å£ç§»åŠ¨çš„éƒ½ç»Ÿç§°ä¸º<strong>æ»‘åŠ¨çª—å£</strong>åšæ³•ã€‚è€Œåœ¨æ­¤ï¼Œæˆ‘ä»¬è¿›è¡Œè¿›ä¸€æ­¥çš„ç»†åˆ†ï¼š</p><ul><li>å®šé•¿æ»‘åŠ¨çª—å£</li><li>å˜é•¿æ»‘åŠ¨çª—å£â€”â€”å°ºå–æ³•</li></ul><p><strong>åº”ç”¨</strong>ï¼š</p><blockquote><p>åˆ©ç”¨çª—å£çš„ç‰¹æ€§ï¼Œå¯ä»¥ç”¨æ¥è§£å†³ä¸€äº›æŸ¥æ‰¾æ»¡è¶³ä¸€å®šæ¡ä»¶çš„<strong>è¿ç»­åŒºé—´çš„</strong>æ€§è´¨ï¼ˆé•¿åº¦ç­‰ï¼‰çš„é—®é¢˜ã€‚ç”±äºåŒºé—´è¿ç»­ï¼Œå› æ­¤å½“åŒºé—´å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¯ä»¥é€šè¿‡<u>æ—§æœ‰çš„è®¡ç®—ç»“æœ</u>è¿›è¡Œä¿®æ”¹ï¼Œä»è€Œå¯¹æœç´¢ç©ºé—´è¿›è¡Œå‰ªæï¼Œè¿™æ ·ä¾¿å‡å°‘äº†é‡å¤è®¡ç®—ï¼Œé™ä½äº†æ—¶é—´å¤æ‚åº¦ã€‚</p></blockquote><p>Qï¼šé‚£ä¹ˆï¼Œå…·ä½“ä»€ä¹ˆæƒ…å†µå¯ä»¥ç”¨æ»‘åŠ¨çª—å£æ¥è§£å†³å®é™…é—®é¢˜å‘¢ï¼Ÿ</p><ol><li>ä¸€èˆ¬ç»™å‡ºçš„æ•°æ®ç»“æ„æ˜¯<u>æ•°ç»„æˆ–è€…å­—ç¬¦ä¸²</u></li><li>æ±‚å–æŸä¸ªå­ä¸²æˆ–è€…<u>å­åºåˆ—</u><u>æœ€é•¿æœ€çŸ­ç­‰æœ€å€¼é—®é¢˜</u>æˆ–è€…æ±‚æŸä¸ªç›®æ ‡å€¼æ—¶</li><li>è¯¥é—®é¢˜<u>æœ¬èº«å¯ä»¥é€šè¿‡æš´åŠ›æ±‚è§£</u>â€”â€”â˜…æ»‘åŠ¨çª—å£è·ŸåŒæŒ‡é’ˆä¸€æ ·ï¼Œé’ˆå¯¹ä¸€äº›é—®é¢˜èƒ½é™ä½æ—¶é—´å¤æ‚åº¦ã€‚</li></ol><h2 id="æ ¸å¿ƒæ€è·¯"><a class="markdownIt-Anchor" href="#æ ¸å¿ƒæ€è·¯"></a> <strong>æ ¸å¿ƒæ€è·¯</strong></h2><p><strong>çª—å£çš„å½¢æˆ</strong></p><p>åœ¨å…·ä½“ä½¿ç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬çŸ¥é“çª—å£å®é™…æ˜¯ä¸¤ä¸ªæŒ‡é’ˆä¹‹é—´å½¢æˆçš„åŒºåŸŸï¼Œé‚£å…³é”®å°±æ˜¯è¿™ä¸¤ä¸ªæŒ‡é’ˆæ˜¯å¦‚ä½•ç§»åŠ¨çš„ã€‚</p><p>ã€ŠæŒ‘æˆ˜ç¨‹åºè®¾è®¡ç«èµ›ã€‹è¿™æœ¬ä¹¦ä¸­æŠŠæ»‘åŠ¨çª—å£å«åšã€Œè™«å–æ³•ã€ï¼Œè¿™ä¹Ÿéå¸¸ç”ŸåŠ¨å½¢è±¡ã€‚å› ä¸ºæ»‘åŠ¨çª—å£çš„ä¸¤ä¸ªæŒ‡é’ˆç§»åŠ¨çš„è¿‡ç¨‹å’Œè™«å­çˆ¬åŠ¨çš„è¿‡ç¨‹éå¸¸åƒï¼šå‰è„š(rightæŒ‡é’ˆ)ä¸åŠ¨ï¼ŒæŠŠåè„š(leftæŒ‡é’ˆ)ç§»åŠ¨è¿‡æ¥ï¼›åè„šä¸åŠ¨ï¼ŒæŠŠå‰è„šå‘å‰ç§»åŠ¨ã€‚</p><p>æ»‘åŠ¨çª—å£ä¸­ç”¨åˆ°äº†å·¦å³ä¸¤ä¸ªæŒ‡é’ˆï¼Œå®ƒä»¬ç§»åŠ¨çš„æ€è·¯æ˜¯ï¼š<strong>ä»¥å³æŒ‡é’ˆä½œä¸ºé©±åŠ¨ï¼Œæ‹–ç€å·¦æŒ‡é’ˆå‘å‰èµ°ã€‚<u>å³æŒ‡é’ˆæ¯æ¬¡åªç§»åŠ¨ä¸€æ­¥ï¼Œè€Œå·¦æŒ‡é’ˆåœ¨å†…éƒ¨ while å¾ªç¯ä¸­æ¯æ¬¡å¯èƒ½ç§»åŠ¨å¤šæ­¥</u>ã€‚å³æŒ‡é’ˆæ˜¯ä¸»åŠ¨å‰ç§»ï¼Œæ¢ç´¢æœªçŸ¥çš„æ–°åŒºåŸŸï¼›å·¦æŒ‡é’ˆæ˜¯è¢«è¿«ç§»åŠ¨ï¼Œè´Ÿè´£å¯»æ‰¾æ»¡è¶³é¢˜æ„çš„åŒºé—´</strong>ã€‚</p><p>ä¸ºäº†å¾—åˆ°ç¬¦åˆè¦æ±‚çš„æœ€é•¿å­æ•°ç»„çš„é•¿åº¦ï¼Œåº”éµå¾ªä»¥ä¸‹ä¸¤ç‚¹åŸåˆ™ï¼š</p><ul><li>å½“ start çš„å€¼å›ºå®šæ—¶ï¼Œend çš„å€¼åº”å°½å¯èƒ½å¤§ï¼›</li><li>å½“ end çš„å€¼å›ºå®šæ—¶, start çš„å€¼åº”å°½å¯èƒ½å°ã€‚</li></ul><p><strong>æ¨¡æ¿çš„æ‰§è¡Œæ€æƒ³æ˜¯ï¼š</strong></p><ol><li>å®šä¹‰ä¸¤ä¸ªæŒ‡é’ˆ left å’Œ right åˆ†åˆ«æŒ‡å‘åŒºé—´çš„å¼€å¤´å’Œç»“å°¾ï¼Œæ³¨æ„æ˜¯<strong>é—­åŒºé—´</strong>ï¼›å®šä¹‰ sums ç”¨æ¥ç»Ÿè®¡è¯¥åŒºé—´å†…çš„å„ä¸ªå­—ç¬¦å‡ºç°æ¬¡æ•°ï¼›</li><li>ç¬¬ä¸€é‡ while å¾ªç¯æ˜¯ä¸ºäº†åˆ¤æ–­ right æŒ‡é’ˆçš„ä½ç½®æ˜¯å¦è¶…å‡ºäº†æ•°ç»„è¾¹ç•Œï¼›å½“ right æ¯æ¬¡åˆ°äº†æ–°ä½ç½®ï¼Œéœ€è¦å¢åŠ  right æŒ‡é’ˆçš„æ±‚å’Œ/è®¡æ•° --&gt; sumï¼›</li><li>ç¬¬äºŒé‡ while å¾ªç¯æ˜¯è®© left æŒ‡é’ˆå‘å³ç§»åŠ¨åˆ° [left, right] åŒºé—´ç¬¦åˆé¢˜æ„çš„ä½ç½®ï¼›å½“ left æ¯æ¬¡ç§»åŠ¨åˆ°äº†æ–°ä½ç½®ï¼Œéœ€è¦å‡å°‘ left æŒ‡é’ˆçš„æ±‚å’Œ/è®¡æ•°ï¼›</li><li>åœ¨ç¬¬äºŒé‡ while å¾ªç¯ä¹‹åï¼ŒæˆåŠŸæ‰¾åˆ°äº†ä¸€ä¸ªç¬¦åˆé¢˜æ„çš„ [left, right] åŒºé—´ï¼Œä¾¿è·³å‡ºå¾ªç¯ï¼Œæ›´æ–°é¢˜ç›®è¦æ±‚æœ€å¤§çš„åŒºé—´é•¿åº¦ï¼Œå³ <code>res = max(res, right - left + 1)</code>ã€‚</li><li>right æŒ‡é’ˆæ¯æ¬¡å‘å³ç§»åŠ¨ä¸€æ­¥ï¼Œå¼€å§‹æ¢ç´¢æ–°çš„åŒºé—´ã€‚</li></ol><h2 id="ä»£ç æ¨¡æ¿"><a class="markdownIt-Anchor" href="#ä»£ç æ¨¡æ¿"></a> ä»£ç æ¨¡æ¿</h2><h3 id="å˜é•¿çª—å£æ¨¡æ¿"><a class="markdownIt-Anchor" href="#å˜é•¿çª—å£æ¨¡æ¿"></a> å˜é•¿çª—å£æ¨¡æ¿</h3><p>ä¼ªä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ»‘åŠ¨çª—å£æ¨¡æ¿</span></span><br><span class="line">left,right = <span class="number">0</span>, (<span class="number">0</span> <span class="keyword">or</span> <span class="number">1</span>)</span><br><span class="line">ans = target = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> right &lt; len(nums):</span><br><span class="line">   æ ¹æ® right æ›´æ–° target å€¼</span><br><span class="line">   <span class="keyword">while</span> çª—å£å†…æ•°æ®ä¸æ»¡è¶³è¦æ±‚</span><br><span class="line">      <span class="comment"># 1. æ›´æ–° target å€¼</span></span><br><span class="line">      <span class="comment"># 2. æ”¶ç¼©å·¦è¾¹ç•Œ ==&gt; ä½¿å¾—æ–°çª—å£æ»¡è¶³è¦æ±‚</span></span><br><span class="line">      <span class="comment"># or: æ›´æ–° ansï¼š çª—å£ç›¸å…³æœ€å°å€¼ï¼Œåˆ™åœ¨æ­¤æ›´æ–°</span></span><br><span class="line">    <span class="comment"># or: æ›´æ–° ansï¼š æ±‚çª—å£ç›¸å…³æœ€å¤§å€¼ï¼Œåˆ™åœ¨æ­¤æ›´æ–°</span></span><br><span class="line">    æ›´æ–°right(ç§»åŠ¨å³è¾¹ç•Œ)</span><br><span class="line">è¿”å› ans</span><br></pre></td></tr></table></figure><p>å…·è±¡åŒ–çš„Pythonä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findSubArray</span><span class="params">(nums)</span>:</span></span><br><span class="line">    N = len(nums) <span class="comment"># æ•°ç»„/å­—ç¬¦ä¸²é•¿åº¦</span></span><br><span class="line">    left, right = <span class="number">0</span>, <span class="number">0</span> <span class="comment"># åŒæŒ‡é’ˆï¼Œè¡¨ç¤ºå½“å‰éå†çš„åŒºé—´[left, right]ï¼Œé—­åŒºé—´</span></span><br><span class="line">    sums = <span class="number">0</span> <span class="comment"># ç”¨äºç»Ÿè®¡ å­æ•°ç»„/å­åŒºé—´ æ˜¯å¦æœ‰æ•ˆï¼Œæ ¹æ®é¢˜ç›®å¯èƒ½ä¼šæ”¹æˆæ±‚å’Œ/è®¡æ•°</span></span><br><span class="line">    res = <span class="number">0</span> <span class="comment"># ä¿å­˜æœ€å¤§çš„æ»¡è¶³é¢˜ç›®è¦æ±‚çš„ å­æ•°ç»„/å­ä¸² é•¿åº¦</span></span><br><span class="line">    <span class="keyword">while</span> right &lt; N: <span class="comment"># å½“å³è¾¹çš„æŒ‡é’ˆæ²¡æœ‰æœç´¢åˆ° æ•°ç»„/å­—ç¬¦ä¸² çš„ç»“å°¾</span></span><br><span class="line">        sums += nums[right] <span class="comment"># å¢åŠ å½“å‰å³è¾¹æŒ‡é’ˆçš„æ•°å­—/å­—ç¬¦çš„æ±‚å’Œ/è®¡æ•°</span></span><br><span class="line">        <span class="keyword">while</span> åŒºé—´[left, right]ä¸ç¬¦åˆé¢˜æ„ï¼š<span class="comment"># æ­¤æ—¶éœ€è¦ä¸€ç›´ç§»åŠ¨å·¦æŒ‡é’ˆï¼Œç›´è‡³æ‰¾åˆ°ä¸€ä¸ªç¬¦åˆé¢˜æ„çš„åŒºé—´</span></span><br><span class="line">            sums -= nums[left] <span class="comment"># ç§»åŠ¨å·¦æŒ‡é’ˆå‰éœ€è¦ä»counterä¸­å‡å°‘leftä½ç½®å­—ç¬¦çš„æ±‚å’Œ/è®¡æ•°</span></span><br><span class="line">            left += <span class="number">1</span> <span class="comment"># çœŸæ­£çš„ç§»åŠ¨å·¦æŒ‡é’ˆï¼Œæ³¨æ„é¡ºåºä¸èƒ½è·Ÿä¸Šé¢ä¸€è¡Œä»£ç å†™å</span></span><br><span class="line">        <span class="comment"># åˆ° while ç»“æŸæ—¶ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†ä¸€ä¸ªç¬¦åˆé¢˜æ„è¦æ±‚çš„ å­æ•°ç»„/å­ä¸²</span></span><br><span class="line">        res = max(res, right - left + <span class="number">1</span>) <span class="comment"># éœ€è¦æ›´æ–°ç»“æœ</span></span><br><span class="line">        right += <span class="number">1</span> <span class="comment"># ç§»åŠ¨å³æŒ‡é’ˆï¼Œå»æ¢ç´¢æ–°çš„åŒºé—´</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><p>å¦ä¸€ç§æ¨¡æ¿ï¼š</p><blockquote><p>(right++åœ¨å‰)</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">string s, t;</span><br><span class="line">    <span class="comment">// åœ¨ s ä¸­å¯»æ‰¾ t çš„ã€Œæœ€å°è¦†ç›–å­ä¸²ã€</span></span><br><span class="line">    <span class="keyword">int</span> left = <span class="number">0</span>, right = <span class="number">0</span>;</span><br><span class="line">    string res = s;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(right &lt; s.size()) &#123;</span><br><span class="line">        window.add(s[right]);</span><br><span class="line">        right++;</span><br><span class="line">        <span class="comment">// å¦‚æœç¬¦åˆè¦æ±‚ï¼Œè¯´æ˜çª—å£æ„é€ å®Œæˆï¼Œç§»åŠ¨ left ç¼©å°çª—å£</span></span><br><span class="line">        <span class="keyword">while</span> (window ç¬¦åˆè¦æ±‚) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœè¿™ä¸ªçª—å£çš„å­ä¸²æ›´çŸ­ï¼Œåˆ™æ›´æ–° res</span></span><br><span class="line">            <span class="comment">// or: ansæ›´æ–°ä½ç½®</span></span><br><span class="line">            res = minLen(res, window);</span><br><span class="line">            window.remove(s[left]);</span><br><span class="line">            left++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// or: ansæ›´æ–°ä½ç½®</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br></pre></td></tr></table></figure><h3 id="å›ºå®šé•¿çª—å£æ¨¡æ¿"><a class="markdownIt-Anchor" href="#å›ºå®šé•¿çª—å£æ¨¡æ¿"></a> <a href="https://www.cnblogs.com/huansky/p/13488234.html" target="_blank" rel="noopener">å›ºå®šé•¿çª—å£æ¨¡æ¿ï¼š</a></h3><blockquote><p>rightæ›´æ–°åœ¨ç¬¬ä¸€å±‚whileæœ€åï¼Œä¸”whileä¸­æ²¡æœ‰<code>if (right &gt; k)</code>ç±»ä¼¼çš„ä»£ç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxVowels</span><span class="params">(String s, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> right = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> len = s.length();</span><br><span class="line">        <span class="keyword">int</span> maxAns = Integer.MIN_VALUE;</span><br><span class="line">        <span class="keyword">int</span> target = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// åˆå§‹æ„é€ å®šé•¿çª—å£</span></span><br><span class="line">        <span class="keyword">while</span> (right &lt; k) &#123;</span><br><span class="line">            <span class="comment">// æ›´æ–°è¿™æ®µåˆå§‹åŒ–çª—å£ä¸­çš„ target å€¼</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// â˜…æ›´æ–° ans å€¼ maxAns = Math.max(maxAns, );</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®© right (æœ‰è¾¹ç•Œ)</span></span><br><span class="line">        <span class="keyword">while</span> (right &lt; len) &#123;</span><br><span class="line">            <span class="comment">// æ›´æ–° target å€¼</span></span><br><span class="line">            <span class="comment">// æ›´æ–° ans å€¼ maxAns = Math.max(maxAns, );</span></span><br><span class="line">            right ++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxAns;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">isVowel</span><span class="params">(<span class="keyword">char</span> ch)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ch == <span class="string">'a'</span> || ch == <span class="string">'e'</span> || ch == <span class="string">'i'</span> || ch == <span class="string">'o'</span> || ch == <span class="string">'u'</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦ä¸€ç§æ¨¡æ¿ï¼š</p><blockquote><ul><li>(right++åœ¨å‰) --&gt; è¿™ä¸ªæ˜¯å¯ä»¥è°ƒæ•´çš„ï¼Œç›¸åº”åœ°ä¿®æ”¹<code>if</code></li><li>æœ‰<code>if right &gt; k</code>çš„åˆ¤æ–­ï¼Œå³çª—å£æ˜¯å¦å·²ç»æ„é€ å®Œæˆ</li></ul></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å›ºå®šçª—å£å¤§å°ä¸º k</span></span><br><span class="line">   <span class="built_in">string</span> s;</span><br><span class="line">   <span class="comment">// åœ¨ s ä¸­å¯»æ‰¾çª—å£å¤§å°ä¸º k æ—¶çš„æ‰€åŒ…å«æœ€å¤§å…ƒéŸ³å­—æ¯ä¸ªæ•°</span></span><br><span class="line">   <span class="keyword">int</span>  right = <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">while</span>(right &lt; s.size()) &#123;</span><br><span class="line">       window.add(s[right]);</span><br><span class="line">       <span class="comment">// æ³¨ï¼šå¦‚æœæ”¾æœ€åï¼Œåˆ™ä¸‹é¢çš„ifæ”¹æˆ right &gt; k</span></span><br><span class="line">       right++;</span><br><span class="line">       <span class="comment">// å¦‚æœç¬¦åˆè¦æ±‚ï¼Œè¯´æ˜çª—å£æ„é€ å®Œæˆï¼Œ</span></span><br><span class="line">       <span class="keyword">if</span> (right&gt;=k) &#123;</span><br><span class="line">           <span class="comment">// è¿™æ˜¯å·²ç»æ˜¯ä¸€ä¸ªçª—å£äº†ï¼Œæ ¹æ®æ¡ä»¶åšä¸€äº›äº‹æƒ…</span></span><br><span class="line">          <span class="comment">// ... å¯ä»¥è®¡ç®—çª—å£æœ€å¤§å€¼ç­‰ </span></span><br><span class="line">           <span class="comment">// æœ€åä¸è¦å¿˜è®°æŠŠ right - k ä½ç½®å…ƒç´ ä»çª—å£é‡Œé¢ç§»é™¤</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> res;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°æ­¤æ—¶ä¸éœ€è¦ä¾èµ– left æŒ‡é’ˆäº†ã€‚å› ä¸ºçª—å£å›ºå®šæ‰€ä»¥å…¶å®å°±æ²¡å¿…è¦ä½¿ç”¨leftã€‚å¯ä»¥ç›´æ¥é€šè¿‡ right æŒ‡é’ˆæ¥æ§åˆ¶çª—å£ã€‚</p><p>ç”±äºçª—å£æ˜¯å›ºå®šçš„ï¼Œå› æ­¤å¯ä»¥è½»æ˜“è·å–åˆ° left çš„ä½ç½®ï¼Œæ­¤å¤„ left = right - kï¼Œæ‰€ä»¥åœ¨ç¬¬äºŒå±‚whileä¸­å¯ä»¥é€šè¿‡<code>nums[right-k]</code>æ¥è·å¾—leftä½ç½®å¾—å€¼ï¼Œä»è€Œä»çª—å£ä¸­åˆ é™¤ã€‚</p><p>æ³¨ï¼š è™½ç„¶æä¾›äº†ä¸¤ç§æ¨¡æ¿ï¼Œä½†ä¸è¦è´ªå¤šï¼Œè·ŸäºŒåˆ†æ¨¡æ¿ä¸€æ ·ï¼Œåªè¦è®°ä½ä¸€ç§å°±è¡Œäº†ã€‚</p><h2 id="easy-point"><a class="markdownIt-Anchor" href="#easy-point"></a> easy point:</h2><ul><li>çª—å£çš„é•¿åº¦: <code>right - left + 1</code>ï¼Œ</li><li>å‡è®¾çª—å£é•¿åº¦ä¸ºkï¼Œåˆ™çª—å£å†…å®¹ä¸º<code>[right-k+1, right-k+2, ..., right]</code>ï¼Œè¦è¢«å‰”é™¤çš„<code>left</code>çš„ç´¢å¼•ä¸º<code>right-k</code>ï¼šå›ºå®šé•¿çª—å£çš„é¢˜ç›®ä¸­ï¼Œå¯ä»¥é€šè¿‡rightä½ç½®æ‰¾åˆ°leftä½ç½®ã€‚</li></ul><h2 id="ä¸€èµ·åšå‡ é¢˜"><a class="markdownIt-Anchor" href="#ä¸€èµ·åšå‡ é¢˜"></a> ä¸€èµ·åšå‡ é¢˜</h2><ul><li><a href="https://leetcode-cn.com/problems/maximum-number-of-vowels-in-a-substring-of-given-length/" target="_blank" rel="noopener">1456. å®šé•¿å­ä¸²ä¸­å…ƒéŸ³çš„æœ€å¤§æ•°ç›®</a>â€”â€”å›ºå®šé•¿çª—å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxVowels</span><span class="params">(String s, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>, right = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> len = s.length();</span><br><span class="line">        <span class="keyword">int</span> maxAns = Integer.MIN_VALUE;</span><br><span class="line">        <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">char</span>[] chars = &#123;<span class="string">'a'</span>, <span class="string">'e'</span>, <span class="string">'i'</span>, <span class="string">'u'</span>, <span class="string">'o'</span>&#125;;</span><br><span class="line">        <span class="keyword">while</span> (right - left + <span class="number">1</span> &lt;= k) &#123;</span><br><span class="line">            <span class="keyword">if</span> (contains(chars, s.charAt(right))) &#123;</span><br><span class="line">                ans++;</span><br><span class="line">            &#125;</span><br><span class="line">            right++;</span><br><span class="line">        &#125;</span><br><span class="line">        maxAns = Math.max(maxAns, ans);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (right &lt; len) &#123;</span><br><span class="line">            <span class="keyword">if</span> (contains(chars, s.charAt(right))) &#123;</span><br><span class="line">                ans += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// è¢«æ’é™¤çš„æ˜¯å…ƒéŸ³</span></span><br><span class="line">            <span class="keyword">if</span> (contains(chars, s.charAt(right - k))) &#123;</span><br><span class="line">                ans -= <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            maxAns = Math.max(maxAns, ans);</span><br><span class="line">            right++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> maxAns;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(<span class="keyword">char</span> chars[], <span class="keyword">char</span> ch)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; chars.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (chars[i] == ch) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ›´å¥½çš„åšæ³•:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxVowels</span><span class="params">(String s, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> right =<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> max = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (right &lt; s.length()) &#123;</span><br><span class="line">            sum += isYuan(s.charAt(right)) ;</span><br><span class="line">            right++;</span><br><span class="line">            <span class="keyword">if</span> (right &gt;=k) &#123;</span><br><span class="line">                max = Math.max(max, sum);</span><br><span class="line">                sum -= isYuan(s.charAt(right-k));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">isYuan</span><span class="params">(<span class="keyword">char</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> s==<span class="string">'a'</span> || s==<span class="string">'e'</span> ||s==<span class="string">'i'</span> ||s==<span class="string">'o'</span> ||s==<span class="string">'u'</span> ? <span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><a href="https://leetcode-cn.com/problems/longest-substring-without-repeating-characters/" target="_blank" rel="noopener"> #3 æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</a> â€”â€”ç”¨setæ¥æ¨¡æ‹Ÿçª—å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = s.length();</span><br><span class="line">        <span class="keyword">if</span> (len &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> len;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>, right = <span class="number">0</span>;</span><br><span class="line">        HashSet&lt;Character&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span> (right &lt; len) &#123;</span><br><span class="line">            <span class="comment">// æŠŠåˆ é™¤ä¹‹å‰s.charAt(right)ä½ç½®å†…æ‰€æœ‰çš„å­—ç¬¦</span></span><br><span class="line">            <span class="keyword">while</span> (set.contains(s.charAt(right))) &#123;</span><br><span class="line">                set.remove(s.charAt(left++));</span><br><span class="line">            &#125;</span><br><span class="line">            set.add(s.charAt(right));</span><br><span class="line">            ans = Math.max(ans, right - left + <span class="number">1</span>);</span><br><span class="line">            right++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><a href="https://leetcode-cn.com/problems/minimum-size-subarray-sum/" target="_blank" rel="noopener"> #209 é•¿åº¦æœ€å°çš„å­æ•°ç»„</a> â€”â€” å˜é•¿çª—å£æ¿å­</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minSubArrayLen</span><span class="params">(<span class="keyword">int</span> target, <span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>, right = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> minLen = Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">int</span> len = nums.length;</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> ( right &lt; len) &#123;</span><br><span class="line">            sum += nums[right];</span><br><span class="line">            <span class="keyword">while</span> (sum &gt;= target) &#123;</span><br><span class="line">                <span class="comment">// ç”±äºéœ€è¦æ±‚æœ€å°, å› æ­¤è¿™è¾¹åœ¨leftæ”¶ç¼©è¿‡ç¨‹ä¸­æ›´æ–°minVal</span></span><br><span class="line">                minLen = Math.min(minLen, right - left +<span class="number">1</span>);</span><br><span class="line">                sum -= nums[left];</span><br><span class="line">                left ++;</span><br><span class="line">            &#125;</span><br><span class="line">            right ++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> minLen == Integer.MAX_VALUE ? <span class="number">0</span> : minLen;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><a href="https://leetcode-cn.com/problems/max-consecutive-ones-iii/" target="_blank" rel="noopener"> #1004 æœ€å¤§è¿ç»­1çš„ä¸ªæ•° III</a> â€”â€” å˜é•¿çª—å£æ¿å­ç•¥æœ‰å˜å½¢</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">longestOnes</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> left= <span class="number">0</span>, right = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> len = nums.length;</span><br><span class="line">        <span class="keyword">int</span> zeroTimes = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (right &lt; len) &#123;</span><br><span class="line">            <span class="keyword">int</span> now = nums[right];</span><br><span class="line">            <span class="comment">// æŠŠå½“å‰ä¿®æ”¹æˆ1</span></span><br><span class="line">            <span class="keyword">if</span> (now == <span class="number">0</span>) &#123;</span><br><span class="line">                zeroTimes ++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¦‚æœæ¬ äº†kï¼Œåˆ™éœ€è¦ä»å·¦è¾¹è¿›è¡ŒæŒªåŠ¨è¡¥å¿ï¼›ä¿è¯ä¸‹ä¸€æ¬¡æ·»åŠ nums[right]æ—¶ kä¸€å®šéè´Ÿ</span></span><br><span class="line">            <span class="keyword">while</span>( zeroTimes &gt; k) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums[left] == <span class="number">0</span>) &#123;</span><br><span class="line">                    zeroTimes--;</span><br><span class="line">                &#125;</span><br><span class="line">                left ++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// è·å¾—æœ€å¤§é•¿åº¦</span></span><br><span class="line">            ans = Math.max(ans, right - left + <span class="number">1</span>);</span><br><span class="line">            right ++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><a href="https://leetcode-cn.com/problems/maximum-average-subarray-i/" target="_blank" rel="noopener"> #643 å­æ•°ç»„æœ€å¤§å¹³å‡æ•° I</a>â€”â€”å›ºå®šé•¿çª—å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">findMaxAverage</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> (i &lt; k) &#123;</span><br><span class="line">          sum += nums[i++];</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">double</span> maxV = -<span class="number">10000</span>;</span><br><span class="line">      maxV = Math.max(maxV, (<span class="keyword">double</span>) sum / k);</span><br><span class="line">      <span class="keyword">for</span> (; i &lt; nums.length; i++) &#123;</span><br><span class="line">          sum = sum - nums[i - k] + nums[i];</span><br><span class="line">          maxV = Math.max(maxV, (<span class="keyword">double</span>) sum / k);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> maxV;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><ul><li><a href="https://leetcode-cn.com/problems/contains-duplicate-ii/" target="_blank" rel="noopener"> #219 å­˜åœ¨é‡å¤å…ƒç´  II</a>â€”â€”ä½¿ç”¨setä½œä¸ºçª—å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsNearbyDuplicate</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        HashSet&lt;Integer&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        <span class="keyword">int</span> right = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–æ„é€ çª—å£</span></span><br><span class="line">        <span class="keyword">while</span> (set.size() &lt; k) &#123;</span><br><span class="line">            set.add(nums[right++]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(right &lt; nums.length)</span><br><span class="line">            <span class="keyword">if</span> (set.contains(nums[right])) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            set.remove(nums[right-k]);</span><br><span class="line">            set.add(nums[right]);</span><br><span class="line">            right++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><a href="https://leetcode-cn.com/problems/find-all-anagrams-in-a-string/" target="_blank" rel="noopener">438. æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯</a>â€”â€”å›ºå®šé•¿çª—å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">findAnagrams</span><span class="params">(String s, String p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = s.length();</span><br><span class="line">        <span class="keyword">int</span> right = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> plen = p.length();</span><br><span class="line">        ArrayList&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="comment">// ä¿è¯pæ¯”sçŸ­</span></span><br><span class="line">        <span class="keyword">if</span> (plen &gt; len) &#123;</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="keyword">int</span>[] mp = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">26</span>];</span><br><span class="line">        <span class="keyword">int</span>[] targetmp = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">26</span>];</span><br><span class="line">        <span class="keyword">int</span> mpSize = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// è®°å½•pä¸­å„ä¸ªå­—ç¬¦å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; plen; i++) &#123;</span><br><span class="line">            targetmp[ p.charAt(i) - <span class="string">'a'</span>] ++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (right &lt; len) &#123;</span><br><span class="line">            <span class="keyword">char</span> c = s.charAt(right);</span><br><span class="line">            mp[c-<span class="string">'a'</span>]++; mpSize++;</span><br><span class="line">            <span class="comment">// whileå’Œifæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºmpå¤§å°æ˜¯é€šè¿‡rightä¸€æ¬¡æ¬¡å¢å¤§çš„</span></span><br><span class="line">            <span class="keyword">if</span> (mpSize &gt; plen) &#123;</span><br><span class="line">                <span class="comment">// ç¼©å°å·¦è¾¹ç•Œ</span></span><br><span class="line">                <span class="keyword">char</span> removeChar = s.charAt(right - plen);</span><br><span class="line">                mpSize--;</span><br><span class="line">                mp[removeChar-<span class="string">'a'</span>]--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (right(mp, targetmp)) &#123;</span><br><span class="line">                list.add(right - plen + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            right ++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">right</span><span class="params">(<span class="keyword">int</span>[] chars1, <span class="keyword">int</span>[] chars2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; chars1.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (chars1[i] != chars2[i]) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><a href="https://leetcode-cn.com/problems/get-equal-substrings-within-budget/" target="_blank" rel="noopener">1208. å°½å¯èƒ½ä½¿å­—ç¬¦ä¸²ç›¸ç­‰</a>â€”â€”å˜é•¿çª—å£æ¿å­</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">equalSubstring</span><span class="params">(String s, String t, <span class="keyword">int</span> maxCost)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = s.length();</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>, right = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// ç°åœ¨å·²ç»èŠ±è´¹çš„cost</span></span><br><span class="line">        <span class="keyword">int</span> cost = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (right &lt; len) &#123;</span><br><span class="line">            cost += Math.abs(s.charAt(right) - t.charAt(right));</span><br><span class="line">            <span class="comment">// æ­¤æ—¶costä¸æ»¡è¶³æ¡ä»¶</span></span><br><span class="line">            <span class="keyword">while</span> (cost &gt; maxCost) &#123;</span><br><span class="line">                <span class="comment">// é€šè¿‡ç§»åŠ¨left, å°†costè¡¥å¿å›æ¥</span></span><br><span class="line">                cost -= Math.abs(s.charAt(left) - t.charAt(left));</span><br><span class="line">                left++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ±‚æœ€å¤§é•¿åº¦ï¼Œåˆ™æ›´æ–°åœ¨ç¬¬ä¸€å±‚whileé‡Œé¢</span></span><br><span class="line">            ans = Math.max(ans, right - left + <span class="number">1</span>);</span><br><span class="line">            right ++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><a href="https://leetcode-cn.com/problems/sliding-window-maximum/" target="_blank" rel="noopener">239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼(å›°éš¾)</a></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">int</span>[] maxSlidingWindow(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> k) &#123;</span><br><span class="line">        <span class="keyword">int</span> len = nums.length;</span><br><span class="line">        <span class="keyword">int</span>[] ans = <span class="keyword">new</span> <span class="keyword">int</span>[len - k + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">int</span> right = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line">        LinkedList&lt;Integer&gt; list = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (right &lt; len) &#123;</span><br><span class="line">            <span class="keyword">int</span> now = nums[right];</span><br><span class="line">            <span class="comment">// ä¿æŒlisté€’å‡</span></span><br><span class="line">            <span class="keyword">while</span> (!list.isEmpty() &amp;&amp; list.peekLast() &lt; now) &#123;</span><br><span class="line">                list.pollLast();</span><br><span class="line">            &#125;</span><br><span class="line">            list.addLast(now);</span><br><span class="line">            right++;</span><br><span class="line">            <span class="keyword">if</span> (right &gt;= k) &#123;</span><br><span class="line">                ans[idx++] = list.peekFirst();</span><br><span class="line">                <span class="comment">// ä¸‹ä¸€æ¬¡çš„æ—¶å€™å°†ä¸ä¼šå†åœ¨çª—å£é‡Œé¢ï¼Œ æ‰€ä»¥åˆ¤æ–­æ˜¯å¦å‡ºå±€</span></span><br><span class="line">                <span class="keyword">if</span> (list.peekFirst() == nums[right - k]) &#123;</span><br><span class="line">                    list.removeFirst();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><a href="https://leetcode-cn.com/problems/permutation-in-string/" target="_blank" rel="noopener">567. å­—ç¬¦ä¸²çš„æ’åˆ—</a>â€”â€”å›ºå®šé•¿åº¦çª—å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸€å¼€å§‹éƒ½æ²¡çœ‹å‡ºæ¥æ€ä¹ˆéœ€è¦ç”¨åˆ°çª—å£ï¼Œ åæ¥å‘ç°s1çš„æ’åˆ—å¿…é¡»æ˜¯s2çš„å­ä¸², æ‰€ä»¥å­—ç¬¦æ˜¯ç›¸åŒçš„, å­ä¸²é•¿åº¦ä¹Ÿæ˜¯å›ºå®šã€‚ æ‰€ä»¥æ˜¯é“å®šé•¿çª—å£é¢˜</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkInclusion</span><span class="params">(String s1, String s2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr1 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">26</span>];</span><br><span class="line">        <span class="keyword">int</span>[] arr2 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">26</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s1.length(); i++) &#123;</span><br><span class="line">            arr1[s1.charAt(i) - <span class="string">'a'</span>]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> k = s1.length(), right = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> len = s2.length();</span><br><span class="line">        <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (right &lt; len) &#123;</span><br><span class="line">            arr2[s2.charAt(right) - <span class="string">'a'</span>]++;</span><br><span class="line">            cnt ++;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (cnt &gt; k) &#123;</span><br><span class="line">                arr2[ s2.charAt(right - k) - <span class="string">'a'</span>]--;</span><br><span class="line">                cnt--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (contains(arr1, arr2)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            right++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(<span class="keyword">int</span>[] arr1, <span class="keyword">int</span>[] arr2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr1.length; i++) &#123;</span><br><span class="line">            <span class="comment">// ä¸€æ—¦arr2ä¸ç¬¦åˆ</span></span><br><span class="line">            <span class="keyword">if</span> (arr1[i] &gt; arr2[i]) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒæ–‡ç« "><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡ç« "></a> å‚è€ƒæ–‡ç« ï¼š</h2><ul><li><a href="https://leetcode-cn.com/problems/max-consecutive-ones-iii/solution/fen-xiang-hua-dong-chuang-kou-mo-ban-mia-f76z/" target="_blank" rel="noopener">åˆ†äº«æ»‘åŠ¨çª—å£æ¨¡æ¿ï¼Œç§’æ€æ»‘åŠ¨çª—å£é—®é¢˜</a>â€”â€”å½¢è±¡çš„ç†è§£ï¼šè™«å–æ³•</li><li><a href="https://www.cnblogs.com/huansky/p/13488234.html" target="_blank" rel="noopener">æ»‘åŠ¨çª—å£ç®—æ³•åŸºæœ¬åŸç†ä¸å®è·µ</a>â€”â€”ä¾‹é¢˜+æ¨¡æ¿</li><li><a href="https://blog.csdn.net/Dby_freedom/article/details/89066140" target="_blank" rel="noopener">ç®—æ³•ä¸æ•°æ®ç»“æ„ï¼ˆä¸€ï¼‰ï¼šæ»‘åŠ¨çª—å£æ³•æ€»ç»“</a>â€”â€”æ¦‚å¿µ+ä¾‹é¢˜</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;Sliding window algorithm is used to perform required operation on specific window size of given large buffer or array.æ»‘åŠ¨çª—å£ç®—æ³•
      
    
    </summary>
    
    
      <category term="æ•°æ®ç»“æ„" scheme="https://nymrli.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>[ç¿»è¯‘]è®¾è®¡Pastebin.com(or Bit.ly)ç³»ç»Ÿ</title>
    <link href="https://nymrli.top/2022/04/05/%E7%BF%BB%E8%AF%91-%E8%AE%BE%E8%AE%A1Pastebin-com-or-Bit-ly-%E7%B3%BB%E7%BB%9F/"/>
    <id>https://nymrli.top/2022/04/05/ç¿»è¯‘-è®¾è®¡Pastebin-com-or-Bit-ly-ç³»ç»Ÿ/</id>
    <published>2022-04-05T09:34:50.000Z</published>
    <updated>2022-04-05T11:30:43.887Z</updated>
    
    <content type="html"><![CDATA[<h1 id="è®¾è®¡pastebincom"><a class="markdownIt-Anchor" href="#è®¾è®¡pastebincom"></a> <a href="http://xn--Pastebin-xx5xji.com" target="_blank" rel="noopener">è®¾è®¡Pastebin.com</a> (or <a href="http://Bit.ly" target="_blank" rel="noopener">Bit.ly</a>)ç³»ç»Ÿ</h1><p>æ³¨ï¼šæœ¬æ–‡æ¡£ç›´æ¥é“¾æ¥åˆ°ç³»ç»Ÿè®¾è®¡ä¸»é¢˜ä¸­çš„ç›¸å…³é¢†åŸŸï¼Œä»¥é¿å…é‡å¤ã€‚è¯·å‚è€ƒé“¾æ¥å†…å®¹æ¥äº†è§£æ€»ä½“çš„è®¨è®ºè¦ç‚¹ã€åˆ©å¼Šæƒè¡¡ä»¥åŠæ›¿ä»£æ–¹æ¡ˆã€‚</p><p>**è®¾è®¡<a href="https://www.baidu.com/s?wd=bit.ly&amp;rsv_spt=1&amp;rsv_iqid=0x97c01cce002338c1&amp;issp=1&amp;f=8&amp;rsv_bp=1&amp;rsv_idx=2&amp;ie=utf-8&amp;rqlang=cn&amp;tn=baiduhome_pg&amp;rsv_enter=0&amp;rsv_dl=tb&amp;oq=bit.ly&amp;rsv_btype=t&amp;rsv_t=e8762eu5%2B6DVVq%2BNlFhLqorUp3QSNtSJ5UjqS%2FLmbVRjAw3gHUzdZ5VW%2F%2BJORNxD3z1%2F&amp;rsv_sug3=7&amp;rsv_sug1=7&amp;rsv_sug7=100&amp;rsv_pq=ce550397001e64ee&amp;prefixsug=bit.ly&amp;rsp=1&amp;rsv_sug4=5598" target="_blank" rel="noopener">Bit.ly</a>**æ˜¯ä¸€ä¸ªç±»ä¼¼çš„é—®é¢˜ã€‚åªæ˜¯Pastebinè¿˜å…·æœ‰ä¸€ä¸ªé¢å¤–çš„åŠŸèƒ½ï¼Œå³å­˜å‚¨ç²˜è´´çš„å†…å®¹ï¼Œè€Œä¸æ˜¯åŸå§‹çš„æœªç¼©çŸ­è¿‡çš„urlã€‚</p><h2 id="ç¬¬ä¸€æ­¥åˆ—å‡ºç”¨ä¾‹å’Œçº¦æŸçš„å¤§çº²"><a class="markdownIt-Anchor" href="#ç¬¬ä¸€æ­¥åˆ—å‡ºç”¨ä¾‹å’Œçº¦æŸçš„å¤§çº²"></a> ç¬¬ä¸€æ­¥ï¼šåˆ—å‡ºç”¨ä¾‹å’Œçº¦æŸçš„å¤§çº²</h2><blockquote><p>ç¡®å®šåº”ç”¨åœºæ™¯ï¼šæ”¶é›†éœ€æ±‚å’ŒèŒƒå›´é—®é¢˜ï¼›æé—®æ¥å¼„æ¸…é˜æ˜ç”¨ä¾‹å’Œçº¦æŸï¼Œè®¨è®ºæ¥ä½œå‡ºå‡è®¾ã€‚</p></blockquote><p>åœ¨æ²¡æœ‰é¢è¯•å®˜æ¥é˜æ˜æ¸…è¿™äº›é—®é¢˜çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†å®šä¹‰ä¸€äº›ç”¨ä¾‹å’Œçº¦æŸã€‚</p><h3 id="ç”¨ä¾‹"><a class="markdownIt-Anchor" href="#ç”¨ä¾‹"></a> ç”¨ä¾‹</h3><h4 id="æˆ‘ä»¬å°†ç¡®å®šé—®é¢˜çš„èŒƒå›´åªå¤„ç†ä»¥ä¸‹ä½¿ç”¨æƒ…å†µ"><a class="markdownIt-Anchor" href="#æˆ‘ä»¬å°†ç¡®å®šé—®é¢˜çš„èŒƒå›´åªå¤„ç†ä»¥ä¸‹ä½¿ç”¨æƒ…å†µ"></a> æˆ‘ä»¬å°†ç¡®å®šé—®é¢˜çš„èŒƒå›´ï¼Œåªå¤„ç†ä»¥ä¸‹ä½¿ç”¨æƒ…å†µ</h4><ul><li><strong>ç”¨æˆ·</strong>ï¼šè¾“å…¥ä¸€æ®µæ–‡æœ¬åï¼Œè·å¾—ä¸€ä¸ªéšæœºç”Ÿæˆçš„é“¾æ¥<ul><li>è¿‡æœŸ<ul><li>é»˜è®¤è®¾ç½®æ˜¯ä¸ä¼šè¿‡æœŸçš„</li><li>å¯ä»¥é€‰æ‹©ä¸€ä¸ªæ—¶é—´è¿‡æœŸ</li></ul></li></ul></li><li><strong>ç”¨æˆ·</strong>ï¼šè¾“å…¥ä¸€ä¸ªpasteçš„urlé“¾æ¥ï¼Œä¾¿å¯ä»¥çœ‹åˆ°å†…å®¹</li><li><strong>ç”¨æˆ·</strong>ï¼šæ˜¯åŒ¿åçš„</li><li><strong>æœåŠ¡</strong>ï¼šå¯ä»¥è¿½è¸ªå¾—åˆ°é¡µé¢åˆ†æç»“æœ<ul><li>æ¯æœˆçš„è®¿é—®æ•°æ®</li></ul></li><li><strong>æœåŠ¡</strong>ï¼šåˆ é™¤è¿‡æœŸçš„pastenå†…å®¹</li><li><strong>æœåŠ¡</strong>ï¼šå…·æœ‰é«˜å¯ç”¨æ€§</li></ul><h4 id="èŒƒå›´ä¹‹å¤–"><a class="markdownIt-Anchor" href="#èŒƒå›´ä¹‹å¤–"></a> èŒƒå›´ä¹‹å¤–</h4><ul><li><strong>ç”¨æˆ·</strong>ï¼šæ³¨å†Œä¸€ä¸ªå¸æˆ·<ul><li><strong>ç”¨æˆ·</strong>ï¼šè®¤è¯é‚®ç®±</li></ul></li><li><strong>ç”¨æˆ·</strong>ï¼šç™»å½•æ³¨å†Œè´¦æˆ·<ul><li><strong>ç”¨æˆ·</strong>ï¼šç¼–è¾‘æ–‡æ¡£</li></ul></li><li><strong>ç”¨æˆ·</strong>ï¼šå¯ä»¥è®¾ç½®å¯è§æ€§</li><li><strong>ç”¨æˆ·</strong>ï¼šå¯ä»¥è®¾ç½®çŸ­é“¾æ¥</li></ul><h3 id="çº¦æŸå’Œå‡è®¾"><a class="markdownIt-Anchor" href="#çº¦æŸå’Œå‡è®¾"></a> çº¦æŸå’Œå‡è®¾</h3><h4 id="æƒ…å†µå‡è®¾"><a class="markdownIt-Anchor" href="#æƒ…å†µå‡è®¾"></a> æƒ…å†µå‡è®¾</h4><ul><li>æµé‡ä¸æ˜¯å‡åŒ€åˆ†å¸ƒçš„</li><li>äº§ç”Ÿä¸€ä¸ªçŸ­é“¾æ¥åº”è¯¥æ˜¯å¿«é€Ÿçš„</li><li>ç²˜è´´pasteå†…å®¹åªèƒ½æ˜¯æ–‡æœ¬</li><li>é¡µé¢æµè§ˆåˆ†æä¸éœ€è¦æ˜¯å®æ—¶çš„</li><li>1000ä¸‡ç”¨æˆ·</li><li>æ¯æœˆ1000ä¸‡æ¬¡çš„ç²˜è´´pasteå†™å…¥é‡</li><li>æ¯æœˆ1äº¿æ¬¡çš„ç²˜è´´pasteé˜…è¯»</li><li>10:1çš„è¯»ä¸å†™æ¯”ä¾‹</li></ul><h3 id="è®¡ç®—ç”¨é‡"><a class="markdownIt-Anchor" href="#è®¡ç®—ç”¨é‡"></a> è®¡ç®—ç”¨é‡</h3><p><strong>å‘ä½ çš„é¢è¯•å®˜è¯´æ˜ä½ æ˜¯å¦åº”è¯¥å¯¹ç”¨é‡è¿›è¡Œç²—ç•¥ä¼°è®¡ã€‚</strong></p><ul><li>æ¯æ¬¡ç²˜è´´pasteçš„å¤§å°<ul><li>æ¯æ¬¡ç²˜è´´çš„å†…å®¹ä¸º1KB</li><li><code>shortlink</code>- 7 bytes</li><li><code>expiration_length_in_minutes</code> - 4 bytes</li><li><code>created_at</code> - 5 bytes</li><li><code>paste_path</code> - 255 bytes</li><li><code>total</code> = ~1.27 KB</li></ul></li><li>æ¯æœˆ12.7GBçš„æ–°ç²˜è´´å†…å®¹<ul><li>æ¯ä¸ª1.27 KB çš„ç²˜è´´paste * æ¯æœˆ1000ä¸‡ä¸ªpaste</li><li>3å¹´å†…çº¦æœ‰450GBçš„æ–°ç²˜è´´å†…å®¹</li><li>3å¹´å†…æœ‰3.6äº¿ä¸ªçŸ­é“¾æ¥</li><li>å‡è®¾å¤§å¤šæ•°æ˜¯æ–°çš„ç²˜è´´å†…å®¹ï¼Œè€Œä¸æ˜¯å¯¹ç°æœ‰å†…å®¹çš„æ›´æ–°</li></ul></li><li>å¹³å‡æ¯ç§’é’Ÿå†™4æ¬¡ç²˜è´´å†…å®¹</li><li>å¹³å‡æ¯ç§’40æ¬¡è¯»å–è¯·æ±‚</li></ul><p>æ–¹ä¾¿çš„è½¬æ¢æŒ‡å—ï¼š</p><ul><li>æ¯æœˆ250ä¸‡ç§’</li><li>æ¯ç§’1ä¸ªè¯·æ±‚=æ¯æœˆ250ä¸‡ä¸ªè¯·æ±‚</li><li>æ¯ç§’40ä¸ªè¯·æ±‚=æ¯æœˆ1äº¿ä¸ªè¯·æ±‚</li><li>æ¯ç§’400ä¸ªè¯·æ±‚=æ¯æœˆ10äº¿ä¸ªè¯·æ±‚</li></ul><h2 id="ç¬¬äºŒæ­¥-åˆ›å»ºä¸€ä¸ªé«˜æ°´å¹³çš„è®¾è®¡"><a class="markdownIt-Anchor" href="#ç¬¬äºŒæ­¥-åˆ›å»ºä¸€ä¸ªé«˜æ°´å¹³çš„è®¾è®¡"></a> ç¬¬äºŒæ­¥: åˆ›å»ºä¸€ä¸ªé«˜æ°´å¹³çš„è®¾è®¡</h2><blockquote><p>å‹¾å‹’å‡ºä¸€ä¸ªåŒ…å«æ‰€æœ‰é‡è¦ç»„æˆéƒ¨åˆ†çš„é«˜å±‚æ¬¡è®¾è®¡ã€‚</p></blockquote><p><img src="http://i.imgur.com/BKsBnmG.png" alt="Imgur"></p><h2 id="ç¬¬ä¸‰æ­¥è®¾è®¡æ ¸å¿ƒç»„ä»¶"><a class="markdownIt-Anchor" href="#ç¬¬ä¸‰æ­¥è®¾è®¡æ ¸å¿ƒç»„ä»¶"></a> ç¬¬ä¸‰æ­¥ï¼šè®¾è®¡æ ¸å¿ƒç»„ä»¶</h2><p><strong>ç”¨ä¾‹: ç”¨æˆ·è¾“å…¥ä¸€æ®µæ–‡æœ¬åï¼Œè·å¾—ä¸€ä¸ªéšæœºç”Ÿæˆçš„é“¾æ¥</strong></p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ª<a href="https://github.com/donnemartin/system-design-primer#relational-database-management-system-rdbms" target="_blank" rel="noopener">å…³ç³»æ•°æ®åº“</a>ä½œä¸ºä¸€ä¸ªå¤§çš„å“ˆå¸Œè¡¨ï¼Œå°†ç”Ÿæˆçš„urlæ˜ å°„åˆ°æ–‡ä»¶æœåŠ¡å™¨å’ŒåŒ…å«ç²˜è´´pasteæ–‡ä»¶çš„è·¯å¾„ã€‚</p><p>æˆ‘ä»¬ä¸é‡‡ç”¨ç®¡ç†æ–‡ä»¶æœåŠ¡å™¨çš„æ–¹å¼ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ªå¯ç®¡ç†çš„<strong>å¯¹è±¡å­˜å‚¨</strong>ï¼Œå¦‚Amazon S3æˆ–<a href="https://github.com/donnemartin/system-design-primer#document-store" target="_blank" rel="noopener">NoSQLæ–‡æ¡£å­˜å‚¨</a>ã€‚</p><p>ä½œä¸ºä¸€ä¸ªå¤§å‹å“ˆå¸Œè¡¨çš„å…³ç³»æ•°æ®åº“çš„æ›¿ä»£å“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<a href="https://github.com/donnemartin/system-design-primer#key-value-store" target="_blank" rel="noopener">NoSQLé”®å€¼å­˜å‚¨</a>ã€‚æˆ‘ä»¬åº”è¯¥è®¨è®º<a href="https://github.com/donnemartin/system-design-primer#sql-or-nosql" target="_blank" rel="noopener">é€‰æ‹©SQLæˆ–NoSQLä¹‹é—´çš„åˆ©å¼Šæƒè¡¡</a>ã€‚ä¸‹é¢çš„è®¨è®ºä½¿ç”¨äº†å…³ç³»å‹æ•°æ®åº“çš„æ–¹æ³•ã€‚</p><ul><li><strong>å®¢æˆ·ç«¯</strong>å‘ä½œä¸ºåå‘ä»£ç†çš„<strong>webæœåŠ¡å™¨</strong>å‘é€ä¸€ä¸ªåˆ›å»ºç²˜è´´pasteè¯·æ±‚</li><li><strong>webæœåŠ¡å™¨</strong>å°†è¯¥è¯·æ±‚è½¬å‘ç»™ <strong>Write API æœåŠ¡å™¨</strong></li><li><strong>Write API æœåŠ¡å™¨</strong>åšä»¥ä¸‹å·¥ä½œã€‚<ul><li>ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„url<ul><li>é€šè¿‡æŸ¥çœ‹<strong>SQLæ•°æ®åº“</strong>æ˜¯å¦æœ‰é‡å¤çš„ç½‘å€ï¼Œæ¥æ£€æŸ¥è¯¥ç½‘å€æ˜¯å¦æ˜¯å”¯ä¸€çš„ã€‚</li><li>å¦‚æœurlä¸æ˜¯å”¯ä¸€çš„ï¼Œå®ƒå°†ç”Ÿæˆå¦ä¸€ä¸ªç½‘å€</li><li>å¦‚æœæˆ‘ä»¬æ”¯æŒè‡ªå®šä¹‰urlï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç”¨æˆ·æä¾›çš„urlï¼ˆä¹Ÿæ£€æŸ¥æ˜¯å¦æœ‰é‡å¤çš„ï¼‰ã€‚</li></ul></li><li>ä¿å­˜åˆ°<strong>SQLæ•°æ®åº“</strong>ä¸­çš„<code>ç²˜è´´paste</code>è¡¨</li><li>å°†ç²˜è´´çš„æ•°æ®ä¿å­˜åˆ°<strong>å¯¹è±¡å­˜å‚¨</strong>ä¸­</li><li>è¿”å›url</li></ul></li></ul><p><strong>ä¸ä½ çš„é¢è¯•å®˜æ˜ç¡®è¯´æ˜ä½ è¦å†™å¤šå°‘ä»£ç </strong></p><p><code>pastes</code>è¡¨çš„ç»“æ„å¯ä»¥è®¾è®¡æˆä¸‹é¢çš„æ ·å­ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">shortlink char(7) NOT NULL</span><br><span class="line">expiration_length_in_minutes int NOT NULL</span><br><span class="line">created_at datetime NOT NULL</span><br><span class="line">paste_path varchar(255) NOT NULL</span><br><span class="line">PRIMARY KEY(shortlink)</span><br></pre></td></tr></table></figure><p>å°†ä¸»é”®è®¾ç½®ä¸ºåŸºäº<code>shortlink</code>åˆ—çš„<a href="https://github.com/donnemartin/system-design-primer#use-good-indices" target="_blank" rel="noopener">ç´¢å¼•</a>ï¼Œæ•°æ®åº“ä¼šä½¿ç”¨è¿™ä¸ªç´¢å¼•æ¥å¼ºåˆ¶æ‰§è¡Œå”¯ä¸€æ€§ã€‚æˆ‘ä»¬å°†åœ¨<code>creative_at</code>ä¸Šåˆ›å»ºä¸€ä¸ªé¢å¤–çš„ç´¢å¼•ï¼Œä»¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ï¼ˆç”¨æ—¥å¿—æ—¶é—´ä»£æ›¿æ‰«ææ•´ä¸ªè¡¨ï¼‰ï¼Œå¹¶å°†æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚ä»å†…å­˜ä¸­è¿ç»­è¯»å–1MBçš„æ•°æ®éœ€è¦250å¾®ç§’ï¼Œè€Œä»SSDä¸­è¯»å–éœ€è¦4å€ï¼Œä»ç£ç›˜ä¸­è¯»å–éœ€è¦80å€çš„æ—¶é—´ã€‚<sup><a href="https://github.com/donnemartin/system-design-primer#latency-numbers-every-programmer-should-know" target="_blank" rel="noopener">1</a></sup></p><p>ä¸ºäº†ç”Ÿæˆå”¯ä¸€çš„urlï¼Œæˆ‘ä»¬å¯ä»¥:</p><ul><li>å¯¹ç”¨æˆ·çš„<code>ip_address</code> + æ—¶é—´æˆ³è¿›è¡Œ<a href="https://en.wikipedia.org/wiki/MD5" target="_blank" rel="noopener"><strong>MD5</strong></a> å“ˆå¸Œ<ul><li>MD5æ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„æ•£åˆ—å‡½æ•°ï¼Œäº§ç”Ÿä¸€ä¸ª128ä½çš„å“ˆå¸Œå€¼</li><li>MD5æ˜¯å‡åŒ€åˆ†å¸ƒçš„</li><li>å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å–éšæœºç”Ÿæˆçš„æ•°æ®çš„MD5å“ˆå¸Œå€¼</li></ul></li><li>ä½¿ç”¨<a href="https://www.kerstner.at/2012/07/shortening-strings-using-base-62-encoding/" target="_blank" rel="noopener"><strong>Base62</strong></a>å¯¹MD5å“ˆå¸Œç»“æœå€¼è¿›è¡Œç¼–ç <ul><li>Base 62 ç¼–ç å­—ç¬¦ä¸º<code>[a-zA-Z0-9]</code>ï¼Œä¸éœ€è¦è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œè¿™å¯¹Urlsæ¥è¯´å¾ˆæœ‰æ•ˆã€‚</li><li>åŸå§‹è¾“å…¥åªæœ‰ä¸€ä¸ªå“ˆå¸Œç»“æœï¼Œè€Œä¸”Base 62æ˜¯ç¡®å®šæ€§çš„ï¼ˆä¸æ¶‰åŠéšæœºæ€§ï¼‰ã€‚</li><li>Base 64 æ˜¯å¦ä¸€ç§æµè¡Œçš„ç¼–ç ï¼Œä½†ç”±äºæœ‰é¢å¤–çš„<code>+</code>å’Œ<code>/</code>å­—ç¬¦ï¼Œæ‰€ä»¥å¯¹urlsæœ‰é—®é¢˜ã€‚</li><li>ä¸‹é¢çš„<a href="http://stackoverflow.com/questions/742013/how-to-code-a-url-shortener" target="_blank" rel="noopener">Base 62ä¼ªä»£ç </a>åœ¨O(k)æ—¶é—´å†…è¿è¡Œï¼Œå…¶ä¸­k=7ã€‚</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">base_encode</span><span class="params">(num, base=<span class="number">62</span>)</span>:</span></span><br><span class="line">    digits = []</span><br><span class="line">    <span class="keyword">while</span> num &gt; <span class="number">0</span></span><br><span class="line">      remainder = modulo(num, base)</span><br><span class="line">      digits.push(remainder)</span><br><span class="line">      num = divide(num, base)</span><br><span class="line">    digits = digits.reverse</span><br></pre></td></tr></table></figure><ul><li>å–è¾“å‡ºçš„å‰7ä¸ªå­—ç¬¦ï¼Œç»“æœæ˜¯62^7ä¸ªå¯èƒ½çš„å€¼ï¼Œåº”è¯¥è¶³ä»¥å¤„ç†æˆ‘ä»¬3å¹´å†…3.6äº¿ä¸ªçŸ­é“¾æ¥çš„çº¦æŸã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url = base_encode(md5(ip_address+timestamp))[:URL_LENGTH]</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªå…¬å…±<a href="https://github.com/donnemartin/system-design-primer#representational-state-transfer-rest" target="_blank" rel="noopener"><strong>REST API</strong></a>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X POST --data <span class="string">'&#123; "expiration_length_in_minutes": "60", \</span></span><br><span class="line"><span class="string">    "paste_contents": "Hello World!" &#125;'</span> https://pastebin.com/api/v1/paste</span><br></pre></td></tr></table></figure><p>Response:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"shortlink"</span>: <span class="string">"foobar"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºå†…éƒ¨é€šä¿¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<a href="https://github.com/donnemartin/system-design-primer#remote-procedure-call-rpc" target="_blank" rel="noopener">è¿œç¨‹è¿‡ç¨‹è°ƒç”¨</a>ã€‚</p><h3 id="ç”¨ä¾‹ç”¨æˆ·è¾“å…¥ä¸€ä¸ªpaste-urlå¹¶æŸ¥çœ‹å…¶å†…å®¹"><a class="markdownIt-Anchor" href="#ç”¨ä¾‹ç”¨æˆ·è¾“å…¥ä¸€ä¸ªpaste-urlå¹¶æŸ¥çœ‹å…¶å†…å®¹"></a> ç”¨ä¾‹ï¼šç”¨æˆ·è¾“å…¥ä¸€ä¸ªpaste urlå¹¶æŸ¥çœ‹å…¶å†…å®¹</h3><ul><li><strong>å®¢æˆ·ç«¯</strong>å‘<strong>webæœåŠ¡å™¨</strong>å‘é€ä¸€ä¸ªè·å–ç²˜è´´pasteçš„è¯·æ±‚</li><li><strong>WebæœåŠ¡å™¨</strong>å°†è¯¥è¯·æ±‚è½¬å‘ç»™ <strong>Read API æœåŠ¡å™¨</strong></li><li><strong>Read APIæœåŠ¡å™¨</strong>åšä»¥ä¸‹å·¥ä½œã€‚<ul><li>æ£€æŸ¥<strong>SQLæ•°æ®åº“</strong>ä¸­ç”Ÿæˆçš„url<ul><li>å¦‚æœurlåœ¨<strong>SQLæ•°æ®åº“</strong>ä¸­ï¼Œåˆ™ä»<strong>å¯¹è±¡å­˜å‚¨</strong>ä¸­è·å–ç²˜è´´å†…å®¹</li><li>å¦åˆ™ï¼Œç»™ç”¨æˆ·è¿”å›ä¸€ä¸ªé”™è¯¯ä¿¡æ¯</li></ul></li></ul></li></ul><p>REST API:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl https://pastebin.com/api/v1/paste?shortlink=foobar</span><br></pre></td></tr></table></figure><p>Response:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"paste_contents"</span>: <span class="string">"Hello World"</span></span><br><span class="line">    <span class="string">"created_at"</span>: <span class="string">"YYYY-MM-DD HH:MM:SS"</span></span><br><span class="line">    <span class="string">"expiration_length_in_minutes"</span>: <span class="string">"60"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç”¨ä¾‹ç½‘é¡µè·Ÿè¸ªåˆ†ææœåŠ¡"><a class="markdownIt-Anchor" href="#ç”¨ä¾‹ç½‘é¡µè·Ÿè¸ªåˆ†ææœåŠ¡"></a> ç”¨ä¾‹ï¼šç½‘é¡µè·Ÿè¸ªåˆ†ææœåŠ¡</h3><p>ç”±äºå®æ—¶åˆ†æä¸æ˜¯ä¸€ä¸ªè¦æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°å¯¹<strong>WebæœåŠ¡å™¨</strong>çš„æ—¥å¿—è¿›è¡Œ <strong>MapReduce</strong> ä»¥ç”Ÿæˆç‚¹å‡»æ•°ã€‚</p><p><strong>ä¸ä½ çš„é¢è¯•å®˜æ˜ç¡®è¯´æ˜ä½ è¦å†™å¤šå°‘ä»£ç </strong>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HitCounts</span><span class="params">(MRJob)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract_url</span><span class="params">(self, line)</span>:</span></span><br><span class="line">        <span class="string">"""Extract the generated url from the log line."""</span></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract_year_month</span><span class="params">(self, line)</span>:</span></span><br><span class="line">        <span class="string">"""Return the year and month portions of the timestamp."""</span></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mapper</span><span class="params">(self, _, line)</span>:</span></span><br><span class="line">        <span class="string">"""Parse each log line, extract and transform relevant lines.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Emit key value pairs of the form:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        (2016-01, url0), 1</span></span><br><span class="line"><span class="string">        (2016-01, url0), 1</span></span><br><span class="line"><span class="string">        (2016-01, url1), 1</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        url = self.extract_url(line)</span><br><span class="line">        period = self.extract_year_month(line)</span><br><span class="line">        <span class="keyword">yield</span> (period, url), <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reducer</span><span class="params">(self, key, values)</span>:</span></span><br><span class="line">        <span class="string">"""Sum values for each key.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        (2016-01, url0), 2</span></span><br><span class="line"><span class="string">        (2016-01, url1), 1</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">yield</span> key, sum(values)</span><br></pre></td></tr></table></figure><h3 id="ç”¨ä¾‹åˆ é™¤è¿‡æœŸpasteçš„æœåŠ¡"><a class="markdownIt-Anchor" href="#ç”¨ä¾‹åˆ é™¤è¿‡æœŸpasteçš„æœåŠ¡"></a> ç”¨ä¾‹ï¼šåˆ é™¤è¿‡æœŸpasteçš„æœåŠ¡</h3><p>è¦åˆ é™¤è¿‡æœŸçš„ç²˜è´´ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ‰«æ<strong>SQLæ•°æ®åº“</strong>ä¸­æ‰€æœ‰è¿‡æœŸæ—¶é—´æˆ³å¤§äºå½“å‰æ—¶é—´æˆ³çš„æ¡ç›®ã€‚ç„¶åï¼Œæ‰€æœ‰è¿‡æœŸçš„æ¡ç›®å°†è¢«ä»è¡¨ä¸­åˆ é™¤ï¼ˆæˆ–æ ‡è®°ä¸ºè¿‡æœŸï¼‰ã€‚</p><h2 id="ç¬¬å››æ­¥æ‰©å±•è®¾è®¡"><a class="markdownIt-Anchor" href="#ç¬¬å››æ­¥æ‰©å±•è®¾è®¡"></a> ç¬¬å››æ­¥ï¼šæ‰©å±•è®¾è®¡</h2><blockquote><p>é‰´äºçº¦æŸæ¡ä»¶ï¼Œè¯†åˆ«å¹¶è§£å†³ç“¶é¢ˆé—®é¢˜ã€‚</p></blockquote><p><img src="http://i.imgur.com/4edXG0T.png" alt="Imgur"></p><p><strong>é‡è¦ï¼šä¸è¦ç®€å•åœ°ä»æœ€åˆçš„è®¾è®¡ç›´æ¥è·³åˆ°æœ€ç»ˆçš„è®¾è®¡ä¸­å»!</strong></p><p>è¯´æ˜ä½ ä¼šè¿­ä»£åœ°åšè¿™ä»¶äº‹ã€‚1) <strong>åŸºå‡†æµ‹è¯•/è´Ÿè½½æµ‹è¯•</strong>ï¼›2) <strong>å‰–æ</strong>ç“¶é¢ˆï¼›3) è§£å†³ç“¶é¢ˆé—®é¢˜ï¼ŒåŒæ—¶è¯„ä¼°æ›¿ä»£æ–¹æ¡ˆå’Œåˆ©å¼Šæƒè¡¡ï¼›4) é‡å¤ã€‚å‚çœ‹<a href="../scaling_aws/README.md">è®¾è®¡ä¸€ä¸ªå¯ä»¥åœ¨AWSä¸Šæ‰©å±•åˆ°æ•°ç™¾ä¸‡ç”¨æˆ·çš„ç³»ç»Ÿ</a>ï¼Œä½œä¸ºä¸€ä¸ªå¦‚ä½•å¯¹åˆå§‹è®¾è®¡è¿›è¡Œè¿­ä»£æ‰©å±•çš„æ ·ä¾‹ã€‚</p><p>è®¨è®ºåˆå§‹è®¾è®¡å¯èƒ½é‡åˆ°çš„ç“¶é¢ˆä»¥åŠå¦‚ä½•è§£å†³æ¯ä¸ªç“¶é¢ˆæ˜¯å¾ˆé‡è¦çš„ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡æ·»åŠ ä¸€ä¸ªå¸¦æœ‰å¤šä¸ª<strong>WebæœåŠ¡å™¨</strong>çš„<strong>è´Ÿè½½å¹³è¡¡å™¨</strong>ã€<strong>CDN</strong>ã€<strong>ä¸»ä»å¤åˆ¶</strong>ï¼Œå¯ä»¥è§£å†³å“ªäº›é—®é¢˜ï¼Ÿå„è‡ªçš„æ›¿ä»£æ–¹æ¡ˆå’Œ<strong>åˆ©å¼Šæƒè¡¡</strong>æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>æˆ‘ä»¬å°†ä»‹ç»ä¸€äº›ç»„ä»¶æ¥å®Œæˆè®¾è®¡å¹¶è§£å†³å¯æ‰©å±•æ€§é—®é¢˜ã€‚å†…éƒ¨è´Ÿè½½å‡è¡¡å™¨æ²¡æœ‰æ˜¾ç¤ºï¼Œä»¥å‡å°‘æ··ä¹±ã€‚</p><p><em>ä¸ºäº†é¿å…é‡å¤è®¨è®º</em>ï¼Œè¯·å‚è€ƒä¸‹é¢çš„<a href="https://github.com/donnemartin/system-design-primer#index-of-system-design-topics" target="_blank" rel="noopener">ç³»ç»Ÿè®¾è®¡ä¸»é¢˜</a>æ¥äº†è§£ä¸»è¦çš„è®ºæ–‡è¦ç‚¹ã€åˆ©å¼Šæƒè¡¡å’Œæ›¿ä»£æ–¹æ¡ˆã€‚</p><ul><li><a href="https://github.com/donnemartin/system-design-primer#domain-name-system" target="_blank" rel="noopener">DNS</a></li><li><a href="https://github.com/donnemartin/system-design-primer#content-delivery-network" target="_blank" rel="noopener">CDN</a></li><li><a href="https://github.com/donnemartin/system-design-primer#load-balancer" target="_blank" rel="noopener">Load balancer</a></li><li><a href="https://github.com/donnemartin/system-design-primer#horizontal-scaling" target="_blank" rel="noopener">Horizontal scaling</a></li><li><a href="https://github.com/donnemartin/system-design-primer#reverse-proxy-web-server" target="_blank" rel="noopener">Web server (reverse proxy)</a></li><li><a href="https://github.com/donnemartin/system-design-primer#application-layer" target="_blank" rel="noopener">API server (application layer)</a></li><li><a href="https://github.com/donnemartin/system-design-primer#cache" target="_blank" rel="noopener">Cache</a></li><li><a href="https://github.com/donnemartin/system-design-primer#relational-database-management-system-rdbms" target="_blank" rel="noopener">Relational database management system (RDBMS)</a></li><li><a href="https://github.com/donnemartin/system-design-primer#fail-over" target="_blank" rel="noopener">SQL write master-slave failover</a></li><li><a href="https://github.com/donnemartin/system-design-primer#master-slave-replication" target="_blank" rel="noopener">Master-slave replication</a></li><li><a href="https://github.com/donnemartin/system-design-primer#consistency-patterns" target="_blank" rel="noopener">Consistency patterns</a></li><li><a href="https://github.com/donnemartin/system-design-primer#availability-patterns" target="_blank" rel="noopener">Availability patterns</a></li></ul><p><strong>æ•°æ®åº“åˆ†æ</strong>å¯ä»¥ä½¿ç”¨æ•°æ®ä»“åº“è§£å†³æ–¹æ¡ˆï¼Œå¦‚äºšé©¬é€Š Redshift æˆ–è°·æ­Œ BigQueryã€‚</p><p>åƒäºšé©¬é€ŠS3è¿™æ ·çš„<strong>å¯¹è±¡å­˜å‚¨</strong>å¯ä»¥ä»å®¹åœ°å¤„ç†æ¯æœˆ12.7 GB çš„æ–°å†…å®¹çš„çº¦æŸã€‚</p><p>ä¸ºäº†è§£å†³æ¯ç§’40æ¬¡çš„å¹³å‡è¯»å–è¯·æ±‚ï¼ˆé«˜å³°æ—¶æ›´é«˜ï¼‰ï¼Œçƒ­é—¨å†…å®¹çš„æµé‡åº”è¯¥ç”±<strong>å†…å­˜ç¼“å­˜</strong>è€Œä¸æ˜¯æ•°æ®åº“æ¥å¤„ç†ã€‚<strong>å†…å­˜ç¼“å­˜</strong>å¯¹äºå¤„ç†åˆ†å¸ƒä¸å‡çš„æµé‡å’Œæµé‡é«˜å³°ä¹Ÿå¾ˆæœ‰ç”¨ã€‚<strong>SQL Read å¤šå‰¯æœ¬</strong>åº”è¯¥èƒ½å¤Ÿå¤„ç†ç¼“å­˜çš„ç¼ºå¤±ï¼Œåªè¦å‰¯æœ¬æ²¡æœ‰è¢«å‰¯æœ¬å†™å…¥æ‰€æ‹–ç´¯ã€‚</p><p>å¯¹äºå•ä¸ª<strong>SQL Write ä¸»ä»</strong>æ¥è¯´ï¼Œæ¯ç§’<em>å¹³å‡</em>4æ¬¡ç²˜è´´å†™ï¼ˆé«˜å³°æ—¶æ›´å¤šï¼‰åº”è¯¥æ˜¯å¯ä»¥åšåˆ°çš„ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬å°±éœ€è¦é‡‡ç”¨é¢å¤–çš„SQLæ‰©å±•æ¨¡å¼ã€‚</p><ul><li><a href="https://github.com/donnemartin/system-design-primer#federation" target="_blank" rel="noopener">Federation</a></li><li><a href="https://github.com/donnemartin/system-design-primer#sharding" target="_blank" rel="noopener">Sharding</a></li><li><a href="https://github.com/donnemartin/system-design-primer#denormalization" target="_blank" rel="noopener">Denormalization</a></li><li><a href="https://github.com/donnemartin/system-design-primer#sql-tuning" target="_blank" rel="noopener">SQL Tuning</a></li></ul><p>æˆ‘ä»¬è¿˜åº”è¯¥è€ƒè™‘å°†ä¸€äº›æ•°æ®è½¬ç§»åˆ°<strong>NoSQLæ•°æ®åº“</strong>ã€‚</p><h2 id="é¢å¤–çš„è®¨è®ºè¦ç‚¹"><a class="markdownIt-Anchor" href="#é¢å¤–çš„è®¨è®ºè¦ç‚¹"></a> é¢å¤–çš„è®¨è®ºè¦ç‚¹</h2><blockquote><p>æ ¹æ®é—®é¢˜çš„èŒƒå›´å’Œå‰©ä½™æ—¶é—´ï¼Œå¯ä»¥æ·±å…¥ç ”ç©¶å…¶ä»–çš„è¯é¢˜ã€‚</p></blockquote><h4 id="nosql"><a class="markdownIt-Anchor" href="#nosql"></a> NoSQL</h4><ul><li><a href="https://github.com/donnemartin/system-design-primer#key-value-store" target="_blank" rel="noopener">Key-value store</a></li><li><a href="https://github.com/donnemartin/system-design-primer#document-store" target="_blank" rel="noopener">Document store</a></li><li><a href="https://github.com/donnemartin/system-design-primer#wide-column-store" target="_blank" rel="noopener">Wide column store</a></li><li><a href="https://github.com/donnemartin/system-design-primer#graph-database" target="_blank" rel="noopener">Graph database</a></li><li><a href="https://github.com/donnemartin/system-design-primer#sql-or-nosql" target="_blank" rel="noopener">SQL vs NoSQL</a></li></ul><h3 id="ç¼“å­˜"><a class="markdownIt-Anchor" href="#ç¼“å­˜"></a> ç¼“å­˜</h3><ul><li>ç¼“å­˜åˆ°å“ªé‡Œï¼Ÿ<ul><li><a href="https://github.com/donnemartin/system-design-primer#client-caching" target="_blank" rel="noopener">Client caching</a></li><li><a href="https://github.com/donnemartin/system-design-primer#cdn-caching" target="_blank" rel="noopener">CDN caching</a></li><li><a href="https://github.com/donnemartin/system-design-primer#web-server-caching" target="_blank" rel="noopener">Web server caching</a></li><li><a href="https://github.com/donnemartin/system-design-primer#database-caching" target="_blank" rel="noopener">Database caching</a></li><li><a href="https://github.com/donnemartin/system-design-primer#application-caching" target="_blank" rel="noopener">Application caching</a></li></ul></li><li>ç¼“å­˜ä»€ä¹ˆï¼Ÿ<ul><li><a href="https://github.com/donnemartin/system-design-primer#caching-at-the-database-query-level" target="_blank" rel="noopener">Caching at the database query level</a></li><li><a href="https://github.com/donnemartin/system-design-primer#caching-at-the-object-level" target="_blank" rel="noopener">Caching at the object level</a></li></ul></li><li>ä½•æ—¶æ›´æ–°ç¼“å­˜ï¼Ÿ<ul><li><a href="https://github.com/donnemartin/system-design-primer#cache-aside" target="_blank" rel="noopener">Cache-aside</a></li><li><a href="https://github.com/donnemartin/system-design-primer#write-through" target="_blank" rel="noopener">Write-through</a></li><li><a href="https://github.com/donnemartin/system-design-primer#write-behind-write-back" target="_blank" rel="noopener">Write-behind (write-back)</a></li><li><a href="https://github.com/donnemartin/system-design-primer#refresh-ahead" target="_blank" rel="noopener">Refresh ahead</a></li></ul></li></ul><h3 id="å¼‚æ­¥æ€§å’Œå¾®æœåŠ¡"><a class="markdownIt-Anchor" href="#å¼‚æ­¥æ€§å’Œå¾®æœåŠ¡"></a> å¼‚æ­¥æ€§å’Œå¾®æœåŠ¡</h3><ul><li><a href="https://github.com/donnemartin/system-design-primer#message-queues" target="_blank" rel="noopener">Message queues</a></li><li><a href="https://github.com/donnemartin/system-design-primer#task-queues" target="_blank" rel="noopener">Task queues</a></li><li><a href="https://github.com/donnemartin/system-design-primer#back-pressure" target="_blank" rel="noopener">Back pressure</a></li><li><a href="https://github.com/donnemartin/system-design-primer#microservices" target="_blank" rel="noopener">Microservices</a></li></ul><h3 id="é€šä¿¡"><a class="markdownIt-Anchor" href="#é€šä¿¡"></a> é€šä¿¡</h3><ul><li>å¯¹åˆ©å¼Šæƒè¡¡è¿›è¡Œè®¨è®ºï¼š<ul><li>ä¸å®¢æˆ·çš„å¤–éƒ¨é€šä¿¡ - <a href="https://github.com/donnemartin/system-design-primer#representational-state-transfer-rest" target="_blank" rel="noopener">HTTP APIs following REST</a><ul><li>å†…éƒ¨é€šä¿¡ - <a href="https://github.com/donnemartin/system-design-primer#remote-procedure-call-rpc" target="_blank" rel="noopener">RPC</a></li></ul></li></ul></li><li><a href="https://github.com/donnemartin/system-design-primer#service-discovery" target="_blank" rel="noopener">æœåŠ¡å‘ç°</a></li></ul><h3 id="å®‰å…¨"><a class="markdownIt-Anchor" href="#å®‰å…¨"></a> å®‰å…¨</h3><p>è§ <a href="https://github.com/donnemartin/system-design-primer#security" target="_blank" rel="noopener">security section</a>.</p><h3 id="å»¶è¿Ÿæ•°"><a class="markdownIt-Anchor" href="#å»¶è¿Ÿæ•°"></a> å»¶è¿Ÿæ•°</h3><p>è§ <a href="https://github.com/donnemartin/system-design-primer#latency-numbers-every-programmer-should-know" target="_blank" rel="noopener">æ¯ä¸ªç¨‹åºå‘˜åº”è¯¥çŸ¥é“çš„å»¶è¿Ÿæ•°å­—</a>ã€‚</p><h3 id="æŒç»­æ¨è¿›"><a class="markdownIt-Anchor" href="#æŒç»­æ¨è¿›"></a> æŒç»­æ¨è¿›</h3><ul><li>ç»§ç»­å¯¹ä½ çš„ç³»ç»Ÿè¿›è¡ŒåŸºå‡†æµ‹è¯•å’Œç›‘æµ‹ï¼Œä»¥è§£å†³å‡ºç°çš„ç“¶é¢ˆé—®é¢˜</li><li>æ‰©å±•æ˜¯ä¸€ä¸ªåå¤çš„è¿‡ç¨‹</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;è®¾è®¡pastebincom&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#è®¾è®¡pastebincom&quot;&gt;&lt;/a&gt; &lt;a href=&quot;http://xn--Pastebin-xx5xji.com&quot; target=&quot;_blank&quot; rel=
      
    
    </summary>
    
    
      <category term="ç¿»è¯‘" scheme="https://nymrli.top/tags/%E7%BF%BB%E8%AF%91/"/>
    
      <category term="ç³»ç»Ÿè®¾è®¡" scheme="https://nymrli.top/tags/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ç†äº†ä¸€å¤©å½»åº•å¼„æ‡‚å…ƒç±»â€”â€”åˆ†äº«ç»™ä½ ä¸€èµ·å¼„æ‡‚</title>
    <link href="https://nymrli.top/2022/04/05/%E7%90%86%E4%BA%86%E4%B8%80%E5%A4%A9%E5%BD%BB%E5%BA%95%E5%BC%84%E6%87%82%E5%85%83%E7%B1%BB%E2%80%94%E2%80%94%E5%88%86%E4%BA%AB%E7%BB%99%E4%BD%A0%E4%B8%80%E8%B5%B7%E5%BC%84%E6%87%82/"/>
    <id>https://nymrli.top/2022/04/05/ç†äº†ä¸€å¤©å½»åº•å¼„æ‡‚å…ƒç±»â€”â€”åˆ†äº«ç»™ä½ ä¸€èµ·å¼„æ‡‚/</id>
    <published>2022-04-05T05:26:39.000Z</published>
    <updated>2022-04-05T05:42:12.847Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™æ˜¯ä¸€ä¸ªåœ¨çœ‹å¼€æºä»£ç æ—¶é…åˆ°äº†å•ä¾‹å…ƒç±»å†™æ³•åçš„ä¸€ä¸ªåŸç†è´´ï¼Œå¯ä»¥å¸®ä½ å½»åº•å¼„æ¸…å…ƒç±»ã€ä»¥åŠ<code>__new__</code>å’Œ<code>__call__</code>ï¼Œç›¸ä¿¡æˆ‘ï¼Œçœ‹å®Œä½ ç»å¯¹ä¼šæœ‰æ”¶è·ã€‚</p><p>é¦–å…ˆï¼Œå…³äºå…ƒç±»çš„ç»“è®ºè¯´åœ¨å‰å¤´ï¼Œå…ˆæœ‰ä¸ªå°è±¡â€”â€”<strong>å°æ€»ç»“</strong>ï¼š</p><ul><li>ç°åœ¨æˆ‘ä»¬èƒ½çŸ¥é“ä¸ºä»€ä¹ˆå…ƒç±»å¿…é¡»ç»§æ‰¿typeäº†ï¼šå› ä¸ºæˆ‘ä»¬å®ä¾‹åŒ–å¯¹è±¡<code>Foo(xxx)</code>æ—¶è°ƒç”¨äº†<code>type.__call__</code>,è€Œ<code>type.__call__</code>åˆä¼šè°ƒç”¨<code>type.__new__</code>å› æ­¤å¦‚æœtypeå­ç±»é‡å†™å®ç°äº†<code>__new__</code>ï¼ˆè¿”å›çš„ç±»å®ä¾‹å¯¹è±¡çš„ç±»å‹ä½œæ§åˆ¶ï¼‰ã€<code>__call__</code>ï¼ˆå¯¹å®ä¾‹åŒ–çš„æµç¨‹åšæ§åˆ¶ï¼‰ï¼Œåˆ™å¯ä»¥å¯¹<strong>ç±»å¯¹è±¡çš„ç±»å‹å’Œç±»å±æ€§</strong>èµ·åˆ°è‡ªå®šä¹‰çš„åŠŸèƒ½ï¼Œè€Œé‡å†™å°±å¿…é¡»ç»§æ‰¿type=&gt;éœ€è¦å…ƒç±»å¿…é¡»ç»§æ‰¿type</li><li>æ‰€ä»¥æŒ‰ç…§ä¸Šè¿°çš„é€»è¾‘ï¼Œå¦‚æœå®šä¹‰äº†ä¸€ä¸ªå…ƒç±»è®©è‡ªå®šä¹‰ç±»ç”¨çš„è¯<code>class Foo(metaclass=MyMetaClass)</code>ï¼Œåœ¨å…¶å®ä¾‹åŒ–è¿‡ç¨‹ä¸­<code>Foo()</code>ä¼šç›´æ¥è°ƒç”¨é‡å†™åçš„<code>MyMetaClass.__call__</code>ï¼Œè€Œåªè¦è®°ä½åœ¨<code>MyMetaClass.__call__</code>ä¸­ä½¿ç”¨åˆ°<code>return super(Singleton, cls).__call__(*args, **kwargs)</code>å°±å¯ä»¥æŠŠ<code>type.__call__</code>ç”Ÿæˆçš„å®ä¾‹è¿”å›å•¦ã€‚æ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ<u>ç¼–å†™å…ƒç±»ï¼Œä¸€èˆ¬éƒ½æ˜¯ç»§æ‰¿äº†typeï¼Œç„¶åæ ¹æ®æƒ³æ§åˆ¶å®ä¾‹åŒ–æµç¨‹å°±é‡å†™<code>__call__</code>æ–¹æ³•ï¼Œæƒ³æ·»åŠ å±æ€§å°±é‡å†™<code>__new__</code>æ–¹æ³•å°±è¡Œäº†ã€‚</u></li><li><strong>â˜…å…ƒç±»äº§ç”Ÿå½±å“çš„æ—¶é—´ç‚¹æ˜¯åœ¨å®ä¾‹åŒ–çš„æ—¶å€™</strong></li></ul></blockquote><p>çœ‹å¼€æºä»£ç æ—¶ï¼Œçœ‹åˆ°äº†ä¸‹é¢ä¸€æ®µä»£ç ï¼Œäºæ˜¯å¯¹withMetaclassäº§ç”Ÿäº†å¥½å¥‡ï¼Œç»è¿‡äº†è§£å‘ç°å…¶ä½œç”¨æ˜¯sixå¯¹python2å’Œpython3ä½¿ç”¨å…ƒç±»å…¼å®¹çš„å†™æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python2å’Œ3å…¼å®¹ä½¿ç”¨å…ƒç±»å†™æ³•</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConfigHandler</span><span class="params">(withMetaclass<span class="params">(Singleton)</span>)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œä¸Šè¿°ä»£ç åœ¨Python3ä¸­ç›¸å½“äº</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python3å…ƒç±»ä½¿ç”¨å†™æ³•</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConfigHandler</span><span class="params">(metaclass=Singleton)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œé—®é¢˜æ¥äº†ï¼ŒwithMetaclassåˆ°åº•æ˜¯æ€ä¹ˆå®ç°å…¼å®¹çš„å‘¢ï¼Ÿä¸‹é¢æ˜¯å…¶å®ç°ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">withMetaclass</span><span class="params">(meta, *bases)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MetaClass</span><span class="params">(meta)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, name, this_bases, d)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> meta(name, bases, d)</span><br><span class="line">    <span class="keyword">return</span> type.__new__(MetaClass, <span class="string">'temporary_class'</span>, (), &#123;&#125;)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å…¶ä¸­å‡ºç°äº†ä¸å°‘æˆ‘ä»¬å¾ˆå°‘çœ‹åˆ°çš„ä½¿ç”¨æ–¹æ³•ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±ä»”ç»†çš„å­¦ä¹ ä¸Šè¿°å†™æ³•ä¸ºä»€ä¹ˆå¯ä»¥æˆåŠŸã€‚</p><p>å…ƒç±»ä½¿ç”¨å¯ä»¥å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/49158035" target="_blank" rel="noopener">Python3 å…ƒç±»ï¼ˆmetaclassï¼‰</a></p><h3 id="é¢„ç½®çŸ¥è¯†typeå’Œobject"><a class="markdownIt-Anchor" href="#é¢„ç½®çŸ¥è¯†typeå’Œobject"></a> é¢„ç½®çŸ¥è¯†ï¼štypeå’Œobject</h3><blockquote><p>object å’Œ typeçš„å…³ç³»å¾ˆåƒé¸¡å’Œè›‹çš„å…³ç³»ï¼Œå…ˆæœ‰objectè¿˜æ˜¯å…ˆæœ‰typeæ²¡æ³•è¯´ï¼Œobejctå’Œtypeæ˜¯å…±ç”Ÿçš„å…³ç³»ï¼Œå¿…é¡»åŒæ—¶å‡ºç°çš„ã€‚</p><p>è®°ä½ä¸€ç‚¹ï¼š<strong>åœ¨Pythoné‡Œé¢ï¼Œæ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯å¯¹è±¡çš„æ¦‚å¿µ</strong>ï¼Œå³åŒ…æ‹¬ç±»ï¼ˆç±»æ˜¯typeçš„å®ä¾‹å¯¹è±¡ï¼‰</p></blockquote><p>æœ€é‡è¦çš„ä¸¤ç‚¹</p><ul><li>objectç±»æ˜¯æ‰€æœ‰ç±»çš„è¶…ç±»ï¼ˆä¹Ÿæ˜¯typeç±»çš„çˆ¶ç±»ï¼‰</li><li>typeæ˜¯æ‰€æœ‰ç±»çš„ç±»ï¼ˆç±»å‹ï¼Œæ‰€æœ‰ç±»éƒ½æ˜¯typeçš„å®ä¾‹å¯¹è±¡ï¼Œobject<u>ç±»å‹</u>ä¹Ÿæ˜¯typeçš„å®ä¾‹å¯¹è±¡ï¼›type åˆ›å»ºçš„å¯¹è±¡æ‹¥æœ‰åˆ›å»ºå¯¹è±¡çš„èƒ½åŠ›(ä¹Ÿå°±æ˜¯ç±»)ï¼‰â€“&gt;æ˜¯æ‰€æœ‰ç±»çš„å…ƒç±»</li></ul><p>æ­¤å¤–ï¼š</p><ul><li>typeæ˜¯æ‰€æœ‰<strong>å…ƒç±»</strong>çš„çˆ¶äº²ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<strong>ç»§æ‰¿typeæ¥åˆ›å»ºå…ƒç±»</strong>ï¼ˆé€šè¿‡é‡å†™<code>type.__new__</code>å’Œ<code>type.__call__</code>æ¥æ‹¦æˆªè‡ªå®šä¹‰ç±»çš„åˆ›å»ºè¿‡ç¨‹ï¼‰ã€‚</li><li>objectæ˜¯æ‰€æœ‰ç±»çš„çˆ¶äº²ã€‚</li><li>å®ä¾‹æ˜¯å¯¹è±¡å…³ç³»é“¾çš„æœ«ç«¯ï¼Œä¸èƒ½å†è¢«å­ç±»åŒ–å’Œå®ä¾‹åŒ–ã€‚</li></ul><p>äº†è§£åˆ°è¿™äº›å…³é”®çš„ç‚¹åï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ä»£ç ä¸­å‡ºç°çš„ä¸€äº›å†…å®¹ï¼š</p><h3 id="__new__"><a class="markdownIt-Anchor" href="#__new__"></a> <code>__new__</code></h3><blockquote><p><code>__new__()</code> æ˜¯ä¸€ç§è´Ÿè´£<strong>åˆ›å»ºç±»å®ä¾‹</strong>çš„<strong>é™æ€æ–¹æ³•</strong>ï¼Œå®ƒæ— éœ€ä½¿ç”¨ staticmethod è£…é¥°å™¨ä¿®é¥°ï¼Œä¸”è¯¥æ–¹æ³•ä¼šä¼˜å…ˆ <code>__init__()</code> åˆå§‹åŒ–æ–¹æ³•è¢«è°ƒç”¨ã€‚</p></blockquote><p><code>__new__()</code>é€šå¸¸ä¼šè¿”å›è¯¥ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œä½†æœ‰æ—¶ä¹Ÿå¯èƒ½ä¼šè¿”å›å…¶ä»–ç±»çš„å®ä¾‹ï¼Œå…¶<code>super().__new__(cls)</code>ä¸­ä¼šè°ƒç”¨<code>object.__init__</code>æ¥<code>Create and return a new object.</code>ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡æ”¹å†™å­ç±»çš„<code>__new__</code>å¯ä»¥æ·»åŠ ä¸€äº›é€»è¾‘æ¥æ§åˆ¶å®ä¾‹çš„äº§ç”Ÿï¼Œç„¶åå†é€šè¿‡<code>super().__new__(cls)</code>æ¥ç”Ÿæˆä¸€ä¸ªinstanceå¹¶è¿”å›ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">demoClass</span>:</span></span><br><span class="line">    instances_created = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="comment"># __new__(): &lt;class '__main__.demoClass'&gt; ('abc',) &#123;&#125;</span></span><br><span class="line">        print(<span class="string">"__new__():"</span>, cls, args, kwargs)</span><br><span class="line">        <span class="comment"># 1. é€šè¿‡çˆ¶ç±»__new__ç”Ÿæˆä¸€ä¸ªå®ä¾‹: è°ƒç”¨çˆ¶ç±»object.__new__ç”Ÿæˆå®ä¾‹(Create and return a new object.) </span></span><br><span class="line">        instance = super().__new__(cls)</span><br><span class="line">        <span class="comment"># 2. è‡ªå·±é‡å†™è¦å®ç°çš„é€»è¾‘</span></span><br><span class="line">        instance.number = cls.instances_created</span><br><span class="line">        cls.instances_created += <span class="number">1</span></span><br><span class="line">        <span class="comment"># 3. å°†çˆ¶ç±»ç”Ÿæˆçš„å®ä¾‹è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> instance</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, attribute)</span>:</span></span><br><span class="line">        <span class="comment"># __init__(): &lt;__main__.demoClass object at 0x00000185A6466EB0&gt; abc</span></span><br><span class="line">        print(<span class="string">"__init__():"</span>, self, attribute)</span><br><span class="line">        self.attribute = attribute</span><br><span class="line"></span><br><span class="line">test1 = demoClass(<span class="string">"abc"</span>)</span><br><span class="line">test2 = demoClass(<span class="string">"xyz"</span>)</span><br><span class="line">print(test1.number, test1.instances_created)</span><br><span class="line">print(test2.number, test2.instances_created)</span><br></pre></td></tr></table></figure><p>Q:ä»€ä¹ˆæƒ…å†µä¸‹é‡å†™ç±»çš„<code>__new__()</code>å‘¢ï¼Ÿç­”æ¡ˆå¾ˆç®€å•ï¼Œåœ¨<code>__init__()</code>ä¸å¤Ÿç”¨çš„æ—¶å€™ã€‚</p><p><code>__new__()</code>é€šå¸¸ä¼šè¿”å›è¯¥ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œä½†æœ‰æ—¶ä¹Ÿå¯èƒ½ä¼šè¿”å›å…¶ä»–ç±»çš„å®ä¾‹ï¼Œå¦‚æœå‘ç”Ÿäº†è¿™ç§æƒ…å†µï¼Œåˆ™ä¼šè·³è¿‡å¯¹ <code>__init__()</code>æ–¹æ³•çš„è°ƒç”¨ã€‚è€Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚éœ€è¦ä¿®æ”¹<strong>ä¸å¯å˜ç±»å®ä¾‹</strong>ï¼ˆ<a href="http://c.biancheng.net/python/" target="_blank" rel="noopener">Python</a> çš„æŸäº›å†…ç½®ç±»å‹ï¼‰çš„åˆ›å»ºè¡Œä¸ºï¼‰ï¼Œåˆ©ç”¨è¿™ä¸€ç‚¹ä¼šäº‹åŠåŠŸå€ã€‚æ¯”å¦‚ï¼š<a href="http://c.biancheng.net/view/5484.html%EF%BC%8C%E5%AF%B9" target="_blank" rel="noopener">http://c.biancheng.net/view/5484.htmlï¼Œå¯¹</a> Python ä¸å¯å˜çš„å†…ç½®ç±»å‹ï¼ˆå¦‚ intã€strã€float ç­‰ï¼‰è¿›è¡Œäº†å­ç±»åŒ–ï¼Œè¿™æ˜¯å› ä¸ºä¸€æ—¦åˆ›å»ºäº†è¿™æ ·ä¸å¯å˜çš„å¯¹è±¡å®ä¾‹ï¼Œå°±æ— æ³•åœ¨<code>__init__()</code>æ–¹æ³•ä¸­å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚</p><p>æ³¨ï¼šç”±äº <code>__new__()</code> ä¸é™äºè¿”å›åŒä¸€ä¸ªç±»çš„å®ä¾‹ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“è¢«æ»¥ç”¨ï¼Œä¸è´Ÿè´£ä»»åœ°ä½¿ç”¨è¿™ç§æ–¹æ³•å¯èƒ½ä¼šå¯¹ä»£ç æœ‰å®³ï¼Œæ‰€ä»¥è¦è°¨æ…ä½¿ç”¨ã€‚</p><h3 id="metaclasså…ƒç±»"><a class="markdownIt-Anchor" href="#metaclasså…ƒç±»"></a> <a href="http://c.biancheng.net/view/2293.html" target="_blank" rel="noopener">MetaClasså…ƒç±»</a></h3><blockquote><p>æ‰¿æ¥ä¸Šæ–‡<code>__new__</code>ï¼ŒPythonä¸­å¤§é‡ä½¿ç”¨<code>__new__()</code>æ–¹æ³•ä¸”åˆç†çš„åœ°æ–¹ï¼Œå°±æ˜¯ MetaClass å…ƒç±»ã€‚</p><p>MetaClasså…ƒç±»ï¼Œå¹¶ä¸æ˜¯æŸä¸€ä¸ªç±»çš„åå­—ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œæ˜¯ä¸€ç§Pythonçš„æ€æƒ³ã€‚å½“ç„¶å…¶æœ¬è´¨ä¹Ÿæ˜¯ä¸€ä¸ªç±»ï¼Œä½†å’Œæ™®é€šç±»çš„ç”¨æ³•ä¸åŒï¼Œå®ƒå¯ä»¥å¯¹<strong>ç±»å†…éƒ¨çš„å®šä¹‰</strong>ï¼ˆåŒ…æ‹¬ç±»å±æ€§å’Œç±»æ–¹æ³•ï¼‰è¿›è¡Œ<strong>åŠ¨æ€çš„ä¿®æ”¹</strong>ã€‚å¯ä»¥è¿™ä¹ˆè¯´ï¼Œä½¿ç”¨å…ƒç±»çš„ä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†å®ç°åœ¨åˆ›å»ºç±»æ—¶ï¼Œèƒ½å¤ŸåŠ¨æ€åœ°æ”¹å˜ç±»ä¸­å®šä¹‰çš„å±æ€§æˆ–è€…æ–¹æ³•ã€‚å…¶å¯ä»¥å°†<strong>åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹æ‹¦æˆª</strong>ä¸‹æ¥ï¼Œä»è€Œå¯¹è¿™ä¸ªå¯¹è±¡è¿›è¡Œè‡ªå®šä¹‰ï¼ˆè¿™ä¸ªéœ€è¦<strong>ç±»ç»§æ‰¿type</strong>ï¼Œä¸å‰æ–‡ç»§æ‰¿objectçš„åšåŒºåˆ«ï¼‰ã€‚</p><p>æ˜ç¡®ä¸€ç‚¹ï¼šå…ƒç±»å¯ä»¥ç†è§£æˆæ˜¯è‡ªå®šä¹‰ç±»ç»§æ‰¿çš„çˆ¶ç±»ï¼ˆä»å…¼å®¹å†™æ³•ä¸­ä¹Ÿèƒ½çœ‹å‡ºï¼‰ï¼Œä½†å…ƒç±»çš„ç‰¹ç‚¹æ˜¯<strong>ä¸ä¼šå‡ºç°åœ¨è‡ªå®šä¹‰ç±»çš„ç»§æ‰¿å…³ç³»(<code>__mro__</code>)ä¹‹ä¸­</strong></p></blockquote><p>ä¸¾ä¸ªä¾‹å­ï¼Œæ ¹æ®å®é™…åœºæ™¯çš„éœ€è¦ï¼Œæˆ‘ä»¬è¦ä¸ºå¤šä¸ªç±»æ·»åŠ ä¸€ä¸ª name å±æ€§å’Œä¸€ä¸ª say() æ–¹æ³•ã€‚æ˜¾ç„¶æœ‰å¤šç§æ–¹æ³•å¯ä»¥å®ç°ï¼Œä½†å…¶ä¸­ä¸€ç§æ–¹æ³•å°±æ˜¯ä½¿ç”¨ MetaClass å…ƒç±»ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªå…ƒç±»ï¼Œç»§æ‰¿typeã€‚å› ä¸ºåªæœ‰ç»§æ‰¿typeæ‰èƒ½é€šè¿‡é‡å†™__new__æ¥æ‹¦æˆªåˆ›å»ºè¿‡ç¨‹</span></span><br><span class="line"><span class="comment"># â–²æ³¨æ„ï¼Œç»§æ‰¿typeå__new__èƒ½æ‹¿åˆ°çš„å‚æ•°ä¿¡æ¯è·Ÿä¸ç»§æ‰¿typeçš„æœ‰å¤©å£¤ä¹‹åˆ«ï¼ŒåŸå› ç»§ç»­çœ‹ä¸‹å»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FirstMetaClass</span><span class="params">(type)</span>:</span></span><br><span class="line">    <span class="comment"># clsä»£è¡¨å…ƒç±»çš„ç±»: FirstMetaClass</span></span><br><span class="line">    <span class="comment"># nameä»£è¡¨è‡ªå®šä¹‰ç±»çš„ç±»å: CLanguage</span></span><br><span class="line">    <span class="comment"># basesä»£è¡¨è¢«åŠ¨æ€ä¿®æ”¹çš„ç±»çš„æ‰€æœ‰çˆ¶ç±»</span></span><br><span class="line">    <span class="comment"># atträ»£è¡¨è¢«åŠ¨æ€ä¿®æ”¹çš„ç±»çš„æ‰€æœ‰å±æ€§ã€æ–¹æ³•ç»„æˆçš„å­—å…¸</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, name, bases, attrs)</span>:</span></span><br><span class="line">        <span class="comment"># åŠ¨æ€ä¸ºè¯¥ç±»æ·»åŠ ä¸€ä¸ªnameå±æ€§</span></span><br><span class="line">        attrs[<span class="string">'name'</span>] = <span class="string">"Cè¯­è¨€ä¸­æ–‡ç½‘"</span></span><br><span class="line">        attrs[<span class="string">'say'</span>] = <span class="keyword">lambda</span> self: print(<span class="string">"è°ƒç”¨ say() å®ä¾‹æ–¹æ³•"</span>)</span><br><span class="line">        <span class="keyword">return</span> super().__new__(cls,name,bases,attrs)</span><br><span class="line">        </span><br><span class="line"><span class="comment"># å®šä¹‰ç±»æ—¶ï¼ŒæŒ‡å®šå…ƒç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CLanguage</span><span class="params">(object, metaclass=FirstMetaClass)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">clangs = CLanguage()</span><br><span class="line">print(clangs.name)</span><br><span class="line">clangs.say()</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨åˆ›å»ºç±»æ—¶ï¼Œé€šè¿‡åœ¨æ ‡æ³¨çˆ¶ç±»çš„åŒæ—¶æŒ‡å®šå…ƒç±»ï¼ˆæ ¼å¼ä¸º<code>metaclass=å…ƒç±»å</code>ï¼‰ï¼Œåˆ™å½“ <a href="http://c.biancheng.net/python/" target="_blank" rel="noopener">Python</a> è§£é‡Šå™¨åœ¨åˆ›å»ºè¯¥ç±»å®ä¾‹æ—¶ï¼Œ<code>FirstMetaClass(type)</code>å…ƒç±»ä¸­çš„<code>__new__</code>æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ï¼Œå…¶ä¸­baseså’Œattrsèƒ½æ‹¿åˆ°è‡ªå®šä¹‰ç±»çš„å‚æ•°ï¼Œä»è€Œå®ç°åŠ¨æ€ä¿®æ”¹ç±»å±æ€§æˆ–è€…ç±»æ–¹æ³•çš„ç›®çš„ã€‚</p><p><strong>å…ƒç±»å’Œçˆ¶ç±»çš„åŒºåˆ«ï¼š</strong></p><p>åœ¨å®šä¹‰å­ç±»çš„æ—¶å€™ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼šâ‘ æ˜¯ä¼ éœ€è¦ç»§æ‰¿çš„çˆ¶ç±»ï¼›â‘¡è‡ªå®šä¹‰çš„å…ƒç±»ã€‚</p><ul><li>çˆ¶ç±»æ˜¯å­ç±»çš„æ¨¡æ¿ï¼Œå­ç±»çš„åŠŸèƒ½æ˜¯è·Ÿçˆ¶ç±»ç´§è€¦åˆçš„ï¼Œå­ç±»å’Œçˆ¶ç±»ä¸€èˆ¬æ˜¯ä¸€ä¸€å¯¹åº”çš„</li><li>å…ƒç±»æ˜¯å­ç±»çš„ä¿®é¥°å™¨ï¼Œå¯ä»¥ä¸ºè¯¥å­ç±»å’Œå…¶ä»–å­ç±»éƒ½æ·»åŠ è‡ªå®šä¹‰åŠŸèƒ½ï¼Œå¹¶ä¸”ä¸åœ¨ç»§æ‰¿å…³ç³»ä¸­(<code>Class.__mro__</code>æŸ¥çœ‹)ï¼Œå­ç±»å’Œå…ƒç±»æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚å…ƒç±»å¹¶ä¸æ˜¯ç‰¹åœ°ä¸ºæŸä¸ªå­ç±»æœåŠ¡çš„</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestMeta3</span><span class="params">(type)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, name, bases, attrs)</span>:</span></span><br><span class="line">        print(cls)    <span class="comment"># å½“å‰ç±» </span></span><br><span class="line">        print(<span class="string">"name"</span>, name)<span class="comment"># å¦‚æœæ˜¯é€šè¿‡metaclassè§¦å‘çš„ï¼Œæ­¤å¤„ä¸ºè°ƒç”¨metaclassçš„ç±»çš„ç±»å‹</span></span><br><span class="line">        print(<span class="string">"bases"</span>, bases)<span class="comment"># å¦‚æœæ˜¯é€šè¿‡metaclassè§¦å‘çš„ï¼Œæ­¤å¤„ä¸ºè°ƒç”¨metaclassçš„ç±»çš„çˆ¶ç±»</span></span><br><span class="line">        print(<span class="string">"attrs"</span>, attrs)<span class="comment"># å¦‚æœæ˜¯é€šè¿‡metaclassè§¦å‘çš„ï¼Œæ­¤å¤„ä¸ºè°ƒç”¨metaclassçš„ç±»çš„å±æ€§</span></span><br><span class="line">        <span class="keyword">return</span> type.__new__(cls, name, bases, attrs)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pa3</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># python3ä¸­å¯ä»¥ç›´æ¥é€šè¿‡metaclasså…³é”®å­—å‚æ•°æ¥æŒ‡å®šç±»çš„å…ƒç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Eg3</span><span class="params">(Pa3, metaclass=TestMeta3)</span>:</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        kkk = []</span><br><span class="line">        kkk.append(self.__skiless__)</span><br><span class="line">        <span class="keyword">return</span> kkk</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">acc2</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'a2'</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">è¾“å‡º</span></span><br><span class="line"><span class="string">&lt;class '__main__.TestMeta3'&gt;</span></span><br><span class="line"><span class="string">name Eg3</span></span><br><span class="line"><span class="string">bases (&lt;class '__main__.Pa3'&gt;,)</span></span><br><span class="line"><span class="string">attrs &#123;'__module__': '__main__', '__qualname__': 'Eg3', 'get': &lt;classmethod object at 0x00000263511C6FA0&gt;, 'acc2': &lt;function Eg3.acc2 at 0x00000263511C5310&gt;&#125;</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><p>åœ¨å®šä¹‰çš„æ—¶å€™ï¼Œå‘ç°ç«Ÿç„¶æœ‰è¾“å‡ºã€‚å› ä¸ºå®šä¹‰çš„æ—¶å€™ï¼Œpythonè§£é‡Šå™¨ä¼šåœ¨å½“å‰ç±»ä¸­æŸ¥æ‰¾metaclass[3]ï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œå°±<strong>ä½¿ç”¨è¯¥metaclassåˆ›å»ºEg3ç±»</strong>ã€‚æ‰€ä»¥æ‰“å°å‡ºæ¥çš„nameã€basesã€attrséƒ½å’ŒEg3æœ‰å…³ã€‚</p><p><strong>with_metaclass</strong></p><blockquote><p>ç”±äºpython2å’Œpython3ä¸­å…ƒç±»ä½¿ç”¨æ–¹æ³•çš„ä¸åŒï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ç§å…¼å®¹çš„æ–¹å¼[1]ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">withMetaclass</span><span class="params">(meta, *bases)</span>:</span></span><br><span class="line">    <span class="string">"""Create a base class with a metaclass."""</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MetaClass</span><span class="params">(meta)</span>:</span></span><br><span class="line"><span class="comment"># å¦‚æœåˆ é™¤__new__ï¼Œåˆ™ç±».__mro__ä¸­èƒ½çœ‹åˆ°metaç±»</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, name, this_bases, d)</span>:</span></span><br><span class="line">            <span class="comment"># å› ä¸ºmetaæ˜¯ç±»ï¼Œæ‰€ä»¥è¿™è¾¹æ˜¯åœ¨è°ƒç”¨metaçš„__call__()ã€‚â–²basesï¼Œdä¸ºConfigHandlerçš„çˆ¶ç±»å’Œå±æ€§</span></span><br><span class="line">            <span class="keyword">return</span> meta(name, bases, d)</span><br><span class="line"><span class="comment"># è¿”å›ä¸€ä¸ªæ–°ç±»å‹, type.__new__()è¦æ±‚ç¬¬ä¸€ä¸ªå¿…é¡»æ˜¯typeçš„å­ç±»</span></span><br><span class="line">    <span class="keyword">return</span> type.__new__(MetaClass, <span class="string">'temporary_class'</span>, (), &#123;&#125;)</span><br><span class="line"><span class="comment"># ä¸‹é¢ä¸¤å¥è¯ç­‰ä»·ï¼ŒwithMetaclassæ˜¯ä¸ºäº†å…¼å®¹python2å’Œpython3,2ä¸­æ²¡æœ‰metaclasså…³é”®å­—</span></span><br><span class="line"><span class="comment"># å…¶åœ¨åˆ›å»ºå®ä¾‹æ—¶ï¼Œ__new__æ–¹æ³•ä¼šè¢«MetaClassæ‹¦æˆª(å…¶å®å°±æ˜¯å­ç±»æ²¡å®šä¹‰__new__ï¼Œèµ°äº†çˆ¶ç±»çš„__new__)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConfigHandler</span><span class="params">(withMetaclass<span class="params">(Singleton)</span>)</span></span></span><br><span class="line"><span class="class"># <span class="title">python3</span>å†™æ³•</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">ConfigHandler</span><span class="params">(metaclass=Singleton)</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"># å› ä¸ºConfigHandlerç›¸å½“äºç»§æ‰¿äº† type.__new__è¿”å›çš„ç±»MetaClassï¼Œæ‰€ä»¥åœ¨c = ConfigHandler()å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œä¼šè§¦å‘Metaclassçš„__new__ç„¶åè°ƒç”¨meta.__call__ä»è€Œè¿”å›ä¸€ä¸ªå¯¹è±¡</span><br></pre></td></tr></table></figure><p><code>with_metaclass</code>è¿”å›çš„ä¸´æ—¶ç±»ä¸­ï¼Œæœ¬èº«æ— ä»»ä½•å±æ€§ï¼Œä½†åŒ…å«äº†å…ƒç±»å’ŒåŸºç±»çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå¹¶åœ¨<strong>ä¸‹ä¸€æ­¥å®šä¹‰ç±»æ—¶</strong>å°†æ‰€æœ‰ä¿¡æ¯è§£åŒ…å‡ºæ¥[1]ã€‚</p><p>è§ï¼š<a href="https://zhuanlan.zhihu.com/p/354828950" target="_blank" rel="noopener">â˜…Python å…ƒç±»åŠwith_metaclass</a></p><h3 id="type"><a class="markdownIt-Anchor" href="#type"></a> <a href="http://c.biancheng.net/view/2292.html" target="_blank" rel="noopener"><code>type</code>åŠ¨æ€åˆ›å»ºç±»</a></h3><ul><li>type() å‡½æ•°å±äº <a href="http://c.biancheng.net/python/" target="_blank" rel="noopener">Python</a> å†…ç½®å‡½æ•°ï¼Œé€šå¸¸ç”¨æ¥æŸ¥çœ‹æŸä¸ªå˜é‡çš„å…·ä½“ç±»å‹ã€‚<ul><li><code>type(obj)</code></li></ul></li><li>å…¶å®ï¼Œtype() å‡½æ•°è¿˜æœ‰ä¸€ä¸ªæ›´é«˜çº§çš„ç”¨æ³•ï¼Œå³<strong>åˆ›å»º</strong>ä¸€ä¸ªè‡ªå®šä¹‰<strong>ç±»å‹</strong>ï¼ˆä¹Ÿå°±æ˜¯åˆ›å»ºä¸€ä¸ªç±»ï¼‰ã€‚<ul><li><code>type(name, bases, dict)</code>ï¼šå…¶ä¸­ name è¡¨ç¤ºç±»çš„åç§°ï¼›bases è¡¨ç¤ºä¸€ä¸ªå…ƒç»„ï¼Œå…¶ä¸­å­˜å‚¨çš„æ˜¯è¯¥ç±»çš„çˆ¶ç±»ï¼›dict è¡¨ç¤ºä¸€ä¸ªå­—å…¸ï¼Œç”¨äºè¡¨ç¤ºç±»å†…å®šä¹‰çš„å±æ€§æˆ–è€…æ–¹æ³•ã€‚</li></ul></li></ul><p>å®é™…ä¸Š<code>type(name, bases, dict)</code>æ˜¯è°ƒç”¨äº†typeç±»çš„<code>type.__init__(cls, what, bases=None, dict=None)</code>æ–¹æ³•ï¼Œåˆ›å»ºäº†ä¸€ä¸ªtypeçš„å®ä¾‹ï¼ˆç±»ç±»å‹å°±æ˜¯ä¸€ä¸ªtypeå®ä¾‹ï¼‰ï¼Œç±»å‹æ˜¯<code>&lt;class 'type'&gt;</code></p><p><strong>&lt;class â€˜typeâ€™&gt;æ˜¯æ‰€æœ‰ç±»å‹çš„ç±»å‹ã€‚&lt;class â€˜objectâ€™&gt;ä¹Ÿæ˜¯æ‰€æœ‰å¯¹è±¡çš„è¶…ç±»ï¼ˆé™¤äº†å®ƒè‡ªå·±ï¼ŒåŒ…æ‹¬typeï¼‰</strong></p><p>â–². æ­¤å¤–typeè¿˜æœ‰<code>type.__new__(*args, **kwargs)</code>ï¼Œå…¶ä½œç”¨æ˜¯<code>Create and return a new object.</code>ï¼Œå¯ä»¥å†™æˆ<code>type.__new__(ClassTpye, name, base, dicts)</code>ï¼Œä½†ClassTypeå¿…é¡»æ˜¯typeçš„å­ç±»ã€‚ä¼šè¿”å›ä¸€ä¸ªè·ŸClassTypeæœ‰å…³ç³»çš„æ–°ç±»å‹</p><h3 id="é€šè¿‡å…ƒç±»åˆ›å»ºå•ä¾‹ç±»"><a class="markdownIt-Anchor" href="#é€šè¿‡å…ƒç±»åˆ›å»ºå•ä¾‹ç±»"></a> é€šè¿‡å…ƒç±»åˆ›å»ºå•ä¾‹ç±»</h3><blockquote><p>ç°åœ¨è®©æˆ‘ä»¬æ­£å¼çœ‹ï¼Œæˆ‘åœ¨å¼€æºä»£ç é‡Œçœ‹åˆ°çš„å†…å®¹ï¼š</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„è¿™è¾¹ç»§æ‰¿äº†type, æ‰€ä»¥ä¸‹é¢çš„__call__æ˜¯é‡å†™typeçš„__call__ï¼Œå³åˆ›å»ºå®ä¾‹çš„æ–¹æ³•</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span><span class="params">(type)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Singleton Metaclass</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    _inst = &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> cls._inst:</span><br><span class="line">            cls._inst[cls] = super(Singleton, cls).__call__(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> cls._inst[cls]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">withMetaclass</span><span class="params">(meta, *bases)</span>:</span></span><br><span class="line">    <span class="string">"""Create a base class with a metaclass."""</span></span><br><span class="line">    <span class="comment"># è¿™éœ€è¦ä¸€ç‚¹è§£é‡Šï¼šåŸºæœ¬æ€æƒ³æ˜¯ä¸ºä¸€ä¸ªçº§åˆ«çš„ç±»å®ä¾‹åŒ–åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿå…ƒç±»ï¼Œç”¨å®é™…çš„å…ƒç±»æ›¿æ¢å®ƒè‡ªå·±ã€‚</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># KeyPoint1. ç»§æ‰¿metaç±»</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MetaClass</span><span class="params">(meta)</span>:</span></span><br><span class="line">        <span class="comment"># å®é™…ä¸Šä¸‹é¢çš„__new__ä¸å½±å“</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, name, this_bases, d)</span>:</span></span><br><span class="line">            <span class="comment"># clsä¸ºwithMetaclass; nameä¸ºä½¿ç”¨è€…çš„ç±»å‹; this_basesä¸ºä½¿ç”¨è€…çš„çˆ¶ç±»ä»¬; dä¸ºä½¿ç”¨è€…çš„å±æ€§</span></span><br><span class="line">            <span class="keyword">return</span> meta(name, bases, d)</span><br><span class="line">    <span class="comment"># KeyPoint2. type.__new__åˆ›å»ºä¸€ä¸ªåç§°å«temporary_classï¼Œç±»å‹ä¸ºMetaClassçš„ç±»</span></span><br><span class="line">    <span class="comment"># â–²æ³¨æ„type.__new__ä¸­çš„ç±»ç±»å‹å¿…é¡»æ˜¯typeçš„å­ç±»</span></span><br><span class="line">    <span class="keyword">return</span> type.__new__(MetaClass, <span class="string">'temporary_class'</span>, (), &#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConfigHandler</span><span class="params">(withMetaclass<span class="params">(Singleton)</span>)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"__init__"</span>)</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="meta">    @LazyProperty</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">serverHost</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> os.environ.get(<span class="string">"HOST"</span>, setting.HOST)</span><br><span class="line"><span class="comment"># res=withMetaclass(Singleton)çš„ç±»å‹ä¸º&lt;class 'util.six.withMetaclass.&lt;locals&gt;.MetaClass'&gt;</span></span><br><span class="line"><span class="comment"># å°†å…¶ä¼ ç»™ConfigHandlerä½œä¸ºçˆ¶ç±»ï¼Œåœ¨å®šä¹‰ ConfigHandler æ—¶ä¼šè§¦å‘MetaClass.__new__, äºæ˜¯è°ƒç”¨meta(name, bases, d)ï¼Œæ­¤å¤„çš„metaä¸ºSingletonï¼Œè€Œnameä¸ºConfigHandlerç±», basesä¸ºç©º, dä¸ºConfigHandlerçš„å±æ€§å’Œæ–¹æ³•ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(type(ConfigHandler)) ==&gt;  &lt;class 'util.singleton.Singleton'&gt;</span></span><br><span class="line"><span class="comment"># å› æ­¤ c = ConfigHandler() ==&gt; Singletonçš„__call__æ–¹æ³•ï¼Œ</span></span><br><span class="line">å½“c = ConfigHandler()æ—¶ä¼šå› ä¸ºtype.__new__(MetaClass, <span class="string">'temporary_class'</span>, (), &#123;&#125;)å»æ‰¾MetaClassçš„__call__è¿›è¡Œè°ƒç”¨ï¼ŒMetaClassæ²¡æœ‰__call__åˆ™æ‰¾åˆ°äº†å…¶çˆ¶ç±»meta(Singleton)çš„__call__</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šç±»ä¹Ÿæ˜¯å¯¹è±¡ï¼Œæ˜¯å…ƒç±»çš„å¯¹è±¡ï¼Œå³æˆ‘ä»¬å®ä¾‹åŒ–ä¸€ä¸ªç±»æ—¶ï¼Œè°ƒç”¨å…¶å…ƒç±»çš„<code>__call__(cls, *args, **kwargs)</code>æ–¹æ³•è¿›è¡Œåˆ›å»ºå¯¹è±¡ã€‚</p><h2 id="__call__"><a class="markdownIt-Anchor" href="#__call__"></a> <code>__call__</code></h2><blockquote><p>ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„å®ä¾‹æ–¹æ³•ï¼Œå³<code>__call__()</code>ã€‚è¯¥æ–¹æ³•çš„åŠŸèƒ½æ˜¯åœ¨ç±»ä¸­<strong>é‡è½½äº†å¯¹è±¡çš„ () è¿ç®—ç¬¦</strong>ï¼Œä½¿å¾—ç±»å®ä¾‹å¯¹è±¡å¯ä»¥åƒè°ƒç”¨æ™®é€šå‡½æ•°é‚£æ ·ï¼Œä»¥â€œ<strong>å¯¹è±¡å()</strong>â€çš„å½¢å¼ä½¿ç”¨ã€‚</p></blockquote><p>å®é™…ä¸Šï¼Œå¦‚æœä¸é‡å†™<code>__call__</code>çš„è¯ï¼Œ<code>Class.__call__(*args, **kwargs)</code>è¿˜æ‰¿æ‹…ç€äº§ç”Ÿç±»å®ä¾‹çš„åŠŸèƒ½ï¼ˆä¼šè°ƒç”¨çˆ¶ç±»ï¼ˆå¯ä»¥é€šè¿‡<code>Class.__class__</code>æ¥æŸ¥çœ‹çˆ¶ç±»ï¼‰çš„<code>type.__call__</code>å…¶ä¼šè¿”å›ä¸€ä¸ªå®ä¾‹ï¼‰</p><p>æ¡ˆä¾‹ä¸€:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç»§æ‰¿çš„æ˜¯object, è€Œä¸æ˜¯type</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        print(<span class="string">"init"</span>)</span><br><span class="line">        self.name = name</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">"call"</span>)</span><br><span class="line"><span class="comment"># å½“æ²¡æœ‰é‡å†™__call__æ—¶ï¼Œæ— è®ºæ˜¯æ˜¾å¼çš„è°ƒç”¨__call__ï¼Œè¿˜æ˜¯é€šè¿‡()è¿ç®—ç¬¦è°ƒç”¨ï¼Œéƒ½ä¼šè°ƒç”¨type.__call__è¿”å›ä¸€ä¸ªå®ä¾‹</span></span><br><span class="line">res = Meta.__call__(<span class="string">"asd"</span>)</span><br><span class="line">print(res, type(res))</span><br><span class="line">res = Meta(<span class="string">"asd"</span>)</span><br><span class="line">print(res, type(res))</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">init</span></span><br><span class="line"><span class="string">&lt;__main__.Meta object at 0x0000014FB5115EE0&gt; &lt;class '__main__.Meta'&gt;</span></span><br><span class="line"><span class="string">init</span></span><br><span class="line"><span class="string">&lt;__main__.Meta object at 0x0000014FB5115A90&gt; &lt;class '__main__.Meta'&gt;</span></span><br><span class="line"><span class="string">ä¸Šè¿°ä¸¤ç§éƒ½èƒ½åˆ›å»ºå¯¹è±¡</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="comment"># å½“é‡å†™__call__ä»¥å, __call__()è¿”å›å®ä¾‹çš„æ•ˆæœå°±å¤±æ•ˆäº†==&gt;å› ä¸ºä¸Šè¿°ä»£ç æ²¡æœ‰return</span></span><br><span class="line"><span class="comment"># æ­¤æ—¶ Meta()ä¸Meta.__call__()ä¸å†ç­‰ä»·</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">call</span></span><br><span class="line"><span class="string">None &lt;class 'NoneType'&gt;</span></span><br><span class="line"><span class="string">init</span></span><br><span class="line"><span class="string">&lt;__main__.Meta object at 0x0000016CC2745EE0&gt; &lt;class '__main__.Meta'&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><p>Q:æˆ‘ä»¬åœ¨å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™<code>f = Foo(1, y=2)</code>ï¼Œå¯ä»¥å‘ç°åœ¨<code>__init__()</code>ä¸­å¹¶æ²¡æœ‰è¿”å›å®ä¾‹ï¼Œä½†è°ƒç”¨<code>Foo(1, y=2)</code><strong>ç¡®å®</strong>è¿”å›äº†ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸”ï¼Œ<code>__init__</code>é¢„æœŸä¸€ä¸ª<code>self</code>å‚æ•°ï¼Œä½†æ˜¯å½“æˆ‘ä»¬è°ƒç”¨<code>Foo(1, y=2)</code>æ—¶è¿™é‡Œå¹¶æ²¡æœ‰è¿™ä¸ªå‚æ•°ã€‚é‚£ä¹ˆç±»å®ä¾‹åŒ–çš„è¿‡ç¨‹åˆ°åº•æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</p><p>A:æ„é€ é¡ºåºâ€”â€”<a href="https://www.jianshu.com/p/f63ad9d550f1" target="_blank" rel="noopener">ç†è§£pythonçš„ç±»å®ä¾‹åŒ–</a></p><p>é¦–å…ˆæ˜ç¡®ä¸€ç‚¹ï¼ŒPythonä¸­çš„<strong>ç±»ä¹Ÿæ˜¯å¯¹è±¡</strong>ï¼ç±»ã€å‡½æ•°ã€æ–¹æ³•ä»¥åŠå®ä¾‹éƒ½æ˜¯å¯¹è±¡â€”â€”<strong>ç±»ç±»å‹æ˜¯typeçš„å¯¹è±¡</strong>ï¼Œå¹¶ä¸”æ— è®ºä½•æ—¶ä½ å°†ä¸€å¯¹æ‹¬å·æ”¾åœ¨å®ƒä»¬çš„åå­—åé¢æ—¶ï¼Œå°±ä¼šè°ƒç”¨<code>type.__call__()</code>æ–¹æ³•ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºtypeæ˜¯ç±»å‹çš„çˆ¶ç±»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Foo.__class__</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">type</span>'&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥<code>Foo</code>æ˜¯ç±»å‹<code>type</code>çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”è°ƒç”¨typeç±»çš„<code>__call__(self, *args, **kwargs)</code>è¿”å›ä¸€ä¸ª<code>Foo</code>ç±»çš„å¯¹è±¡ã€‚è®©æˆ‘ä»¬çœ‹ä¸‹<code>type</code>ä¸­çš„<code>__call__</code>æ–¹æ³•æ˜¯ä»€ä¹ˆæ ·çš„ã€‚è¿™ä¸ªæ–¹æ³•ç›¸å½“çš„å¤æ‚ï¼Œä½†æ˜¯æˆ‘ä»¬å°†å…¶Cä»£ç è½¬æˆPythonä»£ç ï¼Œå¹¶å°è¯•å°½é‡ç®€åŒ–å®ƒï¼Œç»“æœå¦‚ä¸‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">type</span><span class="params">(object)</span>:</span></span><br><span class="line"><span class="comment"># è¿™è¾¹çš„obj_typeè·Ÿclsä¸€æ ·</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(obj_type, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="comment"># é€šè¿‡__new__åˆ›å»ºä¸€ä¸ªç©ºçš„ç±»å®ä¾‹ï¼Œå¦‚æœobj_typeæ²¡æœ‰__new__åˆ™ä½¿ç”¨type.__new__</span></span><br><span class="line">        obj = obj_type.__new__(*args, **kwargs)</span><br><span class="line">        <span class="comment"># è¿›è¡Œç±»å‹æ£€æŸ¥</span></span><br><span class="line">        <span class="keyword">if</span> obj <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">and</span> issubclass(obj, obj_type):</span><br><span class="line">            <span class="comment"># å¯¹ç±»è¿›è¡Œ__init__åˆå§‹åŒ–</span></span><br><span class="line">            obj.__init__(*args, **kwargs)</span><br><span class="line">        <span class="comment"># è¿”å›ç±»å®ä¾‹</span></span><br><span class="line">        <span class="keyword">return</span> obj</span><br></pre></td></tr></table></figure><p>å¯è§<code>__new__</code>æ–¹æ³•ä¸ºå¯¹è±¡åˆ†é…äº†å†…å­˜ç©ºé—´ï¼Œæ„å»ºå®ƒä¸ºä¸€ä¸ªâ€œç©º&quot;å¯¹è±¡ç„¶å<code>__init__</code>æ–¹æ³•è¢«è°ƒç”¨æ¥åˆå§‹åŒ–å®ƒã€‚</p><p>é‚£æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå…·ä½“ç±»æ¥è®²è§£è¿™ä¸ªè¿‡ç¨‹ã€‚é¦–å…ˆæ˜ç¡®ä¸€ç‚¹ï¼š<strong>Fooç›¸å¯¹äºäº§ç”Ÿäº†ä¸€ä¸ªtypeå®ä¾‹åŒ–å¯¹è±¡</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x, y=<span class="number">0</span>)</span>:</span></span><br><span class="line">        self.x = x</span><br><span class="line">        self.y = y</span><br></pre></td></tr></table></figure><p>è·å¾—å®ä¾‹åŒ–å¯¹è±¡**<code>Foo(*args, **kwargs)</code><strong>ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯<code>typeå¯¹è±¡()</code>å³</strong>è°ƒç”¨äº†typeä¸­()è¿ç®—ç¬¦çš„è§¦å‘çš„å‡½æ•°<code>type.__call__</code>ä»è€Œåˆ›å»ºä¸€ä¸ªFooçš„å®ä¾‹**</p><ul><li>è‡³äº<code>type.__call__</code>å‘ç”Ÿäº†ä»€ä¹ˆå°±æ˜¯ä¸Šé¢æŠ½è±¡ä»£ç ä¸­ä»‹ç»çš„é‚£èˆ¬ï¼Œè°ƒç”¨<code>type.__new__(Foo, *args, **kwargs)</code>ç„¶åè¿”å›ä¸€ä¸ªå¯¹è±¡å®ä¾‹objã€‚</li><li><code>obj</code>éšåé€šè¿‡è°ƒç”¨<code>obj.__init__(*args, **kwargs)</code>è¢«åˆå§‹åŒ–ã€‚</li><li><code>obj</code>è¢«<code>type.__call__</code>ä¸­è¿”å›ã€‚</li></ul><p>â–²æ³¨æ„ï¼š<code>Foo.__call__</code>é‡è½½çš„æ˜¯<code>fooå¯¹è±¡</code>çš„()è¿ç®—ç¬¦ï¼Œè€Œ<code>Foo()</code>å®ä¾‹åŒ–fooå¯¹è±¡ï¼Œåˆ™æ‰§è¡Œçš„æ˜¯<code>typeå¯¹è±¡</code>çš„()è¿ç®—ç¬¦ã€‚</p><p><strong>å°æ€»ç»“</strong>ï¼š</p><ul><li>ç°åœ¨æˆ‘ä»¬èƒ½çŸ¥é“ä¸ºä»€ä¹ˆå…ƒç±»å¿…é¡»ç»§æ‰¿typeäº†ï¼šå› ä¸ºæˆ‘ä»¬å®ä¾‹åŒ–å¯¹è±¡<code>Foo(xxx)</code>æ—¶è°ƒç”¨äº†<code>type.__call__</code>,è€Œ<code>type.__call__</code>åˆä¼šè°ƒç”¨<code>type.__new__</code>å› æ­¤å¦‚æœtypeå­ç±»é‡å†™å®ç°äº†<code>__new__</code>ï¼ˆè¿”å›çš„ç±»å®ä¾‹å¯¹è±¡çš„ç±»å‹ä½œæ§åˆ¶ï¼‰ã€<code>__call__</code>ï¼ˆå¯¹å®ä¾‹åŒ–çš„æµç¨‹åšæ§åˆ¶ï¼‰ï¼Œåˆ™å¯ä»¥å¯¹<strong>ç±»å¯¹è±¡çš„ç±»å‹å’Œç±»å±æ€§</strong>èµ·åˆ°è‡ªå®šä¹‰çš„åŠŸèƒ½ï¼Œè€Œé‡å†™å°±å¿…é¡»ç»§æ‰¿type=&gt;éœ€è¦å…ƒç±»å¿…é¡»ç»§æ‰¿type</li><li>æ‰€ä»¥æŒ‰ç…§ä¸Šè¿°çš„é€»è¾‘ï¼Œå¦‚æœå®šä¹‰äº†ä¸€ä¸ªå…ƒç±»è®©è‡ªå®šä¹‰ç±»ç”¨çš„è¯<code>class Foo(metaclass=MyMetaClass)</code>ï¼Œåœ¨å…¶å®ä¾‹åŒ–è¿‡ç¨‹ä¸­<code>Foo()</code>ä¼šç›´æ¥è°ƒç”¨é‡å†™åçš„<code>MyMetaClass.__call__</code>ï¼Œè€Œåªè¦è®°ä½åœ¨<code>MyMetaClass.__call__</code>ä¸­ä½¿ç”¨åˆ°<code>return super(Singleton, cls).__call__(*args, **kwargs)</code>å°±å¯ä»¥æŠŠ<code>type.__call__</code>ç”Ÿæˆçš„å®ä¾‹è¿”å›å•¦ã€‚æ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ<u>ç¼–å†™å…ƒç±»ï¼Œä¸€èˆ¬éƒ½æ˜¯ç»§æ‰¿äº†typeï¼Œç„¶åæ ¹æ®æƒ³æ§åˆ¶å®ä¾‹åŒ–æµç¨‹å°±é‡å†™<code>__call__</code>æ–¹æ³•ï¼Œæƒ³æ·»åŠ å±æ€§å°±é‡å†™<code>__new__</code>æ–¹æ³•å°±è¡Œäº†ã€‚</u></li><li><strong>â˜…å…ƒç±»äº§ç”Ÿå½±å“çš„æ—¶é—´ç‚¹æ˜¯åœ¨å®ä¾‹åŒ–çš„æ—¶å€™</strong></li></ul><p>æ³¨æ„ç‚¹ï¼šå…ƒç±»ç»§æ‰¿äº†typeï¼Œæ‰€ä»¥å®ä¾‹åŒ–å…ƒç±»æ˜¯åœ¨äº§ç”Ÿä¸€ä¸ªç±»ç±»å‹ï¼Œå°±è¦ä»¥typeåˆ›å»ºç±»ç±»å‹çš„å‚æ•°å»äº§ç”Ÿã€‚è€Œå…ƒç±»çš„ä½¿ç”¨ä¸€èˆ¬éƒ½æ˜¯è‡ªå®šä¹‰ç±»<code>class MyClass(metaclass=å…ƒç±»)</code>ï¼Œç„¶åå®ä¾‹åŒ–è‡ªå®šä¹‰ç±»<code>MyClass(xxx)</code></p><p><strong>æ€»ç»“</strong>ï¼šçœ‹å®Œä¸Šè¿°çŸ¥è¯†ç‚¹åï¼Œæˆ‘ä»¬èƒ½çŸ¥é“ä¸ºä»€ä¹ˆwithclassèƒ½èµ·åˆ°metaclassçš„ä½œç”¨(ç±»çš„<code>__mro__</code>ä¸­ä¸å‡ºç°æŒ‡å®šçš„å…ƒç±»)äº†ï¼š</p><ul><li>é¦–å…ˆåˆ†ææµç¨‹ï¼š<code>return type.__new__(Metaclass)</code>è¿”å›äº†ä¸€ä¸ªç±»å‹ä¾›è‡ªå®šä¹‰ç±»ç»§æ‰¿ï¼Œç”±äºMetaClassç»§æ‰¿çš„æ˜¯çœŸæ­£çš„å…ƒç±»(å…ƒç±»éƒ½ç»§æ‰¿type)ï¼Œæ‰€ä»¥åœ¨è‡ªå®šä¹‰ç±»å®ä¾‹åŒ–çš„æ—¶å€™ä¼šè¢«Metaclassçš„<code>__new__</code>æ–¹æ³•æ‹¦æˆªï¼Œåœ¨<code>MetaClass.__new__</code>é‡Œreturnäº†ä¸€ä¸ªè‡ªå®šä¹‰å®ä¾‹ï¼Œå¹¶æŠŠå¯¹è±¡åŠ å…¥åˆ°äº†Singletonå­—å…¸ä¸­äº†ã€‚</li><li>å…¶æ¬¡è®²è§£ä¸ºä»€ä¹ˆMetaClassä¸­æ²¡æœ‰MetaClassï¼šå› ä¸ºæ ¹æ®<a href="#"><code>__new__</code></a>çŸ¥è¯†ç‚¹ä¸­è®²åˆ°çš„ï¼Œ<code>__new__</code>æ§åˆ¶äº†å®ä¾‹äº§ç”Ÿï¼Œ<code>return type.__new__(Metaclass)</code>ä¸­åˆ›å»ºäº†<code>Metaclass</code>ï¼Œä½†å…¶åœ¨<code>__new__</code>ä¸­è¿”å›çš„å¹¶ä¸æ˜¯MetaClassï¼Œå› æ­¤<code>__mro__</code>ä¸­ä¸ä¼šå‡ºç°<code>Metaclass</code></li><li>æœ€åè¿˜è¦è®²è®²Singletonä¸­çš„æ‰§è¡Œé€»è¾‘ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span><span class="params">(type)</span>:</span></span><br><span class="line">    _inst = &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> cls._inst:</span><br><span class="line">            <span class="comment"># super(Singleton, cls).__call__è°ƒç”¨çš„æ˜¯type.__call__(è‡ªå®šä¹‰ç±»ç±»åname, è‡ªå®šä¹‰ç±»çˆ¶ç±»bases, è‡ªå®šä¹‰ç±»å±æ€§attrs)</span></span><br><span class="line">            cls._inst[cls] = super(Singleton, cls).__call__(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> cls._inst[cls]</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªåœ¨çœ‹å¼€æºä»£ç æ—¶é…åˆ°äº†å•ä¾‹å…ƒç±»å†™æ³•åçš„ä¸€ä¸ªåŸç†è´´ï¼Œå¯ä»¥å¸®ä½ å½»åº•å¼„æ¸…å…ƒç±»ã€ä»¥åŠ&lt;code&gt;__new__&lt;/code&gt;å’Œ&lt;code&gt;__call__&lt;/code&gt;ï¼Œç›¸ä¿¡æˆ‘ï¼Œçœ‹å®Œä½ ç»å¯¹ä¼šæœ‰æ”¶è·ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œå…³äºå…ƒç±»çš„ç»“è®ºè¯´åœ¨å‰å¤´ï¼Œå…ˆæœ‰ä¸ª
      
    
    </summary>
    
    
      <category term="Python" scheme="https://nymrli.top/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>PlantUMLä½œå›¾</title>
    <link href="https://nymrli.top/2022/04/04/PlantUML%E4%BD%9C%E5%9B%BE/"/>
    <id>https://nymrli.top/2022/04/04/PlantUMLä½œå›¾/</id>
    <published>2022-04-04T03:30:28.000Z</published>
    <updated>2022-04-04T05:03:10.461Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ€è¿‘åœ¨çœ‹å¼€æºä»£ç ï¼Œæœ‰äº›é¡¹ç›®çš„æ¶æ„å’Œæ‰§è¡Œé€»è¾‘éƒ½éå¸¸æœ‰å­¦ä¹ ã€å€Ÿé‰´æ„ä¹‰ï¼Œå› æ­¤æƒ³ä½œå›¾å¯è§†åŒ–è®°å½•ä¸‹æ¥ã€‚</p><p>åœ¨å†™æ–‡æ¡£çš„è¿‡ç¨‹ä¸­ï¼Œç»å¸¸éœ€è¦è¿›è¡Œç”»å›¾ã€‚è™½ç„¶è¯´ç°åœ¨æœ‰å¾ˆå¤šç±»ä¼¼visoä¹‹ç±»çš„å¯è§†åŒ–ç”»å›¾å·¥å…·ï¼Œä½†æ˜¯è¿˜æ˜¯è¦èŠ±è´¹å¤§é‡æ—¶é—´åœ¨æ‹–æ‹‰ç»„ä»¶ä¸Šï¼Œæ•ˆç‡ååˆ†ä½ä¸‹ã€‚è€Œ<a href="http://plantuml.com/" target="_blank" rel="noopener">Plantuml</a>ä¸markdownç±»ä¼¼ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¹Ÿç®—ä¸€é—¨å¯ä»¥å¿«é€Ÿç”»å›¾çš„<strong>è®¾è®¡è¯­è¨€</strong>ï¼Œå­¦ä¹ èµ·æ¥ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œå­¦å®Œåç›´æ¥ä¹¦å†™ã€ä¸éœ€è¦æ‹–æ‹½å°±èƒ½åšå‡ºè§„æ•´çš„å›¾ï¼Œèƒ½å¤§å¤§èŠ‚çº¦åœ¨å¸ƒå±€ä¸Šç»†ææœ«èŠ‚çš„æ—¶é—´ã€‚</p><p>æ­¤å¤–ï¼ŒPlantUMLåœ¨vscode, webstorméƒ½æœ‰ç›¸å…³çš„æ’ä»¶å¯ä»¥ä½¿ç”¨ã€‚</p></blockquote><p>åœ¨çº¿ä½“éªŒç½‘ç«™æœ‰å¾ˆå¤šä½¿ç”¨çš„æ ·ä¾‹ä»‹ç»ï¼Œåœ¨æ­¤æˆ‘å°±ä¸è¿‡å¤šä»‹ç»äº†ã€‚æœ¬æ–‡ä¼šä»¥æˆ‘ä½¿ç”¨åˆ°çš„åŠŸèƒ½å›¾æ¥æé†’è¯´æ˜ä¸€ä¸‹ä¸€äº›è¯­æ³•è§„èŒƒå’Œæ³¨æ„ç‚¹ã€‚</p><h2 id="æ—¶åºå›¾"><a class="markdownIt-Anchor" href="#æ—¶åºå›¾"></a> æ—¶åºå›¾</h2><ul><li><p>æ³¨é‡Š</p><ul><li><p>å›¾ä¸Šä¸æ˜¾ç¤ºçš„æ³¨é‡Šï¼š<code>/' æ³¨é‡Šå†…å®¹ '/</code></p></li><li><p>å›¾ä¸­æ˜¾ç¤ºçš„æ³¨é‡Šï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å·¦ä¾§æ³¨é‡Š</span></span><br><span class="line">Alice-&gt;Bob : hello</span><br><span class="line">note left: this is a first note</span><br><span class="line"></span><br><span class="line"><span class="comment"># å³ä¾§æ³¨é‡Š</span></span><br><span class="line">Bob--&gt;Alice : ok</span><br><span class="line">note right: this is another note</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·¨è¶Šä¸¤ä¸ªçš„æ³¨é‡Š</span></span><br><span class="line">note over Alice, Bob <span class="comment">#FFAAAA: This is displayed\n over Bob and Alice.</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>è¿”å›ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Alice -&gt; Bob: Another authentication Request</span><br><span class="line"><span class="comment"># åŒæ ·å¯ä»¥å†™æˆBob --&gt; Alice, åªä¸è¿‡ä¸‹é¢çš„æ›´ç›´è§‚èƒ½çœ‹å‡ºæ˜¯è¿”å›</span></span><br><span class="line">Alice &lt;-- Bob: Another authentication Response</span><br></pre></td></tr></table></figure></li><li><p><strong>ç”Ÿå‘½çº¿çš„æ¿€æ´»ä¸æ’¤é”€</strong></p><ul><li>å…³é”®å­—<code>activate</code>å’Œ<code>deactivate</code>ç”¨æ¥è¡¨ç¤ºå‚ä¸è€…çš„ç”Ÿå‘½æ´»åŠ¨ã€‚ä¸€æ—¦å‚ä¸è€…è¢«æ¿€æ´»ï¼Œå®ƒçš„ç”Ÿå‘½çº¿ï¼ˆæŸ±å­ï¼‰å°±ä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚<ul><li><code>activate</code>å’Œ<code>deactivate</code>é€‚ç”¨äºä»¥ä¸Šæƒ…å½¢ã€‚</li><li><code>destroy</code>è¡¨ç¤ºä¸€ä¸ªå‚ä¸è€…çš„ç”Ÿå‘½çº¿çš„ç»ˆç»“ã€‚</li></ul></li><li>ç»™ç”Ÿå‘½çº¿ä¸Šè‰²è¯­æ³•ï¼š<code>activate Holder [#color]</code></li></ul><p>â–².ä¸€ä¸ªå‚ä¸è€…åœ¨æœ€å¤–å±‚åªç”¨äºæœ‰ä¸€ä¸ªç”Ÿå‘½çº¿ï¼Œä½†åœ¨å¤§ç”Ÿå‘½çº¿ä¸­å¯ä»¥é€šè¿‡activateåˆ›å»ºå¤šä¸ªåµŒå¥—çš„å°ç”Ÿå‘½çº¿ï¼Œç”¨deactivateè·³å‡ºå½“å‰ç”Ÿå‘½çº¿</p><p>â˜…å› æ­¤ï¼Œæœ€å¥½ç”Ÿå‘½çº¿çš„åˆ›å»ºå’Œé€€å‡ºåŒæ—¶å†™å‡ºï¼Œå³å†™äº†ä¸€ä¸ª<code>activate ?</code>å°±å†™ä¸€ä¸ª<code>deactivate ?</code>ï¼Œ éœ€è¦å®Œæˆçš„å†…å®¹åœ¨å…¶ä¸­ç¼–å†™</p><p>æ­¤å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“å‰ç»“æœçš„è¿”å›åº”è¯¥åœ¨deactivateä¹‹å‰ã€‚æ¯”å¦‚<code>A &lt;-- C: return</code>åæ‰æ˜¯<code>deactivate C</code>ï¼Œå½“ç„¶å¦‚æœéµå¾ªäº†æˆå¯¹ä¹¦å†™activateçš„ä¹ æƒ¯çš„è¯ï¼Œå°±ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜äº†ã€‚</p></li><li><p><strong>returnå…³é”®å­—</strong>ï¼šä»¥ç”¨äºç”Ÿæˆä¸€ä¸ªå¸¦æœ‰å¯é€‰æ–‡æœ¬æ ‡ç­¾çš„è¿”å›ä¿¡æ¯ã€‚è¿”å›çš„ç‚¹æ˜¯å¯¼è‡´æœ€è¿‘ä¸€æ¬¡æ¿€æ´»ç”Ÿå‘½çº¿çš„ç‚¹ã€‚ä½†<strong>ä¸å»ºè®®ä½¿ç”¨</strong>ï¼Œå› ä¸ºåœ¨ç»´æŠ¤ä¿®æ”¹çš„æ—¶å€™æ— æ³•ç›´è§‚çš„çœ‹å‡ºåˆ°åº•æ˜¯ä»å“ªè¿”å›å“ªã€‚è€Œæ˜¯é‡‡å–<code>A &lt;-- B: return</code>æ¥å£°æ˜ä»Båˆ°Açš„è™šçº¿è¿”å›</p></li><li><p><strong>åˆ†éš”ç¬¦</strong>ï¼š é€šè¿‡ä½¿ç”¨<code>==</code>å…³é”®è¯æ¥å°†ä½ çš„å›¾è¡¨åˆ†å‰²æˆå¤šä¸ªé€»è¾‘æ­¥éª¤ã€‚</p></li><li><p><strong>å£°æ˜å‚ä¸è€…</strong>ï¼š å£°æ˜çš„é¡ºåºå°†æ˜¯ï¼ˆé»˜è®¤çš„ï¼‰<strong>æ˜¾ç¤ºé¡ºåº</strong>ã€‚</p><p>æ ¼å¼ä¸º: <code>ç±»å‹ å‚ä¸è€…åç§° [as AliasName] [order orderVaalue] [#color]</code></p><p>å¯ä»¥é€‰æ‹©çš„ç±»å‹æœ‰ï¼š</p><ul><li><code>actor</code>ï¼ˆè§’è‰²ï¼‰</li><li><code>participant</code>(é»˜è®¤å‚ä¸è€…)</li><li><code>boundary</code>ï¼ˆè¾¹ç•Œï¼‰</li><li><code>control</code>ï¼ˆæ§åˆ¶ï¼‰</li><li><code>entity</code>ï¼ˆå®ä½“ï¼‰</li><li><code>database</code>ï¼ˆæ•°æ®åº“ï¼‰</li><li><code>collections</code>ï¼ˆé›†åˆï¼‰</li><li><code>queue</code>ï¼ˆé˜Ÿåˆ—ï¼‰</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line">/&apos; å£°æ˜å‚ä¸è€… &apos;/</span><br><span class="line">Actor       actor       as A</span><br><span class="line">Participant scheduler as S</span><br><span class="line">Participant Fetcher as F</span><br><span class="line">Participant check as C</span><br><span class="line">Participant DoValidator as D</span><br><span class="line">Participant Queue as Q</span><br><span class="line">Participant ProxyHandler as P</span><br><span class="line">Participant ProxyFetcher as PF</span><br><span class="line">A -&gt; S: runScheduler()</span><br><span class="line"></span><br><span class="line">/&apos;schedulerä¸»è¦é€»è¾‘&apos;/</span><br><span class="line">activate S</span><br><span class="line">S -&gt; S: __runProxyFetch()</span><br><span class="line">== å®šæ—¶å™¨è®¾ç½® ==</span><br><span class="line">S -&gt; S: scheduler.add_job(__runProxyFetch)</span><br><span class="line">S -&gt; S: scheduler.add_job(__runProxyCheck)</span><br><span class="line">S -&gt; S: scheduler.configure()</span><br><span class="line">S -&gt; S: scheduler.start()</span><br><span class="line"></span><br><span class="line">== å®šæ—¶å™¨æ‰§è¡Œ ==</span><br><span class="line">S -&gt; S: __runProxyFetch()</span><br><span class="line">/&apos; --__runProxyFetch-- &apos;/</span><br><span class="line">activate S #orange</span><br><span class="line">S -&gt; F: __runProxyFetch()</span><br><span class="line">activate F  #pink</span><br><span class="line">F-&gt;F: run()</span><br><span class="line">F-&gt;PF: freeProxyXX()</span><br><span class="line">activate PF</span><br><span class="line">PF--&gt;F: proxy</span><br><span class="line">deactivate PF</span><br><span class="line">F-&gt;Q: proxy_queue.put(proxy)</span><br><span class="line">Q--&gt;F</span><br><span class="line">F--&gt;S</span><br><span class="line">deactivate F</span><br><span class="line"></span><br><span class="line">S -&gt; C: Checker(&quot;raw&quot;, proxy_queue)</span><br><span class="line">activate C</span><br><span class="line">C -&gt; C: _ThreadChecker.run()</span><br><span class="line">C -&gt; D: DoValidator.validator(proxy)</span><br><span class="line"></span><br><span class="line">activate D</span><br><span class="line">D -&gt; D: cls.httpValidator(proxy)</span><br><span class="line">D -&gt; D: cls.httpsValidator(proxy)</span><br><span class="line">D -&gt; C</span><br><span class="line">deactivate D</span><br><span class="line"></span><br><span class="line">alt work_type </span><br><span class="line">C-&gt;C: __ifRaw()</span><br><span class="line">else</span><br><span class="line">C-&gt;C: __ifUse()</span><br><span class="line">end</span><br><span class="line">C--&gt;S</span><br><span class="line"></span><br><span class="line">deactivate C</span><br><span class="line">deactivate S</span><br><span class="line">/&apos; --__runProxyFetch-- &apos;/</span><br><span class="line"></span><br><span class="line">/&apos; --__runProxyCheck-- &apos;/</span><br><span class="line">S -&gt; S: __runProxyCheck()</span><br><span class="line">activate S #orange</span><br><span class="line">S-&gt;P: &lt;&lt;create proxy_handler&gt;&gt;</span><br><span class="line">P--&gt;S</span><br><span class="line">S-&gt;Q: &lt;&lt;create proxy_queue&gt;&gt;</span><br><span class="line">Q--&gt;S</span><br><span class="line"></span><br><span class="line">alt proxy_handler.db.getCount() &lt; 0</span><br><span class="line">S-&gt;S: __runProxyFetch()</span><br><span class="line">else</span><br><span class="line">S-&gt;P: proxy_handler.getAll()</span><br><span class="line">P--&gt;S</span><br><span class="line">end</span><br><span class="line">S-&gt;C: Checker(&quot;use&quot;, proxy_queue)</span><br><span class="line">C--&gt;S</span><br><span class="line">deactivate S</span><br><span class="line">/&apos; --__runProxyCheck-- &apos;/</span><br><span class="line">S --&gt; A</span><br><span class="line">deactivate S</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ€è¿‘åœ¨çœ‹å¼€æºä»£ç ï¼Œæœ‰äº›é¡¹ç›®çš„æ¶æ„å’Œæ‰§è¡Œé€»è¾‘éƒ½éå¸¸æœ‰å­¦ä¹ ã€å€Ÿé‰´æ„ä¹‰ï¼Œå› æ­¤æƒ³ä½œå›¾å¯è§†åŒ–è®°å½•ä¸‹æ¥ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å†™æ–‡æ¡£çš„è¿‡ç¨‹ä¸­ï¼Œç»å¸¸éœ€è¦è¿›è¡Œç”»å›¾ã€‚è™½ç„¶è¯´ç°åœ¨æœ‰å¾ˆå¤šç±»ä¼¼visoä¹‹ç±»çš„å¯è§†åŒ–ç”»å›¾å·¥å…·ï¼Œä½†æ˜¯è¿˜æ˜¯è¦èŠ±è´¹å¤§é‡æ—¶é—´åœ¨æ‹–æ‹‰ç»„ä»¶ä¸Šï¼Œæ•ˆç‡ååˆ†ä½ä¸‹ã€‚è€Œ&lt;
      
    
    </summary>
    
    
      <category term="è®¡ç®—æœºåŸºç¡€" scheme="https://nymrli.top/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>å¼€æºé¡¹ç›®ä»£ç é˜…è¯»è®°å½•</title>
    <link href="https://nymrli.top/2022/03/29/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB%E8%AE%B0%E5%BD%95/"/>
    <id>https://nymrli.top/2022/03/29/å¼€æºé¡¹ç›®ä»£ç é˜…è¯»è®°å½•/</id>
    <published>2022-03-29T09:54:46.000Z</published>
    <updated>2022-05-29T10:01:40.807Z</updated>
    
    <content type="html"><![CDATA[<h1 id="çˆ¬è™«ç³»åˆ—"><a class="markdownIt-Anchor" href="#çˆ¬è™«ç³»åˆ—"></a> çˆ¬è™«ç³»åˆ—</h1><h2 id="æŠ¢è´­-ç§’æ€"><a class="markdownIt-Anchor" href="#æŠ¢è´­-ç§’æ€"></a> æŠ¢è´­ã€ç§’æ€</h2><h3 id="taobao_seckill"><a class="markdownIt-Anchor" href="#taobao_seckill"></a> <strong><a href="https://github.com/jerry3747/taobao_seckill" target="_blank" rel="noopener"> taobao_seckill</a></strong></h3><blockquote><p>æ·˜å®ç§’æ€ç‰©å“ï¼šåˆ†ä¸ºseleniumç‰ˆå’Œrequestç½‘ç»œè¯·æ±‚ç‰ˆï¼Œå¾®å°çš„åŒºåˆ«åœ¨äºï¼Œapiå…ˆè¯·æ±‚çš„æ˜¯è´­ç‰©è½¦çš„ç‰©å“ä¿¡æ¯ï¼Œseleniumåˆ™æ˜¯å‹¾é€‰é€‰æ‹©æ¡†ã€‚</p><p>æµç¨‹å¤§è‡´éƒ½ç›¸åŒï¼šâ‘ keep_waitç­‰å¾…ä¸´è¿‘æŠ¢è´­æ—¶é—´-----&gt;â‘¡å°†éœ€è¦çš„ä¿¡æ¯ç¼“å­˜ä½ï¼Œä¸å†åˆ·æ–°ï¼ˆæ¯”å¦‚è¦æŠ¢è´­çš„ç‰©å“ä¿¡æ¯ã€cookiesâ€¦ï¼‰-----&gt;â‘¢è¿›è¡Œç»“ç®—(/ç‚¹å‡»æŒ‰é’®)-----&gt;â‘£æäº¤è®¢å•(/ç‚¹å‡»æŒ‰é’®)-----&gt;â‘¤æ”¯ä»˜è®¢å•(/ç‚¹å‡»æŒ‰é’®)ï¼›</p></blockquote><ul><li><p><a href="https://www.cnblogs.com/amiza/p/10175543.html" target="_blank" rel="noopener">ä½¿ç”¨browsercookieæ¥ç®¡ç†æµè§ˆå™¨cookies</a>â€”â€”ä»æµè§ˆå™¨æå–ä¿å­˜çš„cookiesçš„å·¥å…·ã€‚å®ƒæ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„çˆ¬è™«å·¥å…·ï¼Œé€šè¿‡åŠ è½½ä½ æµè§ˆå™¨çš„cookiesåˆ°ä¸€ä¸ªcookiejarå¯¹è±¡é‡Œé¢ï¼Œè®©ä½ è½»æ¾ä¸‹è½½éœ€è¦ç™»å½•çš„ç½‘é¡µå†…å®¹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>cj = browsercookie.chrome()<span class="comment"># browsercookie.load() åœ¨ä¸çŸ¥é“æˆ–è€…ä¸å…³å¿ƒæµè§ˆå™¨æ—¶ä½¿ç”¨</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(url, cookies=cj)</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½œä¸ºå¼€å‘è€…çš„æˆ‘ä»¬éƒ½æ˜¯å°†cookiesæ‰‹åŠ¨å†™å…¥æˆ–è€…æ˜¯ä¼ å…¥ç¨‹åºçš„ï¼Œè€Œbrowsercookieç”¨é€”ï¼Œæˆ‘æƒ³å¯ä»¥æ˜¯å°†éœ€è¦ä¼ å…¥cookiesçš„ç¨‹åºæ‰“åŒ…ç»™ä¸ä¼šæå–Cookiesçš„ç”¨æˆ·ä½¿ç”¨ã€‚ï¼ˆç±»ä¼¼é€šè¿‡seleniumç™»é™†åï¼Œæ‹¿å–cookieså†å‘é€ç½‘ç»œè¯·æ±‚ï¼Œè¿™è¾¹æ˜¯è®©/å€ŸåŠ©ç”¨æˆ·è‡ªå·±çš„æµè§ˆå™¨æ¥æ‹¿å–cookiesï¼‰</p></li><li><p>ä½¿ç”¨tkinteræ­å»ºç®€å•çš„GUIï¼šç‚¹å‡»â€œå¼€å§‹â€çš„æŒ‰é’®åä¼šå°†å¯†ç æ¡†å’ŒæŠ¢è´­è®¾ç½®æ—¶é—´æ¡†çš„å†…å®¹ä¼ å…¥ï¼Œä½œä¸ºå®ä¾‹åŒ–ChromeDriverSpiderçš„å‚æ•°ï¼Œå¹¶è¿è¡Œå®ä¾‹çš„sec_killæ–¹æ³•å¼€å§‹æ‰§è¡ŒæŠ¢è´­</p></li><li><p>é…ç½®chromeDriverå¯åŠ¨é…ç½®é¡¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_chrome_options</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""é…ç½®å¯åŠ¨é¡¹"""</span></span><br><span class="line">    chrome_options = webdriver.ChromeOptions()</span><br><span class="line">    chrome_options.accept_untrusted_certs = <span class="keyword">True</span></span><br><span class="line">    chrome_options.assume_untrusted_cert_issuer = <span class="keyword">True</span></span><br><span class="line">    arguments = [<span class="string">'--no-sandbox'</span>, <span class="string">'--disable-impl-side-painting'</span>, <span class="string">'--disable-setuid-sandbox'</span>, <span class="string">'--disable-seccomp-filter-sandbox'</span>,</span><br><span class="line">    <span class="string">'--disable-breakpad'</span>, <span class="string">'--disable-client-side-phishing-detection'</span>, <span class="string">'--disable-cast'</span>,</span><br><span class="line">    <span class="string">'--disable-cast-streaming-hw-encoding'</span>, <span class="string">'--disable-cloud-import'</span>, <span class="string">'--disable-popup-blocking'</span>,</span><br><span class="line">    <span class="string">'--ignore-certificate-errors'</span>, <span class="string">'--disable-session-crashed-bubble'</span>, <span class="string">'--disable-ipv6'</span>,</span><br><span class="line">    <span class="string">'--allow-http-screen-capture'</span>, <span class="string">'--start-maximized'</span>]</span><br><span class="line">    <span class="keyword">for</span> arg <span class="keyword">in</span> arguments:</span><br><span class="line">    chrome_options.add_argument(arg)</span><br><span class="line">    chrome_options.add_argument(<span class="string">f'--user-agent=<span class="subst">&#123;choice(get_useragent_data())&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">return</span> chrome_options</span><br></pre></td></tr></table></figure></li></ul><h3 id="taobao_api"><a class="markdownIt-Anchor" href="#taobao_api"></a> <strong><a href="https://github.com/gaoxt/taobao_api" target="_blank" rel="noopener">taobao_api</a></strong></h3><blockquote><p>seleniumå’Œapiç»“åˆï¼šç™»é™†é€»è¾‘ä½¿ç”¨äº†seleniumï¼Œåˆ·æ–°è´­ç‰©è½¦å’Œä¸‹å•è°ƒç”¨äº†æ‰‹æœºæ·˜å®taobao_apiï¼Œè‡ªåŠ¨ä»˜æ¬¾ä¹Ÿä½¿ç”¨äº†seleniumï¼Œèƒ½è‡ªåŠ¨æ¨¡æ‹Ÿè§¦æ‘¸è¾“å…¥å¯†ç ä»˜æ¬¾ï¼Œæ¥å£ç­¾åsignç”Ÿæˆæ–¹æ³•å‚è€ƒget_sign_valã€‚</p></blockquote><ul><li><p>åŒæ­¥é˜¿é‡Œäº‘æ—¶é—´æœåŠ¡å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¸€æ¬¡æ€§è®¾ç½®</span></span><br><span class="line">sudo sntp -sS ntp.aliyun.com</span><br><span class="line"><span class="comment">#æ°¸ä¹…è®¾ç½®</span></span><br><span class="line">sudo systemsetup -setnetworktimeserver ntp.aliyun.com</span><br><span class="line">sudo systemsetup -setusingnetworktime on</span><br></pre></td></tr></table></figure></li><li><p>å±•ç¤ºQRCode</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment"># æ‰¾åˆ°äºŒç»´ç å›¾ç‰‡çš„é“¾æ¥</span></span><br><span class="line">   img = WebDriverWait(browser, <span class="number">2</span>, <span class="number">0.1</span>).until(</span><br><span class="line">       EC.presence_of_element_located((By.XPATH, <span class="string">"//div[@id='J_QRCodeImg']/img"</span>))).get_attribute(<span class="string">'src'</span>)</span><br><span class="line">   <span class="comment"># è·å¾—å›¾ç‰‡å­—èŠ‚æµå†…å®¹</span></span><br><span class="line">   img_content = requests.get(img, timeout=<span class="number">5</span>).content</span><br><span class="line">   <span class="comment"># ä¿å­˜åˆ°æœ¬åœ°å›¾ç‰‡ä¸­</span></span><br><span class="line">   file_name = <span class="string">'taobao_qrcode.png'</span></span><br><span class="line">   fp = open(file_name, <span class="string">'wb'</span>)</span><br><span class="line">   fp.write(img_content)</span><br><span class="line">   fp.close()</span><br><span class="line"><span class="comment"># å°†å…¶è§£ç æˆé“¾æ¥ï¼Œ pyzbarä¸ºäºŒç»´ç å’Œæ¡å½¢ç åº“ ==&gt; ä¸ªäººè§‰å¾—ä¿å­˜åå¯ä»¥ç›´æ¥è½¬æˆPILçš„Imageç„¶åimg.show()</span></span><br><span class="line">   <span class="keyword">from</span> pyzbar.pyzbar <span class="keyword">import</span> decode</span><br><span class="line">   barcode_url = <span class="string">''</span></span><br><span class="line">   barcodes = decode(Image.open(file_name))</span><br><span class="line">   <span class="keyword">for</span> barcode <span class="keyword">in</span> barcodes:</span><br><span class="line">       <span class="comment"># è§£æè·å¾—äºŒç»´ç åçš„å†…å®¹ï¼›å¦‚æœæ˜¯æ¡å½¢ç ï¼Œåˆ™è¿”å›æ¡å½¢ç æ•°</span></span><br><span class="line">       barcode_url = barcode.data.decode(<span class="string">"utf-8"</span>)</span><br><span class="line"><span class="comment"># ç”ŸæˆäºŒç»´ç å¹¶é€šè¿‡æ§åˆ¶å°æ‰“å°</span></span><br><span class="line">   qr = qrcode.QRCode()</span><br><span class="line">   qr.add_data(barcode_url)</span><br><span class="line">   qr.print_ascii(invert=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure><p>æ³¨ï¼š<a href="http://zbar.sourceforge.net/" target="_blank" rel="noopener">ZBar</a>æ˜¯ä¸€ä¸ªå¼€æºè½¯ä»¶å¥—ä»¶ï¼Œç”¨äºä»å„ç§æ¥æºï¼ˆå¦‚è§†é¢‘æµã€å›¾åƒæ–‡ä»¶å’ŒåŸå§‹å¼ºåº¦ä¼ æ„Ÿå™¨ï¼‰è¯»å–æ¡å½¢ç ï¼›<code>pyzbar</code> æ˜¯é€šè¿‡ <code>Python2</code>å’Œ<code>3</code>æ¥å£ï¼Œä½¿ç”¨ <code>ZBar</code> åº“è¯»å–ä¸€ç»´æ¡å½¢ç å’ŒQRç  ã€‚=&gt;<a href="https://blog.csdn.net/qq_37924224/article/details/109582507" target="_blank" rel="noopener">è¯»å–æ¡å½¢ç </a>ã€<a href="https://blog.csdn.net/hxj0323/article/details/112969622" target="_blank" rel="noopener">è¯»å–äºŒç»´ç </a></p></li></ul><h3 id="jd_seckill"><a class="markdownIt-Anchor" href="#jd_seckill"></a> <strong><a href="https://github.com/andyzys/jd_seckill" target="_blank" rel="noopener">jd_seckill</a></strong></h3><blockquote><ol><li>é¢„çº¦å•†å“</li><li>ç§’æ€æŠ¢è´­å•†å“: â‘ <strong>è®¿é—®</strong>å•†å“çš„æŠ¢è´­<strong>é“¾æ¥</strong>ï¼ˆç”¨äºè®¾ç½®cookieç­‰â€”&gt;â‘¡è®¿é—®æŠ¢è´­è®¢å•<strong>ç»“ç®—é¡µé¢</strong>----&gt;â‘¢<strong>æäº¤æŠ¢</strong>è´­ï¼ˆç§’æ€ï¼‰<strong>è®¢å•</strong> [_get_seckill_order_dataç”Ÿæˆæäº¤æŠ¢è´­è®¢å•æ‰€éœ€çš„è¯·æ±‚ä½“å‚æ•°ã€è·å–ç§’æ€åˆå§‹åŒ–ä¿¡æ¯ï¼ˆåŒ…æ‹¬ï¼šåœ°å€ï¼Œå‘ç¥¨ï¼Œtokenï¼‰]</li></ol></blockquote><ul><li><p>ä»UAListä¸­é€šè¿‡<code>random.choice(USER_AGENTS)</code>éšæœºUA</p></li><li><p>ä½¿ç”¨å†…ç½®configparseræ¨¡å—è§£æconfig.ini</p><ul><li>RawConfigParseræ˜¯æœ€åŸºç¡€çš„INIæ–‡ä»¶è¯»å–ç±»ï¼›ConfigParserã€SafeConfigParser<a href="https://blog.csdn.net/miner_k/article/details/77857292" target="_blank" rel="noopener">æ”¯æŒå¯¹%(value)så˜é‡çš„è§£æ</a>ï¼ŒSafeConfigParserç±»å®ç°äº†ConfigParserç›¸åŒçš„æ¥å£ï¼Œæ–°å¢å¦‚ä¸‹æ–¹æ³•ï¼šsetå­˜åœ¨ä¿å­˜çš„æ–¹æ³•</li><li>sectionä¸‹çš„option(key)å¯ä»¥ä¸å¡«valueå€¼ï¼Œå³ä¸ºç©ºã€‚</li><li>from: <a href="https://blog.csdn.net/tianzhu123/article/details/6893755" target="_blank" rel="noopener">pythonä¸­RawConfigParserç±»ã€ConfigParserç±»ã€SafeConfigParserç±»ä¸­å‡½æ•°ä»‹ç»</a>ã€</li></ul></li><li><p>å¤šè¿›ç¨‹æ± ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ProcessPoolExecutor</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> ProcessPoolExecutor(work_count) <span class="keyword">as</span> pool:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(work_count):</span><br><span class="line">        pool.submit(self.seckill)</span><br></pre></td></tr></table></figure></li><li><p>ç§’æ€æ—¶é—´æ¯”è¾ƒ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">buy_time = datetime.strptime(global_config.getRaw(<span class="string">'config'</span>,<span class="string">'buy_time'</span>), <span class="string">"%Y-%m-%d %H:%M:%S.%f"</span></span><br><span class="line">now_time = datetime.now</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="keyword">if</span> now_time() &gt;= buy_time:</span><br><span class="line">        logger.info(<span class="string">'æ—¶é—´åˆ°è¾¾ï¼Œå¼€å§‹æ‰§è¡Œâ€¦â€¦'</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">time.sleep(self.sleep_interval)</span><br></pre></td></tr></table></figure></li><li><p><a href="https://github.com/woxiqingxian/jd_seckill/pull/2/commits/63a41a0609912d5643bc11f3419fe7dd8e84a00a" target="_blank" rel="noopener">è·å–äº¬ä¸œæœåŠ¡å™¨æ—¶é—´</a>ï¼š<code>https://api.m.jd.com/client.action?functionId=queryMaterialProducts&amp;client=wh5</code></p></li></ul><h3 id="jd-assistant"><a class="markdownIt-Anchor" href="#jd-assistant"></a> <strong><a href="https://github.com/tychxn/jd-assistant" target="_blank" rel="noopener">jd-assistantâ˜…</a></strong></h3><blockquote><p>æ˜¯<a href="#jd_seckill">jd_seckill</a>çš„ä¼˜åŒ–è¿›é˜¶ç‰ˆæœ¬</p><ul><li><p>æ™®é€šå•†å“è´­ä¹°ä¸»è¦æµç¨‹ï¼š<code>(1)æ¸…ç©ºè´­ç‰©è½¦</code> --&gt; <code>(2)æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦</code> --&gt; <code>(3)æäº¤è®¢å•</code></p></li><li><p>é¢„çº¦æŠ¢è´­å•†å“ç‰¹ç‚¹ï¼š</p><ol><li>éœ€è¦æå‰ç‚¹å‡»é¢„çº¦</li><li>å¤§éƒ¨åˆ†æ­¤ç±»å•†å“åœ¨é¢„çº¦åè‡ªåŠ¨åŠ å…¥è´­ç‰©è½¦ï¼Œä½†æ˜¯æ— æ³•å‹¾é€‰âœ“ï¼Œä¹Ÿæ— æ³•ï¸è¿›å…¥åˆ°ç»“ç®—é¡µé¢</li><li>åˆ°äº†æŠ¢è´­çš„æ—¶é—´ç‚¹åå°†å•†å“åŠ å…¥è´­ç‰©è½¦ï¼Œæ­¤æ—¶æ‰èƒ½å‹¾é€‰å¹¶ä¸‹å•</li></ol></li><li><p>æ™®é€šå•†å“ï¼šèƒ½åŠ å…¥è´­ç‰©è½¦ğŸ›’ï¼Œç„¶åè¿›å…¥è´­ç‰©è½¦ç»“ç®—ä¸‹å•.</p></li><li><p>æŠ¢è´­å•†å“ï¼šéœ€ææå‰é¢„çº¦ï¼Œå¼€å§‹æŠ¢è´­æ—¶æœ‰â€œç«‹å³æŠ¢è´­â€æŒ‰é’®ğŸ”˜ï¼Œç‚¹å‡»æŒ‰é’®åå•†å“åŠ å…¥è´­ç‰©è½¦ï¼Œç„¶åç»“ç®—ä¸‹å•.</p></li></ul><p>â­ï¸æŠ¢è´­å—å¤šç§å› ç´ å½±å“ï¼š<strong>ç½‘é€Ÿã€è´¦å·è´¨é‡ã€è¿æ°”</strong>ç­‰ç­‰ï¼Œä»…ä¾›å¨±ä¹ï¼Œè®¤çœŸå°±è¾“äº†.</p></blockquote><ul><li><p>deprecatedã€check_loginè£…é¥°å™¨ï¼šä¼ å…¥äº†selfå‚æ•°ï¼Œå¹¶é€šè¿‡selfå®ä¾‹è°ƒç”¨äº†ç±»çš„å…¶ä»–æˆå‘˜æ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_login</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="string">"""ç”¨æˆ·ç™»é™†æ€æ ¡éªŒè£…é¥°å™¨ã€‚è‹¥ç”¨æˆ·æœªç™»é™†ï¼Œåˆ™è°ƒç”¨æ‰«ç ç™»é™†"""</span></span><br><span class="line"><span class="meta">    @functools.wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">new_func</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.is_login:</span><br><span class="line">            logger.info(<span class="string">"&#123;0&#125; éœ€ç™»é™†åè°ƒç”¨ï¼Œå¼€å§‹æ‰«ç ç™»é™†"</span>.format(func.__name__))</span><br><span class="line">            self.login_by_QRcode()</span><br><span class="line">        <span class="keyword">return</span> func(self, *args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> new_func</span><br></pre></td></tr></table></figure></li><li><p>å¯†ç åŠ å¯†â€”â€”<strong><a href="https://github.com/Legrandin/pycryptodome" target="_blank" rel="noopener">pycryptodome</a></strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_v1_5 <span class="keyword">as</span> Cipher_pkcs1_v1_5</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt_pwd</span><span class="params">(password, public_key=RSA_PUBLIC_KEY)</span>:</span></span><br><span class="line">    rsa_key = RSA.importKey(public_key)</span><br><span class="line">    encryptor = Cipher_pkcs1_v1_5.new(rsa_key)</span><br><span class="line">    cipher = b64encode(encryptor.encrypt(password.encode(<span class="string">'utf-8'</span>)))</span><br><span class="line">    <span class="keyword">return</span> cipher.decode(<span class="string">'utf-8'</span>)</span><br></pre></td></tr></table></figure></li><li><p>æä¾›JSè„šæœ¬æ–‡ä»¶æ¥è·å–å•†å“çš„ä¿¡æ¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»¥ä¸‹ä»£ç åœ¨è®¢å•ç»“ç®—é¡µé¢çš„å¼€å‘è€…å·¥å…·Consoleä¸­æ‰§è¡Œï¼Œç”¨äºè·å–å¿…è¦çš„å‚æ•°</span></span><br><span class="line"><span class="keyword">var</span> eid = $(<span class="string">'#eid'</span>).val();</span><br><span class="line"><span class="keyword">var</span> fp = $(<span class="string">'#fp'</span>).val();</span><br><span class="line"><span class="keyword">var</span> trackId = getTakId();</span><br><span class="line"><span class="keyword">var</span> riskControl = $(<span class="string">'#riskControl'</span>).val();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`eid = <span class="subst">$&#123;eid&#125;</span>\nfp = <span class="subst">$&#123;fp&#125;</span>\ntrack_id = <span class="subst">$&#123;trackId&#125;</span>\nrisk_control = <span class="subst">$&#123;riskControl&#125;</span>`</span>);</span><br></pre></td></tr></table></figure></li><li><p>cookieséªŒè¯-é€šè¿‡è¯»å–æœ¬åœ°ä¿å­˜çš„cookiesæ—¶è¦å…ˆéªŒè¯ä¸‹cookiesæ˜¯å¦æœ‰æ•ˆï¼šrequestsåº“çš„ä½¿ç”¨æ–¹å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_validate_cookies</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""éªŒè¯cookiesæ˜¯å¦æœ‰æ•ˆï¼ˆæ˜¯å¦ç™»é™†ï¼‰</span></span><br><span class="line"><span class="string">    é€šè¿‡è®¿é—®ç”¨æˆ·è®¢å•åˆ—è¡¨é¡µè¿›è¡Œåˆ¤æ–­ï¼šè‹¥æœªç™»å½•ï¼Œå°†ä¼šé‡å®šå‘åˆ°ç™»é™†é¡µé¢ã€‚</span></span><br><span class="line"><span class="string">    :return: cookiesæ˜¯å¦æœ‰æ•ˆ True/False</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    url = <span class="string">'https://order.jd.com/center/list.action'</span></span><br><span class="line">    payload = &#123;</span><br><span class="line">        <span class="string">'rid'</span>: str(int(time.time() * <span class="number">1000</span>)),</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        resp = self.sess.get(url=url, params=payload, allow_redirects=<span class="keyword">False</span>)</span><br><span class="line">        <span class="keyword">if</span> resp.status_code == requests.codes.OK:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        logger.error(e)</span><br><span class="line">    <span class="comment"># åˆ›å»ºæ–°çš„session</span></span><br><span class="line">    self.sess = requests.session()</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">False</span></span><br></pre></td></tr></table></figure></li><li><p>äºŒç»´ç ç™»å½•ï¼šä¸‹è½½äºŒç»´ç <code>_get_QRcode</code>â€“&gt;è¯¢é—®è·å–äºŒç»´ç æ‰«æçŠ¶æ€<code>_get_QRcode_ticket</code>â€”&gt;éªŒè¯äºŒç»´ç ä¿¡æ¯(<code>_validate_QRcode_ticket</code>)â€“&gt;è®¾ç½®<code>is_login=Trueå’Œsave_cookies</code>ï¼ˆäºŒç»´ç æœ‰æ•ˆæœŸçº¦120sï¼Œæµè§ˆå™¨å¤§çº¦2så‘é€ä¸€ä¸ªè¯·æ±‚è¯¢é—®æ‰«æçŠ¶æ€ï¼‰â€”â€”çœ‹ä»£ç æ˜¯assistantå‚è€ƒäº†2018å¹´çš„**<a href="https://github.com/adyzng/jd-autobuy" target="_blank" rel="noopener">jd-autobuy</a>**</p></li><li><p>æ‰«æäºŒç»´ç ï¼šå†™å…¥å›¾ç‰‡å’Œæ‰“å¼€å›¾ç‰‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_image</span><span class="params">(resp, image_file)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(image_file, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="comment"># ä»ç½‘ç»œè¯·æ±‚ä¸­ä¸‹è½½å†…å®¹</span></span><br><span class="line">        <span class="keyword">for</span> chunk <span class="keyword">in</span> resp.iter_content(chunk_size=<span class="number">1024</span>):</span><br><span class="line">            f.write(chunk)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">open_image</span><span class="params">(image_file)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> os.name == <span class="string">"nt"</span>:</span><br><span class="line">        os.system(<span class="string">'start '</span> + image_file)  <span class="comment"># for Windows</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> os.uname()[<span class="number">0</span>] == <span class="string">"Linux"</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">"deepin"</span> <span class="keyword">in</span> os.uname()[<span class="number">2</span>]:</span><br><span class="line">                os.system(<span class="string">"deepin-image-viewer "</span> + image_file)  <span class="comment"># for deepin</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                os.system(<span class="string">"eog "</span> + image_file)  <span class="comment"># for Linux</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            os.system(<span class="string">"open "</span> + image_file)  <span class="comment"># for Mac</span></span><br></pre></td></tr></table></figure><p>æ³¨ï¼šåˆ¤æ–­æ“ä½œç³»ç»Ÿè¿˜å¯ä»¥å€ŸåŠ©å†…ç½®çš„platformåº“<code>platform.system().lower()</code>å¾—åˆ°[linuxã€windowsã€mac]</p></li></ul><p>â–²cookieså’ŒäºŒç»´ç ç»“åˆä½¿ç”¨ï¼š</p><ol><li>å¦‚æœç™»é™†æˆåŠŸåˆ™å§cookiesæŒä¹…åŒ–</li><li>ä½¿ç”¨äºŒç»´ç ç™»é™†å‰ï¼Œå…ˆåŠ è½½éªŒè¯ä¹‹å‰æŒä¹…åŒ–çš„cookiesæ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æœæœ‰æ•ˆåˆ™æ— éœ€å†æ¬¡æ‰«ç ç™»é™†(åœ¨QRCode_loginçš„èµ·å§‹ä½ç½®åˆ¤æ–­validationä¸­ä¿®æ”¹çš„is_loginæ˜¯å¦ä¸ºTrue)</li></ol><h3 id="jd-seckill-maotai"><a class="markdownIt-Anchor" href="#jd-seckill-maotai"></a> <strong><a href="https://github.com/hello8817/jd-seckill-maotai" target="_blank" rel="noopener"> jd-seckill-maotai</a></strong></h3><blockquote><ul><li><h2 id="ä¸»è¦åŠŸèƒ½"><a class="markdownIt-Anchor" href="#ä¸»è¦åŠŸèƒ½"></a> ä¸»è¦åŠŸèƒ½</h2><ul><li>ç™»é™†äº¬ä¸œå•†åŸï¼ˆ<a href="http://www.jd.com" target="_blank" rel="noopener">www.jd.com</a>ï¼‰<ul><li>ç”¨äº¬ä¸œAPPæ‰«ç ç»™å‡ºçš„äºŒç»´ç </li></ul></li><li>é¢„çº¦èŒ…å°<ul><li>å®šæ—¶è‡ªåŠ¨é¢„çº¦</li></ul></li><li>ç§’æ€é¢„çº¦åç­‰å¾…æŠ¢è´­<ul><li>å®šæ—¶å¼€å§‹è‡ªåŠ¨æŠ¢è´­</li></ul></li></ul></li></ul><p><strong>ç‰¹åˆ«å£°æ˜ï¼š</strong></p><ul><li>æœ¬ä»“åº“å‘å¸ƒçš„<code>jd_seckill_maotai</code>é¡¹ç›®ä¸­æ¶‰åŠçš„ä»»ä½•è„šæœ¬ï¼Œä»…ç”¨äºæµ‹è¯•å’Œå­¦ä¹ ç ”ç©¶ï¼Œç¦æ­¢ç”¨äºå•†ä¸šç”¨é€”ï¼Œä¸èƒ½ä¿è¯å…¶åˆæ³•æ€§ï¼Œå‡†ç¡®æ€§ï¼Œå®Œæ•´æ€§å’Œæœ‰æ•ˆæ€§ï¼Œè¯·æ ¹æ®æƒ…å†µè‡ªè¡Œåˆ¤æ–­ã€‚</li><li>æœ¬é¡¹ç›®å†…æ‰€æœ‰èµ„æºæ–‡ä»¶ï¼Œç¦æ­¢ä»»ä½•å…¬ä¼—å·ã€è‡ªåª’ä½“è¿›è¡Œä»»ä½•å½¢å¼çš„è½¬è½½ã€å‘å¸ƒã€‚</li><li><code>ChinaVolvocars</code> å¯¹ä»»ä½•è„šæœ¬é—®é¢˜æ¦‚ä¸è´Ÿè´£ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºç”±ä»»ä½•è„šæœ¬é”™è¯¯å¯¼è‡´çš„ä»»ä½•æŸå¤±æˆ–æŸå®³.</li><li>è¯·å‹¿å°†<code>jd_seckill_maotai</code>é¡¹ç›®çš„ä»»ä½•å†…å®¹ç”¨äºå•†ä¸šæˆ–éæ³•ç›®çš„ï¼Œå¦åˆ™åæœè‡ªè´Ÿã€‚</li><li>å¦‚æœä»»ä½•å•ä½æˆ–ä¸ªäººè®¤ä¸ºè¯¥é¡¹ç›®çš„è„šæœ¬å¯èƒ½æ¶‰å«Œä¾µçŠ¯å…¶æƒåˆ©ï¼Œåˆ™åº”åŠæ—¶é€šçŸ¥å¹¶æä¾›èº«ä»½è¯æ˜ï¼Œæ‰€æœ‰æƒè¯æ˜ï¼Œæˆ‘ä»¬å°†åœ¨æ”¶åˆ°è®¤è¯æ–‡ä»¶ååˆ é™¤ç›¸å…³è„šæœ¬ã€‚</li><li>æ‚¨å¿…é¡»åœ¨ä¸‹è½½åçš„24å°æ—¶å†…ä»è®¡ç®—æœºæˆ–æ‰‹æœºä¸­å®Œå…¨åˆ é™¤ä»¥ä¸Šå†…å®¹ã€‚</li><li>æœ¬é¡¹ç›®éµå¾ª<code>GPL-3.0 License</code>åè®®ï¼Œå¦‚æœæœ¬ç‰¹åˆ«å£°æ˜ä¸<code>GPL-3.0 License</code>åè®®æœ‰å†²çªä¹‹å¤„ï¼Œä»¥æœ¬ç‰¹åˆ«å£°æ˜ä¸ºå‡†ã€‚</li><li><em><strong>æ‚¨ä½¿ç”¨æˆ–è€…å¤åˆ¶äº†æœ¬ä»“åº“ä¸”æœ¬äººåˆ¶ä½œçš„ä»»ä½•ä»£ç æˆ–é¡¹ç›®ï¼Œåˆ™è§†ä¸º<code>å·²æ¥å—</code>æ­¤å£°æ˜ï¼Œè¯·ä»”ç»†é˜…è¯»</strong></em><br><em><strong>æ‚¨åœ¨æœ¬å£°æ˜æœªå‘å‡ºä¹‹æ—¶ç‚¹ä½¿ç”¨æˆ–è€…å¤åˆ¶äº†æœ¬ä»“åº“ä¸”æœ¬äººåˆ¶ä½œçš„ä»»ä½•ä»£ç æˆ–é¡¹ç›®ä¸”æ­¤æ—¶è¿˜åœ¨ä½¿ç”¨ï¼Œåˆ™è§†ä¸º<code>å·²æ¥å—</code>æ­¤å£°æ˜ï¼Œè¯·ä»”ç»†é˜…è¯»</strong></em></li></ul></blockquote><blockquote><p>æ ¹æ®12æœˆ14æ—¥ä»¥æ¥æŠ¢èŒ…å°çš„æ—¥å¿—åˆ†æï¼Œå¤§èƒ†æ¨æ–­å†æ¥å†å‰è¿”å›Jsonæ¶ˆæ¯ä¸­<code>resultCode</code>ä¸<strong>å°ç™½ä¿¡ç”¨</strong>çš„å…³ç³»ã€‚<br>è¿™é‡Œä¸»è¦åˆ†æå‡ºç°é¢‘ç‡æœ€é«˜çš„<code>90016</code>å’Œ<code>90008</code>ã€‚</p><table><thead><tr><th>æ¡ˆä¾‹</th><th>å°ç™½ä¿¡ç”¨</th><th>90016</th><th>90008</th><th>æŠ¢åˆ°è€—æ—¶</th></tr></thead><tbody><tr><td>å¼ ä¸‰</td><td>63.8</td><td>59.63%</td><td>40.37%</td><td>æš‚æœªæŠ¢åˆ°</td></tr><tr><td>æå››</td><td>92.9</td><td>72.05%</td><td>27.94%</td><td>4å¤©</td></tr><tr><td>ç‹äº”</td><td>99.6</td><td>75.70%</td><td>24.29%</td><td>æš‚æœªæŠ¢åˆ°</td></tr><tr><td>èµµå…­</td><td>103.4</td><td>91.02%</td><td>8.9%</td><td>2å¤©</td></tr></tbody></table><p>é£æ§æ”¾è¡Œåæ‰ä¼šè¿›è¡ŒæŠ¢è´­ï¼Œè¿™æ—¶å€™ç”¨çš„åº”è¯¥æ˜¯æ°´åº“è®¡æ•°æ¨¡å‹ï¼Œå‡è®¾æ— æ³•ä¸€æ¬¡æ€§æ‹¿åˆ°æ‰€æœ‰æ•°æ®çš„æƒ…å†µä¸‹æ¥å°½é‡çš„åšåˆ°æŠ¢è´­æˆåŠŸç”¨æˆ·çš„å‡åŒ€åˆ†å¸ƒï¼Œè¿™æ ·å°±å’Œæ¦‚ç‡ç›¸å…³äº†ã€‚</p><p><strong>æŠ¢è´­ç»“æœç¡®è®¤</strong></p><p>æŠ¢è´­æ˜¯å¦æˆåŠŸé€šå¸¸åœ¨ç¨‹åºå¼€å§‹çš„ä¸€åˆ†é’Ÿå†…å¯è§åˆ†æ™“ï¼<br>æœç´¢æ—¥å¿—ï¼Œå‡ºç°â€œæŠ¢è´­æˆåŠŸï¼Œè®¢å•å·xxxxx&quot;ï¼Œä»£è¡¨æˆåŠŸæŠ¢åˆ°äº†ï¼ŒåŠ¡å¿…åŠå°æ—¶å†…æ”¯ä»˜è®¢å•ï¼ç¨‹åºæš‚æ—¶ä¸æ”¯æŒè‡ªåŠ¨åœæ­¢ï¼Œéœ€è¦æ‰‹åŠ¨STOPï¼<br>è‹¥ä¸¤åˆ†é’Ÿè¿˜æœªæŠ¢è´­æˆåŠŸï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯æ²¡æŠ¢åˆ°ï¼ç¨‹åºæš‚æ—¶ä¸æ”¯æŒè‡ªåŠ¨åœæ­¢ï¼Œéœ€è¦æ‰‹åŠ¨STOPï¼</p></blockquote><ul><li><p>åœ¨ç¨‹åºå¼€å§‹è¿è¡Œåï¼Œä¼šæ£€æµ‹æœ¬åœ°æ—¶é—´ä¸äº¬ä¸œæœåŠ¡å™¨æ—¶é—´ï¼Œè¾“å‡ºçš„å·®å€¼ä¸ºã€æœ¬åœ°æ—¶é—´-äº¬ä¸œæœåŠ¡å™¨æ—¶é—´ã€‘ï¼Œå³-50ä¸ºæœ¬åœ°æ—¶é—´æ¯”äº¬ä¸œæœåŠ¡å™¨æ—¶é—´æ…¢50msã€‚ æœ¬ä»£ç çš„æ‰§è¡Œçš„æŠ¢è´­æ—¶é—´ä»¥æœ¬åœ°ç”µè„‘/æœåŠ¡å™¨æ—¶é—´ä¸ºå‡†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, ...)</span>:</span></span><br><span class="line">    <span class="comment"># åˆå§‹åŒ–è¯¯å·®</span></span><br><span class="line">self.diff_time = self.local_time() - self.jd_time()</span><br><span class="line"><span class="comment"># ....</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="comment"># æœ¬åœ°æ—¶é—´å‡å»ä¸äº¬ä¸œçš„æ—¶é—´å·®(ms)ï¼Œèƒ½å¤Ÿå°†æ—¶é—´è¯¯å·®æå‡åˆ°0.1ç§’é™„è¿‘, å…·ä½“ç²¾åº¦ä¾èµ–è·å–äº¬ä¸œæœåŠ¡å™¨æ—¶é—´çš„ç½‘ç»œæ—¶é—´æŸè€—</span></span><br><span class="line">    <span class="keyword">if</span> self.local_time() - self.diff_time &gt;= self.buy_time_ms:</span><br><span class="line">        logger.info(<span class="string">'æ—¶é—´åˆ°è¾¾ï¼Œå¼€å§‹æ‰§è¡Œâ€¦â€¦'</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            time.sleep(self.sleep_interval)</span><br></pre></td></tr></table></figure><p>è¡¥å……ï¼šPythonçš„æ—¶é—´æˆ³é»˜è®¤éƒ½æ˜¯ç§’çº§åˆ«çš„ï¼Œå¦‚æœè¦msçº§åˆ«çš„ï¼Œåˆ™è¦ä¹˜ä»¥1000</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">é€šè¿‡timeï¼Œä»¥å…ƒç»„ï¼ˆstruct_timeï¼‰ä¸ºæ ¸å¿ƒå®ç°æ—¶é—´æˆ³å’Œæ ¼å¼åŒ–æ—¶é—´å­—ç¬¦ä¸²çš„ç›¸äº’è½¬æ¢ã€‚</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="comment"># è·å¾—10ä½ç§’çº§æ—¶é—´æˆ³</span></span><br><span class="line">seconds = time.time()</span><br><span class="line"><span class="comment"># è·å¾—13ä½æ¯«ç§’çº§æ—¶é—´æˆ³==&gt;javaé»˜è®¤13ä½</span></span><br><span class="line">millis = int(round(time.time() * <span class="number">1000</span>))</span><br><span class="line"><span class="comment"># åŒæ ·ï¼Œtimeä¸‹çš„mktimeä¹Ÿéœ€è¦*1000</span></span><br><span class="line">time.mktime(self.buy_time.timetuple()) * <span class="number">1000.0</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">é€šè¿‡datetimeï¼Œä»¥datetimeç±»å®ä¾‹å¯¹è±¡ä¸ºæ ¸å¿ƒå®ç°æ—¶é—´æˆ³å’Œæ ¼å¼åŒ–æ—¶é—´å­—ç¬¦ä¸²çš„ç›¸äº’è½¬æ¢ã€‚</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="comment"># è·å¾—å½“å‰æ—¶é—´</span></span><br><span class="line">now = datetime.now()</span><br><span class="line">timestamp = datetime.timestamp(now)</span><br><span class="line">print(<span class="string">"æ—¶é—´æˆ³ ="</span>, timestamp)</span><br><span class="line"><span class="comment"># ä¹Ÿæ˜¯10ä½sçº§</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1648622589.624272</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="jd_mask"><a class="markdownIt-Anchor" href="#jd_mask"></a> <strong><a href="https://github.com/Lasx/jd_mask" target="_blank" rel="noopener">jd_mask</a></strong></h3><blockquote><p>æ­¤toolåªå•ç‹¬æ”¯æŒ<strong>é¢„çº¦-æŠ¢è´­-æˆåŠŸåç›´æ¥æäº¤è®¢å•</strong>çš„å•†å“ï¼Œå¦‚[å£ç½©]ï¼Œåªæä¾›å­¦ä¹ å‚è€ƒç”¨é€”.</p></blockquote><p>â“‚ï¸é˜…è¯»äº†å¤šä»½äº¬ä¸œæŠ¢è´­çš„ä»£ç åï¼Œå‘ç°åŸºæœ¬éƒ½æ˜¯ä»ä¸€ä¸ªæ¨¡æ¿é‡Œä¸æ–­ä¼˜åŒ–å‘å±•å‡ºæ¥çš„ï¼Œååº”äº†å¼€æºçš„æ„ä¹‰ï¼Œä¹Ÿååº”äº†äº¬ä¸œéƒ¨åˆ†ç»†èŠ‚çš„ä¿®æ”¹ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¾—åˆ°ä¸€ä¸ªå‘Šç¤ºï¼šåœ¨å®ç°ç›¸åŒåŠŸèƒ½å‰ï¼Œä¸å¦¨å¤šçœ‹çœ‹ã€å€Ÿé‰´ä¸‹ä»¥å¾€å¯è¡Œçš„ä»£ç ã€‚</p><h3 id="automatic_ticket_purchase"><a class="markdownIt-Anchor" href="#automatic_ticket_purchase"></a> <strong><a href="https://github.com/MakiNaruto/Automatic_ticket_purchase" target="_blank" rel="noopener">Automatic_ticket_purchase</a></strong></h3><p>å¤§éº¦ç½‘æŠ¢è´­æµç¨‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A[å¼€å§‹] --&gt; B(ç™»é™†)</span><br><span class="line">    B --&gt; C&#123;æ˜¯å¦åˆ©ç”¨cookiesç™»é™†&#125;</span><br><span class="line">    C --&gt; |å¦| D[é¡µé¢ç™»é™†]</span><br><span class="line">    C --&gt; |æ˜¯| E[ç™»é™†éªŒè¯]</span><br><span class="line">    D --&gt; E</span><br><span class="line">    E --&gt; G&#123;æ˜¯å¦ç™»é™†æˆåŠŸ&#125;</span><br><span class="line">    G --&gt; |æ˜¯| F[è·å–è´­ç¥¨å¿…è¦ä¿¡æ¯]</span><br><span class="line">    G --&gt; |å¦|ED</span><br><span class="line">    F --&gt; L[æ£€æµ‹æŠ¢ç¥¨ç°åœ¨è´­ç¥¨çŠ¶æ€]</span><br><span class="line">    L --&gt; M&#123;ç›®æ ‡ç¥¨å¯è¿›è¡ŒæŠ¢è´­&#125;</span><br><span class="line">    M --&gt; |å³å°†å¼€æŠ¢|L</span><br><span class="line">    M --&gt; |ç¼ºè´§ç™»è®°|ED((ç»“æŸ))</span><br><span class="line">M --&gt; |ç«‹åˆ»è´­ä¹°|N&#123;æŠ¢è´­&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è·Ÿé™æ—¶ã€å®šæ—¶ç§’æ€ä¸åŒçš„æ˜¯ï¼Œå¤§éº¦ç½‘çš„æŠ¢è´­ä¿¡æ¯æ˜¯é ä¸æ–­åˆ·æ–°çš„ï¼Œéœ€è¦é€šè¿‡ä¸æ–­æ£€æµ‹é¡µé¢å†…å®¹ï¼Œåˆ¤æ–­ç›®å‰ç¥¨çš„å¯å¦è´­ä¹°æƒ…å†µã€‚å¦‚æœåˆ·æ–°ä¸ºå¯è´­ä¹°åˆ™è¿›è¡ŒæŠ¢è´­è´­ä¹°ã€‚</p></blockquote><ul><li><p>ç‚¹å‡»è´­ä¹°æ˜¯å¯¹æŒ‡å®šæ¥å£å‘é€è¯·æ±‚ï¼Œå¹¶æ›´æ–°cookies(cookieså«Œå°‘ä¸å«Œå¤š)ï¼šstep2_click_buy_now</p></li><li><p>æäº¤è®¢å•ï¼šstep3_submit_order</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">response = self.session.post(<span class="string">'https://buy.damai.cn/multi/trans/createOrder'</span>,</span><br><span class="line">                             headers=headers,</span><br><span class="line">                             params=params,</span><br><span class="line">                             data=submit_order_info,</span><br><span class="line">                             cookies=self.login_cookies)</span><br><span class="line">buy_status = json.loads(response.text)</span><br><span class="line"><span class="keyword">if</span> buy_status.get(<span class="string">'success'</span>) <span class="keyword">is</span> <span class="keyword">True</span> <span class="keyword">and</span> buy_status.get(<span class="string">'module'</span>).get(<span class="string">'alipayOrderId'</span>):</span><br><span class="line">    print(<span class="string">'-'</span> * <span class="number">10</span>, <span class="string">'æŠ¢ç¥¨æˆåŠŸ, è¯·å‰å¾€ å¤§éº¦ç½‘-&gt;æˆ‘çš„å¤§éº¦-&gt;äº¤æ˜“ä¸­å¿ƒ-&gt;è®¢å•ç®¡ç† ç¡®è®¤è®¢å•'</span>, <span class="string">'-'</span> * <span class="number">10</span>)</span><br><span class="line">    print(<span class="string">'alipayOrderId: '</span>, buy_status.get(<span class="string">'module'</span>).get(<span class="string">'alipayOrderId'</span>))</span><br><span class="line">    print(<span class="string">'æ”¯ä»˜å®æ”¯ä»˜é“¾æ¥: '</span>, buy_status.get(<span class="string">'module'</span>).get(<span class="string">'alipayWapCashierUrl'</span>))</span><br></pre></td></tr></table></figure></li></ul><h3 id="nikerobot"><a class="markdownIt-Anchor" href="#nikerobot"></a> <strong><a href="https://github.com/cxiaoer/NikeRobot" target="_blank" rel="noopener"> NikeRobot</a></strong></h3><ul><li><p>pdbè°ƒè¯•æ–­ç‚¹ï¼š==&gt;å®é™…ä¸ŠPycharmçš„è°ƒè¯•æ›´åŠ å¥½ç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> DEBUG:</span><br><span class="line">pdb.set_trace()</span><br></pre></td></tr></table></figure></li><li><p>å°†ç±»æˆå‘˜å±æ€§è½¬æˆå­—å…¸å½¢å¼: <code>NikeLoginParam().__dict__</code></p></li><li><p>è‡ªå·±ç®¡ç†çº¿ç¨‹ï¼šåˆ›å»ºç»§æ‰¿Threadçš„æ‰§è¡Œç±»ï¼Œé‡å†™runæ–¹æ³•ï¼Œåœ¨mainä¸­è¿›è¡Œåˆ›å»ºå¤šä¸ªå®ä¾‹MyThread().start()ï¼Œå¹¶joinä½ã€‚</p></li></ul><h3 id="hpv4g"><a class="markdownIt-Anchor" href="#hpv4g"></a> <strong><a href="https://github.com/xiangmingzhe0928/hpv4g" target="_blank" rel="noopener">hpv4g</a>â˜…</strong></h3><ul><li><p>æ˜¯å¦ä½¿ç”¨ä»£ç†ï¼š<code>init_ip_proxy_pool</code></p></li><li><p>å¤šçº¿ç¨‹å‚æ•°è®¾ç½®: python3.8ä¸­ThreadPoolExecutorçš„é»˜è®¤workerï¼š<code>max_workers = min(32, os.cpu_count() + 4)</code></p></li><li><p>çº¿ç¨‹æ± ï¼šThreadPoolExecutor</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor, wait, FIRST_COMPLETED</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> ThreadPoolExecutor(max_workers=max_workers) <span class="keyword">as</span> t:</span><br><span class="line">    fs = [t.submit(sec_kill_task, miao_miao, params[i % _params_len],</span><br><span class="line">                   <span class="keyword">None</span> <span class="keyword">if</span> <span class="keyword">not</span> _ip_proxys_len <span class="keyword">else</span> &#123;</span><br><span class="line">                       <span class="string">'http'</span>: <span class="keyword">None</span> <span class="keyword">if</span> (index := i % _ip_proxys_len) == <span class="number">0</span> <span class="keyword">else</span> ip_proxys[index]&#125;) <span class="keyword">for</span> i <span class="keyword">in</span></span><br><span class="line">          range(max_workers + <span class="number">5</span>)]</span><br><span class="line">    <span class="comment"># 120Såç»“æŸä»»åŠ¡, æœ‰ä¸€ä¸ªå®Œæˆåˆ™å®Œæˆ</span></span><br><span class="line">    wait(fs, <span class="number">120</span>, return_when=FIRST_COMPLETED)</span><br><span class="line">    <span class="keyword">global</span> KILL_FLAG</span><br><span class="line">    KILL_FLAG = <span class="keyword">True</span></span><br><span class="line">    print(<span class="string">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;æœ¬è½®æœªæˆåŠŸç§’æ€åˆ°ç–«è‹—&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;'</span>)</span><br></pre></td></tr></table></figure></li><li><p>ç¼“å­˜é…ç½®â€”â€”éé»˜è®¤å‚æ•°çš„è£…é¥°å™¨ï¼šè€ƒè™‘æå‰ç¼“å­˜ç–«è‹—åˆ—è¡¨ ç§’æ€å¼€å§‹åè·³è¿‡æŸ¥è¯¢åˆ—è¡¨ç­‰æ“ä½œ ç›´æ¥è°ƒç”¨ç§’æ€æ¥å£</p></li><li><p>è·å–æœåŠ¡å™¨å½“å‰æ—¶é—´æˆ³</p></li><li><p>ç›´æ¥è®¾ç½®loggingä¸­çš„log</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="comment"># è®¾ç½®é…ç½®</span></span><br><span class="line">logging.basicConfig(handlers=[logging.FileHandler(filename=LOG_NAME,</span><br><span class="line">                                                  encoding=<span class="string">'utf-8'</span>, mode=<span class="string">'a+'</span>)],</span><br><span class="line">                    format=<span class="string">'%(asctime)s %(message)s'</span>,</span><br><span class="line">                    level=getattr(logging, args.log))</span><br><span class="line"><span class="comment"># ä½¿ç”¨</span></span><br><span class="line">logging.info(<span class="string">"xxx"</span>)</span><br><span class="line">logging.debug(<span class="string">"yyy"</span>)</span><br></pre></td></tr></table></figure></li><li><p>argueparserä½¿ç”¨ï¼š</p><ul><li><p>actionå‚æ•°: <code>parser.add_argument('-reload_cache', action='store_true', help='åˆ·æ–°--region_codeç–«è‹—åˆ—è¡¨æœ¬åœ°ç¼“å­˜')</code>ï¼Œå‡ºç°reload_cacheå‚æ•°åˆ™ä¸ºtrueï¼Œæ‰€ä»¥é»˜è®¤ä¸ºfalse</p></li><li><p><code>parser.add_argument('--log', default='WARNING', choices=['DEBUG', 'INFO', 'WARNING', 'ERROR'],help='æ—¥å¿—çº§åˆ« é»˜è®¤WARNING')</code></p></li><li><p>add_argumentä¸­çš„typeå®é™…ä¸Šæ˜¯ä¸ªç±»å‹è½¬åŒ–å™¨ï¼Œå¦‚type=intï¼Œå¦‚æœæ— æ³•è½¬æˆintåˆ™æŠ¥é”™ï¼Œå› æ­¤å¯ä»¥å€Ÿæ­¤å‚æ•°å¯¹è¾“å…¥è¿›è¡Œçº¦æŸ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_valid_int_type</span><span class="params">(i)</span>:</span></span><br><span class="line">    valid_int = int(i)</span><br><span class="line">    <span class="keyword">if</span> valid_int &lt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> argparse.ArgumentTypeError(<span class="string">f'invalid int argument:<span class="subst">&#123;i&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">return</span> valid_int</span><br></pre></td></tr></table></figure></li></ul></li><li><p>requestsä½¿ç”¨ï¼š</p><ul><li><p><code>raise_for_status</code>çŠ¶æ€ç éæˆåŠŸæ—¶æŠ›å‡ºå¼‚å¸¸</p></li><li><p>è‡ªå®šä¹‰<code>_get(url, params=None, error_exit=True, **kwargs)</code>æ–¹æ³•ï¼Œæ·»åŠ å‚æ•°ï¼šerror_exit:è¿”å›4XX 5XXé”™è¯¯æ—¶ æ˜¯å¦é€€å‡º</p></li><li><p>cookiesé™¤äº†æ”¾åœ¨requests.get(cookies=xxxCookieDict)ï¼Œè¿˜å¯ä»¥ä½œä¸ºå­—ç¬¦ä¸²è®¾ç½®åœ¨header[â€œ<strong>cookie</strong>â€]ä¸­ï¼ˆæ— sï¼‰ï¼Œå¦‚<code>self._headers[&quot;cookie&quot;]=&quot;k1=v1;_xxhm_=%7B%2x%7D;k3=wxapptoken:v3&quot;</code>ï¼Œé€šè¿‡<code>;</code>æ¥åˆ†å‰²</p></li><li><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># disable ssl warnings</span></span><br><span class="line">requests.packages.urllib3.disable_warnings()</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="æŠ¢è´­å‹ä»£ç æ€»ç»“"><a class="markdownIt-Anchor" href="#æŠ¢è´­å‹ä»£ç æ€»ç»“"></a> æŠ¢è´­å‹ä»£ç æ€»ç»“ï¼š</h3><ul><li><p>å®ç°ä¸»è¦åˆ†ä¸ºselenium(è‡ªåŠ¨æµ‹è¯•å·¥å…·)æ¨¡æ‹Ÿç‚¹å‡»ï¼›apiæ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚</p></li><li><p>ç™»é™†ä¹‹åä¼šå¯¹cookiesè¿›è¡ŒæŒä¹…åŒ–ï¼Œä½¿ç”¨pickleçš„å¥½å¤„æ˜¯æ— æ³•æ˜æ–‡çœ‹æ‡‚ã€å¤åˆ¶</p></li><li><p>å¯ä»¥é€šè¿‡æŒä¹…åŒ–çš„cookiesæ¥ç™»é™†ï¼Œä½†ä¼šæ£€æµ‹cookiesæ˜¯å¦ä»ç„¶æœ‰æ•ˆ</p></li><li><p>å®šæ—¶æŠ¢è´­ä¼šç­‰å¾…sleepåˆ°ä¸´è¿‘æ—¶é—´(while True+sleep(time)çš„æ–¹å¼ or sleepUntil+while try)ï¼Œç„¶åå†è¿›è¡Œå¤šæ¬¡æŠ¢è´­è¯·æ±‚ï¼ˆå¦‚æœæŠ¢è´­çš„2åˆ†é’Ÿå†…æ²¡æŠ¢åˆ°ï¼Œå¤§å¤šæ²¡å¸Œæœ›äº†ï¼Œåªå¥½ç­‰å¾…ä¸‹æ¬¡ï¼‰ï¼›å¦‚æœæ˜¯<a href="#Automatic_ticket_purchase">ç­‰å¾…é¡µé¢åˆ·æ–°çš„</a>ï¼Œåˆ™ä¸æ–­è¯·æ±‚é¡µé¢ï¼Œç­‰åˆ°ç»“æœæ”¹å˜ã€‚</p><ul><li>æ³¨æ„ï¼šç­‰å¾…é—´éš”ä¸è¦è¶…è¿‡æ—¶é—´é˜ˆå€¼ï¼Œå¦‚180så‰æ£€æŸ¥ï¼Œå¦‚æœä¸ç¬¦åˆä¸èƒ½è®©å…¶ç­‰å¾…190s</li></ul></li><li><p>æ¨é€å·¥å…·ï¼šæä¾›ä¸€ä¸ªè‡ªå·±å†™çš„</p><p>config.ini</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[pusher]</span></span><br><span class="line"><span class="attr">pusher_type</span> = pushplus</span><br><span class="line"><span class="attr">push_title</span> = é£é±¼ç§’æ€</span><br><span class="line"></span><br><span class="line"><span class="comment"># https://sct.ftqq.com/</span></span><br><span class="line"><span class="section">[serverchan]</span></span><br><span class="line"><span class="attr">sec_key</span> = SCU35113Te369cebc21f6e483c03fffc400c4c5c05bdad63995c32</span><br><span class="line"></span><br><span class="line"><span class="comment"># https://open.dingtalk.com/document/group/custom-robot-access</span></span><br><span class="line"><span class="section">[dingding]</span></span><br><span class="line"><span class="attr">access_token</span> =</span><br><span class="line"><span class="attr">secret</span> =</span><br><span class="line"></span><br><span class="line"><span class="comment"># http://www.pushplus.plus/</span></span><br><span class="line"><span class="section">[pushplus]</span></span><br><span class="line"><span class="attr">pushplus_token</span> = fedcf6b08f6f4aaeb2948b7d7010eb93</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">__author__ = <span class="string">'Mrli'</span></span><br><span class="line"></span><br><span class="line">CONFIG_INI_FILENAME = <span class="string">"push_config.ini"</span></span><br><span class="line">CONFIG_INI_PATH = Path(__file__).resolve().parent.with_name(<span class="string">"push_config.ini"</span>)</span><br><span class="line"></span><br><span class="line">REMIND_MSG = <span class="string">"""</span></span><br><span class="line"><span class="string">[pusher]</span></span><br><span class="line"><span class="string">pusher_type = pushplus</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[serverchan]</span></span><br><span class="line"><span class="string">sec_key =</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[dingding]</span></span><br><span class="line"><span class="string">access_token =</span></span><br><span class="line"><span class="string">secret =</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[pushplus]</span></span><br><span class="line"><span class="string">pushplus_token = </span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PusherException</span><span class="params">(Exception)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, message)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        super().__init__(message)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IPushUtil</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, content: str, title: str = <span class="string">""</span>)</span> -&gt; bool:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PushplusPush</span><span class="params">(IPushUtil)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, push_title, options: dict)</span>:</span></span><br><span class="line">        self.pushplus_token = options.get(<span class="string">"pushplus_token"</span>)</span><br><span class="line">        self.push_title = push_title</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, content: str, title: str = <span class="string">""</span>)</span> -&gt; bool:</span></span><br><span class="line">        d = &#123;</span><br><span class="line">            <span class="string">"token"</span>: self.pushplus_token,</span><br><span class="line">            <span class="string">"template"</span>: <span class="string">"markdown"</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"&#123;push_title&#125;-&#123;title&#125;"</span>.format(push_title=self.push_title, title=title),</span><br><span class="line">            <span class="string">"content"</span>: content</span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(<span class="string">"http://www.pushplus.plus/send"</span>, data=d)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> (<span class="number">200</span> &lt;= res.json().get(<span class="string">"code"</span>) &lt; <span class="number">300</span>):</span><br><span class="line">            print(res.json())</span><br><span class="line">        <span class="keyword">return</span> <span class="number">200</span> &lt;= res.json().get(<span class="string">"code"</span>) &lt; <span class="number">300</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServerChanPush</span><span class="params">(IPushUtil)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, push_title, options: dict)</span>:</span></span><br><span class="line">        self.sec_key = options.get(<span class="string">"sec_key"</span>)</span><br><span class="line">        self.push_title = push_title</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, content: str, title: str = <span class="string">""</span>)</span> -&gt; bool:</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">'text'</span>: <span class="string">"&#123;push_title&#125;-&#123;title&#125;"</span>.format(push_title=self.push_title, title=title),</span><br><span class="line">            <span class="string">'desp'</span>: content</span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(url=<span class="string">'https://sc.ftqq.com/&#123;&#125;.send'</span>.format(self.sec_key), data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> (res.json().get(<span class="string">"errmsg"</span>) == <span class="string">"success"</span>):</span><br><span class="line">            print(res.json())</span><br><span class="line">        <span class="keyword">return</span> res.json().get(<span class="string">"errmsg"</span>) == <span class="string">"success"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DingDingPush</span><span class="params">(IPushUtil)</span>:</span></span><br><span class="line">    URL = <span class="string">"https://oapi.dingtalk.com/robot/send"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, push_title, options: dict)</span>:</span></span><br><span class="line">        self.access_token = options.get(<span class="string">"access_token"</span>)</span><br><span class="line">        self.secret = options.get(<span class="string">"secret"</span>)</span><br><span class="line">        self.target_url = self.get_url()</span><br><span class="line">        self.push_title = push_title</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_url</span><span class="params">(self)</span>:</span></span><br><span class="line">        timestamp = round(time.time() * <span class="number">1000</span>)</span><br><span class="line">        secret_enc = bytes(self.secret, encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">        string_to_sign = <span class="string">"&#123;&#125;\n&#123;&#125;"</span>.format(timestamp, self.secret)</span><br><span class="line">        string_to_sign_enc = bytes(string_to_sign, encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">        hmac_code = hmac.new(</span><br><span class="line">            secret_enc, string_to_sign_enc, digestmod=hashlib.sha256</span><br><span class="line">        ).digest()</span><br><span class="line">        sign = urllib.parse.quote_plus(base64.b64encode(hmac_code))</span><br><span class="line">        <span class="keyword">return</span> self.URL + <span class="string">"?access_token=&#123;access_token&#125;&amp;timestamp=&#123;timestamp&#125;&amp;sign=&#123;sign&#125;"</span>.format(</span><br><span class="line">            access_token=self.access_token, timestamp=timestamp, sign=sign)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, content: str, title: str = <span class="string">""</span>)</span> -&gt; bool:</span></span><br><span class="line">        msg = self.gen_markdown_msg(title, content)</span><br><span class="line">        <span class="keyword">return</span> self.send(msg)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send</span><span class="params">(self, message)</span>:</span></span><br><span class="line">        resp = requests.post(self.target_url, json=message)</span><br><span class="line">        <span class="keyword">return</span> resp.json()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gen_text_msg</span><span class="params">(content, at=None, at_all=False)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> at <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            at = []</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">"msgtype"</span>: <span class="string">"text"</span>,</span><br><span class="line">            <span class="string">"text"</span>: &#123;<span class="string">"content"</span>: content&#125;,</span><br><span class="line">            <span class="string">"at"</span>: &#123;<span class="string">"atMobiles"</span>: at, <span class="string">"isAtAll"</span>: at_all&#125;,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gen_markdown_msg</span><span class="params">(self, title, text, at=None, at_all=False)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">generateText</span><span class="params">()</span>:</span></span><br><span class="line">            res = <span class="string">""</span></span><br><span class="line">            <span class="comment"># æœ€é¡¶è¡Œæ˜¾ç¤ºæ ‡é¢˜</span></span><br><span class="line">            res += <span class="string">"# "</span> + <span class="string">"&#123;&#125;-"</span>.format(self.push_title) + title + <span class="string">"\n"</span></span><br><span class="line">            <span class="comment"># å†…å®¹</span></span><br><span class="line">            res += text</span><br><span class="line">            <span class="comment"># atå¯¹è±¡</span></span><br><span class="line">            res += reduce(<span class="keyword">lambda</span> x, y: x + <span class="string">"@"</span> + y, at, <span class="string">""</span>)</span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">"msgtype"</span>: <span class="string">"markdown"</span>,</span><br><span class="line">            <span class="string">"markdown"</span>: &#123;</span><br><span class="line">                <span class="string">"title"</span>: title,</span><br><span class="line">                <span class="string">"text"</span>: generateText()</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"at"</span>: &#123;<span class="string">"atMobiles"</span>: at, <span class="string">"isAtAll"</span>: at_all&#125;,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pusher</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, logger=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> logger:</span><br><span class="line">            self.cout = logger.info</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.cout = <span class="keyword">print</span></span><br><span class="line">        self._pusher = self.init()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å®ä¾‹åŒ–pusher</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">from</span> configparser <span class="keyword">import</span> RawConfigParser</span><br><span class="line">        cp = RawConfigParser()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(CONFIG_INI_PATH):</span><br><span class="line">            <span class="keyword">raise</span> PusherException(</span><br><span class="line">                <span class="string">"è¯·åˆ›å»º&#123;filename&#125;é…ç½®æ–‡ä»¶\npusheré…ç½®ä¿¡æ¯å¦‚ä¸‹:\n&#123;msg&#125;"</span>.format(filename=CONFIG_INI_FILENAME, msg=REMIND_MSG))</span><br><span class="line">        cp.read(CONFIG_INI_PATH, encoding=<span class="string">"utf8"</span>)</span><br><span class="line">        pusher_type = cp.get(<span class="string">"pusher"</span>, <span class="string">"pusher_type"</span>).lower()</span><br><span class="line">        push_title = cp.get(<span class="string">"pusher"</span>, <span class="string">"push_title"</span>)</span><br><span class="line">        <span class="comment"># æ˜¯å¦ä½¿ç”¨äº†pusher</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> pusher_type:</span><br><span class="line">            self.cout(<span class="string">"åˆå§‹åŒ–Pusher: å½“å‰æœªé…ç½®Pusher, å¦‚æœéœ€è¦æ¨é€åŠŸèƒ½, åˆ™åœ¨&#123;filename&#125;"</span>.format(filename=CONFIG_INI_FILENAME))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">        generator_info = dict(cp.items(pusher_type))</span><br><span class="line">        <span class="comment"># æ£€æŸ¥pusheré…ç½®</span></span><br><span class="line">        <span class="keyword">if</span> pusher_type <span class="keyword">and</span> <span class="keyword">not</span> self._valid(generator_info):</span><br><span class="line">            <span class="keyword">raise</span> PusherException(<span class="string">"&#123;&#125;_pusheré…ç½®é”™è¯¯ï¼Œä¸èƒ½ä¸ºç©º~"</span>.format(pusher_type))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> pusher_type == <span class="string">"serverchan"</span>:</span><br><span class="line">            <span class="keyword">return</span> ServerChanPush(push_title, generator_info)</span><br><span class="line">        <span class="keyword">elif</span> pusher_type == <span class="string">"dingding"</span>:</span><br><span class="line">            <span class="keyword">return</span> DingDingPush(push_title, generator_info)</span><br><span class="line">        <span class="keyword">elif</span> pusher_type == <span class="string">"pushplus"</span>:</span><br><span class="line">            <span class="keyword">return</span> PushplusPush(push_title, generator_info)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> PusherException(<span class="string">"ä¸å¯çŸ¥pusherç±»å‹~"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_valid</span><span class="params">(config_dict: dict)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        åˆ¤æ–­å­—å…¸å€¼æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="string">        :param dict:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> config_dict.values():</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> v:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, content: str, title: str = <span class="string">""</span>)</span> -&gt; bool:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._pusher:</span><br><span class="line">            self.cout(<span class="string">"å½“å‰æœªé…ç½®pusher, æ¶ˆæ¯æ— æ³•å‘é€"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">return</span> self._pusher.push(content, title)</span><br></pre></td></tr></table></figure><h2 id="weibospider"><a class="markdownIt-Anchor" href="#weibospider"></a> <a href="https://github.com/dataabc/weiboSpider" target="_blank" rel="noopener">weiboSpider</a></h2><blockquote><p>å¯ä»¥è¿ç»­çˆ¬å–<strong>ä¸€ä¸ª</strong>æˆ–<strong>å¤šä¸ª</strong>æ–°æµªå¾®åšç”¨æˆ·ï¼ˆå¦‚<a href="https://weibo.cn/u/1223178222" target="_blank" rel="noopener">èƒ¡æ­Œ</a>ã€<a href="https://weibo.cn/u/1669879400" target="_blank" rel="noopener">è¿ªä¸½çƒ­å·´</a>ã€<a href="https://weibo.cn/u/1729370543" target="_blank" rel="noopener">éƒ­ç¢§å©·</a>ï¼‰çš„æ•°æ®ï¼Œå¹¶å°†ç»“æœä¿¡æ¯å†™å…¥<strong>æ–‡ä»¶</strong>æˆ–<strong>æ•°æ®åº“</strong>ã€‚</p></blockquote><ul><li>â‘ å…è®¸ç”¨æˆ·æŒ‡å®šè‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤é…ç½®æ–‡ä»¶ï¼›â‘¡å¯¹é…ç½®æ–‡ä»¶è¿›è¡Œæ ¡éªŒï¼Œå¹¶å¯¹éæ³•é¡¹è¿›è¡Œæç¤º</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">config = _get_config()</span><br><span class="line">    config_util.validate_config(config)</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_get_config</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""è·å–config.jsonæ•°æ®"""</span></span><br><span class="line">    src = os.path.split(</span><br><span class="line">        os.path.realpath(__file__))[<span class="number">0</span>] + os.sep + <span class="string">'config_sample.json'</span></span><br><span class="line">    config_path = os.getcwd() + os.sep + <span class="string">'config.json'</span></span><br><span class="line">    <span class="keyword">if</span> FLAGS.config_path:</span><br><span class="line">        config_path = FLAGS.config_path</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validate_config</span><span class="params">(config)</span>:</span></span><br><span class="line">    <span class="string">"""éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®"""</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># éªŒè¯filterã€pic_downloadã€video_download</span></span><br><span class="line">    argument_list = [<span class="string">'filter'</span>, <span class="string">'pic_download'</span>, <span class="string">'video_download'</span>]</span><br><span class="line">    <span class="keyword">for</span> argument <span class="keyword">in</span> argument_list:</span><br><span class="line">        <span class="keyword">if</span> config[argument] != <span class="number">0</span> <span class="keyword">and</span> config[argument] != <span class="number">1</span>:</span><br><span class="line">            logger.warning(<span class="string">u'%så€¼åº”ä¸º0æˆ–1,è¯·é‡æ–°è¾“å…¥'</span>, config[argument])</span><br><span class="line">            sys.exit()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># éªŒè¯since_date</span></span><br><span class="line">    since_date = config[<span class="string">'since_date'</span>]</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">not</span> _is_date(str(since_date))) <span class="keyword">and</span> (<span class="keyword">not</span> isinstance(since_date, int)):</span><br><span class="line">        logger.warning(<span class="string">u'since_dateå€¼åº”ä¸ºyyyy-mm-ddå½¢å¼æˆ–æ•´æ•°,è¯·é‡æ–°è¾“å…¥'</span>)</span><br><span class="line">        sys.exit()</span><br></pre></td></tr></table></figure><h2 id="proxy_pool"><a class="markdownIt-Anchor" href="#proxy_pool"></a> <strong><a href="https://github.com/jhao104/proxy_pool" target="_blank" rel="noopener">proxy_pool</a>â˜…</strong></h2><blockquote><p>çˆ¬è™«ä»£ç†IPæ± é¡¹ç›®,ä¸»è¦åŠŸèƒ½ä¸ºå®šæ—¶é‡‡é›†ç½‘ä¸Šå‘å¸ƒçš„å…è´¹ä»£ç†éªŒè¯å…¥åº“ï¼Œå®šæ—¶éªŒè¯å…¥åº“çš„ä»£ç†ä¿è¯ä»£ç†çš„å¯ç”¨æ€§ï¼Œæä¾›APIå’ŒCLIä¸¤ç§ä½¿ç”¨æ–¹å¼ã€‚åŒæ—¶ä½ ä¹Ÿå¯ä»¥æ‰©å±•ä»£ç†æºä»¥å¢åŠ ä»£ç†æ± IPçš„è´¨é‡å’Œæ•°é‡ã€‚</p><p>æ¨¡å—ç»„æˆï¼šè·å–åŠŸèƒ½ã€å­˜å‚¨åŠŸèƒ½ã€æ ¡éªŒåŠŸèƒ½ã€æ¥å£ç®¡ç†</p><p>â­ï¸ç¨‹åºä¸»è¦æ˜¯å¯åŠ¨äº†<code>startServer</code>çš„APIæ¥å£æœåŠ¡ã€<code>startScheduler</code>å®šæ—¶æœåŠ¡</p><ul><li><code>startServer-&gt;runFlask</code>ï¼šæ˜¯å‘å¤–æä¾›äº†é€šè¿‡<strong>proxyHandler</strong>æ¥è·å¾—Redisä¸­çš„proxyæ•°æ®</li><li><code>startScheduler-&gt;sche.add_task(__runProxyFetch)ã€sche.add_task(__runProxyCheck)</code>ï¼Œ<ul><li><code>__runProxyFetch:proxy_fetcher.run()-&gt;proxy_queue-&gt;Checker(&quot;raw&quot;, proxy_queue)</code>è·å¾—å„ä¸ªä»£ç†ç½‘ç«™çš„ä»£ç†ä¿¡æ¯åï¼Œè¿›è¡Œæ ¡éªŒï¼Œæ ¡éªŒæˆåŠŸåˆ™å…¥åº“</li><li><code>__runProxyCheck:proxy in proxy_handler.getAll()-&gt;proxy_queue-&gt;Checker(&quot;use&quot;, proxy_queue)</code>ï¼šé€šè¿‡proxy_handleræ‹¿åˆ°åº“é‡Œæ‰€æœ‰ç°å­˜çš„æ•°æ®åï¼Œè¿›è¡Œæœ‰æ•ˆæ€§æ ¡éªŒï¼Œæ— æ•ˆçš„åˆ™åˆ é™¤ï¼Œæœ‰æ•ˆçš„åˆ™æ›´æ–°ä¿¡æ¯</li></ul></li></ul><p>ä½œä¸ºå­˜å‚¨åŠŸèƒ½çš„æ¥å£proxyHandlerï¼Œä¹Ÿæ˜¯ä¸¤ä¸ªAPIæœåŠ¡ä¸å®šæ—¶æœåŠ¡çš„ä¸­ä»‹ã€‚ç¨‹åºä¹Ÿæ˜¯é€šè¿‡å­˜å‚¨åŠŸèƒ½ï¼Œå°†æ ¸å¿ƒçš„ä¸¤ä¸ªåŠŸèƒ½ï¼š<u>å®šæ—¶æŠ“å–çš„proxyæ•°æ®</u>ä¸<u>æä¾›proxyæ•°æ®ç»™ç”¨æˆ·ä½¿ç”¨</u>æˆåŠŸè”ç³»åœ¨äº†ä¸€èµ·</p></blockquote><ul><li><p>é€šè¿‡å…ƒç±»å®ç°å•ä¾‹æ¨¡å¼ï¼šConfigHandlerï¼Œå…¶å¯ä»¥åœ¨ä»»æ„æ¨¡å—ä¸­ä»¥c = ConfigHandler()çš„å½¢å¼è·å¾—ï¼Œè€Œä¸æ˜¯<code>ConfigHandler.getInstance()</code></p></li><li><p><code>@LazyProperty</code>æ‡’åŠ è½½å±æ€§çš„è£…é¥°å™¨ï¼š åªæœ‰ç”¨åˆ°æ—¶æ‰ä¼šåŠ è½½å¹¶å°†å€¼æ³¨å…¥åˆ°<code>__dict__</code>ã€åŠ è½½ä¸€æ¬¡åå€¼å°±ä¸å†å˜åŒ–ã€ï¼›è®²è§£å¯è§ï¼š<a href="https://www.jianshu.com/p/708dc26f9b92%E2%80%94%E2%80%94%E6%8F%8F%E8%BF%B0%E7%AC%A6or%E4%BF%AE%E9%A5%B0%E7%AC%A6%E5%AE%9E%E7%8E%B0" target="_blank" rel="noopener">https://www.jianshu.com/p/708dc26f9b92â€”â€”æè¿°ç¬¦orä¿®é¥°ç¬¦å®ç°</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LazyProperty</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="comment"># åœ¨è¢«æ³¨è§£ç±»æ–¹æ³•è¢«è§£é‡Šå™¨è¿è¡Œçš„æ—¶å€™å°±ä¼šåˆ›å»ºLazyPropertyå®ä¾‹å¹¶è¿”å›</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, func)</span>:</span></span><br><span class="line">        self.func = func</span><br><span class="line">    <span class="string">"""é€šè¿‡pythonæè¿°ç¬¦æ¥å®ç°"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> instance <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">return</span> self</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># ä¼šå°†ç»“æœå€¼é€šè¿‡setattræ–¹æ³•å­˜å…¥åˆ°instanceå¯¹è±¡å®ä¾‹çš„__dict__ä¸­</span></span><br><span class="line">            value = self.func(instance)</span><br><span class="line">            setattr(instance, self.func.__name__, value)</span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConfigHandler</span><span class="params">(withMetaclass<span class="params">(Singleton)</span>)</span>:</span></span><br><span class="line">    <span class="comment"># è¿”å›ä¸€ä¸ªLazyPropertyå®ä¾‹ </span></span><br><span class="line"><span class="meta">    @LazyProperty</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">serverHost</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> os.environ.get(<span class="string">"HOST"</span>, setting.HOST)</span><br><span class="line">c = ConfigHandler()</span><br><span class="line"><span class="comment"># ä¼šè§¦å‘ConfigHandler.__dict__["serverHost"], ç„¶åæ¥è€Œè§¦å‘LazyPropertyçš„__get__ï¼Œvalue = self.func(instance)ä¼šå¾—åˆ°çœŸæ­£serverHostå‡½æ•°çš„å€¼åå°†å…¶è®¾ç½®åœ¨ConfigHandler instanceå¯¹è±¡çš„__dict__ä¸­ï¼Œç”±äºå¯¹è±¡çš„__dict__["serverHost"]=valueä¼˜å…ˆçº§é«˜äºç±»çš„__dict__["serverHost"]=LazyProperty()å¯¹è±¡ï¼Œå› æ­¤ä¹‹åè°ƒç”¨å¾—åˆ°çš„æ˜¯valueç»“æœ</span></span><br><span class="line">print(c.serverHost)</span><br></pre></td></tr></table></figure><p><code>__get__</code>åªæœ‰è®¿é—®ç±»å±æ€§çš„æ—¶å€™æ‰ä¼šç”Ÿæ•ˆï¼Œè¿™è¾¹æ˜¯é€šè¿‡setattrå°†serverHostè®¾ç½®æˆäº†ConfigHandlerçš„ç±»å±æ€§</p></li><li><p>å°è£…äº†ä¸€ä¸ªè¯·æ±‚å·¥å…·ç±»<code>WebRequest</code>:</p><ul><li>å¢åŠ äº†å¼‚å¸¸å¤„ç†çš„åŠŸèƒ½</li><li>å¢åŠ äº†æ—¥å¿—åŠŸèƒ½</li><li>è¯·æ±‚å¤´ä¼šå¾—åˆ°éšæœºUA</li><li>è®¾ç½®é‡è¯•</li></ul></li><li><p>ä½¿ç”¨clickåˆ›å»ºå­å‘½ä»¤ï¼š</p><ol><li>å¾—åˆ°ä¸€ä¸ªclick_group</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CONTEXT_SETTINGS = dict(help_option_names=[<span class="string">'-h'</span>, <span class="string">'--help'</span>])</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.group(context_settings=CONTEXT_SETTINGS)</span></span><br><span class="line"><span class="meta">@click.version_option(version=VERSION)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cli</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""ProxyPool cliå·¥å…·"""</span></span><br></pre></td></tr></table></figure><ol start="2"><li>æŒ‡å®šgroupä¸‹çš„å­å‘½ä»¤</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@cli.command(name="server")</span></span><br><span class="line"><span class="comment"># è¿˜å¯ä»¥è®¾ç½®å‚æ•°: @click.option('--count', default=1, help='Number of greetings.') --&gt; def server(count)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">server</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">""" å¯åŠ¨apiæœåŠ¡ """</span></span><br><span class="line">    click.echo(BANNER)</span><br><span class="line">    startServer()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    cli()</span><br></pre></td></tr></table></figure><p>ç„¶åé€šè¿‡bashè„šæœ¬åŒæ—¶å¼€å¯ä¸¤ä¸ªè¿›ç¨‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line">python proxyPool.py server &amp;</span><br><span class="line">python proxyPool.py schedule</span><br></pre></td></tr></table></figure></li><li><p>DbClient DBå·¥å‚ç±»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DbClient</span><span class="params">(withMetaclass<span class="params">(Singleton)</span>)</span>:</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, db_conn)</span>:</span></span><br><span class="line">        self.parseDbConn(db_conn)</span><br><span class="line">        self.__initDbClient()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parseDbConn</span><span class="params">(cls, db_conn)</span>:</span></span><br><span class="line">        <span class="comment"># å¯ä»¥å…³æ³¨ä¸€ä¸‹urlparseçš„ä½¿ç”¨</span></span><br><span class="line">        db_conf = urlparse(db_conn)</span><br><span class="line">        cls.db_type = db_conf.scheme.upper().strip()</span><br><span class="line">        <span class="comment"># _NetlocResultMixinBaseå¯¹è±¡æ¥è·å–æƒ³è¦çš„å‚æ•°</span></span><br><span class="line">        cls.db_host = db_conf.hostname</span><br><span class="line">        cls.db_port = db_conf.port</span><br><span class="line">        cls.db_user = db_conf.username</span><br><span class="line">        cls.db_pwd = db_conf.password</span><br><span class="line">        cls.db_name = db_conf.path[<span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">return</span> cls</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__initDbClient</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        init DB Client</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        __type = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"SSDB"</span> == self.db_type:</span><br><span class="line">            __type = <span class="string">"ssdbClient"</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">"REDIS"</span> == self.db_type:</span><br><span class="line">            __type = <span class="string">"redisClient"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">assert</span> __type, <span class="string">'type error, Not support DB type: &#123;&#125;'</span>.format(self.db_type)</span><br><span class="line">        self.client = getattr(__import__(__type), <span class="string">"%sClient"</span> % self.db_type.title())(host=self.db_host,</span><br><span class="line">port=self.db_port,</span><br><span class="line">username=self.db_user,</span><br><span class="line">password=self.db_pwd,</span><br><span class="line">db=self.db_name)</span><br></pre></td></tr></table></figure></li><li><p>pythonä¸­ä½¿ç”¨redis</p><blockquote><p>Redisä¸­ä»£ç†å­˜æ”¾çš„ç»“æ„ä¸ºhashï¼šhash  æ˜¯ä¸€ä¸ªé”®å€¼(key=&gt;value)å¯¹é›†åˆï¼›æ˜¯ä¸€ä¸ª string ç±»å‹çš„ fieldï¼ˆå­—æ®µï¼‰ å’Œ valueï¼ˆå€¼ï¼‰ çš„<strong>æ˜ å°„è¡¨</strong>ï¼Œhash ç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ã€‚</p><p>æœ¬é¡¹ç›®ä¸­åº”ç”¨ï¼škeyä¸ºip:port, valueä¸ºä»£ç†å±æ€§çš„å­—å…¸;</p></blockquote><ul><li>pythonä¸åˆ›å»ºè¿æ¥</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pip install redis</span></span><br><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> Redis, BlockingConnectionPool</span><br><span class="line">conn_dict = &#123;</span><br><span class="line">    <span class="string">"host"</span>: <span class="string">"49.235.118.244"</span>,</span><br><span class="line">    <span class="string">"port"</span>: <span class="number">6379</span>,</span><br><span class="line">    <span class="string">"db"</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">r = Redis(connection_pool=BlockingConnectionPool(decode_responses=<span class="keyword">True</span>,</span><br><span class="line">                                                 timeout=<span class="number">5</span>,</span><br><span class="line">                                                 socket_timeout=<span class="number">15</span>,</span><br><span class="line">                                                 **conn_dict)</span><br><span class="line">         )</span><br></pre></td></tr></table></figure><ul><li><a href="https://github.com/jhao104/proxy_pool/blob/master/db/redisClient.py" target="_blank" rel="noopener">â˜…hashä½¿ç”¨å°è£…</a></li></ul><blockquote><p>æ·»åŠ ï¼šsetã€zsetä¸ºaddã€listä¸ºpushã€stringå’Œhashä¸ºset</p></blockquote><p>å‚è€ƒ:<a href="https://blog.csdn.net/weixin_39576234/article/details/87603701" target="_blank" rel="noopener">RedisåŸºæœ¬æ¦‚å¿µåŠä½¿ç”¨</a>ã€<a href="https://www.runoob.com/redis/redis-sorted-sets.html%E3%80%81" target="_blank" rel="noopener">https://www.runoob.com/redis/redis-sorted-sets.htmlã€</a><a href="https://www.runoob.com/w3cnote/python-redis-intro.html" target="_blank" rel="noopener">â˜…Python redis ä½¿ç”¨ä»‹ç»</a></p><p><img src="/2022/03/29/å¼€æºé¡¹ç›®ä»£ç é˜…è¯»è®°å½•/E:%5Chexo%5Csource_posts%5C%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB%E8%AE%B0%E5%BD%95%5Credis.jpg" alt="redis"></p></li><li><p>ç»§æ‰¿é‡å†™logging.loggerï¼Œå¯é€‰å‚æ•°ä¸º<code>name, level=DEBUG, stream=True, file=True</code>ï¼Œè®©æ¯ä¸ªåŠŸèƒ½å‡½æ•°éƒ½èƒ½ç”Ÿæˆå•ç‹¬çš„æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶è¿›è¡Œäº†å¯é€‰æ§åˆ¶ã€‚</p><p>ç›¸æ¯”å•ä¾‹ï¼Œæ—¥å¿—ç²¾åº¦æ›´ç»†ï¼Œä½†ä¹Ÿä½¿ç”¨èµ·æ¥ä¹Ÿæ›´éº»çƒ¦ï¼Œéœ€è¦è€ƒè™‘ä»€ä¹ˆåœ°æ–¹éœ€è¦ã€‚</p></li><li><p>æä¾›&quot;æ‰©å±•ä»£ç†&quot;æ¥å£</p><ol><li><p>åœ¨<a href="https://github.com/jhao104/proxy_pool/blob/1a3666283806a22ef287fba1a8efab7b94e94bac/fetcher/proxyFetcher.py#L21" target="_blank" rel="noopener">ProxyFetcher</a>ç±»ä¸­æ·»åŠ è‡ªå®šä¹‰çš„è·å–ä»£ç†çš„é™æ€æ–¹æ³•ï¼Œ è¯¥æ–¹æ³•éœ€è¦ä»¥ç”Ÿæˆå™¨(yield)å½¢å¼è¿”å›<code>host:ip</code>æ ¼å¼çš„ä»£ç†</p></li><li><p>æ·»åŠ å¥½æ–¹æ³•åï¼Œä¿®æ”¹<a href="https://github.com/jhao104/proxy_pool/blob/1a3666283806a22ef287fba1a8efab7b94e94bac/setting.py#L47" target="_blank" rel="noopener">setting.py</a>æ–‡ä»¶ä¸­çš„<code>PROXY_FETCHER</code>é¡¹ä¸‹æ·»åŠ è‡ªå®šä¹‰æ–¹æ³•çš„åå­—:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PROXY_FETCHER = [</span><br><span class="line">    <span class="string">"freeProxy01"</span>,    </span><br><span class="line">    <span class="string">"freeProxy02"</span>,</span><br><span class="line">    <span class="comment"># ....</span></span><br><span class="line">    <span class="string">"freeProxyCustom1"</span>  <span class="comment">#  # ç¡®ä¿åå­—å’Œä½ æ·»åŠ æ–¹æ³•åå­—ä¸€è‡´</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><code>schedule</code> è¿›ç¨‹ä¼šæ¯éš”ä¸€æ®µæ—¶é—´æŠ“å–ä¸€æ¬¡ä»£ç†ï¼Œä¸‹æ¬¡æŠ“å–æ—¶ä¼šè‡ªåŠ¨è¯†åˆ«è°ƒç”¨ä½ å®šä¹‰çš„æ–¹æ³•ã€‚</p></li></ol><p><a href="https://github.com/jhao104/proxy_pool/blob/master/helper/fetch.py" target="_blank" rel="noopener">å®ç°æ–¹å¼</a>ï¼š</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">self.log.info(<span class="string">"ProxyFetch : start"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»é…ç½®ä¸­æ‹¿æ‰§è¡Œå‡½æ•°</span></span><br><span class="line"><span class="keyword">for</span> fetch_source <span class="keyword">in</span> self.conf.fetchers:</span><br><span class="line">    <span class="comment"># åˆ¤æ–­ProxyFetcherä¸­æ˜¯å¦æœ‰å®šä¹‰ã€æ˜¯å¦å¯è°ƒç”¨</span></span><br><span class="line">fetcher = getattr(ProxyFetcher, fetch_source, <span class="keyword">None</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> fetcher:</span><br><span class="line">self.log.error(<span class="string">"ProxyFetch - &#123;func&#125;: class method not exists!"</span>.format(func=fetch_source))</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> callable(fetcher):</span><br><span class="line">self.log.error(<span class="string">"ProxyFetch - &#123;func&#125;: must be class method"</span>.format(func=fetch_source))</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">thread_list.append(_ThreadFetcher(fetch_source, proxy_dict))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> thread <span class="keyword">in</span> thread_list:</span><br><span class="line">    thread.setDaemon(<span class="keyword">True</span>)</span><br><span class="line">    thread.start()</span><br><span class="line"><span class="keyword">for</span> thread <span class="keyword">in</span> thread_list:</span><br><span class="line">    thread.join()</span><br><span class="line">self.log.info(<span class="string">"ProxyFetch - all complete!"</span>)</span><br></pre></td></tr></table></figure><ul><li><p>Cpython(é»˜è®¤å®‰è£…çš„éƒ½æ˜¯Cpython)ä¸­Dictå’Œlistã€tupleéƒ½æ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„</p><ul><li><p>ä»¥è£…é¥°å™¨çš„å½¢å¼å°†è¿‡æ»¤å™¨å°†å…¥åˆ°å®¹å™¨ä¸­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProxyValidator</span><span class="params">(withMetaclass<span class="params">(Singleton)</span>)</span>:</span></span><br><span class="line">    pre_validator = []</span><br><span class="line">    http_validator = []</span><br><span class="line">    https_validator = []</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addPreValidator</span><span class="params">(cls, func)</span>:</span></span><br><span class="line">        cls.pre_validator.append(func)</span><br><span class="line">        <span class="keyword">return</span> func</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®é™…ä¸Šæ‰§è¡Œäº† formatValidator=ProxyValidator.addPreValidator(formatValidator)</span></span><br><span class="line"><span class="comment"># ç”±äºaddPreValidatorè¿”å›äº†func, æ‰€ä»¥formatValidatorè¿˜æ˜¯åŸæ¥çš„addPreValidator, ä½†åœ¨ç±»å®šä¹‰çš„æ—¶å€™ProxyValidator.pre_validatoræ·»åŠ äº†formatValidatoræ–¹æ³•</span></span><br><span class="line"><span class="meta">@ProxyValidator.addPreValidator</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">formatValidator</span><span class="params">(proxy)</span>:</span></span><br><span class="line">    <span class="string">"""æ£€æŸ¥ä»£ç†æ ¼å¼"""</span></span><br><span class="line">    verify_regex = <span class="string">r"\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;:\d&#123;1,5&#125;"</span></span><br><span class="line">    _proxy = findall(verify_regex, proxy)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">True</span> <span class="keyword">if</span> len(_proxy) == <span class="number">1</span> <span class="keyword">and</span> _proxy[<span class="number">0</span>] == proxy <span class="keyword">else</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DoValidator</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">""" æ ¡éªŒæ‰§è¡Œå™¨ """</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validator</span><span class="params">(cls, proxy)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        æ ¡éªŒå…¥å£</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            proxy: Proxy Object</span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            Proxy Object</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        http_r = cls.httpValidator(proxy)</span><br><span class="line">        https_r = <span class="keyword">False</span> <span class="keyword">if</span> <span class="keyword">not</span> http_r <span class="keyword">else</span> cls.httpsValidator(proxy)</span><br><span class="line"></span><br><span class="line">        proxy.check_count += <span class="number">1</span></span><br><span class="line">        proxy.last_time = datetime.now().strftime(<span class="string">"%Y-%m-%d %H:%M:%S"</span>)</span><br><span class="line">        proxy.last_status = <span class="keyword">True</span> <span class="keyword">if</span> http_r <span class="keyword">else</span> <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">if</span> http_r:</span><br><span class="line">            <span class="keyword">if</span> proxy.fail_count &gt; <span class="number">0</span>:</span><br><span class="line">                proxy.fail_count -= <span class="number">1</span></span><br><span class="line">            proxy.https = <span class="keyword">True</span> <span class="keyword">if</span> https_r <span class="keyword">else</span> <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            proxy.fail_count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> proxy</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">preValidator</span><span class="params">(cls, proxy)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> func <span class="keyword">in</span> ProxyValidator.pre_validator:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> func(proxy):</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><a href="http://www.network-science.de/ascii/" target="_blank" rel="noopener">starter-banner</a>ï¼šå¯åŠ¨æ¨ªå¹…</p><ul><li>reflection: Noã€adjustment: cewnterã€Stretch: Yesã€width: 80</li><li>è¿˜ä¸é”™çš„fontï¼š<ul><li>5lineobliqueâ€”â€”å¥½çœ‹</li><li>banner3â€”â€”æ¸…æ¥š</li><li>bellâ€”â€”æŠ½è±¡</li><li>bigâ€”â€”æ¸…æ™°</li><li>bigchiefâ€”â€”ç­‰é«˜çº¿ç‰ˆæœ¬ã€è‰ºæœ¯</li><li>blockâ€”â€”å—çŠ¶</li><li>bulbheadâ€”â€”å¯çˆ±</li><li>larry3dâ€”â€”ç«‹ä½“3d</li><li>ogreâ€”â€”æ¸…æ™°</li><li>puffyâ€”â€”æ¸…æ™°+ä¸€ç‚¹å¯çˆ±</li><li>slantâ€”â€”æ¸…æ™°+æ–œä½“</li></ul></li></ul></li><li><p>å®šæ—¶å™¨æ¡†æ¶apscheduleé…ç½®:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">scheduler = BlockingScheduler(logger=scheduler_log, timezone=timezone)</span><br><span class="line"></span><br><span class="line">scheduler.add_job(__runProxyCheck, <span class="string">'interval'</span>, minutes=<span class="number">2</span>, id=<span class="string">"proxy_check"</span>, name=<span class="string">"proxyæ£€æŸ¥"</span>)</span><br><span class="line"></span><br><span class="line">executors = &#123;</span><br><span class="line">    <span class="comment"># job_defaultsä¸­çš„max_instancesä¹Ÿå—é™äºmax_workers, æ‰€ä»¥è¦å¤§äºmax_instancesï¼›æ­¤å¤–max_workersä¹Ÿå†³å®šäº†åŒæ—¶èƒ½å¤„ç†å‡ ä¸ªåŒæ—¶å‘ç”Ÿçš„task</span></span><br><span class="line">    <span class="string">'default'</span>: &#123;<span class="string">'type'</span>: <span class="string">'threadpool'</span>, <span class="string">'max_workers'</span>: <span class="number">20</span>&#125;,</span><br><span class="line">    <span class="string">'processpool'</span>: ProcessPoolExecutor(max_workers=<span class="number">5</span>)</span><br><span class="line">&#125;</span><br><span class="line">job_defaults = &#123;</span><br><span class="line">    <span class="comment"># åˆå¹¶å°†æ‰€æœ‰è¿™äº›é”™è¿‡çš„æ‰§è¡Œåˆå¹¶ä¸ºä¸€ä¸ª, é»˜è®¤ä¸ºTrueã€‚ å¦‚æœæ˜¯å®šæ—¶çš„å­˜å‚¨ä»»åŠ¡çš„è¯ï¼Œå‚æ•°è‚¯å®šä¸åŒï¼Œä¸èƒ½åˆå¹¶æ‰€ä»¥å¾—æ‰‹åŠ¨è®¾ç½®False</span></span><br><span class="line">    <span class="comment"># åƒæœ¬é¡¹ç›®æ¯éš”ä¸€æ®µæ—¶é—´æŠ“å–åˆ°çš„æ•°æ®ä¹Ÿä¸å¤ªä¸€æ ·ï¼Œæ‰€ä»¥æ— æ³•ç›´æ¥å½“ä½œä¸€æ¬¡é”™è¯¯ä»»åŠ¡åˆå¹¶</span></span><br><span class="line">    <span class="string">'coalesce'</span>: <span class="keyword">False</span>,</span><br><span class="line">    <span class="comment"># é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªä½œä¸šåªå…è®¸åŒæ—¶è¿è¡Œä¸€ä¸ªå®ä¾‹ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½œä¸šå³å°†è¿è¡Œï¼Œä½†å‰ä¸€æ¬¡è¿è¡Œå°šæœªå®Œæˆï¼Œåˆ™è®¤ä¸ºæœ€è¿‘ä¸€æ¬¡è¿è¡Œå¤±è´¥ã€‚é€šè¿‡åœ¨æ·»åŠ ä½œä¸šæ—¶ä½¿ç”¨å…³é”®å­—å‚æ•°ï¼Œå¯ä»¥è®¾ç½®è°ƒåº¦ç¨‹åºå…è®¸åŒæ—¶è¿è¡Œçš„ç‰¹å®šä½œä¸šçš„æœ€å¤§å®ä¾‹æ•°ã€‚é»˜è®¤ä¸º1</span></span><br><span class="line">    <span class="string">'max_instances'</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="comment"># æ¡†æ¶ä¼šæ£€æŸ¥æ¯ä¸ªé”™è¿‡çš„æ‰§è¡Œæ—¶é—´ï¼Œå¦‚æœå½“å‰è¿˜åœ¨misfire_grace_timeæ—¶é—´å†…ï¼Œåˆ™ä¼šé‡æ–°å°è¯•æ‰§è¡Œä»»åŠ¡ï¼Œè®¾é«˜ç‚¹å°±å¯ä»¥é¿å…ä»»åŠ¡è¢«æ¼æ‰æ‰§è¡Œã€‚é»˜è®¤ä¸º1</span></span><br><span class="line">    <span class="comment"># "misfire_grace_time": 5  è¯¥é¡¹ç›®æœªä½¿ç”¨ï¼Œè€Œæ˜¯é‡‡ç”¨äº†å¤šä»»åŠ¡å®ä¾‹æ¥è§„é¿ä»»åŠ¡é”™è¿‡æ‰§è¡Œ==&gt;å³å®˜æ–¹ç»™å‡ºä¸¤ç§æ–¹æ¡ˆä¸­çš„å¦ä¸€ç§ã€‚ä»»åŠ¡é”™è¿‡ä¿¡æ¯ï¼šRun time of job "say (trigger: interval[0:00:02])" was missed by 0:00:03.010383</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">scheduler.configure(executors=executors, job_defaults=job_defaults, timezone=timezone)</span><br><span class="line">scheduler.start()</span><br></pre></td></tr></table></figure><p>job_defaultså‚æ•°å«ä¹‰è§<a href="https://apscheduler.readthedocs.io/en/3.x/userguide.html?highlight=max_instances#modifying-jobs" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ã€<a href="https://blog.csdn.net/weixin_44301439/article/details/124062178" target="_blank" rel="noopener">https://blog.csdn.net/weixin_44301439/article/details/124062178</a></p><p>æ³¨ï¼š ç»è¿‡æµ‹è¯•ï¼Œåœ¨add_taskä¸­çš„funcå¦‚æœèµ·äº†å¤šä¸ªçº¿ç¨‹ï¼Œå…¶æ‰§è¡Œä¸å—é™äºscheçš„é…ç½®</p></li><li><p>Pythonä¸­å¦‚æœåªæ˜¯ä½¿ç”¨å…¨å±€å˜é‡åˆ™ä¸éœ€è¦ç”¨globalå£°æ˜ï¼ˆå› ä¸ºå˜é‡æœå¯»ä¼šç”±å†…å¾€å¤–ï¼‰ï¼Œä½†æ˜¯å¦‚æœéœ€è¦ä¿®æ”¹åˆ™éœ€è¦ç”¨globalå£°æ˜ï¼Œå¦åˆ™æ— æ³•æ‰¾åˆ°ç›¸åº”å˜é‡</p></li><li><p>ç”Ÿæˆå™¨ï¼šä½¿ç”¨äº†yieldå…³é”®å­—çš„å‡½æ•°å°±æ˜¯ç”Ÿæˆå™¨ï¼Œç”Ÿæˆå™¨æ˜¯ä¸€ç±»ç‰¹æ®Šçš„è¿­ä»£å™¨ã€‚</p><p>ä½œç”¨ï¼š</p><ul><li>å¤„ç†å¤§é‡æ•°æ®ï¼šç”Ÿæˆå™¨ä¸€æ¬¡è¿”å›ä¸€ä¸ªç»“æœï¼Œè€Œä¸æ˜¯ä¸€æ¬¡è¿”å›æ‰€æœ‰ç»“æœã€‚æ¯”å¦‚<code>sum([i for i in range(10000000000000)])</code>ä¼šå¡æœºï¼›<code>sum(i for i in range(10000000000000))</code>åˆ™ä¸ä¼š</li><li><a href="https://blog.csdn.net/a200822146085/article/details/89388362" target="_blank" rel="noopener">ä»£ç æ›´åŠ ç®€æ´</a>ï¼šå¯ä»¥å‡å°‘å˜é‡ã€ç©ºé—´</li><li>è¿­ä»£å™¨æœ¬èº«çš„ä½œç”¨</li></ul><p>yieldå…³é”®å­—æœ‰ä¸¤ç‚¹ä½œç”¨ï¼š</p><p>ä¿å­˜å½“å‰è¿è¡ŒçŠ¶æ€ï¼ˆ<strong>æ–­ç‚¹</strong>ï¼‰ï¼Œç„¶åæš‚åœæ‰§è¡Œï¼Œå³å°†ç”Ÿæˆå™¨ï¼ˆå‡½æ•°ï¼‰æŒ‚èµ·ï¼›å¯ä»¥ä½¿ç”¨next()å‡½æ•°è®©ç”Ÿæˆå™¨ä»æ–­ç‚¹å¤„<strong>ç»§ç»­æ‰§è¡Œ</strong>ï¼Œå³å”¤é†’ç”Ÿæˆå™¨ï¼ˆå‡½æ•°ï¼‰<br>å°†yieldå…³é”®å­—åé¢è¡¨è¾¾å¼çš„å€¼ä½œä¸º<strong>è¿”å›å€¼è¿”å›</strong>ï¼Œæ­¤æ—¶å¯ä»¥ç†è§£ä¸ºèµ·åˆ°äº†returnçš„ä½œç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__runProxyFetch</span><span class="params">()</span>:</span>     </span><br><span class="line">    <span class="keyword">for</span> proxy <span class="keyword">in</span> proxy_fetcher.run():</span><br><span class="line">        proxy_queue.put(proxy)</span><br><span class="line">        </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fetcher</span><span class="params">(object)</span>:</span></span><br><span class="line">    name = <span class="string">"fetcher"</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># ...</span></span><br><span class="line">        <span class="comment"># ç›¸æ¯”ä½¿ç”¨ç”Ÿæˆæ¨å¯¼å¼ return [p for p in proxy_dict.values() if DoValidator.preValidator(p.proxy)]ï¼Œ ä½¿ç”¨yieldç”Ÿæˆå™¨å¯ä»¥èŠ‚çœç©ºé—´</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> proxy_dict.values():</span><br><span class="line">                <span class="keyword">if</span> DoValidator.preValidator(_.proxy):</span><br><span class="line">                    <span class="keyword">yield</span> _</span><br></pre></td></tr></table></figure></li><li><p>åº”ç”¨éƒ¨ç½²ï¼š</p><p>â‘ å¯¹apkæ¢æºï¼›â‘¡è®¾ç½®æ—¶åŒº</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.6</span>-alpine</span><br><span class="line"><span class="comment"># ..</span></span><br><span class="line"><span class="comment"># apk repository</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> sed -i <span class="string">'s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g'</span> /etc/apk/repositories</span></span><br><span class="line"><span class="bash"><span class="comment"># timezone</span></span></span><br><span class="line"><span class="bash">RUN apk add -U tzdata &amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; apk del tzdata</span></span><br><span class="line"><span class="bash"><span class="comment"># ...</span></span></span><br><span class="line"><span class="bash">ENTRYPOINT [ <span class="string">"sh"</span>, <span class="string">"start.sh"</span> ]</span></span><br></pre></td></tr></table></figure><p><code>docker-compose.yml</code>ï¼š é•œåƒè¿˜æ²¡ç¼–è¯‘å¥½çš„æƒ…å†µã€‚ï¼ˆå¦‚æœè‡ªå·±æ”¹äº†åŠŸèƒ½å¹¶å¯ç”¨çš„è¯ï¼Œéœ€è¦ç”¨è¿™ç§ï¼›æˆ–è€…è‡ªå·±å‘å¸ƒé•œåƒåç”¨åä¸€ç§ï¼‰</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'2'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  proxy_pool:</span></span><br><span class="line"><span class="attr">    build:</span> <span class="string">.</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">proxy_pool</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"5010:5010"</span></span><br><span class="line"><span class="attr">    links:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">proxy_redis</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="attr">      DB_CONN:</span> <span class="string">"redis://@proxy_redis:6379/0"</span></span><br><span class="line"><span class="attr">  proxy_redis:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">"redis"</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">proxy_redis</span></span><br></pre></td></tr></table></figure><p><code>docker-compose.yml</code>ï¼šåˆ«äººé•œåƒå·²ç»ç¼–è¯‘å¥½å¹¶ä¸Šä¼ </p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3"</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  redis:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">    expose:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">6379</span></span><br><span class="line"><span class="attr">  web:</span></span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">jhao104/proxy_pool</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">DB_CONN=redis://redis:6379/0</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"5010:5010"</span></span><br><span class="line"><span class="attr">    depends_on:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">redis</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="schedulerçš„é€»è¾‘"><a class="markdownIt-Anchor" href="#schedulerçš„é€»è¾‘"></a> schedulerçš„é€»è¾‘</h3><p><img src="/2022/03/29/å¼€æºé¡¹ç›®ä»£ç é˜…è¯»è®°å½•/E:%5Chexo%5Csource_posts%5C%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB%E8%AE%B0%E5%BD%95%5Cproxy_pool%E6%97%B6%E5%BA%8F%E5%9B%BE.png" alt="proxy_poolæ—¶åºå›¾"></p><h3 id="é¡¹ç›®ç›®å½•ç»“æ„é»˜å†™"><a class="markdownIt-Anchor" href="#é¡¹ç›®ç›®å½•ç»“æ„é»˜å†™"></a> é¡¹ç›®ç›®å½•ç»“æ„é»˜å†™ï¼š</h3><ul><li>settings: é…ç½®æ–‡ä»¶</li><li>mainï¼šå¯åŠ¨æ–‡ä»¶</li><li>apiï¼šæä¾›è·å–proxyæ•°æ®æ¥å£</li><li>handler:<ul><li>loggerHandlerï¼šæ—¥å¿—ç±»</li><li>configHandlerï¼šå•ä¾‹çš„é…ç½®æ¥å£ç±»</li><li>ProxyHandler: Proxy CRUDæ“ä½œç±»</li></ul></li><li>fetcher: ä»£ç†æ•°æ®è·å–ç±»</li><li>db:<ul><li>dbClinetï¼š å­˜å‚¨åŠŸèƒ½æ¥å£ç±»</li><li>redisClientï¼šå­˜å‚¨åŠŸèƒ½å®ç°ç±»</li></ul></li><li>helper<ul><li>scheduler: å®šæ—¶ä»»åŠ¡çš„å®šä¹‰ä¸å¯åŠ¨ç±»</li><li>validator: proxyæœ‰æ•ˆæ€§æ ¡éªŒç±»</li><li>check: å…·ä½“æ‰§è¡Œæ ¡éªŒé€»è¾‘ç±»</li><li>proxy: è·å–çš„proxyæ•°æ®å°è£…ç±»</li></ul></li><li>utils:<ul><li>lazyPropertyï¼š æ‡’åŠ è½½æè¿°å™¨</li><li>singleton: å•ä¾‹ç®¡ç†å™¨ç±»</li><li>sixï¼š python2ä¸python3å…¼å®¹ç±»</li><li>webRequest: ç½‘ç»œè¯·æ±‚å°è£…ç±»</li></ul></li></ul><h2 id="æéªŒæ»‘å—éªŒè¯ç ç ´è§£ä¸ç ”ç©¶ä¸‰æ»‘å—ç¼ºå£è¯†åˆ«"><a class="markdownIt-Anchor" href="#æéªŒæ»‘å—éªŒè¯ç ç ´è§£ä¸ç ”ç©¶ä¸‰æ»‘å—ç¼ºå£è¯†åˆ«"></a> æéªŒæ»‘å—éªŒè¯ç ç ´è§£ä¸ç ”ç©¶ï¼ˆä¸‰ï¼‰ï¼šæ»‘å—ç¼ºå£è¯†åˆ«</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸¤å¼ å›¾ç‰‡ï¼š1. å¸¦ç¼ºå£çš„èƒŒæ™¯å›¾ï¼›2. ä¸ä¹‹å¯¹åº”çš„æ¥å£å›¾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> PIL</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">imshow</span><span class="params">(img, winname=<span class="string">'test'</span>, delay=<span class="number">0</span>)</span>:</span></span><br><span class="line">    <span class="string">"""cv2å±•ç¤ºå›¾ç‰‡"""</span></span><br><span class="line">    cv2.imshow(winname, img)</span><br><span class="line">    cv2.waitKey(delay)</span><br><span class="line">    cv2.destroyAllWindows()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pil_to_cv2</span><span class="params">(img)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    pilè½¬cv2å›¾ç‰‡</span></span><br><span class="line"><span class="string">    :param img: pilå›¾åƒ, &lt;type 'PIL.JpegImagePlugin.JpegImageFile'&gt;</span></span><br><span class="line"><span class="string">    :return: cv2å›¾åƒ, &lt;type 'numpy.ndarray'&gt;</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    img = cv2.cvtColor(np.asarray(img), cv2.COLOR_RGB2BGR)</span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bytes_to_cv2</span><span class="params">(img)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    äºŒè¿›åˆ¶å›¾ç‰‡è½¬cv2</span></span><br><span class="line"><span class="string">    :param img: äºŒè¿›åˆ¶å›¾ç‰‡æ•°æ®, &lt;type 'bytes'&gt;</span></span><br><span class="line"><span class="string">    :return: cv2å›¾åƒ, &lt;type 'numpy.ndarray'&gt;</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># å°†å›¾ç‰‡å­—èŠ‚ç bytes, è½¬æ¢æˆä¸€ç»´çš„numpyæ•°ç»„åˆ°ç¼“å­˜ä¸­</span></span><br><span class="line">    img_buffer_np = np.frombuffer(img, dtype=np.uint8)</span><br><span class="line">    <span class="comment"># ä»æŒ‡å®šçš„å†…å­˜ç¼“å­˜ä¸­è¯»å–ä¸€ç»´numpyæ•°æ®, å¹¶æŠŠæ•°æ®è½¬æ¢(è§£ç )æˆå›¾åƒçŸ©é˜µæ ¼å¼</span></span><br><span class="line">    img_np = cv2.imdecode(img_buffer_np, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> img_np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cv2_open</span><span class="params">(img, flag=None)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    ç»Ÿä¸€è¾“å‡ºå›¾ç‰‡æ ¼å¼ä¸ºcv2å›¾åƒ, &lt;type 'numpy.ndarray'&gt;</span></span><br><span class="line"><span class="string">    :param img: &lt;type 'bytes'/'numpy.ndarray'/'str'/'Path'/'PIL.JpegImagePlugin.JpegImageFile'&gt;</span></span><br><span class="line"><span class="string">    :param flag: é¢œè‰²ç©ºé—´è½¬æ¢ç±»å‹, default: None</span></span><br><span class="line"><span class="string">        eg: cv2.COLOR_BGR2GRAYï¼ˆç°åº¦å›¾ï¼‰</span></span><br><span class="line"><span class="string">    :return: cv2å›¾åƒ, &lt;numpy.ndarray&gt;</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(img, bytes):</span><br><span class="line">        img = bytes_to_cv2(img)</span><br><span class="line">    <span class="keyword">elif</span> isinstance(img, (str, Path)):</span><br><span class="line">        img = cv2.imread(str(img))</span><br><span class="line">    <span class="keyword">elif</span> isinstance(img, np.ndarray):</span><br><span class="line">        img = img</span><br><span class="line">    <span class="keyword">elif</span> isinstance(img, PIL.Image):</span><br><span class="line">        img = pil_to_cv2(img)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">f'è¾“å…¥çš„å›¾ç‰‡ç±»å‹æ— æ³•è§£æ: <span class="subst">&#123;type(img)&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">if</span> flag <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        img = cv2.cvtColor(img, flag)</span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_distance</span><span class="params">(bg, tp, im_show=False, save_path=None)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    :param bg: èƒŒæ™¯å›¾è·¯å¾„æˆ–Pathå¯¹è±¡æˆ–å›¾ç‰‡äºŒè¿›åˆ¶</span></span><br><span class="line"><span class="string">        eg: 'assets/bg.jpg'</span></span><br><span class="line"><span class="string">            Path('assets/bg.jpg')</span></span><br><span class="line"><span class="string">    :param tp: ç¼ºå£å›¾è·¯å¾„æˆ–Pathå¯¹è±¡æˆ–å›¾ç‰‡äºŒè¿›åˆ¶</span></span><br><span class="line"><span class="string">        eg: 'assets/tp.jpg'</span></span><br><span class="line"><span class="string">            Path('assets/tp.jpg')</span></span><br><span class="line"><span class="string">    :param im_show: æ˜¯å¦æ˜¾ç¤ºç»“æœ, &lt;type 'bool'&gt;; default: False</span></span><br><span class="line"><span class="string">    :param save_path: ä¿å­˜è·¯å¾„, &lt;type 'str'/'Path'&gt;; default: None</span></span><br><span class="line"><span class="string">    :return: ç¼ºå£ä½ç½®</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># è¯»å–å›¾ç‰‡</span></span><br><span class="line">    bg_gray = cv2_open(bg, flag=cv2.COLOR_BGR2GRAY)</span><br><span class="line">    tp_gray = cv2_open(tp, flag=cv2.COLOR_BGR2GRAY)</span><br><span class="line">    <span class="comment"># è¾¹ç¼˜æ£€æµ‹</span></span><br><span class="line">    tp_gray = cv2.Canny(tp_gray, <span class="number">255</span>, <span class="number">255</span>)</span><br><span class="line">    bg_gray = cv2.Canny(bg_gray, <span class="number">255</span>, <span class="number">255</span>)</span><br><span class="line">    <span class="comment"># ç›®æ ‡åŒ¹é…</span></span><br><span class="line">    result = cv2.matchTemplate(bg_gray, tp_gray, cv2.TM_CCOEFF_NORMED)</span><br><span class="line">    <span class="comment"># è§£æåŒ¹é…ç»“æœ</span></span><br><span class="line">    min_val, max_val, min_loc, max_loc = cv2.minMaxLoc(result)</span><br><span class="line"></span><br><span class="line">    distance = max_loc[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> save_path <span class="keyword">or</span> im_show:</span><br><span class="line">        <span class="comment"># éœ€è¦ç»˜åˆ¶çš„æ–¹æ¡†é«˜åº¦å’Œå®½åº¦</span></span><br><span class="line">        tp_height, tp_width = tp_gray.shape[:<span class="number">2</span>]</span><br><span class="line">        <span class="comment"># çŸ©å½¢å·¦ä¸Šè§’ç‚¹ä½ç½®</span></span><br><span class="line">        x, y = max_loc</span><br><span class="line">        <span class="comment"># çŸ©å½¢å³ä¸‹è§’ç‚¹ä½ç½®</span></span><br><span class="line">        _x, _y = x + tp_width, y + tp_height</span><br><span class="line">        <span class="comment"># ç»˜åˆ¶çŸ©å½¢</span></span><br><span class="line">        bg_img = cv2_open(bg)</span><br><span class="line">        cv2.rectangle(bg_img, (x, y), (_x, _y), (<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">2</span>)</span><br><span class="line">        <span class="comment"># ä¿å­˜ç¼ºå£è¯†åˆ«ç»“æœåˆ°èƒŒæ™¯å›¾</span></span><br><span class="line">        <span class="keyword">if</span> save_path:</span><br><span class="line">            save_path = Path(save_path).resolve()</span><br><span class="line">            save_path = save_path.parent / <span class="string">f"<span class="subst">&#123;save_path.stem&#125;</span>.<span class="subst">&#123;distance&#125;</span><span class="subst">&#123;save_path.suffix&#125;</span>"</span></span><br><span class="line">            save_path = save_path.__str__()</span><br><span class="line">            cv2.imwrite(save_path, bg_img)</span><br><span class="line">        <span class="comment"># æ˜¾ç¤ºç¼ºå£è¯†åˆ«ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> im_show:</span><br><span class="line">            imshow(bg_img)</span><br><span class="line">    <span class="keyword">return</span> distance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    d = get_distance(</span><br><span class="line">        bg=<span class="string">'assets/bg.jpg'</span>,</span><br><span class="line">        tp=<span class="string">'assets/tp.png'</span>,</span><br><span class="line">        im_show=<span class="keyword">True</span>,</span><br><span class="line">        save_path=<span class="string">'assets/bg.jpg'</span></span><br><span class="line">    )</span><br><span class="line">    print(d)</span><br></pre></td></tr></table></figure><p>ç±»ä¼¼ä»£ç ï¼š<strong><a href="https://github.com/lixi5338619/lxBook" target="_blank" rel="noopener">lxBook</a></strong></p><p>ç›¸å…³æ–‡ç« ï¼š</p><ol><li><a href="https://blog.csdn.net/qq_42857999/article/details/121586389" target="_blank" rel="noopener">æéªŒæ»‘å—éªŒè¯ç ç ´è§£ä¸ç ”ç©¶ï¼ˆä¸€ï¼‰ï¼šASTè¿˜åŸæ··æ·†JS</a></li><li><a href="https://blog.csdn.net/qq_42857999/article/details/121628908" target="_blank" rel="noopener">æéªŒæ»‘å—éªŒè¯ç ç ´è§£ä¸ç ”ç©¶ï¼ˆäºŒï¼‰ï¼šç¼ºå£å›¾ç‰‡è¿˜åŸ</a></li><li><a href="https://blog.csdn.net/qq_42857999/article/details/121635961" target="_blank" rel="noopener">æéªŒæ»‘å—éªŒè¯ç ç ´è§£ä¸ç ”ç©¶ï¼ˆä¸‰ï¼‰ï¼šæ»‘å—ç¼ºå£è¯†åˆ«</a></li><li><a href="https://blog.csdn.net/qq_42857999/article/details/121659205" target="_blank" rel="noopener">æéªŒæ»‘å—éªŒè¯ç ç ´è§£ä¸ç ”ç©¶ï¼ˆå››ï¼‰ï¼šæ»‘å—è½¨è¿¹æ„é€ </a></li><li><a href="https://blog.csdn.net/qq_42857999/article/details/121674134" target="_blank" rel="noopener">æéªŒæ»‘å—éªŒè¯ç ç ´è§£ä¸ç ”ç©¶ï¼ˆäº”ï¼‰ï¼šè¯·æ±‚åˆ†æåŠåŠ å¯†å‚æ•°ç ´è§£</a></li></ol><h1 id="æœºå™¨å­¦ä¹ "><a class="markdownIt-Anchor" href="#æœºå™¨å­¦ä¹ "></a> æœºå™¨å­¦ä¹ </h1><h2 id="cardrecorder"><a class="markdownIt-Anchor" href="#cardrecorder"></a> <strong><a href="https://github.com/ZDZX-T/cardRecorder" target="_blank" rel="noopener">cardRecorder</a></strong></h2><blockquote><p>é€šè¿‡pyautoGUIå®ç°çš„æ–—åœ°ä¸»è®°ç‰Œå™¨ï¼Œæä¾›äº†tkinterçš„ç•Œé¢</p></blockquote><ul><li><p>ä½¿ç”¨pyAutoGuiæ‰¾åˆ°ç±»ä¼¼çš„å›¾ç‰‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment"># è¿›è¡Œæˆªå›¾</span></span><br><span class="line">   img = pyautogui.screenshot(region=myPos)</span><br><span class="line"><span class="comment"># éå†æ‰€æœ‰æ’ç±»å‹    </span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> myCardsNum.keys():</span><br><span class="line">       <span class="comment"># è¿›è¡Œå®šä½, æ‰¾åˆ°pics\\m1.pngåœ¨å½“å‰å›¾ç‰‡imgé‡Œçš„ä½ç½®</span></span><br><span class="line">       result = pyautogui.locateAll(needleImage=<span class="string">'pics\\m'</span> + i + <span class="string">'.png'</span>, haystackImage=img, confidence=myConfidence)</span><br><span class="line">       </span><br><span class="line">       myCardsNum[i] = cardsFilter(list(result), myFilter)</span><br></pre></td></tr></table></figure><p>pyautoGUIå›¾ç‰‡è¯†åˆ«åŠŸèƒ½ä»‹ç»ï¼š</p><blockquote><p>PyAutoGUIå¯ä»¥æˆªå–å±å¹•æˆªå›¾ï¼ˆæˆªå›¾ï¼‰ï¼Œå°†å…¶ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œå¹¶åœ¨å±å¹•ä¸­æŸ¥æ‰¾å›¾åƒ(å®šä½)ã€‚</p></blockquote><ul><li>æˆªå›¾</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æˆªå…¨å±</span></span><br><span class="line">pg.screenshot()  <span class="comment"># åªä¼šä¿å­˜åˆ°å†…å­˜ï¼Œä¸ä¼šç¼“å­˜åˆ°æœ¬åœ°</span></span><br><span class="line">pg.screenshot(<span class="string">'data/screenshot.jpg'</span>)  <span class="comment"># æŒ‡å®šè·¯å¾„ï¼Œåˆ™ä¼šä¿å­˜åˆ°æœ¬åœ°</span></span><br><span class="line"><span class="comment"># æŒ‰ç…§æŒ‡å®šåŒºåŸŸæˆªå±, region(xåæ ‡,yåæ ‡,å®½åº¦,é«˜åº¦)ï¼Œåæ ‡ä¸ºæŒ‡å®šæˆªå›¾çš„å·¦ä¸Šè§’åæ ‡</span></span><br><span class="line">pg.screenshot(imageFilename=<span class="string">'data/screenshot.jpeg'</span>, region=(<span class="number">300</span>, <span class="number">300</span>, <span class="number">500</span>, <span class="number">500</span>))</span><br></pre></td></tr></table></figure><ul><li>å›¾ç‰‡å®šä½</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨å±å¹•ä¸­åŒ¹é…å›¾ç‰‡ï¼Œå¹¶è¿”å›ä½ç½®ç›¸å…³æ•°æ®ï¼ŒåŒ¹é…ä¸åˆ°åˆ™è¿”å› None</span></span><br><span class="line">locate_1 = pg.locateOnScreen(image=<span class="string">'data/test.png'</span>)</span><br><span class="line">print(locate_1)  <span class="comment"># Box(left=177, top=614, width=43, height=37)</span></span><br><span class="line">print(locate_1.left)  <span class="comment"># 177  å¯ä»¥é€šè¿‡ .left ç­‰å±æ€§è·å–ç›¸åº”çš„å€¼</span></span><br><span class="line">print(locate_1[<span class="number">0</span>])  <span class="comment"># 177  ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹æ ‡è·å–ç›¸åº”çš„å€¼</span></span><br><span class="line"><span class="comment"># â€œæ¨¡ç³Šâ€åŒ¹é…  --  å¯ä»¥ä½¿ç”¨å‚æ•° confidence æ¥æŒ‡å®šæ¨¡ç³Šç¨‹åº¦ï¼Œé»˜è®¤æ˜¯ 1ï¼ŒèŒƒå›´æ˜¯ 0 - 1ï¼ˆå½“ç„¶ï¼Œå¤ªä½å°±æ²¡æ„ä¹‰äº†ï¼‰, ä½¿ç”¨è¯¥å‚æ•°è¦æ±‚å·²ç»å®‰è£…å¥½ openCV</span></span><br><span class="line"><span class="comment"># è¿™é‡Œçš„è·¯å¾„å…³é”®å­—æ˜¯ imageï¼Œå’Œä¸Šé¢çš„ imageFilename ä¸åŒï¼Œæ‰€ä»¥å»ºè®®ä¸è¦å†™å…³é”®å­—ï¼Œç›´æ¥å†™è·¯å¾„å°±å¥½ï¼Œé˜²æ­¢å†™é”™</span></span><br><span class="line">locate_2 = pg.locateOnScreen(image=<span class="string">'data/test.png'</span>, confidence=<span class="number">0.9</span>)</span><br><span class="line"><span class="comment"># è¿”å›åŒ¹é…åˆ°çš„å›¾ç‰‡çš„ä¸­å¿ƒä½ç½®åæ ‡</span></span><br><span class="line">center_point_1 = pg.center(locate_1)</span><br><span class="line">print(center_point_1)  <span class="comment"># Point(x=198, y=632)</span></span><br></pre></td></tr></table></figure><p>æ³¨ï¼šå±å¹•æˆªå›¾åŠŸèƒ½éœ€è¦Pillowæ¨¡å—ã€ç½®ä¿¡åº¦éœ€è¦cv</p><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/math98/p/14399644.html" target="_blank" rel="noopener">PyAutoGui å›¾ç‰‡è¯†åˆ«+å®šä½+æˆªå›¾å‡½æ•°æ–‡æ¡£</a>ã€<a href="https://zhuanlan.zhihu.com/p/417147884" target="_blank" rel="noopener">pyautogui çš„æˆªå›¾åŠå›¾ç‰‡åŒ¹é…</a>ã€<a href="https://www.cnblogs.com/gexbooks/p/10790063.html" target="_blank" rel="noopener">pyautogui æ–‡æ¡£ï¼ˆäº”ï¼‰ï¼šæˆªå›¾åŠå®šä½åŠŸèƒ½</a></p></li><li><p>tkinterä½¿ç”¨:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å˜é‡ä½¿ç”¨</span></span><br><span class="line">num_8 = tkinter.StringVar()  <span class="comment"># 8</span></span><br><span class="line">num_8.set(strCards[<span class="number">8</span>])</span><br><span class="line"></span><br><span class="line">root = tkinter.Tk()</span><br><span class="line"><span class="comment"># æ˜¾ç¤º</span></span><br><span class="line">x_start = <span class="number">20</span></span><br><span class="line">y_start = <span class="number">5</span></span><br><span class="line">x_add = <span class="number">30</span></span><br><span class="line">x_dif = <span class="number">2</span></span><br><span class="line">y_dif = <span class="number">25</span></span><br><span class="line"><span class="comment"># æ ‡ç­¾</span></span><br><span class="line">tkinter.Label(root, text=<span class="string">'å¤§'</span>, font=(<span class="string">''</span>, <span class="number">14</span>), width=<span class="number">1</span>).place(x=x_start, y=y_start)</span><br><span class="line"><span class="comment"># è¾“å…¥æ¡†</span></span><br><span class="line">tkinter.Entry(root, textvariable=num_dw, font=(<span class="string">''</span>, <span class="number">14</span>), width=<span class="number">1</span>).place(x=x_start + x_dif, y=y_start + y_dif)</span><br><span class="line"><span class="comment"># è¿›è¡Œå¾ªç¯ç­‰å¾…äº‹ä»¶å‘ç”Ÿ</span></span><br><span class="line">root.main_loop()</span><br></pre></td></tr></table></figure><p>å¸ƒå±€</p><ul><li>pack()ï¼šå°†æ§ä»¶æ”¾ç½®åœ¨çˆ¶æ§ä»¶å†…ä¹‹å‰ï¼Œè§„åˆ’æ­¤æ§ä»¶åœ¨åŒºå—å†…çš„ä½ç½®ã€‚</li><li>grid()ï¼šå°†æ§ä»¶æ”¾ç½®åœ¨çˆ¶æ§ä»¶å†…ä¹‹å‰ï¼Œè§„åˆ’æ­¤æ§ä»¶ä¸ºä¸€ä¸ªç½‘æ ¼ç±»å‹çš„æ¶æ„ã€‚</li><li>place()ï¼šå°†æ§ä»¶æ”¾ç½®åœ¨çˆ¶æ§ä»¶å†…çš„ç‰¹å®š(æŒ‡å®š)ä½ç½®ã€‚</li></ul></li></ul><h2 id="wiki_zh_word2vec"><a class="markdownIt-Anchor" href="#wiki_zh_word2vec"></a> <strong><a href="https://github.com/AimeeLee77/wiki_zh_word2vec" target="_blank" rel="noopener">wiki_zh_word2vec</a></strong></h2><blockquote><p>åˆ©ç”¨Pythonæ„å»ºWikiä¸­æ–‡è¯­æ–™è¯å‘é‡æ¨¡å‹è¯•éªŒâ€”â€”æ‰¾åˆ°ç»™å®šè¯ç›¸ä¼¼çš„è¯è¯­</p><p>ä»£ç æ¶‰åŠï¼šå¼€å‘ç¯å¢ƒå‡†å¤‡ã€æ•°æ®çš„è·å–ã€æ•°æ®çš„é¢„å¤„ç†ã€æ¨¡å‹æ„å»ºå’Œæ¨¡å‹æµ‹è¯•å››å¤§å†…å®¹ï¼Œå¯¹åº”çš„æ˜¯å®ç°æ¨¡å‹æ„å»ºçš„äº”ä¸ªæ­¥éª¤ã€‚</p></blockquote><ol><li><p>å¼€å‘ç¯å¢ƒå‡†å¤‡: Python + gensim (NLPç¥å™¨åº“) +jieba + <a href="https://bintray.com/package/files/byvoid/opencc/OpenCC" target="_blank" rel="noopener">OpenCC</a>(ä¸­æ–‡ç¹ä½“æ›¿æ¢æˆç®€ä½“)</p></li><li><p>æ•°æ®è·å–: åˆ°wikiå®˜ç½‘ä¸‹è½½<a href="https://dumps.wikimedia.org/zhwiki/latest/zhwiki-latest-pages-articles.xml.bz2" target="_blank" rel="noopener">ä¸­æ–‡è¯­æ–™</a>ã€å°†XMLçš„Wikiæ•°æ®è½¬æ¢ä¸ºtextæ ¼å¼ï¼Œä½¿ç”¨åˆ°äº†gensim.corporaä¸­çš„WikiCorpuså‡½æ•°</p></li><li><p>Wikiæ•°æ®é¢„å¤„ç†ï¼šâ‘ ä½¿ç”¨OpenCCè¿›è¡Œç¹ç®€è½¬æ¢ï¼›â‘¡jiebaåˆ†è¯</p></li><li><p>Word2Vecæ¨¡å‹è®­ç»ƒï¼šåˆ†å¥½è¯çš„æ–‡æ¡£å³å¯è¿›è¡Œword2vecè¯å‘é‡æ¨¡å‹çš„è®­ç»ƒäº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®­ç»ƒskip-gramæ¨¡å‹</span></span><br><span class="line">model = Word2Vec(LineSentence(inp), size=<span class="number">400</span>, window=<span class="number">5</span>, min_count=<span class="number">5</span>,</span><br><span class="line">                 workers=multiprocessing.cpu_count())</span><br><span class="line">   </span><br><span class="line"><span class="comment"># ä¿å­˜æ¨¡å‹</span></span><br><span class="line">model.save(outp1)</span><br><span class="line">model.wv.save_word2vec_format(outp2, binary=<span class="keyword">False</span>)</span><br></pre></td></tr></table></figure><p>ä»£ç è¿è¡Œå®Œæˆåå¾—åˆ°å¦‚ä¸‹å››ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­wiki.zh.text.modelæ˜¯å»ºå¥½çš„æ¨¡å‹ï¼Œwiki.zh.text.vectoræ˜¯è¯å‘é‡ã€‚</p></li><li><p>æ¨¡å‹æµ‹è¯•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">model = gensim.models.Word2Vec.load(fdir + <span class="string">'wiki.zh.text.model'</span>)</span><br><span class="line">word = model.most_similar(<span class="string">u"è¶³çƒ"</span>)</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> word:</span><br><span class="line">    <span class="keyword">print</span> (t[<span class="number">0</span>],t[<span class="number">1</span>])</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">è¶³çƒè¿åŠ¨ 0.531202495098</span></span><br><span class="line"><span class="string">å›½é™…è¶³çƒ 0.510423064232</span></span><br><span class="line"><span class="string">è¶³çƒæ¯”èµ› 0.499910503626</span></span><br><span class="line"><span class="string">å›½å®¶è¶³çƒé˜Ÿ 0.488919615746</span></span><br><span class="line"><span class="string">æ’çƒ 0.488108128309</span></span><br><span class="line"><span class="string">ç”·ä½“å­ç¯®çƒ0.482638418674</span></span><br><span class="line"><span class="string">ä½“è‚² 0.47221454978</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure></li></ol><p>é™„ï¼šä»€ä¹ˆæ˜¯è¯å‘é‡? â€”â€”è¯å‘é‡æŠ€æœ¯æ˜¯å°†è¯è½¬åŒ–æˆä¸ºç¨ å¯†å‘é‡ï¼Œå¹¶ä¸”å¯¹äºç›¸ä¼¼çš„è¯ï¼Œå…¶å¯¹åº”çš„è¯å‘é‡ä¹Ÿç›¸è¿‘ã€‚</p><p>åœ¨<a href="https://so.csdn.net/so/search?q=%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener">è‡ªç„¶è¯­è¨€å¤„ç†</a>ä»»åŠ¡ä¸­ï¼Œé¦–å…ˆéœ€è¦è€ƒè™‘è¯å¦‚ä½•åœ¨è®¡ç®—æœºä¸­è¡¨ç¤ºã€‚é€šå¸¸ï¼Œæœ‰ä¸¤ç§è¡¨ç¤ºæ–¹å¼ï¼š</p><ul><li>one-hot representation(ç¦»æ•£è¡¨ç¤º)<ul><li>ä¼ ç»Ÿçš„åŸºäºè§„åˆ™æˆ–åŸºäºç»Ÿè®¡çš„è‡ªç„¶è¯­ä¹‰å¤„ç†æ–¹æ³•å°†å•è¯çœ‹ä½œä¸€ä¸ªåŸå­ç¬¦å·</li><li>æŠŠæ¯ä¸ªè¯è¡¨ç¤ºä¸ºä¸€ä¸ªé•¿å‘é‡ã€‚è¿™ä¸ªå‘é‡çš„ç»´åº¦æ˜¯è¯è¡¨å¤§å°ï¼Œå‘é‡ä¸­åªæœ‰ä¸€ä¸ªç»´åº¦çš„å€¼ä¸º1ï¼Œå…¶ä½™ç»´åº¦ä¸º0ï¼Œè¿™ä¸ªç»´åº¦å°±ä»£è¡¨äº†å½“å‰çš„è¯ã€‚</li><li>one-hot representationç›¸å½“äºç»™æ¯ä¸ªè¯åˆ†é…ä¸€ä¸ªidï¼Œè¿™å°±å¯¼è‡´è¿™ç§è¡¨ç¤ºæ–¹å¼ä¸èƒ½å±•ç¤ºè¯ä¸è¯ä¹‹é—´çš„å…³ç³»ã€‚å¦å¤–ï¼Œone-hot representationå°†ä¼šå¯¼è‡´ç‰¹å¾ç©ºé—´éå¸¸å¤§ï¼Œä½†ä¹Ÿå¸¦æ¥ä¸€ä¸ªå¥½å¤„ï¼Œå°±æ˜¯åœ¨é«˜ç»´ç©ºé—´ä¸­ï¼Œå¾ˆå¤šåº”ç”¨ä»»åŠ¡çº¿æ€§å¯åˆ†ã€‚</li></ul></li><li>distribution representation(åˆ†å¸ƒå¼è¡¨ç¤º)<ul><li>word embeddingæŒ‡çš„æ˜¯å°†è¯è½¬åŒ–æˆä¸€ç§åˆ†å¸ƒå¼è¡¨ç¤ºï¼Œåˆç§°è¯å‘é‡ã€‚åˆ†å¸ƒå¼è¡¨ç¤ºå°†è¯è¡¨ç¤ºæˆä¸€ä¸ªå®šé•¿çš„è¿ç»­çš„ç¨ å¯†å‘é‡ã€‚</li><li>åˆ†å¸ƒå¼è¡¨ç¤ºä¼˜ç‚¹:<ol><li>è¯ä¹‹é—´å­˜åœ¨ç›¸ä¼¼å…³ç³»ï¼šæ˜¯è¯ä¹‹é—´å­˜åœ¨â€œè·ç¦»â€æ¦‚å¿µï¼Œè¿™å¯¹å¾ˆå¤šè‡ªç„¶è¯­è¨€å¤„ç†çš„ä»»åŠ¡éå¸¸æœ‰å¸®åŠ©ã€‚</li><li>åŒ…å«æ›´å¤šä¿¡æ¯ï¼šè¯å‘é‡èƒ½å¤ŸåŒ…å«æ›´å¤šä¿¡æ¯ï¼Œå¹¶ä¸”æ¯ä¸€ç»´éƒ½æœ‰ç‰¹å®šçš„å«ä¹‰ã€‚åœ¨é‡‡ç”¨one-hotç‰¹å¾æ—¶ï¼Œå¯ä»¥å¯¹ç‰¹å¾å‘é‡è¿›è¡Œåˆ å‡ï¼Œè¯å‘é‡åˆ™ä¸èƒ½ã€‚</li></ol></li></ul></li></ul><h1 id="ç³»ç»Ÿè®¾è®¡"><a class="markdownIt-Anchor" href="#ç³»ç»Ÿè®¾è®¡"></a> ç³»ç»Ÿè®¾è®¡</h1><h2 id="python-è‡ªåˆ¶å±å¹•ç¿»è¯‘å·¥å…·"><a class="markdownIt-Anchor" href="#python-è‡ªåˆ¶å±å¹•ç¿»è¯‘å·¥å…·"></a> <a href="https://pythondict.com/python-work/screen-translate-tools/" target="_blank" rel="noopener">Python è‡ªåˆ¶å±å¹•ç¿»è¯‘å·¥å…·</a></h2><p>ç¨‹åºçš„åŠŸèƒ½ä¸»è¦ç”±3ä¸ªæ¨¡å—ç»„æˆ</p><ol><li><p>screenshotï¼šæˆªå›¾</p><blockquote><p>ä½¿ç”¨Pillowåº“</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…PILä¾èµ–: pip install pillow</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step1: ä»å‰ªåˆ‡æ¿è¯»å–å›¾ç‰‡</span></span><br><span class="line">img = ImageGrab.grabclipboard()</span><br><span class="line"><span class="comment"># ä¿å­˜åˆ°æœ¬åœ° or å†…å­˜ä¸­</span></span><br><span class="line">image_result = <span class="string">'./temp.png'</span></span><br><span class="line">img.save(image_result)</span><br></pre></td></tr></table></figure></li><li><p>recognitionï¼šå°†æˆªå›¾ä¸­çš„é—®é¢˜è¯†åˆ«æˆæ–‡å­—</p><blockquote><p>ä½¿ç”¨easyocræˆ–è€…pytesseract</p></blockquote><p>easyocrï¼š</p><ul><li>ç¼–ç¨‹ä½¿ç”¨</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> easyocr</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œçš„è¿‡ç¨‹ä¸­ä¼šå®‰è£…æ‰€éœ€è¦çš„æ¨¡å‹æ–‡ä»¶, ä¹Ÿå¯ä»¥è‡ªå·±ä¸‹è½½åæ”¾åˆ°å¯¹åº”è·¯å¾„ä¸‹</span></span><br><span class="line"><span class="comment"># Windowsï¼šC:\Users\ç”¨æˆ·å.EasyOCR\model</span></span><br><span class="line"><span class="comment"># Linuxï¼š~/ .EasyOCR / model</span></span><br><span class="line">reader = easyocr.Reader([<span class="string">'ch_sim'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨GPUï¼Œçœ‹æ˜¯å¦ä¼šæœ‰æç¤º CUDA not available</span></span><br><span class="line"><span class="comment"># reader = easyocr.Reader(['ch_sim'])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ”¯æŒåŒæ—¶å¤šä¸ªè¯­è¨€, è™½ç„¶å¯ä»¥ä¸€æ¬¡æ€§è¯†åˆ«è®¸å¤šç§è¯­è¨€ï¼Œ</span></span><br><span class="line"><span class="comment"># ä½†å¹¶éæ‰€æœ‰è¯­è¨€éƒ½å¯ä»¥ä¸€èµ·ç”¨ï¼Œé€šå¸¸æ˜¯å…¬å…±è¯­è¨€å’Œä¸€ä¸ªç‰¹æ®Šè¯­ç§å¯ä»¥ä¸€èµ·è¯†åˆ«ï¼Œç›¸äº’å…¼å®¹ï¼Œæ¯”å¦‚è‹±è¯­å’Œæ—¥è¯­ã€‚</span></span><br><span class="line"><span class="comment"># reader = easyocr.Reader(['ch_sim','en'])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯†åˆ«</span></span><br><span class="line">resp = requests.get(<span class="string">'https://images.zsxq.com/Fsl4plilMdpd_C8gXVJT1mKJDui9?e=1656604799&amp;token=kIxbL07-8jAj8w1n4s9zv64FuZZNEATmlU_Vm6zD:Pg0990rjMMQUAlf2bJlNL9lmLSU='</span>)</span><br><span class="line">result = reader.readtext(resp.content)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><ul><li>å‘½ä»¤è¡Œè¿è¡Œï¼š <code>easyocr -l ch_sim en -f test.png --detail=1 --gpu=True</code></li></ul><p>å›¾ç‰‡åŠ è½½å‡½æ•°<code>readtext</code>æ¥æ”¶ä¸‰ç§å‚æ•°</p><ul><li>æ–‡ä»¶è·¯å¾„</li><li>å›¾ç‰‡çš„<code>np_array</code></li><li>å­—èŠ‚æµå¯¹è±¡</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> easyocr</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> ImageGrab</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»å‰ªåˆ‡æ¿ä¸­è·å¾—å›¾ç‰‡</span></span><br><span class="line">r = easyocr.Reader([<span class="string">"ch_sim"</span>])</span><br><span class="line"></span><br><span class="line">img = ImageGrab.grabclipboard()</span><br><span class="line">print(img, type(img))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‚æ•°ä¸º: file path or numpy-array or a byte stream object</span></span><br><span class="line"><span class="comment"># 1: file path</span></span><br><span class="line">img_path = <span class="string">"ttt.png"</span></span><br><span class="line">img.save(img_path)</span><br><span class="line">reg_result = r.readtext(img_path)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2: numpy-array</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">np_img = np.array(img)</span><br><span class="line">reg_result = r.readtext(np_img)</span><br><span class="line">print(reg_result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3: a byte stream object</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">resp = requests.get(<span class="string">'https://images.zsxq.com/Fsl4plilMdpd_C8gXVJT1mKJDui9?e=1656604799&amp;token=kIxbL07-8jAj8w1n4s9zv64FuZZNEATmlU_Vm6zD:Pg0990rjMMQUAlf2bJlNL9lmLSU='</span>)</span><br><span class="line">reg_result = r.readtext(resp.content)</span><br><span class="line">print(reg_result)</span><br></pre></td></tr></table></figure></li><li><p>Translationï¼šå°†æ–‡å­—ç¿»è¯‘</p><blockquote><p>å¯ä»¥ä½¿ç”¨ç½‘ä¸Šçš„æœ‰é“ç¿»è¯‘APIã€æˆ–è€…ç›´æ¥ä½¿ç”¨Googleæä¾›çš„ç¿»è¯‘åº“<code>googletrans</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Googleç¿»è¯‘</span></span><br><span class="line">translator = Translator(service_urls=[<span class="string">'translate.google.cn'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¿»è¯‘æˆä¸­æ–‡</span></span><br><span class="line">content_chinese = translator.translate(content_eng, src=<span class="string">'en'</span>, dest=<span class="string">'zh-cn'</span>).text</span><br></pre></td></tr></table></figure></li><li><p>GUIï¼šå°†ç¿»è¯‘åçš„ç»“æœå±•ç¤º</p><blockquote><p>ä½¿ç”¨ Python è‡ªå¸¦çš„ GUI tkinkerï¼Œå°†è¯†åˆ«åçš„ä¸­æ–‡æ˜¾ç¤ºå‡ºæ¥ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆå§‹åŒ–</span></span><br><span class="line">root = Tk()</span><br><span class="line">root.withdraw()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºç¿»è¯‘åçš„ç»“æœï¼Œä»¥å¯¹è¯æ¡†çš„å½¢å¼</span></span><br><span class="line">tkinter.messagebox.showinfo(<span class="string">'ç¿»è¯‘ç»“æœ'</span>, content_chinese)</span><br></pre></td></tr></table></figure></li></ol><p>å®Œæ•´ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> easyocr</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> ImageGrab, Image</span><br><span class="line"></span><br><span class="line"><span class="comment"># r = easyocr.Reader(["ch_sim"])</span></span><br><span class="line">r = easyocr.Reader([<span class="string">"en"</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">screenShot</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""1. ä»å‰ªåˆ‡æ¿ä¸­è·å¾—å›¾ç‰‡"""</span></span><br><span class="line">    img = ImageGrab.grabclipboard()</span><br><span class="line">    print(img, type(img))</span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">identify</span><span class="params">(img: Image)</span>:</span></span><br><span class="line">    <span class="string">"""2. è¯†åˆ«æ–‡å­—"""</span></span><br><span class="line">    <span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">    np_img = np.array(img)</span><br><span class="line">    reg_result = r.readtext(np_img)</span><br><span class="line">    rs = sorted(reg_result, key=<span class="keyword">lambda</span> x: x[<span class="number">2</span>], reverse=<span class="keyword">True</span>)[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> rs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">translate</span><span class="params">(rs: str)</span>:</span></span><br><span class="line">    <span class="string">"""3. ç¿»è¯‘ï¼šgoogletrans åº“"""</span></span><br><span class="line">    <span class="keyword">from</span> googletrans <span class="keyword">import</span> Translator</span><br><span class="line">    <span class="comment"># Googleç¿»è¯‘</span></span><br><span class="line">    translator = Translator(service_urls=[<span class="string">'translate.google.cn'</span>])</span><br><span class="line">    <span class="comment"># ç¿»è¯‘æˆä¸­æ–‡</span></span><br><span class="line">    translated_str = translator.translate(rs, src=<span class="string">'en'</span>, dest=<span class="string">'zh-cn'</span>).text</span><br><span class="line">    <span class="keyword">return</span> translated_str</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">showText</span><span class="params">(s: str)</span>:</span></span><br><span class="line">    <span class="string">"""4. tkå±•ç¤º"""</span></span><br><span class="line">    <span class="keyword">import</span> tkinter <span class="keyword">as</span> tk</span><br><span class="line">    <span class="keyword">from</span> tkinter.messagebox <span class="keyword">import</span> showinfo  <span class="comment"># å¼¹çª—åº“</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ‰¾åˆ°ä¸»åº”ç”¨</span></span><br><span class="line">    root = tk.Tk()</span><br><span class="line">    <span class="comment"># éšè—ä¸»ç•Œé¢</span></span><br><span class="line">    root.withdraw()</span><br><span class="line">    print(s)</span><br><span class="line">    showinfo(<span class="string">"ç¿»è¯‘ç»“æœ"</span>, s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    img = screenShot()</span><br><span class="line">    <span class="comment"># è¯†åˆ«å‡ºæ¥çš„æ–‡å­—</span></span><br><span class="line">    rs = identify(img)</span><br><span class="line">    translated_str = translate(rs)</span><br><span class="line">    showText(translated_str)</span><br></pre></td></tr></table></figure><h2 id="system-design-primer"><a class="markdownIt-Anchor" href="#system-design-primer"></a> <strong><a href="https://github.com/donnemartin/system-design-primer" target="_blank" rel="noopener">system-design-primer</a></strong></h2><h2 id="go-package-plantuml"><a class="markdownIt-Anchor" href="#go-package-plantuml"></a> <strong><a href="https://github.com/qquunn/go-package-plantuml" target="_blank" rel="noopener"> go-package-plantuml</a></strong></h2><ul><li>goä¸­çš„argueparserï¼š<code>&quot;import github.com/jessevdk/go-flags&quot;</code>ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰flagã€pflagæ¥å¤„ç†è¾“å…¥å‚æ•°</li></ul><h2 id="id-maker"><a class="markdownIt-Anchor" href="#id-maker"></a> <a href="https://github.com/yongxinz/id-maker" target="_blank" rel="noopener">id-maker</a></h2><h2 id="health_checker"><a class="markdownIt-Anchor" href="#health_checker"></a> <a href="https://github.com/Freedomisgood/When_Coding_in_ZJU/blob/main/Health_Checkin/health_checkin_helper_cst.py" target="_blank" rel="noopener">health_checker</a></h2><blockquote><p>æµ™å¤§çš„ç™»é™†åŠ å¯†</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Pythonè½¬ä¹‰å®ç°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_rsa_encrypt</span><span class="params">(self, password_str, e_str, M_str)</span>:</span></span><br><span class="line">    <span class="comment"># å°†strè½¬åŒ–ä¸ºasciiçš„å­—èŠ‚</span></span><br><span class="line">    password_bytes = bytes(password_str, <span class="string">'ascii'</span>)</span><br><span class="line">    <span class="comment"># å¤§ç«¯å¡«å……</span></span><br><span class="line">    password_int = int.from_bytes(password_bytes, <span class="string">'big'</span>)</span><br><span class="line">    <span class="comment"># å°†å…¶æŒ‰ç…§16è¿›åˆ¶çš„å½¢å¼è½¬æˆ10è¿›åˆ¶</span></span><br><span class="line">    e_int = int(e_str, <span class="number">16</span>)</span><br><span class="line">    M_int = int(M_str, <span class="number">16</span>)</span><br><span class="line">    <span class="comment"># password_int^e%M</span></span><br><span class="line">    result_int = pow(password_int, e_int, M_int)</span><br><span class="line">    <span class="comment"># 10è¿›åˆ¶è½¬æˆ16è¿›åˆ¶str, å¹¶ rjust() è¿”å›ä¸€ä¸ªåŸå­—ç¬¦ä¸²å³å¯¹é½,å¹¶ä½¿ç”¨ç©ºæ ¼å¡«å……è‡³é•¿åº¦ width çš„æ–°å­—ç¬¦ä¸²ã€‚</span></span><br><span class="line">    <span class="comment"># "hello".rjust(8, "0") ==&gt; 000hello</span></span><br><span class="line">    <span class="keyword">return</span> hex(result_int)[<span class="number">2</span>:].rjust(<span class="number">128</span>, <span class="string">'0'</span>)</span><br></pre></td></tr></table></figure><p>JsåŠ å¯†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">RSAUtils.encryptedString = <span class="function"><span class="keyword">function</span>(<span class="params">key, s</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> a = [];</span><br><span class="line">    <span class="comment">// sä¸ºåå‘çš„password, å¦‚321321aaa</span></span><br><span class="line"><span class="keyword">var</span> sl = s.length;</span><br><span class="line"><span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (i &lt; sl) &#123;</span><br><span class="line">a[i] = s.charCodeAt(i);</span><br><span class="line">i++;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">// è¡¥è¶³0</span></span><br><span class="line"><span class="keyword">while</span> (a.length % key.chunkSize != <span class="number">0</span>) &#123;</span><br><span class="line">a[i++] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// a ==&gt; 321312aaa000000 çš„ asciiå­—ç¬¦æ•°ç»„</span></span><br><span class="line"><span class="keyword">var</span> al = a.length;</span><br><span class="line"><span class="keyword">var</span> result = <span class="string">""</span>;</span><br><span class="line"><span class="keyword">var</span> j, k, block;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; al; i += key.chunkSize) &#123;</span><br><span class="line">block = <span class="keyword">new</span> BigInt();</span><br><span class="line">j = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (k = i; k &lt; i + key.chunkSize; ++j) &#123;</span><br><span class="line">block.digits[j] = a[k++];</span><br><span class="line">block.digits[j] += a[k++] &lt;&lt; <span class="number">8</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> crypt = key.barrett.powMod(block, key.e);</span><br><span class="line">        </span><br><span class="line"><span class="keyword">var</span> text = key.radix == <span class="number">16</span> ? RSAUtils.biToHex(crypt) : RSAUtils.biToString(crypt, key.radix);</span><br><span class="line">result += text + <span class="string">" "</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result.substring(<span class="number">0</span>, result.length - <span class="number">1</span>); <span class="comment">// Remove last space.</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><code>new BigInt();</code>å¾—åˆ°çš„æ˜¯digits.len=130çš„intæ•°ç»„</li></ul><h2 id="cookiecutter-golang"><a class="markdownIt-Anchor" href="#cookiecutter-golang"></a> <strong><a href="https://github.com/lacion/cookiecutter-golang" target="_blank" rel="noopener">cookiecutter-golang</a></strong></h2><blockquote><p>å¿«é€Ÿç”ŸæˆGoé¡¹ç›®çš„cookiecutteræ¨¡æ¿</p></blockquote><ul><li><a href="https://github.com/lacion/cookiecutter-golang/blob/master/%7B%7Bcookiecutter.app_name%7D%7D/main.go" target="_blank" rel="noopener">cobarä½¿ç”¨</a>ä¸<a href="https://github.com/lacion/cookiecutter-golang/blob/master/%7B%7Bcookiecutter.app_name%7D%7D/cmd/root.go" target="_blank" rel="noopener">cobarå‘½ä»¤å®šä¹‰</a>ï¼Œç›¸å½“äºPythonä¸­çš„Clickæ¨¡å—</li></ul><h2 id="dddd_trainer"><a class="markdownIt-Anchor" href="#dddd_trainer"></a> <strong><a href="https://github.com/sml2h3/dddd_trainer" target="_blank" rel="noopener"> dddd_trainer</a></strong></h2><ul><li><p>Cliå‘½ä»¤ä½¿ç”¨fireåº“ï¼šfireæ˜¯pythonä¸­ç”¨äºç”Ÿæˆå‘½ä»¤è¡Œç•Œé¢(Command Line Interfaces, CLIs)çš„å·¥å…·ï¼Œä¸éœ€è¦åšä»»ä½•é¢å¤–çš„å·¥ä½œï¼Œåªéœ€è¦ä»ä¸»æ¨¡å—ä¸­è°ƒç”¨fire.Fire()ï¼Œå®ƒä¼šè‡ªåŠ¨å°†ä½ çš„ä»£ç è½¬åŒ–ä¸ºCLIï¼Œ<u>Fire()çš„å‚æ•°å¯ä»¥è¯´ä»»ä½•çš„pythonå¯¹è±¡</u></p><p>ç‰¹ç‚¹ï¼šæ‰€æœ‰çš„<strong>å­å‘½ä»¤</strong>éƒ½èƒ½ä»¥å‡½æ•°ã€ç±»ç­‰å½¢å¼ä¹¦å†™ï¼Œæµç¨‹å’Œå‚æ•°è·å–éƒ½æ¯”è¾ƒæ¸…æ™°ï¼›ä¼ å‚å¯ä»¥è‡ªåŠ¨è¢«è§£ææˆPythonç±»å‹ï¼šå­—ç¬¦ä¸²ã€å…ƒç»„ã€åˆ—è¡¨ã€å­—å…¸</p><p>â˜…ä½¿ç”¨æŒ‡å—ï¼š <a href="https://blog.csdn.net/qq_17550379/article/details/79943740" target="_blank" rel="noopener">https://blog.csdn.net/qq_17550379/article/details/79943740</a></p></li><li><p><a href="https://www.jianshu.com/p/476478c17b8e" target="_blank" rel="noopener">ONNXRuntime</a>ï¼š é€šå¸¸æˆ‘ä»¬åœ¨è®­ç»ƒæ¨¡å‹æ—¶å¯ä»¥ä½¿ç”¨å¾ˆå¤šä¸åŒçš„æ¡†æ¶ï¼Œæ¯”å¦‚æœ‰çš„åŒå­¦å–œæ¬¢ç”¨ <code>Pytorch</code>ï¼Œæœ‰çš„åŒå­¦å–œæ¬¢ä½¿ç”¨ <code>TensorFLow</code>ï¼Œä¹Ÿæœ‰çš„å–œæ¬¢ <code>MXNet</code>ï¼Œä»¥åŠæ·±åº¦å­¦ä¹ æœ€å¼€å§‹æµè¡Œçš„ <code>Caffe</code>ç­‰ç­‰ï¼Œè¿™æ ·ä¸åŒçš„è®­ç»ƒæ¡†æ¶å°±å¯¼è‡´äº†äº§ç”Ÿä¸åŒçš„æ¨¡å‹ç»“æœåŒ…ï¼Œåœ¨æ¨¡å‹è¿›è¡Œéƒ¨ç½²æ¨ç†æ—¶å°±éœ€è¦ä¸åŒçš„ä¾èµ–åº“ï¼Œè€Œä¸”åŒä¸€ä¸ªæ¡†æ¶æ¯”å¦‚<code>tensorflow</code> ä¸åŒçš„ç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚è¾ƒå¤§ï¼Œ ä¸ºäº†è§£å†³è¿™ä¸ªæ··ä¹±é—®é¢˜ï¼Œ<a href="https://links.jianshu.com/go?to=https%3A%2F%2Flfaidata.foundation%2F" target="_blank" rel="noopener">LF AI</a> è¿™ä¸ªç»„ç»‡è”åˆ Facebook, MicroSoftç­‰å…¬å¸åˆ¶å®šäº†æœºå™¨å­¦ä¹ æ¨¡å‹çš„æ ‡å‡†ï¼Œè¿™ä¸ªæ ‡å‡†å«åš<strong>ONNX, Open Neural Network Exchage</strong>ï¼Œ<em>æ‰€æœ‰å…¶ä»–æ¡†æ¶äº§ç”Ÿçš„æ¨¡å‹åŒ… (<code>.pth</code>, <code>.pb</code>) éƒ½å¯ä»¥è½¬æ¢æˆè¿™ä¸ªæ ‡å‡†æ ¼å¼ï¼Œè½¬æ¢æˆè¿™ä¸ªæ ‡å‡†æ ¼å¼åï¼Œå°±å¯ä»¥ä½¿ç”¨ç»Ÿä¸€çš„ ONNX Runtimeç­‰å·¥å…·è¿›è¡Œç»Ÿä¸€éƒ¨ç½²ã€‚</em></p></li><li><p><a href="https://pythondict.com/life-intelligent/tools/loguru/" target="_blank" rel="noopener">Loguru â€” æœ€å¼ºå¤§çš„ Python æ—¥å¿—è®°å½•å™¨</a>ï¼š å¼ºå¤§çš„å…¨å±€æ—¥å¿—å¯¹è±¡ï¼Œå…·æœ‰å¼€ç®±å³ç”¨çš„ç‰¹æ€§ã€ç¾è§‚çš„è¾“å‡ºï¼Œæ”¯æŒ<code>f-string</code>ã€æ”¯æŒåœ¨ä¸»è¿›ç¨‹å’Œçº¿ç¨‹ä¸­æ•è·å¼‚å¸¸</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">logger.add(<span class="string">"file.log"</span>, rotation=<span class="string">"12:00"</span> , format=<span class="string">"&#123;time:YYYY-MM-DD at HH:mm:ss&#125; | &#123;level&#125; | &#123;message&#125;"</span>, level=<span class="string">"INFO"</span>)</span><br><span class="line">logger.info(<span class="string">"That's it, beautiful and simple logging!"</span>)</span><br></pre></td></tr></table></figure></li></ul><h2 id="njupt-api"><a class="markdownIt-Anchor" href="#njupt-api"></a> <strong><a href="https://github.com/gaoliang/NJUPT-API" target="_blank" rel="noopener">NJUPT-API</a></strong></h2><blockquote><p>å—äº¬é‚®ç”µå¤§å­¦ç½‘ç«™æ¥å£, Pythonæ¨¡å—</p></blockquote><ul><li><p><code>@login_required</code> è£…é¥°å™¨: ç”±äºæœ‰äº›æ“ä½œå¿…é¡»ç™»å½•åæ‰ä¼šæœ‰æ­£ç¡®ç»“æœï¼Œæ‰€ä»¥ç›¸å½“äºåœ¨æ‰§è¡Œå‰åšäº†ä¸€å±‚æ ¡éªŒï¼ˆè‡³äºæŠ›å‡ºå¼‚å¸¸orè½¬å‘ç™»å½•å°±çœ‹è£…é¥°å™¨ä¸­æ€ä¹ˆå†™äº†ï¼‰â€”&gt; ç”±äºæ˜¯å°è£…æˆäº†packageåº“ï¼Œæ‰€ä»¥åœ¨è¿™ä¸€å±‚éœ€è¦è¿›è¡Œé™åˆ¶ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login_required</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">    @wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.verified:</span><br><span class="line">            self.login_by_sso()</span><br><span class="line">        <span class="keyword">return</span> func(self, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure></li><li><p>setuptoolsä½¿ç”¨</p><ul><li><a href="http://setup.py" target="_blank" rel="noopener">setup.py</a></li><li><a href="http://MANIFEST.in" target="_blank" rel="noopener">MANIFEST.in</a></li></ul></li><li><p>æ¨¡å—æš´éœ²ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># njupt/__init__.py</span></span><br><span class="line"><span class="keyword">from</span> njupt.card <span class="keyword">import</span> Card  <span class="comment"># noqa</span></span><br><span class="line"><span class="keyword">from</span> njupt.zhengfang <span class="keyword">import</span> Zhengfang  <span class="comment"># noqa</span></span><br><span class="line"><span class="keyword">from</span> njupt.library <span class="keyword">import</span> Library  <span class="comment"># noqa</span></span><br><span class="line"><span class="keyword">from</span> njupt.runningman <span class="keyword">import</span> RunningMan  <span class="comment"># noqa</span></span><br><span class="line"><span class="keyword">from</span> njupt.sso <span class="keyword">import</span> SSO  <span class="comment"># noqa</span></span><br><span class="line"><span class="comment"># è¡¨ç¤ºnjuptæ¨¡å—æä¾›ä»¥ä¸‹5ä¸ªæ¥å£</span></span><br><span class="line">__all__ = [<span class="string">'SSO'</span>, <span class="string">'Card'</span>, <span class="string">'Zhengfang'</span>, <span class="string">'Library'</span>, <span class="string">'RunningMan'</span>]</span><br></pre></td></tr></table></figure></li><li><p>éªŒè¯ç è¯†åˆ«</p><blockquote><p>å­—ç¬¦å‹éªŒè¯ç ï¼šæŠŠå›¾ç‰‡å»å™ªã€åˆ†å‰²ã€å½’ç±»ã€‚æ”¶é›†äº†è¶³å¤Ÿå¤šçš„æ ·æœ¬ï¼Œç„¶åå¯¹æ–°çš„å›¾ç‰‡ä¹Ÿåˆ†å‰²ã€‚å°†åˆ†éš”åçš„æ¯ä¸ªå­—ç¬¦ä¸æ ·æœ¬é›†åŒ¹é…ï¼Œé€‰æ¦‚ç‡æœ€å¤§çš„å­—ç¬¦ï¼Œå°†ç»„åˆ</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CardCaptcha</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    ä¸€å¡é€šç³»ç»Ÿçš„éªŒè¯ç å·¥å…·ç±»</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, im)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :param im: PIL.imageå¯¹è±¡</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.im = im.convert(<span class="string">'L'</span>)</span><br><span class="line">        self.image_pre_process()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">image_pre_process</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># äºŒå€¼åŒ–, å»é™¤æ‚è‰²ç‚¹</span></span><br><span class="line">        threshold = <span class="number">200</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(self.im.width):</span><br><span class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> range(self.im.height):</span><br><span class="line">                pix = self.im.getpixel((x, y))</span><br><span class="line">                <span class="keyword">if</span> pix &gt; threshold:</span><br><span class="line">                    self.im.putpixel((x, y), BLACK)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.im.putpixel((x, y), WHITE)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_split_image</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># åˆ‡å‰²éªŒè¯ç ï¼Œè¿”å›åŒ…å«äº”ä¸ªå­—ç¬¦å›¾åƒçš„åˆ—è¡¨</span></span><br><span class="line">        y_min, y_max = <span class="number">0</span>, <span class="number">82</span></span><br><span class="line">        <span class="comment"># å­—ç¬¦ä½ç½®å¤§è‡´å›ºå®š([7,49], [49, 91], ...)</span></span><br><span class="line">        split_lines = [<span class="number">7</span>, <span class="number">49</span>, <span class="number">91</span>, <span class="number">133</span>, <span class="number">175</span>, <span class="number">217</span>]</span><br><span class="line">        ims = [self.im.crop([u, y_min, v, y_max]) <span class="keyword">for</span> u, v <span class="keyword">in</span> zip(split_lines[:<span class="number">-1</span>], split_lines[<span class="number">1</span>:])]</span><br><span class="line">        <span class="keyword">return</span> ims</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">crack</span><span class="params">(self)</span>:</span></span><br><span class="line">        result = []</span><br><span class="line">        <span class="comment"># è£…è½½è®­ç»ƒæ•°æ®é›†</span></span><br><span class="line">        <span class="keyword">with</span> open(os.path.join(current_dir, <span class="string">'image_data.json'</span>), <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            image_data = json.load(f)</span><br><span class="line">        <span class="keyword">for</span> letter <span class="keyword">in</span> self.handle_split_image():</span><br><span class="line">            <span class="comment"># build_vectorå°†å›¾ç‰‡è½¬æˆä¸€ç»´å‘é‡: for pixel in image.getdata():</span></span><br><span class="line">            letter_vector = build_vector(letter)</span><br><span class="line">            guess = []</span><br><span class="line">            <span class="comment"># åœ¨æ¨¡å‹æ•°æ®ä¸­, æ‰¾ä¸€ä¸ªæ±‰æ˜è·ç¦»æœ€å°(æœ€åƒçš„ç»“æœ)</span></span><br><span class="line">            <span class="keyword">for</span> image <span class="keyword">in</span> image_data:</span><br><span class="line">                <span class="comment"># xä¸ºkey, å½“å‰åŒ¹é…çš„å­—ç¬¦; yä¸ºå‘é‡</span></span><br><span class="line">                <span class="keyword">for</span> x, y <span class="keyword">in</span> image.items():</span><br><span class="line">                    <span class="keyword">if</span> len(y) != <span class="number">0</span>:</span><br><span class="line">                        <span class="comment"># è®¡ç®—ä¸¤ä¸ªä¸€ç»´å‘é‡çš„æ±‰æ˜è·ï¼ˆå‘é‡åªåŒ…å«0ï¼Œ1æ—¶ï¼‰:(åªè¦å…ƒç´ å€¼ä¸ç­‰, è·ç¦»å°±+1)</span></span><br><span class="line">                        guess.append((distance_hanmming(y, letter_vector), x))</span><br><span class="line">            guess.sort()</span><br><span class="line">            <span class="comment"># æ‰¾å‡ºè·ç¦»æœ€å°çš„, å³æœ€åŒ¹é…çš„å­—ç¬¦</span></span><br><span class="line">            result.append(guess[<span class="number">0</span>][<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join(result)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.crack()</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šPILä¸­image.convert()å‡½æ•°ä½¿ç”¨</p><ol><li>æ¨¡å¼â€œ1â€ï¼šä¸ºäºŒå€¼å›¾åƒï¼Œéé»‘å³ç™½ã€‚ä½†æ˜¯å®ƒæ¯ä¸ªåƒç´ ç”¨8ä¸ªbitè¡¨ç¤ºï¼Œ0è¡¨ç¤ºé»‘ï¼Œ255è¡¨ç¤ºç™½ã€‚</li><li>æ¨¡å¼â€œLâ€ï¼š ä¸ºç°è‰²å›¾åƒï¼Œå®ƒçš„æ¯ä¸ªåƒç´ ç”¨8ä¸ªbitè¡¨ç¤ºï¼Œ0è¡¨ç¤ºé»‘ï¼Œ255è¡¨ç¤ºç™½ï¼Œå…¶ä»–æ•°å­—è¡¨ç¤ºä¸åŒçš„ç°åº¦ã€‚åœ¨PILä¸­ï¼Œä»æ¨¡å¼â€œRGBâ€è½¬æ¢ä¸ºâ€œLâ€æ¨¡å¼æ˜¯æŒ‰ç…§ä¸‹é¢çš„å…¬å¼è½¬æ¢çš„ï¼š<code>L = R * 299/1000 + G * 587/1000+ B * 114/1000</code></li><li>æ¨¡å¼â€œPâ€ä¸º8ä½å½©è‰²å›¾åƒã€æ¨¡å¼â€œRGBAâ€(alphaé€æ˜åº¦)ä¸º32ä½å½©è‰²å›¾åƒã€æ¨¡å¼â€œCMYKâ€ä¸º32ä½å½©è‰²å›¾åƒ</li></ol></li><li><p>è‡ªåˆ¶æ‰“ç å·¥å…·</p><ol><li><code>captcha_getter.py</code></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ ¹æ®å›¾ç‰‡è‡ªå·±è¾“å…¥è¯†åˆ«ç»“æœ, å°†å›¾ç‰‡ä¿å­˜ä¸‹æ¥, å›¾ç‰‡åä¸ºæ­£ç¡®çš„æ‰“ç ç»“æœ</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CaptchaGUI</span>:</span></span><br><span class="line">    BASE_URL = <span class="string">"http://yktapp.njupt.edu.cn:8070"</span></span><br><span class="line">    CAPTCHA_URL = BASE_URL + <span class="string">"/Login/GetValidateCode"</span></span><br><span class="line">    LOGIN_URL = BASE_URL + <span class="string">"/Login/LoginBySnoQuery"</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.s = requests.session()</span><br><span class="line">        self.r = self.s.get(self.CAPTCHA_URL)</span><br><span class="line">        self.im = Image.open(BytesIO(self.r.content))</span><br><span class="line">        self.root = tkinter.Tk()</span><br><span class="line">        self.tkimg = ImageTk.PhotoImage(self.im)</span><br><span class="line">        self.imgLabel = tkinter.Label(self.root, image=self.tkimg)</span><br><span class="line">        self.imgLabel.pack()</span><br><span class="line">        self.message = tkinter.Entry(self.root)</span><br><span class="line">        self.message.pack()</span><br><span class="line">        self.root.bind(<span class="string">'&lt;Return&gt;'</span>, self.judge_and_save)</span><br><span class="line">        self.root.mainloop()</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">judge_and_save</span><span class="params">(self, event)</span>:</span></span><br><span class="line">        <span class="comment"># è¾“å‡ºè¾“å…¥æ¡†çš„å†…å®¹</span></span><br><span class="line">        captcha_value = self.message.get()</span><br><span class="line">        print(captcha_value)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"sno"</span>: self.account,</span><br><span class="line">            <span class="string">"pwd"</span>: base64.b64encode(self.pwd.encode(<span class="string">"utf8"</span>)),</span><br><span class="line">            <span class="string">"ValiCode"</span>: captcha_value,</span><br><span class="line">            <span class="string">"remember"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">"uclass"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">"zqcode"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"json"</span>: <span class="keyword">True</span>,</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment"># åªæœ‰è¾“å…¥æ­£ç¡®çš„æ‰ä¿å­˜</span></span><br><span class="line">        r = self.s.post(self.LOGIN_URL, data=data)</span><br><span class="line">        <span class="keyword">if</span> r.json()[<span class="string">"IsSucceed"</span>]:</span><br><span class="line">            print(<span class="string">"æˆåŠŸï¼"</span>)</span><br><span class="line">            <span class="keyword">with</span> open(<span class="string">"captchas/&#123;&#125;.gif"</span>.format(captcha_value), <span class="string">'wb+'</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(self.r.content)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(r.json())</span><br><span class="line">            print(<span class="string">"éªŒè¯ç è¾“é”™äº†"</span>)</span><br><span class="line"><span class="comment"># åˆ·æ–°, è¿›è¡Œæ‰“ç ä¸‹ä¸€å¼ </span></span><br><span class="line">        self.r = self.s.get(self.CAPTCHA_URL)</span><br><span class="line">        self.im = Image.open(BytesIO(self.r.content))</span><br><span class="line">        <span class="comment"># åˆ·æ–°å›¾ç‰‡æ¡†</span></span><br><span class="line">        self.tkimg = ImageTk.PhotoImage(self.im)</span><br><span class="line">        self.imgLabel.config(image=self.tkimg)</span><br><span class="line">        <span class="comment"># â–². å°†è¾“å…¥æ¡†æ¸…ç©º</span></span><br><span class="line">        self.message.delete(<span class="number">0</span>, <span class="string">'end'</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li><code>captcha_gen.py</code></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">spilt2chars</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    åˆ†å‰²å·²æœ‰çš„æ•°æ®ä¸ºå­—ç¬¦å¹¶ä¿å­˜</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        shutil.rmtree(<span class="string">'captcha_chars'</span>)</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    os.mkdir(<span class="string">"captcha_chars"</span>)</span><br><span class="line">    values = <span class="string">"1234567890"</span></span><br><span class="line">    <span class="comment"># æ¯ä¸ªå­—ç¬¦åˆ›å»ºå¯¹åº”çš„æ–‡ä»¶å¤¹</span></span><br><span class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> values:</span><br><span class="line">        os.mkdir(<span class="string">'captcha_chars/&#123;&#125;'</span>.format(value))</span><br><span class="line"></span><br><span class="line">    file_names = os.listdir(<span class="string">'captchas'</span>)</span><br><span class="line">    <span class="comment"># éå†æ‰€æœ‰å­—ç¬¦æ–‡ä»¶å¤¹</span></span><br><span class="line">    <span class="keyword">for</span> file_name <span class="keyword">in</span> file_names: </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(<span class="string">'captchas/&#123;&#125;'</span>.format(file_name)) <span class="keyword">and</span> file_name != <span class="string">'.DS_Store'</span>:</span><br><span class="line">            <span class="comment"># è·å¾—æ‰“ç imgçš„å›¾ç‰‡åç§°(æ­£ç¡®ç»“æœ)</span></span><br><span class="line">            values = file_name[:<span class="number">4</span>]</span><br><span class="line">            im = Image.open(<span class="string">'captchas/&#123;&#125;'</span>.format(file_name))</span><br><span class="line">            captcha = CardCaptcha(im)</span><br><span class="line">            <span class="comment"># handle_split_imageä¸ºåˆ‡å‰²åçš„å››ä¸ªå­—ç¬¦å›¾ç‰‡, valuesä¸º3fgcçš„å€¼</span></span><br><span class="line">            <span class="keyword">for</span> im_part, value <span class="keyword">in</span> zip(captcha.handle_split_image(), values):</span><br><span class="line">                <span class="comment"># è¿›è¡Œmd5éšæœºå–åä¿å­˜</span></span><br><span class="line">                m = hashlib.md5()</span><br><span class="line">                m.update(<span class="string">"&#123;&#125;&#123;&#125;"</span>.format(time.time(), value).encode(<span class="string">'utf8'</span>))</span><br><span class="line">                <span class="comment"># captcha_chars/3/asdz.png</span></span><br><span class="line">                im_part.save(<span class="string">"captcha_chars/&#123;&#125;/&#123;&#125;.png"</span>.format(value, m.hexdigest()))</span><br><span class="line">                </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_models</span><span class="params">()</span>:</span></span><br><span class="line">    iconset = list(<span class="string">'0123456789'</span>)</span><br><span class="line">    <span class="comment"># å°†å›¾åƒæ•°æ®è½¬ä¸ºå‘é‡æ•°æ®å¹¶ä¿å­˜</span></span><br><span class="line">    image_data = []</span><br><span class="line">    <span class="keyword">for</span> letter <span class="keyword">in</span> iconset:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># éå†å­—ç¬¦3ä¸‹é¢æ‰€æœ‰çš„å›¾ç‰‡</span></span><br><span class="line">            <span class="keyword">for</span> img <span class="keyword">in</span> os.listdir(<span class="string">'captcha_chars/&#123;&#125;/'</span>.format(letter)):</span><br><span class="line">                <span class="keyword">if</span> img != <span class="string">"Thumbs.db"</span> <span class="keyword">and</span> img != <span class="string">".DS_Store"</span>:</span><br><span class="line">                    <span class="comment"># å¾—åˆ°å…¶å›¾ç‰‡å‘é‡</span></span><br><span class="line">                    temp = build_vector(Image.open(<span class="string">"captcha_chars/&#123;&#125;/&#123;&#125;"</span>.format(letter, img)))</span><br><span class="line">                    <span class="comment"># models_listä¸­æ·»åŠ [&#123;1: [0,1,1...]&#125;]</span></span><br><span class="line">                    image_data.append(&#123;letter: temp&#125;)</span><br><span class="line">        <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">            print(letter)</span><br><span class="line">image_data = [ &#123;<span class="number">1</span>: [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,...]&#125;, &#123;<span class="number">1</span>: [<span class="number">1</span>,<span class="number">0</span>,...]&#125;, ..., &#123;<span class="number">2</span>: [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,...]&#125;]</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'image_data.json'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        json.dump(image_data, f)</span><br></pre></td></tr></table></figure><p>é™„ï¼šæ‰¾åˆ°æœ€åˆé€‚çš„æ—‹è½¬è§’åº¦</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rotate_img</span><span class="params">(image)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    æ ¹æ®å›¾åƒåœ¨xè½´æ–¹å‘æŠ•å½±å¤§å°ç¡®å®šå­—ç¬¦çš„æ‘†æ”¾æ–¹å‘</span></span><br><span class="line"><span class="string">    -45~+45å¾ªç¯, å½“xè½´ä¸ŠæŠ•å½±å¾—åˆ°çš„ç™½è‰²åƒç´ æ•°é‡æœ€å°ï¼Œæ­¤æ—¶å°±æ˜¯æ­£ç¡®çš„è§’åº¦</span></span><br><span class="line"><span class="string">    :param image: PIL.Image object</span></span><br><span class="line"><span class="string">    :return: rotated Image object</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    min_count = <span class="number">1000</span></span><br><span class="line">    final_angle = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> angle <span class="keyword">in</span> range(<span class="number">-45</span>, <span class="number">45</span>):</span><br><span class="line">        x_count = <span class="number">0</span></span><br><span class="line">        ti = image.rotate(angle, expand=<span class="keyword">True</span>)</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(ti.width):</span><br><span class="line">            <span class="comment"># å½“å‰yåˆ—åªè¦æœ‰ä¸€ä¸ªåƒç´ ä¸ºwhite, é‚£ä¹ˆå°±+1ç»“æŸ, è¿›è¡Œä¸‹ä¸€åˆ—åˆ¤æ–­</span></span><br><span class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> range(ti.height):</span><br><span class="line">                <span class="keyword">if</span> ti.getpixel((x, y)) == WHITE:</span><br><span class="line">                    x_count += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> x_count &lt; min_count:</span><br><span class="line">            min_count = x_count</span><br><span class="line">            final_angle = angle</span><br><span class="line">    image = image.rotate(final_angle, expand=<span class="keyword">False</span>)</span><br><span class="line">    <span class="keyword">return</span> image</span><br></pre></td></tr></table></figure></li></ul><h2 id="rss-monitor"><a class="markdownIt-Anchor" href="#rss-monitor"></a> <strong><a href="https://github.com/Freedomisgood/Rss-Monitor" target="_blank" rel="noopener">Rss-Monitor</a></strong></h2><blockquote><p>ä¸€ä¸ªé€šç”¨çš„RSSè®¢é˜…é€šçŸ¥å™¨ï¼Œå’Œ**<a href="https://github.com/DIYgod/RSSHub" target="_blank" rel="noopener">RSSHub</a>**ä¸€èµ·é£Ÿç”¨æ•ˆæœæ›´å¥½å“¦ã€‚<br>RSS(Really Simple Syndication,ç®€æ˜“ä¿¡æ¯èšåˆ)æ˜¯ä¸€ç§æè¿°å’ŒåŒæ­¥ç½‘ç«™å†…å®¹çš„æ ¼å¼ä½ å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç§å®šåˆ¶ä¸ªæ€§åŒ–æ¨é€ä¿¡æ¯çš„æœåŠ¡ã€‚å®ƒèƒ½å¤Ÿè§£å†³ä½ æ¼«æ— ç›®çš„çš„æµè§ˆç½‘é¡µçš„é—®é¢˜ã€‚</p></blockquote><ul><li><p>åŠ¨æ€å¯¼å…¥æ¨¡å—</p></li><li><p>è·å¾—Rssé“¾æ¥ä¿¡æ¯â€”â€”<a href="https://pypi.python.org/pypi/feedparser/" target="_blank" rel="noopener">feedparser</a>åº“</p><blockquote><p>feedparseræ˜¯ä¸€ä¸ªPythonçš„Feedè§£æåº“ï¼Œå¯ä»¥å¤„ç†RSS ï¼ŒCDFï¼ŒAtom ã€‚ä½¿ç”¨å®ƒæˆ‘ä»¬å¯ä»ä»»ä½• RSS æˆ– Atom è®¢é˜…æºå¾—åˆ°æ ‡é¢˜ã€é“¾æ¥å’Œæ–‡ç« çš„æ¡ç›®äº†ã€‚</p></blockquote><p>æ ‡å‡†çš„itemæ ¼å¼:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>&lt;![CDATA[å¦é—¨å…¬äº¤è½¦æ”¾ç«æ¡ˆæ­»è€…åå•å…¬å¸ƒ&lt;br/&gt;è­¦æ–¹å…¬å¸ƒå«ŒçŠ¯çŠ¯ç½ªè¯æ®]]&gt;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span>&gt;</span>http://www.infzm.com/content/91404<span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>&lt;![CDATA[6æœˆ11æ—¥ä¸‹åˆï¼Œå¦é—¨BRTå…¬äº¤è½¦æ”¾ç«æ¡ˆ47åæ­»äº¡è€…åå•å…¬å¸ƒã€‚å¦é—¨æ”¿åºœæ–°é—»åŠ6æœˆ10æ—¥å‘å¸ƒæ¶ˆæ¯ç§°ï¼Œæœ‰è¯æ®è¡¨æ˜ï¼Œé™ˆæ°´æ€»æºå¸¦æ±½æ²¹ä¸Šäº†é—½DY7396å…¬äº¤è½¦ã€‚ä¸”æœ‰å¤šåå¹¸å­˜è€…æŒ‡è®¤å…¶åœ¨è½¦ä¸Šçºµç«ï¼Œè‡´ä½¿æ•´éƒ¨è½¦å¼•èµ·çŒ›çƒˆç‡ƒçƒ§ã€‚ç»ç¬”è¿¹é‰´å®šï¼Œé™ˆæ°´æ€»6æœˆ7æ—¥è‡´å¦»ã€å¥³çš„ä¸¤å°ç»ç¬”ä¹¦ç³»é™ˆæ°´æ€»æœ¬äººæ‰€å†™ã€‚]]&gt;<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">category</span>&gt;</span>å—æ–¹å‘¨æœ«-çƒ­ç‚¹æ–°é—»<span class="tag">&lt;/<span class="name">category</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">author</span>&gt;</span>infzm<span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pubDate</span>&gt;</span>2013-06-11 11:24:32<span class="tag">&lt;/<span class="name">pubDate</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br></pre></td></tr></table></figure><p>feedparseræ¨¡å—api</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> feedparser</span><br><span class="line">d=feedparser.parse(<span class="string">'http://feed.cnblogs.com/blog/sitehome/rss'</span>)</span><br><span class="line"><span class="comment"># d.feedä¸ºæ•°æ®å­—å…¸, ä¸entriesç›¸æ¯”ä¸€ä¸ªæ˜¯dictä¸€ä¸ªæ˜¯list, å…¶æ¬¡entriesä¸­æ˜¯æ›´åŠ å‡ç»ƒç‚¹çš„æ•°æ®</span></span><br><span class="line"><span class="comment">#   è¾“å‡ºå­—å…¸ä¸­çš„é”®å€¼æœ‰å“ªäº›ï¼Œä¸€å…±æœ‰10ä¸­å¦‚ä¸‹ï¼š</span></span><br><span class="line">[<span class="string">'feed'</span>, <span class="string">'status'</span>, <span class="string">'version'</span>, <span class="string">'encoding'</span>, <span class="string">'bozo'</span>, <span class="string">'headers'</span>, <span class="string">'href'</span>, <span class="string">'namespaces'</span>, <span class="string">'entries'</span>, <span class="string">'bozo_exception'</span>]</span><br><span class="line">&#123;<span class="string">'feed'</span>: &#123;&#125;, <span class="string">'encoding'</span>: <span class="string">u'utf-8'</span>, <span class="string">'bozo'</span>: <span class="number">1</span>, <span class="string">'version'</span>: <span class="string">u''</span>, <span class="string">'namespaces'</span>: &#123;&#125;, <span class="string">'entries'</span>: [], <span class="string">'bozo_exception'</span>: SAXParseException(<span class="string">'no element found'</span>,)&#125;</span><br><span class="line"><span class="comment"># d.channelä¸‹çš„å±æ€§ä¸ºchannelä¸­ä¸­çš„å­—æ®µï¼Œæ¯”å¦‚titleã€linkã€descriptionã€generatorã€webMasterã€lastBuildDate</span></span><br><span class="line">&gt;&gt;&gt;d[<span class="string">'feed'</span>][<span class="string">'title'</span>]</span><br><span class="line"><span class="string">'åšå®¢å›­_é¦–é¡µ'</span></span><br><span class="line">&gt;&gt;&gt;d.feed.title    <span class="comment">#é€šè¿‡å±æ€§çš„æ–¹å¼è®¿é—®</span></span><br><span class="line"><span class="string">'åšå®¢å›­_é¦–é¡µ'</span></span><br><span class="line">&gt;&gt;&gt;d.feed.subtitle</span><br><span class="line"><span class="string">'ä»£ç æ”¹å˜ä¸–ç•Œ'</span></span><br><span class="line">&gt;&gt;&gt;d.feed.link</span><br><span class="line"><span class="string">'uuid:1b90fd0c-6080-4ea5-86b1-b87c64b95d69;id=4466'</span></span><br><span class="line">d.entries <span class="comment">#è¯¥å±æ€§ç±»å‹ä¸ºåˆ—è¡¨ï¼Œè¡¨ç¤ºä¸€ç»„æ–‡ç« çš„æ¡ç›®</span></span><br><span class="line">&gt;&gt;&gt;type(d.entries)    <span class="comment">#ç±»å‹ä¸ºåˆ—è¡¨, ä¸ºitemæ ‡ç­¾ä¸­çš„å†…å®¹</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">list</span>'&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt;<span class="title">len</span><span class="params">(d.entries)</span>   #ä¸€å…±20ç¯‡æ–‡ç« </span></span><br><span class="line"><span class="class">20</span></span><br></pre></td></tr></table></figure><p>æ¯ä¸ªRSSå’ŒAtomè®¢é˜…æºéƒ½åŒ…å«ä¸€ä¸ªæ ‡é¢˜ï¼ˆd.feed.titleï¼‰å’Œä¸€ç»„æ–‡ç« æ¡ç›®(d.entries)</p><p><strong>é€šå¸¸</strong>æ¯ä¸ªæ–‡ç« æ¡ç›®éƒ½æœ‰ä¸€æ®µæ‘˜è¦ï¼ˆd.entries[i].summaryï¼‰,æˆ–è€…æ˜¯åŒ…å«äº†æ¡ç›®ä¸­å®é™…æ–‡æœ¬çš„æè¿°æ€§æ ‡ç­¾ï¼ˆd.entries[i].descriptionï¼‰</p></li><li><p>è‡ªå®šä¹‰æ·»åŠ Rssé“¾æ¥-&gt;<a href="https://docs.rsshub.app/joinus/quick-start.html%E3%80%81" target="_blank" rel="noopener">https://docs.rsshub.app/joinus/quick-start.htmlã€</a><a href="https://github.com/DIYgod/RSSHub/pull/1768/files#" target="_blank" rel="noopener"><br>æ·»åŠ æµ™æ±Ÿå·¥å•†å¤§å­¦æ•™åŠ¡å¤„å’Œå­¦æ ¡é¦–é¡µé€šçŸ¥</a></p><blockquote><p>é™¤äº†æŒ‰ç…§Rsshubæ¥è‡ªå®šä¹‰Rssè®¢é˜…æºä»¥å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <a href="https://github.com/huginn/huginn" target="_blank" rel="noopener">Huginn</a>ã€Feed43ç­‰å·¥å…·ï¼Œå¦‚<a href="https://www.jianshu.com/p/1024956c8396" target="_blank" rel="noopener">ç”¨Feed43ä¸ºæ•™åŠ¡å¤„ç½‘ç«™åˆ¶ä½œRSS</a></p></blockquote><ol><li><p>æš´éœ²è·¯ç”±é“¾æ¥ï¼šåœ¨ <a href="https://github.com/DIYgod/RSSHub/blob/master/lib/router.js" target="_blank" rel="noopener">/lib/router.js (opens new window)</a>é‡Œæ·»åŠ è·¯ç”±</p></li><li><p>ç¼–å†™æ•°æ®æºè„šæœ¬ï¼šåœ¨ <a href="https://github.com/DIYgod/RSSHub/tree/master/lib/routes" target="_blank" rel="noopener">/lib/routes/ (opens new window)</a>ä¸­çš„è·¯ç”±å¯¹åº”è·¯å¾„ä¸‹åˆ›å»ºæ–°çš„ js è„šæœ¬ï¼š</p><ol><li>ä½¿ç”¨ got è¯·æ±‚ HTML æ•°æ®ï¼š</li><li>ä½¿ç”¨ cheerio è§£æè¿”å›çš„ HTML:</li><li>ä½¿ç”¨ map éå†æ•°ç»„ï¼Œè§£æå‡ºæ¯ä¸€ä¸ª item çš„ç»“æœ â€”â€”å¯¹æ•°æ®è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ï¼Œç”Ÿæˆç¬¦åˆ RSS è§„èŒƒçš„å¯¹è±¡ï¼ŒæŠŠè·å–çš„æ ‡é¢˜ã€é“¾æ¥ã€æè¿°ã€å‘å¸ƒæ—¶é—´ç­‰æ•°æ®èµ‹å€¼ç»™ ctx.state.data, <a href="https://docs.rsshub.app/joinus/quick-start.html#%E7%94%9F%E6%88%90-rss-%E6%BA%90" target="_blank" rel="noopener">ç”Ÿæˆ RSS æº</a>ï¼š</li></ol><blockquote><p>ç”Ÿæˆ RSS æºåŸç†ï¼šè·å–åˆ°çš„æ•°æ®èµ‹ç»™ ctx.state.data, ç„¶åæ•°æ®ä¼šç»è¿‡ <a href="https://github.com/DIYgod/RSSHub/blob/master/lib/middleware/template.js" target="_blank" rel="noopener">template.js (opens new window)</a>ä¸­é—´ä»¶å¤„ç†ï¼Œæœ€åä¼ åˆ° <a href="https://github.com/DIYgod/RSSHub/blob/master/lib/views/rss.art" target="_blank" rel="noopener">/lib/views/rss.art (opens new window)</a>æ¥ç”Ÿæˆæœ€åçš„ RSS ç»“æœï¼Œæ¯ä¸ªå­—æ®µçš„å«ä¹‰å¦‚ä¸‹ï¼š<a href="https://docs.rsshub.app/joinus/quick-start.html#ti-jiao-xin-de-rsshub-gui-ze-bian-xie-jiao-ben" target="_blank" rel="noopener">https://docs.rsshub.app/joinus/quick-start.html#ti-jiao-xin-de-rsshub-gui-ze-bian-xie-jiao-ben</a></p></blockquote></li></ol><p>3.æ·»åŠ è„šæœ¬æ–‡æ¡£: <code>&lt;Route author=&quot;HenryQW&quot; example=&quot;/github/issue/DIYgod/RSSHub&quot; path=&quot;/github/issue/:user/:repo&quot; :paramsDesc=&quot;['ç”¨æˆ·å', 'ä»“åº“å']&quot; /&gt;</code></p></li></ul><h2 id="ddt-sharp-shooter"><a class="markdownIt-Anchor" href="#ddt-sharp-shooter"></a> <strong><a href="https://github.com/boring-plans/ddt-sharp-shooter" target="_blank" rel="noopener"> ddt-sharp-shooter</a></strong></h2><blockquote><p>ä½¿ç”¨åˆ°çš„åº“: <code>screeninfoã€pillowã€ddddocrã€pynput</code></p><ul><li>pynput: æ§åˆ¶å’Œç›‘è§†è¾“å…¥è®¾å¤‡ï¼›ç±»ä¼¼çš„æœ‰PyHook3ï¼ˆç›‘è§†é”®é¼ ï¼‰ã€pywin32 ï¼ˆæ¨¡æ‹Ÿé”®é¼ ï¼‰</li><li>ddddocrï¼šè¯†åˆ«éªŒè¯ç ï¼Œè¿™è¾¹ç”¨æ¥è¯†åˆ«æ•°å­—</li></ul></blockquote><ol><li><p>è¿›ç¨‹é—´é€šä¿¡ã€‚ Tkinterç•Œé¢å¼€å¯mainloopè¿›ç¨‹ï¼Œå…¶ä¸­åˆå¼€è¾Ÿå‡ºä¸€ä¸ªå­çº¿ç¨‹æ¥ä¾¦å¬å…¶ä»–è¿›ç¨‹å‘é€çš„æ•°æ®æ¶ˆæ¯ï¼Œç„¶åé€šè¿‡<code>tk.Text</code>æ§ä»¶æ¥å±•ç¤º</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> tkinter</span><br><span class="line"><span class="comment"># å£°æ˜å…¨å±€å¯¹è±¡åŠç±»å‹</span></span><br><span class="line">_tk: tkinter.Tk</span><br><span class="line">_text: tkinter.Text</span><br><span class="line">_terminate = <span class="keyword">False</span></span><br><span class="line">_queue: multiprocessing.Queue</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_text</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""å­çº¿ç¨‹ä¾¦å¬è¿›ç¨‹æ¶ˆæ¯"""</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> _terminate:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> _queue.empty():</span><br><span class="line">            text = _queue.get(<span class="keyword">False</span>)</span><br><span class="line">            append_text(text)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">append_text</span><span class="params">(text)</span>:</span></span><br><span class="line">    _text.config(state=<span class="string">'normal'</span>)</span><br><span class="line">    _text.insert(<span class="string">'end'</span>, <span class="string">f'\n<span class="subst">&#123;text&#125;</span>'</span>)</span><br><span class="line">    _text.see(<span class="string">'end'</span>)</span><br><span class="line">    _text.config(state=<span class="string">'disabled'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(gui_queue)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> _tk, _text, _queue, _screen_size</span><br><span class="line">    _queue = gui_queue</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    threading.Thread(target=update_text).start()</span><br><span class="line">    </span><br><span class="line">    _tk.mainloop()</span><br></pre></td></tr></table></figure></li><li><p><code>py2app setup</code>ï¼Œåœ¨macosä¸‹åˆ›å»ºpythonåº”ç”¨ï¼Œ <code>python setup.py py2app</code></p></li><li><p>å¯¹çº¯æ•°å­—è¯†åˆ«ç»“æœè¿›è¡Œæ¸…æ´—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recognize_digits</span><span class="params">(image: bytes)</span>:</span></span><br><span class="line">    ocr = ddddocr.DdddOcr(show_ad=<span class="keyword">False</span>)</span><br><span class="line">    result = ocr.classification(image)</span><br><span class="line">    <span class="keyword">return</span> wash_digits(result)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wash_digits</span><span class="params">(digits: str)</span>:</span></span><br><span class="line">    <span class="string">"""ç”±äºä¸ä¼šå‡ºç°éæ•°å­—, æ‰€ä»¥å¯¹æ˜“è¯†åˆ«é”™è¯¯çš„å­—ç¬¦è¿›è¡Œæ›¿æ¢"""</span></span><br><span class="line">    washed = digits \</span><br><span class="line">        .replace(<span class="string">'g'</span>, <span class="string">'9'</span>).replace(<span class="string">'q'</span>, <span class="string">'9'</span>) \</span><br><span class="line">        .replace(<span class="string">'l'</span>, <span class="string">'1'</span>).replace(<span class="string">'i'</span>, <span class="string">'1'</span>) \</span><br><span class="line">        .replace(<span class="string">'z'</span>, <span class="string">'2'</span>) \</span><br><span class="line">        .replace(<span class="string">'o'</span>, <span class="string">'0'</span>)</span><br><span class="line">    <span class="keyword">return</span> re.sub(<span class="string">r'\D'</span>, <span class="string">'0'</span>, washed)</span><br></pre></td></tr></table></figure></li></ol><h1 id="æ–‡ç« è®°å½•"><a class="markdownIt-Anchor" href="#æ–‡ç« è®°å½•"></a> æ–‡ç« è®°å½•</h1><h2 id="githubä¼˜ç§€çš„æ–‡ç« é¡¹ç›®"><a class="markdownIt-Anchor" href="#githubä¼˜ç§€çš„æ–‡ç« é¡¹ç›®"></a> Githubä¼˜ç§€çš„æ–‡ç« é¡¹ç›®</h2><ul><li><strong><a href="https://github.com/danistefanovic/build-your-own-x" target="_blank" rel="noopener">build-your-own-x</a></strong>â€”â€”è‡ªå·±é€ è½®å­</li><li><strong><a href="https://github.com/donnemartin/system-design-primer" target="_blank" rel="noopener">system-design-primer</a></strong>â€”â€”ç³»ç»Ÿæ¶æ„è®¾è®¡</li><li><strong><a href="https://github.com/doocs/advanced-java" target="_blank" rel="noopener">advanced-java</a></strong>â€”â€”äº’è”ç½‘ Java å·¥ç¨‹å¸ˆè¿›é˜¶çŸ¥è¯†å®Œå…¨æ‰«ç›²</li><li><a href="https://juejin.cn/post/6844903624062009352" target="_blank" rel="noopener">https://juejin.cn/post/6844903624062009352</a></li><li></li></ul><h2 id="goå¥½ç”¨çš„ä¸‰æ–¹åº“"><a class="markdownIt-Anchor" href="#goå¥½ç”¨çš„ä¸‰æ–¹åº“"></a> Goå¥½ç”¨çš„ä¸‰æ–¹åº“</h2><ul><li><p>ä¸°å¯ŒåŸç”Ÿæ•°æ®ç»“æ„mapã€sliceçš„å·¥å…·åº“ï¼š<a href="https://github.com/samber/lo" target="_blank" rel="noopener">https://github.com/samber/lo</a></p></li><li><p>è¾“å…¥å‚æ•°è§£æåº“: <a href="https://github.com/jessevdk/go-flags" target="_blank" rel="noopener">go-flags</a></p></li><li><p>æ“ä½œexcelçš„åº“ï¼š<a href="https://github.com/qax-os/excelize" target="_blank" rel="noopener">excelize</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;çˆ¬è™«ç³»åˆ—&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#çˆ¬è™«ç³»åˆ—&quot;&gt;&lt;/a&gt; çˆ¬è™«ç³»åˆ—&lt;/h1&gt;
&lt;h2 id=&quot;æŠ¢è´­-ç§’æ€&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#æŠ¢è´­-ç§’æ€&quot;&gt;&lt;/a&gt; æŠ¢è´­ã€ç§’æ€&lt;
      
    
    </summary>
    
    
      <category term="ä»£ç é˜…è¯»" scheme="https://nymrli.top/tags/%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB/"/>
    
  </entry>
  
  <entry>
    <title>2022å¹´3æœˆ19~20æ—¥-çˆ¬è™«é¡¹ç›®è®°å½•</title>
    <link href="https://nymrli.top/2022/03/19/2022%E5%B9%B43%E6%9C%8819%E6%97%A5-20%E6%97%A5%E7%88%AC%E8%99%AB%E9%A1%B9%E7%9B%AE%E8%AE%B0%E5%BD%95/"/>
    <id>https://nymrli.top/2022/03/19/2022å¹´3æœˆ19æ—¥-20æ—¥çˆ¬è™«é¡¹ç›®è®°å½•/</id>
    <published>2022-03-19T11:06:06.000Z</published>
    <updated>2022-04-04T11:33:04.136Z</updated>
    
    <content type="html"><![CDATA[<h1 id="2022å¹´3æœˆ20æ—¥å…¬å‘Šå­˜ç½‘ç«™é¡µé¢åˆ°æ•°æ®åº“"><a class="markdownIt-Anchor" href="#2022å¹´3æœˆ20æ—¥å…¬å‘Šå­˜ç½‘ç«™é¡µé¢åˆ°æ•°æ®åº“"></a> 2022å¹´3æœˆ20æ—¥â€”â€”å…¬å‘Šå­˜ç½‘ç«™é¡µé¢åˆ°æ•°æ®åº“</h1><h2 id="æ–‡ä»¶å­˜å‚¨"><a class="markdownIt-Anchor" href="#æ–‡ä»¶å­˜å‚¨"></a> æ–‡ä»¶å­˜å‚¨</h2><ol><li>æ–‡ä»¶å¤¹ä¸å…è®¸å‡ºç°<code>/\:*?|&lt;&gt;&quot;</code></li><li>aæ ‡ç­¾ä¸­hrefä¸èƒ½æœ‰, å› ä¸ºé€šè¿‡etree.tostringä¼šè¢«è½¬ä¹‰æˆ%5C===&gt;è¿›è¡Œäº†str.replace(&quot;\&quot;, â€œ/â€)</li><li>windowsä¸‹è·¯å¾„åˆ†éš”ç¬¦æ˜¯<code>\\</code>, æ‰€ä»¥save_pathä¸­ä¼šæœ‰<code>\\</code>, å› æ­¤ä½¿ç”¨<code>save_path.replace(&quot;\\&quot;, &quot;/&quot;)</code>å¯ä»¥è§£å†³</li><li>å¤šçº§åˆ›å»ºæ–‡ä»¶å¤¹<code>os.makedirs()</code>ã€å•å±‚åˆ›å»º<code>os.mkdir()</code><br>5æ–‡ä»¶åç§°é—®é¢˜: ä¹±ç å¤ªé•¿æŠ¥é”™, å°†å…¶å–aæ ‡ç­¾ä¸­å†…å®¹è§£å†³</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¹±ç å¤ªé•¿æŠ¥é”™</span></span><br><span class="line">s = <span class="string">".\\attaches\\11963218-2021å¹´09æœˆ22æ—¥åèƒ½èƒ½æºäº¤é€šäº§ä¸šæ§è‚¡æœ‰é™å…¬å¸é›†å›¢ç‰©èµ„ä¾›åº”ä¸­å¿ƒï¼ˆç”˜è‚ƒåŒºåŸŸï¼‰07æœˆä»½é›†ä¸­ç‰©èµ„ä¾›åº”--å…«é›¶ä¸‰ç”µå‚é˜€é—¨è¯¢ä»·é‡‡è´­ï¼ˆåŒ…093ï¼‰è¯¢ä»·ä¹¦è¯¢ä»·å…¬å‘Š\\ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½07ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½--ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½093ï¿½ï¿½ï¿½.wps"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(s, <span class="string">"wb"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">b"ggg"</span>)</span><br></pre></td></tr></table></figure><h2 id="æ•°æ®åº“è¡¨"><a class="markdownIt-Anchor" href="#æ•°æ®åº“è¡¨"></a> æ•°æ®åº“è¡¨</h2><p><strong>varcharèƒ½å­˜å¤šå°‘æ±‰å­—ã€æ•°å­—ï¼Ÿ</strong></p><p>å…·ä½“è¿˜æ˜¯è¦çœ‹ç‰ˆæœ¬çš„ï¼Œä¸€ä¸ªå­—ç¬¦å ç”¨3ä¸ªå­—èŠ‚  ï¼Œä¸€ä¸ªæ±‰å­—ï¼ˆåŒ…æ‹¬æ•°å­—ï¼‰å ç”¨3ä¸ªå­—èŠ‚=ä¸€ä¸ªå­—ç¬¦</p><ul><li><strong>4.0ç‰ˆæœ¬ä»¥ä¸‹</strong>ï¼Œvarchar(100)ï¼ŒæŒ‡çš„æ˜¯<strong>100å­—èŠ‚</strong>ï¼Œå¦‚æœå­˜æ”¾UTF8æ±‰å­—æ—¶ï¼Œåªèƒ½å­˜33ä¸ªï¼ˆæ¯ä¸ªæ±‰å­—3å­—èŠ‚ï¼‰</li><li><strong>5.0ç‰ˆæœ¬ä»¥ä¸Š</strong>**ï¼Œvarchar(100)ï¼ŒæŒ‡çš„æ˜¯<strong>100å­—ç¬¦</strong>ï¼Œâ­ï¸æ— è®ºå­˜æ”¾çš„æ˜¯æ•°å­—ã€å­—æ¯è¿˜æ˜¯UTF8æ±‰å­—ï¼ˆæ¯ä¸ªæ±‰å­—3å­—èŠ‚ï¼‰ï¼Œéƒ½å¯ä»¥å­˜æ”¾100ä¸ªã€‚</li><li><strong>UTF8ç¼–ç ä¸­ä¸€ä¸ªæ±‰å­—ï¼ˆåŒ…æ‹¬æ•°å­—ï¼‰å ç”¨3ä¸ªå­—èŠ‚</strong></li><li><em>GBKç¼–ç ä¸­ä¸€ä¸ªæ±‰å­—ï¼ˆåŒ…æ‹¬æ•°å­—ï¼‰å ç”¨2ä¸ªå­—èŠ‚</em>*</li></ul><p><strong>varcharçš„æœ€å¤§é•¿åº¦æ˜¯å¤šå°‘å‘¢ï¼Ÿ</strong></p><p>mysqlçš„vacharå­—æ®µçš„ç±»å‹è™½ç„¶æœ€å¤§é•¿åº¦æ˜¯65535ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯èƒ½å­˜è¿™ä¹ˆå¤šæ•°æ®ï¼Œæœ€å¤§å¯ä»¥åˆ°65533ï¼Œå…¶ä¸­éœ€è¦1åˆ°2ä¸ªå­—èŠ‚æ¥å­˜å‚¨æ•°æ®é•¿åº¦ï¼ˆå¦‚æœåˆ—å£°æ˜çš„é•¿åº¦è¶…è¿‡255ï¼Œåˆ™ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥å­˜å‚¨é•¿åº¦ï¼Œå¦åˆ™1ä¸ªï¼‰å­—èŠ‚ï¼Œå½“ä¸å…è®¸éç©ºå­—æ®µçš„æ—¶å€™ï¼ˆå› ä¸ºè¦ç”¨ä¸€ä¸ªå­—èŠ‚æ¥å­˜å‚¨ä¸å¯ä¸ºç©ºçš„æ ‡è¯†ï¼‰ï¼Œå½“å…è®¸éç©ºå­—æ®µçš„æ—¶å€™åªèƒ½åˆ°65532(çœä¸‹äº†å­˜å‚¨éç©ºçš„é‚£ä¸ªå­—èŠ‚)ã€‚</p><h3 id="mysqlå­—æ®µç±»å‹å­˜å‚¨éœ€è¦å¤šå°‘å­—èŠ‚"><a class="markdownIt-Anchor" href="#mysqlå­—æ®µç±»å‹å­˜å‚¨éœ€è¦å¤šå°‘å­—èŠ‚"></a> mysqlå­—æ®µç±»å‹å­˜å‚¨éœ€è¦å¤šå°‘å­—èŠ‚ï¼Ÿ</h3><p><strong>æ•°å­—ç±»å‹</strong></p><table><thead><tr><th style="text-align:left">åˆ—ç±»å‹</th><th style="text-align:left">éœ€è¦çš„å­˜å‚¨é‡</th></tr></thead><tbody><tr><td style="text-align:left">TINYINT</td><td style="text-align:left">1 å­—èŠ‚</td></tr><tr><td style="text-align:left">SMALLINT</td><td style="text-align:left">2 ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:left">MEDIUMINT</td><td style="text-align:left">3 ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:left">INT</td><td style="text-align:left">4 ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:left">INTEGER</td><td style="text-align:left">4 ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:left">BIGINT</td><td style="text-align:left">8 ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:left">FLOAT(X)</td><td style="text-align:left">4 å¦‚æœ X &lt; = 24 æˆ– 8 å¦‚æœ 25 &lt; = X &lt; = 53</td></tr><tr><td style="text-align:left">FLOAT</td><td style="text-align:left">4 ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:left">DOUBLE</td><td style="text-align:left">8 ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:left">DOUBLE PRECISION</td><td style="text-align:left">8 ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:left">REAL</td><td style="text-align:left">8 ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:left">DECIMAL(M,D)</td><td style="text-align:left">Må­—èŠ‚(D+2 , å¦‚æœM &lt; D)</td></tr><tr><td style="text-align:left">NUMERIC(M,D)</td><td style="text-align:left">Må­—èŠ‚(D+2 , å¦‚æœM &lt; D)</td></tr></tbody></table><p><strong>æ—¥æœŸå’Œæ—¶é—´ç±»å‹</strong></p><table><thead><tr><th style="text-align:left">åˆ—ç±»å‹</th><th style="text-align:left">éœ€è¦çš„å­˜å‚¨é‡</th></tr></thead><tbody><tr><td style="text-align:left">DATE</td><td style="text-align:left">3 ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:left">DATETIME</td><td style="text-align:left">8 ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:left">TIMESTAMP</td><td style="text-align:left">4 ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:left">TIME</td><td style="text-align:left">3 ä¸ªå­—èŠ‚</td></tr><tr><td style="text-align:left">YEAR</td><td style="text-align:left">1 å­—èŠ‚</td></tr></tbody></table><p><strong>ä¸²ç±»å‹</strong></p><table><thead><tr><th style="text-align:left">åˆ—ç±»å‹</th><th style="text-align:left">éœ€è¦çš„å­˜å‚¨é‡</th></tr></thead><tbody><tr><td style="text-align:left">CHAR(M)</td><td style="text-align:left">Må­—èŠ‚ï¼Œ1 &lt;= M &lt;= 255</td></tr><tr><td style="text-align:left">VARCHAR(M)</td><td style="text-align:left">L+1 å­—èŠ‚, åœ¨æ­¤L &lt;= Må’Œ1 &lt;= M &lt;= 255</td></tr><tr><td style="text-align:left">TINYBLOB, TINYTEXT</td><td style="text-align:left">L+1 å­—èŠ‚, åœ¨æ­¤L&lt; 2 ^ 8</td></tr><tr><td style="text-align:left">BLOB, TEXT</td><td style="text-align:left">L+2 å­—èŠ‚, åœ¨æ­¤L&lt; 2 ^ 16</td></tr><tr><td style="text-align:left">MEDIUMBLOB, MEDIUMTEXT</td><td style="text-align:left">L+3 å­—èŠ‚, åœ¨æ­¤L&lt; 2 ^ 24</td></tr><tr><td style="text-align:left">LONGBLOB, LONGTEXT</td><td style="text-align:left">L+4 å­—èŠ‚, åœ¨æ­¤L&lt; 2 ^ 32</td></tr><tr><td style="text-align:left">ENUM(â€˜value1â€™,â€˜value2â€™,â€¦)</td><td style="text-align:left">1 æˆ– 2 ä¸ªå­—èŠ‚, å–å†³äºæšä¸¾å€¼çš„æ•°ç›®(æœ€å¤§å€¼65535ï¼‰</td></tr><tr><td style="text-align:left">SET(â€˜value1â€™,â€˜value2â€™,â€¦)</td><td style="text-align:left">1ï¼Œ2ï¼Œ3ï¼Œ4æˆ–8ä¸ªå­—èŠ‚, å–å†³äºé›†åˆæˆå‘˜çš„æ•°é‡(æœ€å¤š64ä¸ªæˆå‘˜ï¼‰</td></tr></tbody></table><h3 id="mysqlä¸­ç±»å‹åé¢çš„æ•°å­—å«ä¹‰"><a class="markdownIt-Anchor" href="#mysqlä¸­ç±»å‹åé¢çš„æ•°å­—å«ä¹‰"></a> <a href="https://www.itdaan.com/blog/2019/04/08/7762d501e9d5c7cc0316743eaaab6b54.html" target="_blank" rel="noopener">MySQLä¸­ç±»å‹åé¢çš„æ•°å­—å«ä¹‰</a></h3><p>å½¢å¼ï¼šç±»å‹(m)</p><ol><li>æ•´æ•°å‹çš„<strong>æ•°å€¼ç±»å‹</strong>å·²ç»<strong>é™åˆ¶äº†å–å€¼èŒƒå›´</strong>ï¼Œæœ‰ç¬¦å·æ•´å‹å’Œæ— ç¬¦å·æ•´å‹éƒ½æœ‰ï¼Œè€ŒMå€¼å¹¶ä¸ä»£è¡¨å¯ä»¥å­˜å‚¨çš„æ•°å€¼å­—ç¬¦é•¿åº¦ï¼Œå®ƒä»£è¡¨çš„æ˜¯<strong>æ•°æ®åœ¨æ˜¾ç¤ºæ—¶æ˜¾ç¤ºçš„æœ€å°é•¿åº¦</strong>ï¼Œå½“å­˜å‚¨çš„å­—ç¬¦é•¿åº¦è¶…è¿‡Må€¼æ—¶ï¼Œæ²¡æœ‰ä»»ä½•çš„å½±å“ï¼Œåªè¦ä¸è¶…è¿‡æ•°å€¼ç±»å‹é™åˆ¶çš„èŒƒå›´ã€‚å½“å­˜å‚¨çš„å­—ç¬¦é•¿åº¦å°äºMå€¼æ—¶ï¼Œ<u>åªæœ‰åœ¨è®¾ç½®äº†zerofillç”¨0æ¥å¡«å……ï¼Œæ‰èƒ½å¤Ÿçœ‹åˆ°æ•ˆæœï¼Œæ¢å¥è¯å°±æ˜¯è¯´ï¼Œæ²¡æœ‰zerofillï¼ŒMå€¼å°±æ˜¯æ— ç”¨çš„</u>ã€‚</li><li>å­—ç¬¦å‹å¦‚varchar(50) å¯ä»¥å‚¨å­˜50ä¸ªå­—ç¬¦ï¼Œè¡¨ç¤ºçš„æ˜¯å¯å˜ä¸å®šé•¿çš„ã€‚</li></ol><h3 id="mysqlé»˜è®¤å­—ç¬¦é›†"><a class="markdownIt-Anchor" href="#mysqlé»˜è®¤å­—ç¬¦é›†"></a> mySQLé»˜è®¤å­—ç¬¦é›†</h3><blockquote><p>MySQLå¯¹äºå­—ç¬¦é›†çš„æŒ‡å®šå¯ä»¥ç»†åŒ–åˆ°ä¸€ä¸ªæ•°æ®åº“ï¼Œä¸€å¼ è¡¨ï¼Œä¸€åˆ—ï¼Œåº”è¯¥ç”¨ä»€ä¹ˆå­—ç¬¦é›†ã€‚ ä½†æ˜¯ï¼Œä¼ ç»Ÿçš„ç¨‹åºåœ¨åˆ›å»ºæ•°æ®åº“å’Œæ•°æ®è¡¨æ—¶å¹¶æ²¡æœ‰ä½¿ç”¨é‚£ä¹ˆå¤æ‚çš„é…ç½®ï¼Œå®ƒä»¬ç”¨çš„æ˜¯é»˜è®¤çš„é…ç½®ï¼Œé‚£ä¹ˆï¼Œé»˜è®¤çš„é…ç½®ä»ä½•è€Œæ¥å‘¢ï¼Ÿ</p></blockquote><ol><li>ç¼–è¯‘MySQL æ—¶ï¼ŒæŒ‡å®šäº†ä¸€ä¸ªé»˜è®¤çš„å­—ç¬¦é›†ï¼Œè¿™ä¸ªå­—ç¬¦é›†æ˜¯ latin1ï¼›</li><li>å®‰è£…MySQL æ—¶ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ (my.ini) ä¸­æŒ‡å®šä¸€ä¸ªé»˜è®¤çš„çš„å­—ç¬¦é›†ï¼Œå¦‚æœæ²¡æŒ‡å®šï¼Œè¿™ä¸ªå€¼ç»§æ‰¿è‡ªç¼–è¯‘æ—¶æŒ‡å®šçš„ï¼›</li><li>å¯åŠ¨mysqld æ—¶ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œå‚æ•°ä¸­æŒ‡å®šä¸€ä¸ªé»˜è®¤çš„çš„å­—ç¬¦é›†ï¼Œå¦‚æœæ²¡æŒ‡å®šï¼Œè¿™ä¸ªå€¼ç»§æ‰¿è‡ªé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®,æ­¤æ—¶ character_set_server è¢«è®¾å®šä¸ºè¿™ä¸ªé»˜è®¤çš„å­—ç¬¦é›†ï¼›</li><li>å½“åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“æ—¶ï¼Œé™¤éæ˜ç¡®æŒ‡å®šï¼Œè¿™ä¸ªæ•°æ®åº“çš„å­—ç¬¦é›†è¢«ç¼ºçœè®¾å®šä¸ºcharacter_set_serverï¼›</li><li>å½“é€‰å®šäº†ä¸€ä¸ªæ•°æ®åº“æ—¶ï¼Œcharacter_set_databaseè¢«è®¾å®šä¸ºè¿™ä¸ªæ•°æ®åº“é»˜è®¤çš„å­—ç¬¦é›†ï¼›</li><li>åœ¨è¿™ä¸ªæ•°æ®åº“é‡Œåˆ›å»ºä¸€å¼ è¡¨æ—¶ï¼Œè¡¨é»˜è®¤çš„å­—ç¬¦é›†è¢«è®¾å®šä¸º character_set_databaseï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªæ•°æ®åº“é»˜è®¤çš„å­—ç¬¦é›†ï¼›</li><li>å½“åœ¨è¡¨å†…è®¾ç½®ä¸€æ æ—¶ï¼Œé™¤éæ˜ç¡®æŒ‡å®šï¼Œå¦åˆ™æ­¤æ ç¼ºçœçš„å­—ç¬¦é›†å°±æ˜¯è¡¨é»˜è®¤çš„å­—ç¬¦é›†ï¼›</li></ol><h3 id="æœ€ç»ˆcreatesqlæ–‡ä»¶"><a class="markdownIt-Anchor" href="#æœ€ç»ˆcreatesqlæ–‡ä»¶"></a> æœ€ç»ˆcreate.sqlæ–‡ä»¶</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8mb4;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">EXISTS</span>  <span class="string">`huaneng`</span> ;</span><br><span class="line"><span class="keyword">use</span> <span class="string">`huaneng`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for quotation_inone</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`quotation_inone`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`quotation_inone`</span>  (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`title`</span> <span class="built_in">varchar</span>(<span class="number">128</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`date`</span> <span class="built_in">varchar</span>(<span class="number">16</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`content`</span> LONGTEXT <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">   <span class="string">`proclamation_url`</span> <span class="built_in">VARCHAR</span>(<span class="number">512</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> (<span class="string">`proclamation_url`</span>),</span><br><span class="line"></span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">InnoDB</span> AUTO_INCREMENT = <span class="number">1</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> = utf8mb4 <span class="keyword">COLLATE</span> = utf8mb4_general_ci ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS = <span class="number">1</span>;</span><br></pre></td></tr></table></figure><h1 id="2022å¹´3æœˆ20æ—¥-æŠ¤å£«é¢˜ç›®ä¸‹è½½å­˜word"><a class="markdownIt-Anchor" href="#2022å¹´3æœˆ20æ—¥-æŠ¤å£«é¢˜ç›®ä¸‹è½½å­˜word"></a> 2022å¹´3æœˆ20æ—¥-æŠ¤å£«é¢˜ç›®ä¸‹è½½å­˜Word</h1><h3 id="ç´¢å¼•æŠ¥é”™"><a class="markdownIt-Anchor" href="#ç´¢å¼•æŠ¥é”™"></a> ç´¢å¼•æŠ¥é”™</h3><ul><li>MySQL æ·»åŠ ç´¢å¼•æŠ¥é”™ï¼š<code>BLOB/TEXT column used in key specification without a key length</code><ol><li>å½“æˆ‘ä»¬å¯¹ä¸€ä¸ªåç§°ä¸ºplatformçš„å­—æ®µï¼Œç±»å‹ä¸º text æ·»åŠ uniqueå”¯ä¸€æ€§çº¦æŸå’Œç´¢å¼•çº¦æŸæ—¶ï¼Œä¼šæŠ¥é”™ã€‚ åŸå› ï¼šMySQLåªèƒ½å°†BLOB/TEXTç±»å‹å­—æ®µè®¾ç½®ç´¢å¼•æ•°æ®çš„å‰Nä¸ªå­—ç¬¦ï¼Œå› æ­¤ï¼Œåªéœ€è¦é€šè¿‡sqlåœ¨å¢åŠ ç´¢å¼•æ—¶æŒ‡å®šå¯¹åº”å­—æ®µçš„é•¿åº¦å³å¯ï¼Œå¦‚ï¼š<br><code>ALTER TABLE hello_world ADD INDEX key1(platform(250), platform2(250), type);</code>, å…¶ä¸­ï¼Œplatform å’Œ platform2 å°±æ˜¯ text ç±»å‹çš„æ•°æ®<ul><li>more: <a href="https://www.cnblogs.com/wqbin/p/11903878.html" target="_blank" rel="noopener">https://www.cnblogs.com/wqbin/p/11903878.html</a></li></ul></li><li>æ ¹æœ¬åŸå› ï¼š é”™è¯¯å‘ç”Ÿçš„åŸå› æ˜¯å› ä¸ºMySQLåªèƒ½å°†BLOB/TEXTç±»å‹å­—æ®µè®¾ç½®ç´¢å¼•ä¸ºBLOB/TEXTæ•°æ®çš„å‰Nä¸ªå­—ç¬¦ï¼Œå› æ­¤é”™è¯¯å¸¸å¸¸å‘ç”Ÿåœ¨å­—æ®µè¢«å®šä¹‰ä¸ºTEXT/BLOBç±»å‹æˆ–è€…å’ŒTEXT/BLOBåŒè´¨çš„æ•°æ®ç±»å‹ï¼Œå¦‚TINYTEXT,MEDIUMTEXT,LONGTEXT ,TINYBLOB,MEDIUMBLOB å’ŒLONGBLOBï¼Œå¹¶ä¸”å½“å‰æ“ä½œæ˜¯å°†è¿™ä¸ªå­—æ®µè®¾ç½®æˆä¸»é”®æˆ–è€…æ˜¯ç´¢å¼•çš„æ“ä½œã€‚åœ¨æœªæŒ‡å®šTEXT/BLOBâ€˜é”®é•¿â€™çš„æƒ…å†µä¸‹ï¼Œå­—æ®µæ˜¯å˜åŠ¨çš„å¹¶ä¸”æ˜¯åŠ¨æ€çš„å¤§å°æ‰€ä»¥MySQLä¸èƒ½å¤Ÿä¿è¯å­—æ®µçš„å”¯ä¸€æ€§ã€‚å› æ­¤å½“ä½¿ç”¨TEXT/BLOBç±»å‹å­—æ®µåšä¸ºç´¢å¼•æ—¶ï¼ŒNçš„å€¼å¿…é¡»æä¾›å‡ºæ¥æ‰å¯ä»¥è®©MySQLå†³å®šé”®é•¿ï¼Œä½†æ˜¯MySQLä¸æ”¯æŒåœ¨TEXT/BLOBé™åˆ¶ï¼ŒTEXT(88)æ˜¯ä¸è¡Œçš„ã€‚<ul><li>è§£å†³æ–¹æ¡ˆæ˜¯<strong>å°†uniqueé™åˆ¶å’Œç´¢å¼•ä»TEXT/BLOBå­—æ®µä¸­ç§»é™¤</strong>ï¼Œæˆ–è€…æ˜¯<strong>è®¾ç½®å¦ä¸€ä¸ªå­—æ®µä¸ºä¸»é”®</strong>ï¼Œå¦‚æœä½ ä¸æ„¿æ„è¿™æ ·åšå¹¶ä¸”æƒ³åœ¨TEXT/BLOBä¸ŠåŠ é™åˆ¶ï¼Œé‚£ä¹ˆä½ å¯ä»¥å°è¯•å°†è¿™ä¸ªå­—æ®µæ›´æ”¹ä¸ºVARCHARç±»å‹ï¼ŒåŒæ—¶ç»™ä»–ä¸€ä¸ªé™åˆ¶é•¿åº¦ï¼Œé»˜è®¤VARCHARæœ€å¤šå¯ä»¥é™å®šåœ¨255ä¸ªå­—ç¬¦ï¼Œå¹¶ä¸”é™åˆ¶è¦åœ¨å£°æ˜ç±»å‹çš„å³è¾¹æŒ‡æ˜ï¼Œå¦‚VARCHAR(200)å°†ä¼šé™åˆ¶ä»…ä»…200ä¸ªå­—ç¬¦.(æ³¨: ä½†æ˜¯mysqlä¸æ”¯æŒå¯¹TEXT/BLOBé•¿åº¦çš„é™åˆ¶ã€‚)</li><li><a href="https://blog.csdn.net/u012069924/article/details/28858337" target="_blank" rel="noopener">https://blog.csdn.net/u012069924/article/details/28858337</a><br>â–². åœ¨ varchar å­—æ®µä¸Šå»ºç«‹ç´¢å¼•æ—¶ï¼Œå¿…é¡»æŒ‡å®šç´¢å¼•é•¿åº¦ï¼Œæ²¡å¿…è¦å¯¹å…¨å­—æ®µå»ºç«‹ç´¢å¼•ï¼Œæ ¹æ® å®é™…æ–‡æœ¬åŒºåˆ†åº¦å†³å®šç´¢å¼•é•¿åº¦å³å¯ã€‚Java å¼€å‘æ‰‹å†Œ 33/44 è¯´æ˜ï¼šç´¢å¼•çš„é•¿åº¦ä¸åŒºåˆ†åº¦æ˜¯ä¸€å¯¹çŸ›ç›¾ä½“ï¼Œä¸€èˆ¬å¯¹å­—ç¬¦ä¸²ç±»å‹æ•°æ®ï¼Œé•¿åº¦ä¸º 20 çš„ç´¢å¼•ï¼ŒåŒºåˆ†åº¦ä¼šé«˜è¾¾ 90%ä»¥ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ count(distinct left(åˆ—å, ç´¢å¼•é•¿åº¦))/count(*)çš„åŒºåˆ†åº¦æ¥ç¡®å®šã€‚</li></ul></li></ol></li></ul><h3 id="æ•°æ®åº“æ’å…¥æ•°æ®"><a class="markdownIt-Anchor" href="#æ•°æ®åº“æ’å…¥æ•°æ®"></a> æ•°æ®åº“æ’å…¥æ•°æ®</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- \\è¡¨ç¤ºä¸€ä¸ª\</span></span><br><span class="line"><span class="keyword">use</span> xian_nurse;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="string">`question`</span> (<span class="string">`path`</span>) <span class="keyword">VALUES</span> (<span class="string">'ä¹¦ç±\\C-ã€Šä¼ æŸ“ç—…æŠ¤ç†å­¦ä¹ æŒ‡å¯¼ä¸ä¹ é¢˜é›†ã€‹-é€‰æ‹©é¢˜'</span>), (<span class="string">'ä¹¦ç±\\C-ã€Šä¼ æŸ“ç—…æŠ¤ç†æŠ€æœ¯å­¦ä¹ æŒ‡å¯¼ä¸ä¹ é¢˜é›†ã€‹-é€‰æ‹©é¢˜'</span>), (<span class="string">'ä¹¦ç±\\C-ã€Šä¼ æŸ“ç—…æŠ¤ç†æŠ€æœ¯å­¦ä¹ æŒ‡å¯¼ä¸ä¹ é¢˜é›†ã€‹-é¢˜å¹²é¢˜'</span>), (<span class="string">'ä¹¦ç±\\C-ã€ŠæˆäººæŠ¤ç†å­¦å­¦ä¹ æŒ‡å¯¼ä¸ä¹ é¢˜é›†-äººæ°‘å«ç”Ÿå‡ºç‰ˆç¤¾ã€‹-é€‰æ‹©é¢˜'</span>), (<span class="string">'ä¹¦ç±\\C-ã€ŠæˆäººæŠ¤ç†å­¦å­¦ä¹ æŒ‡å¯¼ä¸ä¹ é¢˜é›†-äººæ°‘å«ç”Ÿå‡ºç‰ˆç¤¾ã€‹-é¢˜å¹²é¢˜'</span>), (<span class="string">'ä¹¦ç±\\E -ã€Šå„¿ç§‘æŠ¤ç†å­¦å®è·µä¸å­¦ä¹ æŒ‡å¯¼ï¼ˆåä¸‰äº”ï¼‰ã€‹â€”é€‰æ‹©é¢˜'</span>), (<span class="string">'ä¹¦ç±\\E -ã€Šå„¿ç§‘æŠ¤ç†å­¦å®è·µä¸å­¦ä¹ æŒ‡å¯¼ï¼ˆåä¸‰äº”ï¼‰ã€‹â€”é¢˜å¹²é¢˜'</span>);</span><br></pre></td></tr></table></figure><h2 id="æ“ä½œword"><a class="markdownIt-Anchor" href="#æ“ä½œword"></a> æ“ä½œword</h2><blockquote><p>ä½¿ç”¨<code>python-docx</code>: <code>python -m pip install python-docx</code>ï¼Œ <a href="https://python-docx.readthedocs.io/en/latest/" target="_blank" rel="noopener">https://python-docx.readthedocs.io/en/latest/</a></p></blockquote><ol><li>æ·»åŠ 1-9çº§æ ‡é¢˜</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> docx <span class="keyword">import</span> Document</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ–°çš„docxæ–‡ä»¶</span></span><br><span class="line">document = Document()</span><br><span class="line">document.add_heading(<span class="string">'1çº§æ ‡é¢˜'</span>, <span class="number">1</span>)  <span class="comment"># æ·»åŠ 1çº§æ ‡é¢˜</span></span><br><span class="line">document.add_heading(<span class="string">'2çº§æ ‡é¢˜'</span>, <span class="number">2</span>)  <span class="comment"># æ·»åŠ 2çº§æ ‡é¢˜</span></span><br><span class="line">document.add_heading(<span class="string">'3çº§æ ‡é¢˜'</span>, <span class="number">3</span>)  <span class="comment"># æ·»åŠ 3çº§æ ‡é¢˜</span></span><br><span class="line">document.add_heading(<span class="string">'4çº§æ ‡é¢˜'</span>, <span class="number">4</span>)  <span class="comment"># æ·»åŠ 4çº§æ ‡é¢˜</span></span><br><span class="line">document.add_heading(<span class="string">'5çº§æ ‡é¢˜'</span>, <span class="number">5</span>)  <span class="comment"># æ·»åŠ 5çº§æ ‡é¢˜</span></span><br><span class="line">document.add_heading(<span class="string">'6çº§æ ‡é¢˜'</span>, <span class="number">6</span>)  <span class="comment"># æ·»åŠ 6çº§æ ‡é¢˜</span></span><br><span class="line">document.add_heading(<span class="string">'7çº§æ ‡é¢˜'</span>, <span class="number">7</span>)  <span class="comment"># æ·»åŠ 7çº§æ ‡é¢˜</span></span><br><span class="line">document.add_heading(<span class="string">'8çº§æ ‡é¢˜'</span>, <span class="number">8</span>)  <span class="comment"># æ·»åŠ 8çº§æ ‡é¢˜</span></span><br><span class="line">document.add_heading(<span class="string">'9çº§æ ‡é¢˜'</span>, <span class="number">9</span>)  <span class="comment"># æ·»åŠ 9çº§æ ‡é¢˜</span></span><br><span class="line">document.save(<span class="string">'&#123;&#125;.docx'</span>.format(datetime.now().strftime(<span class="string">'%Y%m%d%H%M%S'</span>)))</span><br></pre></td></tr></table></figure><ol start="2"><li>æ·»åŠ æ®µè½</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> docx <span class="keyword">import</span> Document</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ–°çš„docxæ–‡ä»¶</span></span><br><span class="line">document = Document()</span><br><span class="line">paragraph = <span class="string">"""è¿™æ˜¯ä¸€ä¸ªæ®µè½</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">paragraph2 = <span class="string">"""è¿™æ˜¯ä¸€ä¸ªæ–°çš„æ®µè½"""</span></span><br><span class="line">paragraph3 = <span class="string">"""è¿™æ˜¯ä¸€ä¸ªæ–°çš„æ®µè½ã€‚</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">document.add_paragraph(paragraph)</span><br><span class="line">document.add_paragraph(paragraph2)</span><br><span class="line">document.add_paragraph(paragraph3)</span><br><span class="line">document.save(<span class="string">'&#123;&#125;.docx'</span>.format(datetime.now().strftime(<span class="string">'%Y%m%d%H%M%S'</span>)))</span><br></pre></td></tr></table></figure><ol start="3"><li>è®¾ç½®å­—ä½“å¤§å°å’Œæ ·å¼</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> docx <span class="keyword">import</span> Document</span><br><span class="line"><span class="comment"># åˆ›å»ºæ–°çš„docxæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">from</span> docx.shared <span class="keyword">import</span> Pt</span><br><span class="line"></span><br><span class="line">document = Document()</span><br><span class="line">document.add_paragraph(<span class="string">"è¿™æ˜¯ä¸€ä¸ªæ®µè½"</span>)  <span class="comment"># æ·»åŠ æ®µè½</span></span><br><span class="line">paragraph = document.add_paragraph(<span class="string">"è¿™æ˜¯ä¸€ä¸ªæ®µè½,"</span>)  <span class="comment"># æ·»åŠ æ®µè½</span></span><br><span class="line">run = paragraph.add_run(<span class="string">'è®¾ç½®äº†å­—ä½“çš„æ®µè½'</span>)  <span class="comment"># åœ¨åŒä¸€æ®µæ·»åŠ å†…å®¹, å³ä¸ºäº†æ“ä½œæ®µè½æˆ–å•è¯çš„å­å­—ç¬¦ä¸². æ¦‚å¿µä¸Šè®²ï¼Œæ‚¨éœ€è¦ä¸ºæ®µè½/æ–‡æœ¬çš„runæ¯ä¸ªéƒ¨åˆ†åˆ›å»ºä¸€ä¸ªå®ä¾‹ã€‚</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Append a run to this paragraph containing *text* and having character</span></span><br><span class="line"><span class="string">style identified by style ID *style*. *text* can contain tab</span></span><br><span class="line"><span class="string">(``\\t``) characters, which are converted to the appropriate XML form</span></span><br><span class="line"><span class="string">for a tab. *text* can also include newline (``\\n``) or carriage</span></span><br><span class="line"><span class="string">return (``\\r``) characters, each of which is converted to a line</span></span><br><span class="line"><span class="string">break.</span></span><br><span class="line"><span class="string">å¤§æ¦‚æ„æ€å°±æ˜¯è¿½åŠ ä¸€ä¸ªæ®µè½, åŒ…å«text, ä¸”è®¾ç½®äº†æ ¼å¼, æˆ‘æ„Ÿè§‰æ˜¯è¿™æ ·</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">run.font.name = <span class="string">u'å®‹ä½“'</span>  <span class="comment"># è®¾ç½®å­—ä½“</span></span><br><span class="line">run.font.size = Pt(<span class="number">20</span>)  <span class="comment"># è®¾ç½®å­—å·</span></span><br><span class="line"><span class="comment"># run.font.color.rgb = RGBColor(255, 0, 0)# è®¾ç½®çº¢è‰²</span></span><br><span class="line">run.font.underline = <span class="keyword">True</span><span class="comment"># è®¾ç½®ä¸‹åˆ’çº¿</span></span><br><span class="line"></span><br><span class="line">run1 = paragraph.add_run(<span class="string">'\tç²—ä½“'</span>)</span><br><span class="line">run1.bold = <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">run2 = paragraph.add_run(<span class="string">'\tæ–œä½“'</span>)</span><br><span class="line">run2.italic = <span class="keyword">True</span></span><br><span class="line"> <span class="comment">#å›¾ç‰‡å±…ä¸­è®¾ç½®</span></span><br><span class="line">paragraph.alignment = WD_PARAGRAPH_ALIGNMENT.CENTER</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Doc = Document() </span><br><span class="line">Doc.styles[<span class="string">'Normal'</span>].font.name = <span class="string">u'å®‹ä½“'</span></span><br><span class="line">Doc.styles[<span class="string">'Normal'</span>]._element.rPr.rFonts.set(qn(<span class="string">'w:eastAsia'</span>), <span class="string">u'å®‹ä½“'</span>)</span><br><span class="line">Doc.styles[<span class="string">'Normal'</span>].font.size = Pt(<span class="number">10.5</span>)</span><br><span class="line">Doc.styles[<span class="string">'Normal'</span>].font.color.rgb = RGBColor(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">Head = Doc.add_heading(<span class="string">""</span>,level=<span class="number">1</span>)<span class="comment"># è¿™é‡Œä¸å¡«æ ‡é¢˜å†…å®¹</span></span><br><span class="line">run  = Head.add_run(<span class="string">"åˆšæ¥csdnï¼Œè¿™å°±æ˜¯åšå®¢ä¹ˆï¼ŒIäº†"</span>)</span><br><span class="line">run.font.name=<span class="string">u'Cambria'</span></span><br><span class="line">run.font.color.rgb = RGBColor(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">run._element.rPr.rFonts.set(qn(<span class="string">'w:eastAsia'</span>), <span class="string">u'Cambria'</span>)</span><br><span class="line">Doc.add_paragraph(<span class="string">"Python "</span>)</span><br><span class="line">Doc.add_paragraph(<span class="string">"Python å¯¹wordè¿›è¡Œæ“ä½œ"</span>)</span><br><span class="line">Doc.save(<span class="string">"Python_word.docx"</span>)</span><br></pre></td></tr></table></figure><p>from : <a href="https://www.pythonheidong.com/blog/article/692569/99875f167810b45f17e8/" target="_blank" rel="noopener">https://www.pythonheidong.com/blog/article/692569/99875f167810b45f17e8/</a></p><ol start="4"><li>æœ‰åº(æ— åº)åˆ—è¡¨å’Œå¼•ç”¨</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¢åŠ å¼•ç”¨</span></span><br><span class="line">document.add_paragraph(<span class="string">'123'</span>, style=<span class="string">'Intense Quote'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¢åŠ æœ‰åºåˆ—è¡¨</span></span><br><span class="line">document.add_paragraph(<span class="string">u'æœ‰åºåˆ—è¡¨å…ƒç´ 1'</span>, style=<span class="string">'List Number'</span>)</span><br><span class="line">document.add_paragraph(<span class="string">u'æœ‰åºåˆ—åˆ«å…ƒç´ 2'</span>, style=<span class="string">'List Number'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¢åŠ æ— åºåˆ—è¡¨</span></span><br><span class="line">document.add_paragraph(<span class="string">u'æ— åºåˆ—è¡¨å…ƒç´ 1'</span>, style=<span class="string">'List Bullet'</span>)</span><br><span class="line">document.add_paragraph(<span class="string">u'æ— åºåˆ—è¡¨å…ƒç´ 2'</span>, style=<span class="string">'List Bullet'</span>)</span><br></pre></td></tr></table></figure><ol start="5"><li>è¡¨æ ¼å’Œåˆ†é¡µ</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¢åŠ å›¾ç‰‡ï¼ˆæ­¤å¤„ä½¿ç”¨ç›¸å¯¹ä½ç½®ï¼‰</span></span><br><span class="line"><span class="comment"># document.add_picture('jdb.jpg', width=Inches(1.25))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¢åŠ è¡¨æ ¼</span></span><br><span class="line">table = document.add_table(rows=<span class="number">3</span>, cols=<span class="number">3</span>)  <span class="comment"># 3è¡Œ3åˆ—</span></span><br><span class="line">hdr_cells1 = table.rows[<span class="number">0</span>].cells  <span class="comment"># ç¬¬ä¸€è¡Œ</span></span><br><span class="line">hdr_cells1[<span class="number">0</span>].text = <span class="string">"ç¬¬ä¸€è¡Œ,ç¬¬ä¸€åˆ—"</span></span><br><span class="line">hdr_cells1[<span class="number">1</span>].text = <span class="string">"ç¬¬ä¸€è¡Œ,ç¬¬äºŒåˆ—"</span></span><br><span class="line">hdr_cells1[<span class="number">2</span>].text = <span class="string">"ç¬¬ä¸€è¡Œ,ç¬¬ä¸‰åˆ—"</span></span><br><span class="line"></span><br><span class="line">hdr_cells2 = table.rows[<span class="number">1</span>].cells  <span class="comment"># ç¬¬äºŒè¡Œ</span></span><br><span class="line">hdr_cells2[<span class="number">0</span>].text = <span class="string">"ç¬¬äºŒè¡Œ,ç¬¬ä¸€åˆ—"</span></span><br><span class="line">hdr_cells2[<span class="number">1</span>].text = <span class="string">"ç¬¬äºŒè¡Œ,ç¬¬äºŒåˆ—"</span></span><br><span class="line">hdr_cells2[<span class="number">2</span>].text = <span class="string">"ç¬¬äºŒè¡Œ,ç¬¬ä¸‰åˆ—"</span></span><br><span class="line"></span><br><span class="line">hdr_cells3 = table.rows[<span class="number">2</span>].cells  <span class="comment"># ç¬¬ä¸‰è¡Œ</span></span><br><span class="line">hdr_cells3[<span class="number">0</span>].text = <span class="string">"ç¬¬ä¸‰è¡Œ,ç¬¬ä¸€åˆ—"</span></span><br><span class="line">hdr_cells3[<span class="number">1</span>].text = <span class="string">"ç¬¬ä¸‰è¡Œ,ç¬¬äºŒåˆ—"</span></span><br><span class="line">hdr_cells3[<span class="number">2</span>].text = <span class="string">"ç¬¬ä¸‰è¡Œ,ç¬¬ä¸‰åˆ—"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¢åŠ åˆ†é¡µ</span></span><br><span class="line">document.add_page_break()</span><br></pre></td></tr></table></figure><h3 id="æå–æ–‡å­—"><a class="markdownIt-Anchor" href="#æå–æ–‡å­—"></a> æå–æ–‡å­—</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> docx <span class="keyword">import</span> Document</span><br><span class="line"></span><br><span class="line">path = <span class="string">'/media/bobo/è‡ªåŠ¨åŒ–åŠå…¬/wordOperation/wordDemo/test2.docx'</span></span><br><span class="line"></span><br><span class="line">doc = Document(path)</span><br><span class="line">print(doc.paragraphs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºçš„æ˜¯åˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­ä¸€å…±æœ‰4ä»½å†…å®¹</span></span><br><span class="line"><span class="comment"># [&lt;docx.text.paragraph.Paragraph object at 0x7fca95f0aba8&gt;,</span></span><br><span class="line"><span class="comment"># &lt;docx.text.paragraph.Paragraph object at 0x7fca95f0abe0&gt;,</span></span><br><span class="line"><span class="comment"># &lt;docx.text.paragraph.Paragraph object at 0x7fca95f0ab70&gt;, </span></span><br><span class="line"><span class="comment">#&lt;docx.text.paragraph.Paragraph object at 0x7fca95f0ac50&gt;,]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> paragraph <span class="keyword">in</span> doc.paragraphs:</span><br><span class="line">print(paragraph.text)</span><br></pre></td></tr></table></figure><p>from :</p><ul><li><a href="https://www.cnblogs.com/rainbow-tan/p/14981998.html" target="_blank" rel="noopener">https://www.cnblogs.com/rainbow-tan/p/14981998.html</a></li><li><a href="https://www.cnblogs.com/wenshi-jj/p/15388808.html" target="_blank" rel="noopener">https://www.cnblogs.com/wenshi-jj/p/15388808.html</a></li><li><a href="https://www.cnblogs.com/rencm/p/6285304.html" target="_blank" rel="noopener">https://www.cnblogs.com/rencm/p/6285304.html</a></li><li><a href="https://blog.csdn.net/weixin_44576802/article/details/86552550%E2%80%94%E2%80%94%E9%A2%9C%E8%89%B2" target="_blank" rel="noopener">https://blog.csdn.net/weixin_44576802/article/details/86552550â€”â€”é¢œè‰²</a></li><li>å‚è€ƒï¼š<a href="https://www.cnblogs.com/wenshi-jj/p/15388808.html%E2%80%94%E2%80%94%E9%A1%B5%E8%BE%B9%E8%B7%9D%E3%80%81%E9%A1%B5%E7%9C%89%E5%92%8C%E9%A1%B5%E8%84%9A%E3%80%81%E5%88%86%E6%A0%8F" target="_blank" rel="noopener">https://www.cnblogs.com/wenshi-jj/p/15388808.htmlâ€”â€”é¡µè¾¹è·ã€é¡µçœ‰å’Œé¡µè„šã€åˆ†æ </a></li></ul><h1 id="å…±åŒç‚¹å¤„ç†"><a class="markdownIt-Anchor" href="#å…±åŒç‚¹å¤„ç†"></a> å…±åŒç‚¹å¤„ç†</h1><h2 id="æ–‡ä»¶ä¿å­˜"><a class="markdownIt-Anchor" href="#æ–‡ä»¶ä¿å­˜"></a> æ–‡ä»¶ä¿å­˜</h2><blockquote><p>ç”±äºæ–‡ä»¶å¤¹ã€æ–‡ä»¶åä¸å…è®¸æœ‰<code>/\:*?|&lt;&gt;&quot;</code>ï¼Œå› æ­¤éœ€è¦ä¿å­˜æ—¶å¦‚æœå‡ºç°è¿™äº›å­—ç¬¦å¾—ç‰¹åˆ«å¤„ç†ã€‚</p></blockquote><ol><li>é¡¹ç›®ä¸€ï¼š<code>xxxxé˜»å¢å‰‚\åæ¸—é€é˜»å¢å‰‚\25KGè¯¢ä»·ä¹¦è¯¢ä»·å…¬å‘Š\zxc.doc</code> ==&gt; <code>xxxé˜»å¢å‰‚ã€åæ¸—é€é˜»å¢å‰‚ã€25KGè¯¢ä»·ä¹¦è¯¢ä»·å…¬å‘Š\zxc.doc</code>ï¼Œå­˜å‚¨åœ¨<code>attaches\xxxé˜»å¢å‰‚ã€åæ¸—é€é˜»å¢å‰‚ã€25KGè¯¢ä»·ä¹¦è¯¢ä»·å…¬å‘Š\zxc.doc</code></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">format_name</span><span class="params">(name: str)</span> -&gt; [bool, str]:</span></span><br><span class="line">       <span class="string">"""</span></span><br><span class="line"><span class="string">       æ–‡ä»¶å’Œæ–‡ä»¶å¤¹åè§„èŒƒåŒ–</span></span><br><span class="line"><span class="string">       :param name:</span></span><br><span class="line"><span class="string">       :return:</span></span><br><span class="line"><span class="string">       """</span></span><br><span class="line">   invalid_char = [<span class="string">"/"</span>, <span class="string">"\\"</span>, <span class="string">":"</span>, <span class="string">"*"</span>, <span class="string">"?"</span>, <span class="string">"|"</span>, <span class="string">"&lt;"</span>, <span class="string">"&gt;"</span>, <span class="string">"\""</span>]</span><br><span class="line">       rename = name</span><br><span class="line">       valid = <span class="keyword">True</span></span><br><span class="line">       <span class="keyword">for</span> ch <span class="keyword">in</span> invalid_char:</span><br><span class="line">           <span class="keyword">if</span> ch <span class="keyword">in</span> rename:</span><br><span class="line">               <span class="keyword">if</span> ch == <span class="string">"?"</span>:</span><br><span class="line">                   rename = rename.replace(<span class="string">"?"</span>, <span class="string">"ï¼Ÿ"</span>)</span><br><span class="line">               <span class="keyword">elif</span> ch == <span class="string">"&lt;"</span>:</span><br><span class="line">                   rename = rename.replace(<span class="string">"&lt;"</span>, <span class="string">"["</span>)</span><br><span class="line">               <span class="keyword">elif</span> ch == <span class="string">"&gt;"</span>:</span><br><span class="line">                   rename = rename.replace(<span class="string">"&gt;"</span>, <span class="string">"]"</span>)</span><br><span class="line">               <span class="keyword">else</span>:</span><br><span class="line">                   rename = rename.replace(ch, <span class="string">"ã€"</span>)</span><br><span class="line">               valid = <span class="keyword">False</span></span><br><span class="line">       <span class="keyword">return</span> valid, rename</span><br></pre></td></tr></table></figure><ol start="2"><li>é¡¹ç›®äºŒï¼š<code>'.\\docx/ä¸“ç§‘é¢˜åº“\\å„¿ç§‘\\[ä¹¦ç±]\\S-ã€Šå®ç”¨ä¸´åºŠæŠ¤ç†ä¸‰åŸº-&quot;åº”çŸ¥åº”ä¼š&quot;ã€‹â€”åè¯è§£é‡Šã€ç®€ç­”(è§„02ï¼‰\\something.docx'</code>===&gt;<code>'.\\docx/ä¸“ç§‘é¢˜åº“\\å„¿ç§‘\\[ä¹¦ç±]\\S-ã€Šå®ç”¨ä¸´åºŠæŠ¤ç†ä¸‰åŸº-'åº”çŸ¥åº”ä¼š'ã€‹â€”åè¯è§£é‡Šã€ç®€ç­”(è§„02ï¼‰\\something.docx'</code></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">format_file_path</span><span class="params">(path: str)</span> -&gt; [bool, str]:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    æ–‡ä»¶å’Œæ–‡ä»¶å¤¹åè§„èŒƒåŒ–</span></span><br><span class="line"><span class="string">    :param name:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    invalid_char = [<span class="string">"/"</span>, <span class="string">"\\"</span>, <span class="string">":"</span>, <span class="string">"*"</span>, <span class="string">"?"</span>, <span class="string">"|"</span>, <span class="string">"&lt;"</span>, <span class="string">"&gt;"</span>, <span class="string">"\""</span>]</span><br><span class="line">    rename = path</span><br><span class="line">    valid = <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> invalid_char:</span><br><span class="line">        <span class="keyword">if</span> ch <span class="keyword">in</span> rename:</span><br><span class="line">            <span class="keyword">if</span> ch == <span class="string">"?"</span>:</span><br><span class="line">                rename = rename.replace(<span class="string">"?"</span>, <span class="string">"ï¼Ÿ"</span>)</span><br><span class="line">            <span class="keyword">elif</span> ch == <span class="string">"&lt;"</span>:</span><br><span class="line">                rename = rename.replace(<span class="string">"&lt;"</span>, <span class="string">"["</span>)</span><br><span class="line">            <span class="keyword">elif</span> ch == <span class="string">"&gt;"</span>:</span><br><span class="line">                rename = rename.replace(<span class="string">"&gt;"</span>, <span class="string">"]"</span>)</span><br><span class="line">            <span class="keyword">elif</span> ch == <span class="string">'"'</span>:</span><br><span class="line">                rename = rename.replace(<span class="string">"\""</span>, <span class="string">"\'"</span>)</span><br><span class="line">            <span class="keyword">elif</span> ch == <span class="string">"\\"</span> <span class="keyword">or</span> ch == <span class="string">"/"</span>:</span><br><span class="line">                <span class="comment"># æ³¨æ„è·Ÿ ä¸Šä¸€ä¸ªçš„åŒºåˆ«ï¼Œ ç”±äºä¸Šä¸€ä¸ªé¡¹ç›®ä¸­çš„/å’Œ\éƒ½æ˜¯åˆ†éš”ç¬¦ï¼Œè€Œä¸æ˜¯çœŸå®çš„åˆ†éš”ç›®å½•ï¼Œå› æ­¤éœ€è¦æ›¿æ¢ï¼Œä½†æœ¬é¡¹ç›®æ˜¯çœŸå®è·¯å¾„åˆ†éš”ç¬¦ï¼Œæ‰€ä»¥ä¸éœ€è¦è½¬æ¢</span></span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                rename = rename.replace(ch, <span class="string">"ã€"</span>)</span><br><span class="line">            valid = <span class="keyword">False</span></span><br><span class="line">    <span class="keyword">return</span> valid, rename</span><br></pre></td></tr></table></figure><h1 id="é™„å½•"><a class="markdownIt-Anchor" href="#é™„å½•"></a> é™„å½•</h1><h3 id="lxmlåº“çš„ä½¿ç”¨"><a class="markdownIt-Anchor" href="#lxmlåº“çš„ä½¿ç”¨"></a> lxmlåº“çš„ä½¿ç”¨</h3><ul><li><p>æå–Elementä¸­æœ€è¿‘æ ‡ç­¾ä¸­çš„æ–‡æœ¬(ä¸åŒ…å«æ ‡ç­¾æœ¬èº«): <code>ele.xpath('//*[@id=&quot;xxx&quot;]/text()')</code></p></li><li><p>æå–Elementä¸­æ‰€æœ‰æ ‡ç­¾(æ ‡ç­¾åµŒå¥—)ä¸­çš„æ–‡æœ¬(ä¸åŒ…å«æ ‡ç­¾æœ¬èº«): <code>ele.xpath('//*[@id=&quot;xxx&quot;]/string(.)')</code></p><ul><li>æ³¨ï¼šè·Ÿ<code>//text()</code>åŒºåˆ«åœ¨äºï¼Œ<code>string(.)</code>çš„ç»“æœä¸ºåˆå¹¶åçš„strï¼Œ<code>//text()</code>ä¸ºæœªåˆå¹¶çš„list</li></ul></li><li><p>æå–Elementä¸­æ‰€æœ‰å†…å®¹(æ ‡ç­¾æœ¬èº«): <code>etree.tostring(ele, method=&quot;html&quot;)</code></p></li><li><p>ä¿®æ”¹ElementæŸä¸€å±æ€§:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">appendixs = html_content.xpath(<span class="string">'/html/body/div[4]/div/div[4]/div/div/div[1]/div[4]/p/a'</span>)</span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> appendixs:</span><br><span class="line">    href = a.xpath(<span class="string">"@href"</span>)[<span class="number">0</span>]</span><br><span class="line">    save_path = self.download_file(ReUtil.extra_announcement_id(detail_article_url), href, title)</span><br><span class="line">    <span class="comment"># htmlä¸­ä¼šå¯¹\è¿›è¡Œè½¬ä¹‰</span></span><br><span class="line">    a.attrib[<span class="string">"href"</span>] = save_path</span><br></pre></td></tr></table></figure><p>æ³¨: ä¿®æ”¹å­elementçš„æŸå±æ€§åï¼ŒrootèŠ‚ç‚¹tostringçš„ç»“æœä¸­elementä¹Ÿä¼šè¢«ä¿®æ”¹ã€‚(rootæŠ±æœ‰elementçš„å¼•ç”¨)</p></li><li><p>Elementçš„XMLæ ‡è®°åé€šè¿‡å¯¹è±¡çš„å±æ€§è®¿é—®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a = &apos;&lt;a href=&quot;http://baidu.com&quot;&gt;hh&lt;span&gt;gg&lt;/span&gt;&lt;/a&gt;&apos;</span><br><span class="line">res = &#123;_Element: 1&#125; &lt;Element html at 0x1de3a6b9800&gt;</span><br><span class="line">     attrib = &#123;_Attrib: 0&#125; &#123;&#125;</span><br><span class="line">     base = &#123;NoneType&#125; None</span><br><span class="line">     nsmap = &#123;dict: 0&#125; &#123;&#125;</span><br><span class="line">     prefix = &#123;NoneType&#125; None</span><br><span class="line">     sourceline = &#123;int&#125; 1</span><br><span class="line">     tag = &#123;str&#125; &apos;html&apos;</span><br><span class="line">     tail = &#123;NoneType&#125; None</span><br><span class="line">     text = &#123;NoneType&#125; None</span><br></pre></td></tr></table></figure></li><li><p>Elementè¢«ç»„ç»‡åœ¨XMLæ ‘ç»“æ„ä¸­ã€‚å¢åŠ å­Elementå¹¶æŒ‡å®šå®ƒä»¬çš„çˆ¶Elementï¼Œä½¿ç”¨appendæ–¹æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³•ä¸€</span></span><br><span class="line">root = etree.Element(<span class="string">"root"</span>)</span><br><span class="line">root.append(etree.Element(<span class="string">"child1"</span>))</span><br><span class="line"><span class="comment"># æ³•äºŒ</span></span><br><span class="line">childNode = etree.SubElement(root, <span class="string">"child"</span>)</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤Elementä¸‹æŸä¸€èŠ‚ç‚¹å†…å®¹ï¼Œä¸æ·»åŠ ç›¸åŒï¼Œä¹Ÿæœ‰å®ä¾‹æ–¹æ³•å’Œå·¥å‚æ–¹æ³•ä¸¤ç§</p><ul><li><p><code>parentnode.remove(node)</code></p></li><li><p><code>etree.strip_elements(html, 'element_name', with_tag=True/False)</code></p></li></ul></li></ul><h3 id="timeitæ¨¡å—ä½¿ç”¨"><a class="markdownIt-Anchor" href="#timeitæ¨¡å—ä½¿ç”¨"></a> <code>timeit</code>æ¨¡å—ä½¿ç”¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spider = HuaNengSpider(ifend=<span class="string">"in"</span>)</span><br><span class="line"><span class="comment"># è®°å¾—setupå¯¼å…¥ </span></span><br><span class="line">run_time = timeit.timeit(<span class="string">"spider.run_parallelly()"</span>, <span class="string">"from __main__ import spider"</span>, number=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># è¾“å‡ºçš„å•ä½ä¸ºs </span></span><br><span class="line">print(<span class="string">"è€—æ—¶: &#123;&#125;s"</span>.format(run_time))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">run_time = timeit.timeit(<span class="string">'HuaNengSpider(ifend="notin", is_in_one=True).run_with_concurrent()'</span>,</span><br><span class="line">                         <span class="string">"from __main__ import HuaNengSpider"</span>, number=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h3 id="pythonä¸­æ“ä½œsqlalchemysqlalchemyä¸­æ–‡æŠ€æœ¯æ–‡æ¡£"><a class="markdownIt-Anchor" href="#pythonä¸­æ“ä½œsqlalchemysqlalchemyä¸­æ–‡æŠ€æœ¯æ–‡æ¡£"></a> Pythonä¸­æ“ä½œSQLAlchemy,SQLAlchemyä¸­æ–‡æŠ€æœ¯æ–‡æ¡£</h3><p>å‚è€ƒï¼š<a href="https://www.jianshu.com/p/0ad18fdd7eed%E3%80%81" target="_blank" rel="noopener">https://www.jianshu.com/p/0ad18fdd7eedã€</a><a href="https://www.cnblogs.com/yc-c/p/9627968.html" target="_blank" rel="noopener">python3 SQLAlchemyæ¨¡å—ä½¿ç”¨</a></p><h3 id="argumentparserä½¿ç”¨"><a class="markdownIt-Anchor" href="#argumentparserä½¿ç”¨"></a> <code>ArgumentParser</code>ä½¿ç”¨</h3><ul><li><p><code>parser.add_argument(&quot;-o&quot;, &quot;--is_in_one&quot;, action=&quot;store_true&quot;, help=&quot;æ•°æ®å­˜æ”¾åœ¨ä¸€å¼ è¡¨ä¸­&quot;)</code>, å…¶ä¸­actionçš„<code>store_true</code>è¡¨ç¤ºï¼Œå¦‚æœå‡ºç°â€“is_in_one(action)åˆ™è®¾ç½®æœªtrue, æ‰€ä»¥é»˜è®¤ä¸ºFalse</p><ul><li>å‚æ•°è®¾ç½®ä¸ºTrueã€Falseçš„æœ€å¥½ä¸ä½¿ç”¨choiceå‚æ•°ï¼šå› ä¸º</li><li><code>parser.add_argument(&quot;-o&quot;, &quot;--is_in_one&quot;, choices=[True, False], help=&quot;æ•°æ®å­˜æ”¾åœ¨ä¸€å¼ è¡¨ä¸­&quot;)</code>, choiceä¸­ä¸ºTrueã€Falseæ—¶ï¼Œ å¯ä»¥é€‰æ‹©ä¸å¡«ï¼Œæ­¤æ—¶is_in_oneä¸ºNoneï¼Œ å¦‚æœå¿…é¡»è¦è¿™ä¸¤ä¸ªåˆ™é€‰ä¸€ä¸ªåˆ™åŠ ä¸Š<code>required=True</code>é€‰é¡¹</li><li>åŠ ä¸Šrequiredæ•ˆæœ===&gt;<code>çˆ¬è™«è„šæœ¬: error: argument -o/--is_in_one: invalid choice: 'q' (choose from True, False)</code>ï¼Œ ä½†æ˜¯å¦‚æœè¾“å…¥TrueåŒæ ·ä¼šæŠ¥é”™: çˆ¬è™«è„šæœ¬: error: argument -o/â€“is_in_one: invalid choice: â€˜Trueâ€™ (choose from True, False)</li></ul><p>æ‰€ä»¥åªæœ‰<code>choices=[&quot;True&quot;, &quot;False&quot;]</code>æ‰èƒ½ç”Ÿæ•ˆï¼Œ å¥½åœ¨çš„æ˜¯Pythonä¸­å¯¹trueåˆ¤æ–­æ¯”è¾ƒå®½å®¹ï¼Œä¸‹é¢ä¸‰ç§éƒ½å¯ä»¥ï¼Œå› æ­¤ä½¿å¾—choiceä¼ strç±»å‹çš„Trueä¹Ÿå¯ä»¥æˆåŠŸåˆ¤å®šï¼Œå³èƒ½å®ç°ç›¸åŒæ•ˆæœï¼Œä½†æ˜¯è¿˜æ˜¯å­˜åœ¨äº›æ­§ä¹‰çš„ï¼Œå¾—è°¨æ…ä½¿ç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">"true"</span></span><br><span class="line">b = <span class="keyword">True</span></span><br><span class="line">c = <span class="string">"True"</span></span><br><span class="line"><span class="keyword">if</span> a:</span><br><span class="line">    print(<span class="string">"a yes"</span>)</span><br><span class="line"><span class="keyword">if</span> b:</span><br><span class="line">    print(<span class="string">"b yes"</span>)</span><br><span class="line"><span class="keyword">if</span> c:</span><br><span class="line">    print(<span class="string">"c yes"</span>)</span><br></pre></td></tr></table></figure></li></ul><h3 id="å…¶ä»–sqlæ–‡ä»¶"><a class="markdownIt-Anchor" href="#å…¶ä»–sqlæ–‡ä»¶"></a> å…¶ä»–SQLæ–‡ä»¶</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`auto_bilibili`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`userid`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'åˆ›å»ºçš„ä»»åŠ¡å'</span>,</span><br><span class="line">  <span class="string">`sessdata`</span> longtext <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`bili_jct`</span> longtext <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`dedeuserid`</span> longtext <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`taskIntervalTime`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'10'</span> <span class="keyword">COMMENT</span> <span class="string">'ä»»åŠ¡ä¹‹é—´çš„æ‰§è¡Œé—´éš”'</span>,</span><br><span class="line">  <span class="string">`numberOfCoins`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'5'</span> <span class="keyword">COMMENT</span> <span class="string">'æ¯æ—¥æŠ•å¸æ•°é‡'</span>,</span><br><span class="line">  <span class="string">`reserveCoins`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'50'</span> <span class="keyword">COMMENT</span> <span class="string">'é¢„ç•™çš„ç¡¬å¸æ•°'</span>,</span><br><span class="line">  <span class="string">`selectLike`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> <span class="keyword">COMMENT</span> <span class="string">'æŠ•å¸æ—¶æ˜¯å¦ç‚¹èµï¼Œé»˜è®¤ 0, 0ï¼šå¦ 1ï¼šæ˜¯'</span>,</span><br><span class="line">  <span class="string">`monthEndAutoCharge`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'true'</span> <span class="keyword">COMMENT</span> <span class="string">'å¹´åº¦å¤§ä¼šå‘˜æœˆåº•æ˜¯å¦ç”¨ B å¸åˆ¸ç»™è‡ªå·±å……ç”µï¼Œé»˜è®¤ trueï¼Œå³å……ç”µå¯¹è±¡æ˜¯ä½ æœ¬äººã€‚'</span>,</span><br><span class="line">  <span class="string">`giveGift`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'true'</span> <span class="keyword">COMMENT</span> <span class="string">'ç›´æ’­é€å‡ºå³å°†è¿‡æœŸçš„ç¤¼ç‰©ï¼Œé»˜è®¤å¼€å¯'</span>,</span><br><span class="line">  <span class="string">`upLive`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> <span class="keyword">COMMENT</span> <span class="string">'ç›´æ’­é€å‡ºå³å°†è¿‡æœŸçš„ç¤¼ç‰©ï¼ŒæŒ‡å®š up ä¸»ï¼Œä¸º 0 æ—¶åˆ™éšéšæœºé€‰å–ä¸€ä¸ª up ä¸»'</span>,</span><br><span class="line">  <span class="string">`chargeForLove`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> <span class="keyword">COMMENT</span> <span class="string">'ç»™æŒ‡å®š up ä¸»å……ç”µï¼Œå€¼ä¸º 0 æˆ–è€…å……ç”µå¯¹è±¡çš„ uidï¼Œé»˜è®¤ä¸º 0ï¼Œå³ç»™è‡ªå·±å……ç”µ'</span>,</span><br><span class="line">  <span class="string">`devicePlatform`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'ios'</span> <span class="keyword">COMMENT</span> <span class="string">'æ‰‹æœºç«¯æ¼«ç”»ç­¾åˆ°æ—¶çš„å¹³å°ï¼Œå»ºè®®é€‰æ‹©ä½ è®¾å¤‡çš„å¹³å° ï¼Œé»˜è®¤ ios'</span>,</span><br><span class="line">  <span class="string">`coinAddPriority`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'1'</span> <span class="keyword">COMMENT</span> <span class="string">'0ï¼šä¼˜å…ˆç»™çƒ­æ¦œè§†é¢‘æŠ•å¸ï¼Œ1ï¼šä¼˜å…ˆç»™å…³æ³¨çš„ up æŠ•å¸'</span>,</span><br><span class="line">  <span class="string">`userAgent`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36 Edg/86.0.622.69'</span> <span class="keyword">COMMENT</span> <span class="string">'æµè§ˆå™¨ UA'</span>,</span><br><span class="line">  <span class="string">`skipDailyTask`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'false'</span> <span class="keyword">COMMENT</span> <span class="string">'æ˜¯å¦è·³è¿‡æ¯æ—¥ä»»åŠ¡'</span>,</span><br><span class="line">  <span class="string">`webhook`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'æ¨é€åœ°å€'</span>,</span><br><span class="line">  <span class="string">`enddate`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`match_enable`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'false'</span> <span class="keyword">COMMENT</span> <span class="string">'é¢„æµ‹æ˜¯å¦å¼€å¯'</span>,</span><br><span class="line">  <span class="string">`match_predictNumberOfCoins`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'10'</span> <span class="keyword">COMMENT</span> <span class="string">'å•æ¬¡é¢„æµ‹æŠ•æ³¨ç¡¬å¸'</span>,</span><br><span class="line">  <span class="string">`match_minimumNumberOfCoins`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'200'</span> <span class="keyword">COMMENT</span> <span class="string">'é¢„æµ‹ä¿ç•™ç¡¬å¸'</span>,</span><br><span class="line">  <span class="string">`match_showHandModel`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'false'</span> <span class="keyword">COMMENT</span> <span class="string">'æŠ¼æ³¨å½¢å¼'</span>,</span><br><span class="line">  <span class="string">`other`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`userid`</span> (<span class="string">`userid`</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">7</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 ROW_FORMAT=DYNAMIC</span><br></pre></td></tr></table></figure><h1 id="2022å¹´3æœˆ26æ—¥å°é¸¡è¯å…¸"><a class="markdownIt-Anchor" href="#2022å¹´3æœˆ26æ—¥å°é¸¡è¯å…¸"></a> 2022å¹´3æœˆ26æ—¥â€”â€”å°é¸¡è¯å…¸</h1><h1 id="æŠ“å–æŒ‡å®šè¯æ¡ä¿¡æ¯"><a class="markdownIt-Anchor" href="#æŠ“å–æŒ‡å®šè¯æ¡ä¿¡æ¯"></a> æŠ“å–æŒ‡å®šè¯æ¡ä¿¡æ¯</h1><blockquote><p><a href="https://jikipedia.com/search?phrase=a&amp;category=definition" target="_blank" rel="noopener">https://jikipedia.com/search?phrase=a&amp;category=definition</a></p></blockquote><p>éœ€æ±‚ï¼šå°†åŒ…å«è‹±æ–‡çš„è¯æ¡ä¿¡æ¯ä¿å­˜åˆ°excelæ–‡ä»¶ä¸­</p><p>éš¾ç‚¹ï¼š</p><ul><li>ç”±äºä¸æ–­ä¸‹æ»‘éƒ½ä¼šäº§ç”Ÿæ•°æ®ï¼Œ å› æ­¤éš¾ä»¥è¯„ä¼°æ•°æ®é‡</li></ul><p>æ€è·¯ï¼šé€šè¿‡æœç´¢a-zè‹±æ–‡å­—æ¯ï¼Œä»è€Œæ‰¾å‡ºæ‰€æœ‰åŒ…å«è‹±æ–‡å­—æ¯çš„å•è¯ï¼Œç”±äºæœç´¢ç»“æœçš„æ•°é‡æ˜¯æœ‰é™çš„ï¼Œå› æ­¤å¯ä»¥ç¡®å®šæ˜¯å¦å®Œæˆã€‚ éšç€è€Œæ¥çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœè¯æ¡ä¸ºappleï¼Œé‚£ä¹ˆæœa/p/l/eéƒ½ä¼šé‡å¤æŠ“å–==&gt;é˜²é‡æ€è·¯: é€šè¿‡è¯æ¡idæ¥åˆ¤æ–­æ˜¯å¦å·²ç»çˆ¬å–è¿‡</p><h1 id="lookup"><a class="markdownIt-Anchor" href="#lookup"></a> Lookup:</h1><ul><li><p><a href="https://blog.csdn.net/weixin_37577134/article/details/89048798" target="_blank" rel="noopener">ã€pythonã€‘xlwingså¦‚ä½•è®¾ç½®å­—ä½“ã€é¢œè‰²ç­‰å±æ€§</a></p></li><li><p><a href="https://zhuanlan.zhihu.com/p/120415076" target="_blank" rel="noopener">å…¨ç½‘æœ€è¯¦ç»†çš„xlwingsåº“è§£æ(3) â€“ Pythonæ“ä½œå·¥ä½œç°¿&amp;è¡¨</a></p></li><li><p><a href="https://blog.csdn.net/chang1976272446/article/details/84140117" target="_blank" rel="noopener">xlwingsè·å–excel sheetå¤šå°‘è¡Œå¤šå°‘åˆ—</a></p></li><li><p><a href="https://blog.csdn.net/weixin_44015669/article/details/117637954" target="_blank" rel="noopener">Pythonï¼šåˆ©ç”¨xlwingsåº“å®ç°excelè¿›è¡Œæ’å…¥ã€åˆ é™¤è¡Œæ“ä½œå®ä¾‹</a></p></li><li><p>æ•°æ®åº“ä¸­create_timeæ—¢å¯ä»¥æŒ‡å®šä¸ºDATETIMEä¹Ÿå¯ä»¥è®¾ç½®ä¸ºTIMESTAMPï¼Œè€Œå¯¹åº”çš„åœ¨SQLä¸­ä½db.DateTimeã€TIMESTAMP</p></li></ul><p>â–². ç”±äºä¸éœ€è¦å¯¹excelä¸­æ ·å¼è¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ºäº†çœäº‹ï¼Œæœ€ç»ˆç›´æ¥é‡‡ç”¨äº†å…¥åº“å¯¼å‡ºExcelçš„æ–¹å¼ï¼Œè€Œæ²¡ç”¨ä½¿ç”¨xlwingsåº“</p><h2 id="æ—¥å¿—è¾“å‡ºä¸¤æ¬¡"><a class="markdownIt-Anchor" href="#æ—¥å¿—è¾“å‡ºä¸¤æ¬¡"></a> æ—¥å¿—è¾“å‡ºä¸¤æ¬¡</h2><p>åŸå› æ˜¯å¤šä¸ªPyæ–‡ä»¶ä¸­å¼•å…¥äº†<code>LOG</code>, ä½†å¼•å…¥æ–¹å¼ä¸ä¸€æ ·ï¼Œå¦‚main.pyä¸­æ˜¯<code>from logger import LOG</code>, è€Œspider.pyä¸­æ˜¯<code>from logger import LOG</code>,<br>saver.oyä¸­æ˜¯<code>from jikipedia.logger import LOG</code></p><p>â–² <a href="http://xn--mainspider-yt2pm7a86yp5bky8aghsszaw517eiuka.py" target="_blank" rel="noopener">é—®é¢˜å°±å‡ºåœ¨mainä¸­å¯¼å…¥äº†spider.py</a>, <a href="http://xn--spidersaver-ox9qz06chk1b4gzejotb.py" target="_blank" rel="noopener">è€Œspideråˆå¼•ç”¨äº†saver.py</a>ï¼Œä½†æ˜¯saverä¸­å¼•ç”¨çš„LOGç”±äºå¯¼å…¥æ–¹å¼ä¸åŒï¼Œä½¿å¾—è·Ÿå‰ä¸¤ä¸ªçš„ä½¿ç”¨çš„LOGä¸æ˜¯åŒä¸€ä¸ªï¼Œä½†LOGé…ç½®éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¯¼è‡´äº†è¾“å‡ºå¤šæ¬¡ã€‚</p><h2 id="pyteståº“ä½¿ç”¨"><a class="markdownIt-Anchor" href="#pyteståº“ä½¿ç”¨"></a> pyteståº“ä½¿ç”¨</h2><blockquote><p><code>pip install pytest</code></p></blockquote><ul><li>æµ‹è¯•æ–‡ä»¶ä»¥test_å¼€å¤´ï¼ˆä»¥_testç»“å°¾ä¹Ÿå¯ä»¥ï¼‰</li><li>æµ‹è¯•ç±»ä»¥Testå¼€å¤´ï¼Œå¹¶ä¸”ä¸èƒ½å¸¦æœ‰ init æ–¹æ³•</li><li>æµ‹è¯•å‡½æ•°ä»¥test_å¼€å¤´</li><li>æ–­è¨€ä½¿ç”¨åŸºæœ¬çš„assertå³å¯</li></ul><p><strong>pytest å¤¹å…·</strong>(fixture)</p><blockquote><p>æµ‹è¯•éœ€è¦åœ¨ä¸€ç»„å·²çŸ¥å¯¹è±¡çš„èƒŒæ™¯ä¸‹è¿›è¡Œã€‚ è¿™ç»„å¯¹è±¡ç§°ä¸ºæµ‹è¯•å¤¹å…·(fixture)ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> algo</span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">data</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">-3</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">-2</span>, <span class="number">11</span>, <span class="number">9</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_sel_sort</span><span class="params">(data)</span>:</span></span><br><span class="line">    sorted_vals = algo.sel_sort(data)</span><br><span class="line">    <span class="keyword">assert</span> sorted_vals == sorted(data)</span><br></pre></td></tr></table></figure><h3 id="ç»¼åˆæµ‹è¯•"><a class="markdownIt-Anchor" href="#ç»¼åˆæµ‹è¯•"></a> ç»¼åˆæµ‹è¯•</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å±•ç¤ºå¦‚ä½•åœ¨ Python åŒ…ä¸­è¿è¡Œæµ‹è¯•ã€‚</p><ol><li>é¦–å…ˆæŠŠå°†æ‰€æœ‰çš„æµ‹è¯•æ–‡ä»¶å…¨éƒ¨æ”¾åœ¨<code>./tests/</code>æ–‡ä»¶å¤¹ä¸‹</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">setup.py</span><br><span class="line">utils</span><br><span class="line">â”‚   algo.py</span><br><span class="line">â”‚   srel.py</span><br><span class="line">â”‚   __init__.py</span><br><span class="line">â”‚</span><br><span class="line">â””â”€â”€â”€tests</span><br><span class="line">        algo_test.py</span><br><span class="line">        srel_test.py</span><br><span class="line">        __init__.py</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># tests/algo_test.py</span></span><br><span class="line"><span class="keyword">import</span> utils.algo</span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">data</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">-3</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">-2</span>, <span class="number">11</span>, <span class="number">9</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_sel_sort</span><span class="params">(data)</span>:</span></span><br><span class="line">    sorted_vals = utils.algo.sel_sort(data)</span><br><span class="line">    <span class="keyword">assert</span> sorted_vals == sorted(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_min</span><span class="params">()</span>:</span></span><br><span class="line">    values = (<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">    val = utils.algo.min(values)</span><br><span class="line">    <span class="keyword">assert</span> val == <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_max</span><span class="params">()</span>:</span></span><br><span class="line">    values = (<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">    val = utils.algo.max(values)</span><br><span class="line">    <span class="keyword">assert</span> val == <span class="number">6</span></span><br></pre></td></tr></table></figure><ol start="2"><li><code>pytest tests/</code></li></ol><p>æ‰§è¡Œæ–‡ä»¶ã€æ–‡ä»¶å¤¹</p><ul><li>pytest test_mod.py æ‰§è¡Œè¯¥æ¨¡å—ä¸‹çš„æµ‹è¯•ç±»æµ‹è¯•æ–¹æ³•</li><li>pytest testing æ‰§è¡Œè¯¥æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ¨¡å—</li><li>pytest test_cgi.py::test_answerï¼Œæ‰§è¡Œtest_answeræ–¹æ³•</li><li>pytest test_cgi.py::TestMyClass::test_oneï¼Œæ‰§è¡ŒTestMyClassç±»ä¸‹çš„test_oneæ–¹æ³•</li></ul><p>more: <a href="https://www.imooc.com/wiki/pycharmlesson/pytest.html" target="_blank" rel="noopener">åœ¨ PyCharm é‡Œä½¿ç”¨ Pytest æµ‹è¯•æ¡†æ¶</a></p><h2 id="requestså¼‚å¸¸"><a class="markdownIt-Anchor" href="#requestså¼‚å¸¸"></a> requestså¼‚å¸¸</h2><p>ReadTimeout: æ„æ€æ˜¯å·²ç»å»ºç«‹è¿æ¥ï¼Œå¹¶å¼€å§‹è¯»å–æœåŠ¡ç«¯èµ„æºã€‚å¦‚æœåˆ°äº†æŒ‡å®šçš„æ—¶é—´ï¼Œæ²¡æœ‰å¯èƒ½çš„æ•°æ®è¢«å®¢æˆ·ç«¯è¯»å–ï¼Œåˆ™æŠ¥å¼‚å¸¸ã€‚<br>å‡ºç°çš„æƒ…å†µæ˜¯åœ¨è®¾ç½®äº†timeoutè®¾ç½®ä¸º3ç§’ï¼ŒæœåŠ¡å™¨åœ¨3ç§’å†…æœªç»™å‡ºå“åº”ï¼Œå‡ºç°æŠ¥é”™<code>requests.exceptions.ReadTimeout</code>ã€‚ ConnectTimeout:<br>æ„æ€æ˜¯ç”¨æ¥å»ºç«‹è¿æ¥çš„æ—¶é—´ã€‚å¦‚æœåˆ°äº†æŒ‡å®šçš„æ—¶é—´ï¼Œè¿˜æ²¡å»ºç«‹è¿æ¥ï¼Œåˆ™æŠ¥å¼‚å¸¸ã€‚</p><h2 id="é™„å½•-2"><a class="markdownIt-Anchor" href="#é™„å½•-2"></a> é™„å½•</h2><h3 id="å¯¼å…¥é—®é¢˜"><a class="markdownIt-Anchor" href="#å¯¼å…¥é—®é¢˜"></a> å¯¼å…¥é—®é¢˜ï¼š</h3><p>åœ¨tests/ä¸­å¦‚æœè¦å¼•å·¥ç¨‹æ ¹ç›®å½•çš„æ–‡ä»¶æ¯”è¾ƒéº»çƒ¦ï¼Œå¾—é€šè¿‡ç›¸å¯¹è·¯å¾„<code>from ..utils import xxx</code>çš„æ–¹å¼, ä½†æ˜¯è¿™æ ·å¿…é¡»æŠŠå†åŠ ä¸Š<code>sys.path.append(&quot;..&quot;)</code><br>ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯æ‰€æœ‰æ¨¡å—éƒ½ä»æ ¹å·¥ç¨‹ä¸ºç»å¯¹è·¯å¾„å¼€å§‹å¼•ï¼Œæ¯”å¦‚main.pyä¸­å¼•settingsä¸º<code>from jikipedia.settings import xxx</code>,<br>è€Œtestsä¸­å¼•ä¹Ÿæ˜¯åŒæ ·<code>from jikipedia.settings import xxx</code>==&gt;pycharmä¸­ä½¿ç”¨alt+enteræç¤ºåä½¿ç”¨çš„importä¹Ÿæ˜¯ä»æ ¹ç›®å½•å¯¼å…¥<code>from jikipedia.xxx import yyy</code></p><p>æ³¨ï¼š è¿™æ ·éœ€è¦æŠŠå·¥ç¨‹æ ¹ç›®å½•ä½œä¸ºåŒ…ï¼Œæ‰€ä»¥å¾—åœ¨æ ¹ç›®å½•åŠ ä¸Š<code>__init__.py</code>æ–‡ä»¶</p><h3 id="è„šæœ¬ä¸­ç›¸å¯¹è·¯å¾„é—®é¢˜"><a class="markdownIt-Anchor" href="#è„šæœ¬ä¸­ç›¸å¯¹è·¯å¾„é—®é¢˜"></a> è„šæœ¬ä¸­ç›¸å¯¹è·¯å¾„é—®é¢˜</h3><p>ç”±äºsettings.pyä¼šç›´æ¥åœ¨åŒçº§çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºattachesæ–‡ä»¶å¤¹ï¼Œä½†æ˜¯å¦‚æœç›´æ¥æ˜¯<code>mkdir(&quot;./attaches&quot;)</code>çš„è¯ï¼Œtests/ä¸­åªè¦é—´æ¥å¯¼å…¥äº†settings.pyéƒ½ä¼šåœ¨tests/ä¸‹åˆ›å»ºattachesï¼Œå› ä¸ºæ­¤æ—¶çš„è„šæœ¬è·¯å¾„æ˜¯åœ¨tests/ä¸‹ï¼Œæ‰€ä»¥settingsä¸­çš„å¯æ‰§è¡Œ<code>mkdir(.)</code>å°±å˜æˆäº†åœ¨<code>tests/.</code>æ‰€ä»¥è¿™è¾¹åº”è¯¥æŒ‡å®šç»å¯¹è·¯å¾„, ä¸‹é¢æ˜¯ä¸€ä¸ªé€šè¿‡<code>__file__</code>è·å¾—è„šæœ¬ç»å¯¹è·¯å¾„ï¼Œç„¶åå†è·å¾—å…¶æ‰€åœ¨æ–‡ä»¶å¤¹çš„åšæ³•ï¼š</p><p><code>DOWNLOAD_PATH = os.path.join(os.path.dirname(os.path.abspath(__file__)), &quot;attaches&quot;)</code></p><p>DOWNLOAD_PATHçš„å€¼è¢«èµ‹å€¼æˆäº†<code>F:\aDevelopment\Python\ShowYourCode\jikipedia</code>ä»è€Œè§£å†³äº†è¿™ä¸ªé—®é¢˜</p><h3 id="redisä½¿ç”¨"><a class="markdownIt-Anchor" href="#redisä½¿ç”¨"></a> redisä½¿ç”¨</h3><blockquote><p>ç‰¹ç‚¹ï¼š</p><p>1.åŸºäºå†…å­˜çš„key-valueæ•°æ®åº“<br>2.åŸºäºcè¯­è¨€ç¼–å†™çš„ï¼Œå¯ä»¥æ”¯æŒå¤šç§è¯­è¨€çš„api //setæ¯ç§’11ä¸‡æ¬¡ï¼Œå–get 81000æ¬¡<br>3.æ”¯æŒæ•°æ®æŒä¹…åŒ–<br>4.valueå¯ä»¥æ˜¯stringï¼Œhashï¼Œ listï¼Œ set, sorted set</p></blockquote><h4 id="è¿æ¥redisæœåŠ¡å™¨"><a class="markdownIt-Anchor" href="#è¿æ¥redisæœåŠ¡å™¨"></a> <strong>è¿æ¥redisæœåŠ¡å™¨</strong></h4><ul><li>æœ¬åœ°å‘½ä»¤è¡Œè¿›å…¥redisï¼š <code>redis-cli</code></li><li>è¿œç¨‹è¿æ¥ï¼š<code>redis-cli -h host -p port -a password</code></li></ul><h4 id="å‘½ä»¤å‚æ•°"><a class="markdownIt-Anchor" href="#å‘½ä»¤å‚æ•°"></a> å‘½ä»¤å‚æ•°ï¼š</h4><p>key</p><ul><li>keys * è·å–æ‰€æœ‰çš„key</li><li>select 0 é€‰æ‹©ç¬¬ä¸€ä¸ªåº“</li><li>move myString 1 å°†å½“å‰çš„æ•°æ®åº“keyç§»åŠ¨åˆ°æŸä¸ªæ•°æ®åº“,ç›®æ ‡åº“æœ‰ï¼Œåˆ™ä¸èƒ½ç§»åŠ¨</li><li>flush db      æ¸…é™¤æŒ‡å®šåº“</li><li>randomkey     éšæœºkey</li><li>type key      ç±»å‹</li><li>set key1 value1 è®¾ç½®key</li><li>get key1    è·å–key</li><li>mset key1 value1 key2 value2 key3 value3</li><li>mget key1 key2 key3</li><li>del key1   åˆ é™¤key</li><li>exists key      åˆ¤æ–­æ˜¯å¦å­˜åœ¨key</li><li>expire key 10   10è¿‡æœŸ</li><li>pexpire key 1000 æ¯«ç§’</li><li>persist key     åˆ é™¤è¿‡æœŸæ—¶é—´</li></ul><p>string</p><ul><li>set name cxx</li><li>get name</li><li>getrange name 0 -1        å­—ç¬¦ä¸²åˆ†æ®µ</li><li>getset name new_cxx       è®¾ç½®å€¼ï¼Œè¿”å›æ—§å€¼</li><li>mset key1 key2            æ‰¹é‡è®¾ç½®</li><li>mget key1 key2            æ‰¹é‡è·å–</li><li>setnx key value           ä¸å­˜åœ¨å°±æ’å…¥ï¼ˆnot existsï¼‰</li><li>setex key time value      è¿‡æœŸæ—¶é—´ï¼ˆexpireï¼‰</li><li>setrange key index value  ä»indexå¼€å§‹æ›¿æ¢value</li><li>incr age        é€’å¢</li><li>incrby age 10   é€’å¢</li><li>decr age        é€’å‡</li><li>decrby age 10   é€’å‡</li><li>incrbyfloat     å¢å‡æµ®ç‚¹æ•°</li><li>append          è¿½åŠ </li><li>strlen          é•¿åº¦</li><li>getbit/setbit/bitcount/bitop    ä½æ“ä½œ</li></ul><p>hash</p><ul><li>hset myhash name cxx</li><li>hget myhash name</li><li>hmset myhash name cxx age 25 note â€œi am notesâ€</li><li>hmget myhash name age note</li><li>hgetall myhash               è·å–æ‰€æœ‰çš„</li><li>hexists myhash name          æ˜¯å¦å­˜åœ¨</li><li>hsetnx myhash score 100      è®¾ç½®ä¸å­˜åœ¨çš„</li><li>hincrby myhash id 1          é€’å¢</li><li>hdel myhash name             åˆ é™¤</li><li>hkeys myhash                 åªå–key</li><li>hvals myhash                 åªå–value</li><li>hlen myhash                  é•¿åº¦</li></ul><p>list</p><ul><li>lpush mylist a b c  å·¦æ’å…¥</li><li>rpush mylist x y z  å³æ’å…¥</li><li>lrange mylist 0 -1  æ•°æ®é›†åˆ</li><li>lpop mylist  å¼¹å‡ºå…ƒç´ </li><li>rpop mylist  å¼¹å‡ºå…ƒç´ </li><li>llen mylist  é•¿åº¦</li><li>lrem mylist count value  åˆ é™¤</li><li>lindex mylist 2          æŒ‡å®šç´¢å¼•çš„å€¼</li><li>lset mylist 2 n          ç´¢å¼•è®¾å€¼</li><li>ltrim mylist 0 4         åˆ é™¤key</li><li>linsert mylist before a  æ’å…¥</li><li>linsert mylist after a   æ’å…¥</li><li>rpoplpush list list2     è½¬ç§»åˆ—è¡¨çš„æ•°æ®</li></ul><p>set</p><ul><li>sadd myset redis</li><li>smembers myset       æ•°æ®é›†åˆ</li><li>srem myset set1         åˆ é™¤</li><li>sismember myset set1 åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­</li><li>scard key_name       ä¸ªæ•°</li><li>sdiff | sinter | sunion æ“ä½œï¼šé›†åˆé—´è¿ç®—ï¼šå·®é›† | äº¤é›† | å¹¶é›†</li><li>srandmember          éšæœºè·å–é›†åˆä¸­çš„å…ƒç´ </li><li>spop                 ä»é›†åˆä¸­å¼¹å‡ºä¸€ä¸ªå…ƒç´ </li><li></li></ul><p>zset</p><ul><li>zadd zset 1 one</li><li>zadd zset 2 two</li><li>zadd zset 3 three</li><li>zincrby zset 1 one              å¢é•¿åˆ†æ•°</li><li>zscore zset two                 è·å–åˆ†æ•°</li><li>zrange zset 0 -1 withscores     èŒƒå›´å€¼</li><li>zrangebyscore zset 10 25 withscores æŒ‡å®šèŒƒå›´çš„å€¼</li><li>zrangebyscore zset 10 25 withscores limit 1 2 åˆ†é¡µ</li><li>Zrevrangebyscore zset 10 25 withscores  æŒ‡å®šèŒƒå›´çš„å€¼</li><li>zcard zset  å…ƒç´ æ•°é‡</li><li>Zcount zset è·å¾—æŒ‡å®šåˆ†æ•°èŒƒå›´å†…çš„å…ƒç´ ä¸ªæ•°</li><li>Zrem zset one two        åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </li><li>Zremrangebyrank zset 0 1  æŒ‰ç…§æ’åèŒƒå›´åˆ é™¤å…ƒç´ </li><li>Zremrangebyscore zset 0 1 æŒ‰ç…§åˆ†æ•°èŒƒå›´åˆ é™¤å…ƒç´ </li><li>Zrank zset 0 -1    åˆ†æ•°æœ€å°çš„å…ƒç´ æ’åä¸º0</li><li>Zrevrank zset 0 -1  åˆ†æ•°æœ€å¤§çš„å…ƒç´ æ’åä¸º0</li><li>Zinterstore</li><li>zunionstore rank:last_week 7 rank:20150323 rank:20150324 rank:20150325  weights 1 1 1 1 1 1 1</li></ul><p>æ’åºï¼š</p><ul><li>sort mylist  æ’åº</li><li>sort mylist alpha desc limit 0 2 å­—æ¯æ’åº</li><li>sort list by it:* desc           byå‘½ä»¤</li><li>sort list by it:* desc get it:*  getå‚æ•°</li><li>sort list by it:* desc get it:* store sorc:result  sortå‘½ä»¤ä¹‹storeå‚æ•°ï¼šè¡¨ç¤ºæŠŠsortæŸ¥è¯¢çš„ç»“æœé›†ä¿å­˜èµ·æ¥</li></ul><p>è®¢é˜…ä¸å‘å¸ƒï¼š</p><ul><li>è®¢é˜…é¢‘é“ï¼šsubscribe chat1</li><li>å‘å¸ƒæ¶ˆæ¯ï¼špublish chat1 â€œhell0 ni haoâ€</li><li>æŸ¥çœ‹é¢‘é“ï¼špubsub channels</li><li>æŸ¥çœ‹æŸä¸ªé¢‘é“çš„è®¢é˜…è€…æ•°é‡: pubsub numsub chat1</li><li>é€€è®¢æŒ‡å®šé¢‘é“ï¼š unsubscrible chat1   , punsubscribe java.*</li><li>è®¢é˜…ä¸€ç»„é¢‘é“ï¼š psubscribe java.*</li><li></li></ul><p>redisäº‹ç‰©ï¼š</p><ul><li>éš”ç¦»æ€§ï¼ŒåŸå­æ€§ï¼Œ</li><li>æ­¥éª¤ï¼š  å¼€å§‹äº‹åŠ¡ï¼Œæ‰§è¡Œå‘½ä»¤ï¼Œæäº¤äº‹åŠ¡</li><li><pre><code>     multi  //å¼€å¯äº‹åŠ¡</code></pre></li><li><pre><code>     sadd myset a b c</code></pre></li><li><pre><code>     sadd myset e f g</code></pre></li><li><pre><code>     lpush mylist aa bb cc</code></pre></li><li><pre><code>     lpush mylist dd ff gg</code></pre></li></ul><p>æœåŠ¡å™¨ç®¡ç†</p><ul><li>dump.rdb</li><li>appendonly.aof</li><li>//BgRewriteAof å¼‚æ­¥æ‰§è¡Œä¸€ä¸ªaop(appendOnly file)æ–‡ä»¶é‡å†™, ä¼šåˆ›å»ºå½“å‰ä¸€ä¸ªAOFæ–‡ä»¶ä½“ç§¯çš„ä¼˜åŒ–ç‰ˆæœ¬</li><li>//BgSave åå°å¼‚æ­¥ä¿å­˜æ•°æ®åˆ°ç£ç›˜ï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶dump.rdb</li><li>//saveåŒæ­¥ä¿å­˜æ•°æ®åˆ°ç£ç›˜ï¼Œä¼šé˜»å¡ä¸»è¿›ç¨‹ï¼Œåˆ«çš„å®¢æˆ·ç«¯æ— æ³•è¿æ¥</li><li>//client kill å…³é—­å®¢æˆ·ç«¯è¿æ¥</li><li>//client list åˆ—å‡ºæ‰€æœ‰çš„å®¢æˆ·ç«¯</li><li>client setname myclient1 //ç»™å®¢æˆ·ç«¯è®¾ç½®ä¸€ä¸ªåç§°</li><li>client getname</li><li>config get port</li><li>//configRewrite å¯¹redisçš„é…ç½®æ–‡ä»¶è¿›è¡Œæ”¹å†™</li></ul><p>rdb</p><ul><li>save 900 1</li><li>save 300 10</li><li>save 60 10000</li></ul><p>aopå¤‡ä»½å¤„ç†</p><ul><li>appendonly yes å¼€å¯æŒä¹…åŒ–</li><li>appendfsync everysec æ¯ç§’å¤‡ä»½ä¸€æ¬¡</li></ul><p>å‘½ä»¤ï¼š</p><ul><li>bgsaveå¼‚æ­¥ä¿å­˜æ•°æ®åˆ°ç£ç›˜ï¼ˆå¿«ç…§ä¿å­˜ï¼‰</li><li>lastsaveè¿”å›ä¸Šæ¬¡æˆåŠŸä¿å­˜åˆ°ç£ç›˜çš„unixçš„æ—¶é—´æˆ³</li><li>shutdownåŒæ­¥ä¿å­˜åˆ°æœåŠ¡å™¨å¹¶å…³é—­redisæœåŠ¡å™¨</li><li>bgrewriteaofæ–‡ä»¶å‹ç¼©å¤„ç†ï¼ˆå‘½ä»¤ï¼‰</li></ul><h4 id="ä½¿ç”¨åœºæ™¯"><a class="markdownIt-Anchor" href="#ä½¿ç”¨åœºæ™¯"></a> ä½¿ç”¨åœºæ™¯</h4><ol><li>å»æœ€æ–°nä¸ªæ•°æ®çš„æ“ä½œ</li><li>æ’è¡Œæ¦œï¼Œå–top nä¸ªæ•°æ® //æœ€ä½³äººæ°”å‰10æ¡</li><li>ç²¾ç¡®çš„è®¾ç½®è¿‡æœŸæ—¶é—´</li><li>è®¡æ•°å™¨</li><li>å®æ—¶ç³»ç»Ÿï¼Œ ååƒåœ¾ç³»ç»Ÿ</li><li>pubï¼Œ subå‘å¸ƒè®¢é˜…æ„å»ºå®æ—¶æ¶ˆæ¯ç³»ç»Ÿ</li><li>æ„å»ºæ¶ˆæ¯é˜Ÿåˆ—</li><li>ç¼“å­˜</li></ol><p>Redisåœ¨äº’è”ç½‘å…¬å¸ä¸€èˆ¬æœ‰ä»¥ä¸‹åº”ç”¨ï¼š</p><ul><li>Stringï¼šç¼“å­˜ã€é™æµã€è®¡æ•°å™¨ã€åˆ†å¸ƒå¼é”ã€åˆ†å¸ƒå¼Session</li><li>Hashï¼šå­˜å‚¨ç”¨æˆ·ä¿¡æ¯ã€ç”¨æˆ·ä¸»é¡µè®¿é—®é‡ã€ç»„åˆæŸ¥è¯¢</li><li>Listï¼šå¾®åšå…³æ³¨äººæ—¶é—´è½´åˆ—è¡¨ã€ç®€å•é˜Ÿåˆ—</li><li>Setï¼šèµã€è¸©ã€æ ‡ç­¾ã€å¥½å‹å…³ç³»</li><li>Zsetï¼šæ’è¡Œæ¦œ</li></ul><h2 id="mysqlä¸­æ—¶é—´ç±»å‹è®¾ç½®"><a class="markdownIt-Anchor" href="#mysqlä¸­æ—¶é—´ç±»å‹è®¾ç½®"></a> MYSQLä¸­æ—¶é—´ç±»å‹è®¾ç½®</h2><ul><li>create_timeï¼šè®¾ç½®æ•°æ®ç±»å‹ä¸ºï¼šTIMESTAMPï¼Œé»˜è®¤å€¼ä¸ºï¼š<code>CURRENT_TIMESTAMP()</code></li><li>modify_timeï¼šè®¾ç½®æ•°æ®ç±»å‹ä¸ºï¼šTIMESTAMPï¼Œé»˜è®¤å€¼ä¸ºï¼š<code>CURRENT_TIMESTAMP() ON UPDATE CURRENT_TIMESTAMP()</code></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`base_name`</span>.<span class="string">`table_name`</span> (</span><br><span class="line">  <span class="string">`create_time`</span> <span class="keyword">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>(),</span><br><span class="line">  <span class="string">`modify_time`</span> <span class="keyword">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>() <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span>());</span><br></pre></td></tr></table></figure><p>é™¤äº†TIMESTAMPä»¥å¤–ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸ºDATETIME(0)ï¼Œå¯¹äºåœ¨SQLAlchemyä¸­ä¸ºTIMESTAMPå’ŒDateTimeç±»å‹</p><h2 id="ipä»£ç†æ± "><a class="markdownIt-Anchor" href="#ipä»£ç†æ± "></a> IPä»£ç†æ± </h2><p>çˆ¬è™«å’Œåçˆ¬è™«æ˜¯ä¸€å¯¹çŸ›å’Œç›¾ï¼Œåçˆ¬è™«å¾ˆå¸¸è§çš„ä¸€ä¸ªæ–¹æ³•å°±æ˜¯å°IPï¼Œä¸€ä¸ªIPçŸ­æ—¶é—´å†…é¢‘ç¹è®¿é—®ï¼Œå¯ä»¥åšé™æµæˆ–è€…æ˜¯åŠ å…¥é»‘åå•ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨IPä»£ç†æ± +éšæœºUAçš„æ–¹å¼æ¥è§„é¿ã€‚</p><p>æ­¤å¤–çˆ¬è™«æ˜¯ä¸€ç§IOå¯†é›†å‹ç¨‹åºï¼Œå¦‚æœå…¨ç¨‹å•çº¿ç¨‹æ‰§è¡Œé‚£ä¼šå¾ˆæ…¢ï¼Œå› æ­¤å¯ä»¥ç”¨å¤šçº¿ç¨‹æ¥æé«˜æ•°æ®é‡‡é›†æ•ˆç‡ï¼Œä¸è¿‡è‡ªå·±ç®¡ç†å¤šçº¿ç¨‹å¤ªéº»çƒ¦ï¼Œæ‰€ä»¥å¯ä»¥é€‰æ‹©çº¿ç¨‹æ± ã€‚</p><h3 id="ä»£ç†æ± "><a class="markdownIt-Anchor" href="#ä»£ç†æ± "></a> ä»£ç†æ± </h3><p>ä¸€ä¸ªå®Œå–„çš„ä»£ç†æ± ï¼Œåº”è¯¥å¯ä»¥å®ç°ä»¥ä¸‹åŠŸèƒ½</p><ul><li>æ‰¹é‡<strong>é‡‡é›†</strong>ä»£ç†ï¼ˆæˆ–è€…é€šè¿‡æ¥å£å¯¼å…¥æˆ‘ä»¬è´­ä¹°çš„ä»£ç†ï¼Œä¸è¿‡å¶å°”ç”¨ä¸€ç”¨è¿˜æ˜¯å…è´¹çš„å°±å¥½ï¼‰</li><li>é‡‡é›†åˆ°ä¹‹åè‡ªåŠ¨<strong>éªŒè¯</strong>ä»£ç†æœ‰æ•ˆæ€§</li><li>å°†æœ‰æ•ˆä»£ç†<strong>å­˜å‚¨</strong>èµ·æ¥</li><li>æä¾›<u>è·å–</u>éšæœºä»£ç†çš„<strong>æ¥å£</strong>ã€æä¾›<u>ç®¡ç†</u>ï¼ˆåˆ é™¤ã€å¢åŠ ï¼‰ä»£ç†çš„<strong>æ¥å£</strong></li></ul><h3 id="ä½¿ç”¨ä»£ç†æ± "><a class="markdownIt-Anchor" href="#ä½¿ç”¨ä»£ç†æ± "></a> ä½¿ç”¨ä»£ç†æ± </h3><p>ä¹‹å‰åœ¨å°±çœ‹åˆ°è¿‡<a href="https://cn.bing.com/search?q=%E7%88%AC%E8%99%AB+%E5%B4%94%E5%BA%86%E6%89%8D&amp;FORM=QSRE1" target="_blank" rel="noopener">å´”åº†æ‰</a>ä¹¦ä¸­ä»‹ç»çš„å¼€æºä»£ç†æ± ï¼Œä½†æ²¡ä»”ç»†ç ”ç©¶ï¼Œæœ¬æ¬¡æœç´¢è¿‡ååˆå‘ç°äº†ä¸€ä¸ªåœ¨GitHubä¸Šæœ‰14k+ Starsçš„ä»£ç†æ± æ¥ç”¨ï¼Œåå­—å«<a href="https://github.com/jhao104/proxy_pool" target="_blank" rel="noopener"><code>ProxyPool</code></a>ã€‚</p><p>å®˜æ–¹æ–‡æ¡£æä¾›äº†ä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼ŒåŒ…æ‹¬ä¸‹è½½ä»£ç è¿è¡Œå’Œdockerï¼Œæ—¢ç„¶æœ‰dockeré‚£è‚¯å®šé€‰æœ€æ–¹ä¾¿çš„dockerå•¦ï¼</p><p>ä¸è¿‡å®˜æ–¹çš„dockerå‘½ä»¤è¿˜ä¸å¤Ÿæ–¹ä¾¿ï¼Œå› ä¸ºè¿™ä¸ªä»£ç†æ± è¿˜éœ€è¦ä¾èµ–RedisæœåŠ¡ï¼Œå› æ­¤å¯ä»¥ç”¨docker-composeé…ç½®æ¥ç”¨ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3"</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  redis:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">    expose:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">6379</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  web:</span></span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">jhao104/proxy_pool</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">DB_CONN=redis://redis:6379/0</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"5010:5010"</span></span><br><span class="line"><span class="attr">    depends_on:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">redis</span></span><br></pre></td></tr></table></figure><p>æ¥å£ä¿¡æ¯ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"url"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"desc"</span>: <span class="string">"get a proxy"</span>,</span><br><span class="line">      <span class="attr">"params"</span>: <span class="string">"type: ''https'|''"</span>,</span><br><span class="line">      <span class="attr">"url"</span>: <span class="string">"/get"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"desc"</span>: <span class="string">"get and delete a proxy"</span>,</span><br><span class="line">      <span class="attr">"params"</span>: <span class="string">""</span>,</span><br><span class="line">      <span class="attr">"url"</span>: <span class="string">"/pop"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"desc"</span>: <span class="string">"delete an unable proxy"</span>,</span><br><span class="line">      <span class="attr">"params"</span>: <span class="string">"proxy: 'e.g. 127.0.0.1:8080'"</span>,</span><br><span class="line">      <span class="attr">"url"</span>: <span class="string">"/delete"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"desc"</span>: <span class="string">"get all proxy from proxy pool"</span>,</span><br><span class="line">      <span class="attr">"params"</span>: <span class="string">"type: ''https'|''"</span>,</span><br><span class="line">      <span class="attr">"url"</span>: <span class="string">"/all"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"desc"</span>: <span class="string">"return proxy count"</span>,</span><br><span class="line">      <span class="attr">"params"</span>: <span class="string">""</span>,</span><br><span class="line">      <span class="attr">"url"</span>: <span class="string">"/count"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è·å–éšæœºä»£ç†"><a class="markdownIt-Anchor" href="#è·å–éšæœºä»£ç†"></a> è·å–éšæœºä»£ç†</h4><p>å°è£…è·å–éšæœºä»£ç†å’Œåˆ é™¤ä»£ç†çš„æ“ä½œåå°±å¯ä»¥ä½¿ç”¨äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment"># IPæ¢æˆè‡ªå·±æœåŠ¡å™¨çš„IP</span></span><br><span class="line">PROXY_POOL_URL = <span class="string">'http://127.0.0.1:5010'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_proxy</span><span class="params">()</span>:</span></span><br><span class="line">    proxy = requests.get(<span class="string">f"<span class="subst">&#123;PROXY_POOL_URL&#125;</span>/get/"</span>).json().get(<span class="string">"proxy"</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">'http'</span>: proxy, <span class="string">'https'</span>: proxy&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete_proxy</span><span class="params">(proxy)</span>:</span></span><br><span class="line">    requests.get(<span class="string">f"<span class="subst">&#123;PROXY_POOL_URL&#125;</span>/delete/?proxy=<span class="subst">&#123;proxy&#125;</span>"</span>)</span><br></pre></td></tr></table></figure><p>fromï¼š <a href="https://www.cnblogs.com/deali/p/15890678.html" target="_blank" rel="noopener">https://www.cnblogs.com/deali/p/15890678.html</a></p><h2 id="æ·»åŠ ä»£ç†è£…é¥°å™¨"><a class="markdownIt-Anchor" href="#æ·»åŠ ä»£ç†è£…é¥°å™¨"></a> æ·»åŠ ä»£ç†è£…é¥°å™¨</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @author: Mrli</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reqCheck</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    ç›®å‰åªæ”¯æŒhttpä»£ç†ï¼Œhttpså¤§å¤šæ— æ•ˆ</span></span><br><span class="line"><span class="string">    :param func:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"><span class="meta">    @wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        rand_proxy = get_proxy()</span><br><span class="line">        <span class="comment"># ç»™è¯·æ±‚åŠ ä¸Šproxyå‚æ•°</span></span><br><span class="line">        kwargs[<span class="string">"proxy"</span>] = rand_proxy</span><br><span class="line">        tryTimes = <span class="number">0</span></span><br><span class="line">        resp = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">while</span> tryTimes &lt; MAX_RETRY_COUNT:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                resp = func(*args, **kwargs)</span><br><span class="line">                print(resp.status_code)</span><br><span class="line">                <span class="keyword">if</span> <span class="number">100</span> &lt; resp.status_code &lt; <span class="number">400</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> RequestException <span class="keyword">as</span> e:</span><br><span class="line">                tryTimes += <span class="number">1</span></span><br><span class="line">                LOG.warn(<span class="string">"&#123;&#125;è¯·æ±‚å¤±è´¥: e~&#123;&#125;"</span>.format(rand_proxy, e))</span><br><span class="line">                rand_proxy = get_proxy()</span><br><span class="line">                delete_proxy(rand_proxy)</span><br><span class="line">        <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;2022å¹´3æœˆ20æ—¥å…¬å‘Šå­˜ç½‘ç«™é¡µé¢åˆ°æ•°æ®åº“&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#2022å¹´3æœˆ20æ—¥å…¬å‘Šå­˜ç½‘ç«™é¡µé¢åˆ°æ•°æ®åº“&quot;&gt;&lt;/a&gt; 2022å¹´3æœˆ20æ—¥â€”â€”å…¬å‘Šå­˜ç½‘ç«™é¡µé¢åˆ°æ•°æ®åº“&lt;/h1&gt;
&lt;h2 id=&quot;æ–‡ä»¶å­˜å‚¨&quot;&gt;&lt;a
      
    
    </summary>
    
    
      <category term="çˆ¬è™«" scheme="https://nymrli.top/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>æ·±å…¥å­¦ä¹ ä½¿ç”¨Spring</title>
    <link href="https://nymrli.top/2022/02/27/%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0%E4%BD%BF%E7%94%A8Spring/"/>
    <id>https://nymrli.top/2022/02/27/æ·±å…¥å­¦ä¹ ä½¿ç”¨Spring/</id>
    <published>2022-02-27T05:52:08.000Z</published>
    <updated>2022-02-27T05:54:23.566Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>From : <a href="https://www.bilibili.com/video/BV1fr4y1Y7UH?p=6" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1fr4y1Y7UH?p=6</a></p></blockquote><h2 id="åˆ›å»ºbeançš„æ–¹å¼"><a class="markdownIt-Anchor" href="#åˆ›å»ºbeançš„æ–¹å¼"></a> åˆ›å»ºbeançš„æ–¹å¼ï¼š</h2><h3 id="å£°æ˜å¼"><a class="markdownIt-Anchor" href="#å£°æ˜å¼"></a> å£°æ˜å¼</h3><h4 id="beanbean"><a class="markdownIt-Anchor" href="#beanbean"></a> <code>&lt;bean&gt;&lt;/bean&gt;</code></h4><ul><li><p><code>&lt;bean&gt;&lt;/bean&gt;</code>ï¼š é€šè¿‡xmlæ¥é…ç½®bean</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/tx/spring-tx-3.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context/spring-context-3.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"p1"</span> <span class="attr">class</span>=<span class="string">"top.nymrli.tryboot.po.User"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"å¼ ä¸‰"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"18"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testPerson()</span><br><span class="line">    &#123;</span><br><span class="line"> ApplicationContext ctx = new ClassPathXmlApplicationContext("applicationContext.xml");</span><br><span class="line"></span><br><span class="line">        User user = annotationConfigApplicationContext.getBean("p1", User.class);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="bean"><a class="markdownIt-Anchor" href="#bean"></a> <code>@Bean</code></h4><ul><li><p><code>@Bean</code>: é€šè¿‡æ³¨è§£æ¥æ ‡æ³¨SpringBeanå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Config</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"user"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">"name"</span>, <span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPerson</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        AnnotationConfigApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext();</span><br><span class="line">        ctx.register(Config.class);</span><br><span class="line">        <span class="comment">// æˆ–è€… AnnotationConfigApplicationContext annotationConfigApplicationContext = new AnnotationConfigApplicationContext(Config.class);</span></span><br><span class="line"></span><br><span class="line">        ctx.refresh();</span><br><span class="line"></span><br><span class="line">        User user = ctx.getBean(<span class="string">"user"</span>, User.class);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><code>AnnotationConfigApplicationContext annotationConfigApplicationContext = new AnnotationConfigApplicationContext(Config.class);</code>ä¸<code>ApplicationContext ctx = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);</code>ä¸€æ ·ï¼Œéƒ½æ˜¯æŒ‡å®šbeançš„é…ç½®è·¯å¾„åè§£æï¼Œè·å¾—beançš„é…ç½®ã€‚</p></li></ul><h4 id="component"><a class="markdownIt-Anchor" href="#component"></a> <code>@Component</code></h4><ul><li><p><code>@Component</code>: é€šè¿‡æ ‡æ³¨æ¥åˆ›å»ºä¸€ä¸ªç»„ä»¶SpringBeanå¯¹è±¡ï¼Œå¦‚ä¸‹çš„Userã€‚ ==&gt; ç­‰ä»·äº<code>ctx.registerBean(User.class)</code>ï¼ŒregisterBeanæ–¹æ³•çš„å®ç°æœ€ç»ˆä¹Ÿæ˜¯è°ƒç”¨äº†registerBeanDefinition</p><p>è€ŒConfigä¸æ˜¯ä¸€ä¸ªbeanï¼Œä»–çš„ä½œç”¨è·ŸapplicationContext.xmlä¸€æ ·ï¼Œä»–æ˜¯å­˜æ”¾beanå®šä¹‰è·¯å¾„çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œåœ¨è¿™é‡Œæ˜¯é€šè¿‡ComponentScanè®©Springèƒ½å¤Ÿæ‰¾åˆ°top.nymrli.tryboot.poä¸‹çš„æ‰€æœ‰Beanå¹¶è§£ææˆSpringBean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"top.nymrli.tryboot.po"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Config</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Component</span><span class="comment">// ==&gt; beanNameä¸ºuser, ç±»åå°å†™</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPerson</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    AnnotationConfigApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(Config.class);</span><br><span class="line"></span><br><span class="line">    User user = ctx.getBean(User.class);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼šè‡ªåŠ¨è°ƒç”¨Userçš„æ— å‚æ„é€ æ–¹å¼æ¥åˆ›å»ºJavaBeanï¼Œ å› æ­¤å¾—åˆ°çš„Useræ˜¯<code>User(name=null, age=0)</code></p></li></ul><p>â–².ä¸Šè¿°ä¸‰ç§åˆ›å»ºæ–¹å¼æœ¬è´¨ä¸Šéƒ½æ˜¯åˆ›å»ºäº†BeanDefinitionï¼Œåªä¸è¿‡Springè¿›è¡Œäº†å°è£…ï¼Œå› æ­¤ä½¿ç”¨èµ·æ¥æ¯”è¾ƒç®€å•ç›´è§‚</p><h4 id="import"><a class="markdownIt-Anchor" href="#import"></a> @Import</h4><blockquote><p>spring4.2ä¹‹å<code>@Import</code>æ³¨è§£å¯ä»¥å®ä¾‹åŒ–æ™®é€šç±»çš„beanå®ä¾‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Import</span>(Role.class)<span class="comment">// @Import(&#123;Role.class, User.class&#125;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/"</span>)</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Role role;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/test"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(role);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"test"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Springåœ¨åˆ›å»ºMyConfigçš„æ—¶å€™ï¼Œä¼šæ ¹æ®@Importå°†Roleä¹Ÿå®ä¾‹åŒ–æˆä¸€ä¸ªBean</p><h3 id="ç¼–ç¨‹å¼"><a class="markdownIt-Anchor" href="#ç¼–ç¨‹å¼"></a> ç¼–ç¨‹å¼</h3><h4 id="beandefinition"><a class="markdownIt-Anchor" href="#beandefinition"></a> BeanDefinition</h4><blockquote><p>é€šè¿‡åˆ›å»ºå¹¶é…ç½® BeanDefinition æ¥åˆ›å»ºä¸€ä¸ªBean</p><p>Q: ä»€ä¹ˆæ˜¯BeanDefinition?</p><p>A: BeanDefinitionè¡¨ç¤ºBeançš„å®šä¹‰ä¿¡æ¯ï¼Œ Springä¼šæ ¹æ®BeanDefinitionæ¥åˆ›å»ºBeanå¯¹è±¡ã€‚BeanDefinitionæœ‰å¾ˆå¤šçš„å±æ€§ç”¨æ¥æè¿°Beanï¼Œ BeanDefinitionæ˜¯Springä¸­éå¸¸æ ¸å¿ƒçš„æ¦‚å¿µã€‚</p><ul><li>beanClass: è¡¨ç¤ºBeanå¯¹è±¡çš„ç±»ç±»å‹ï¼Œ Springåœ¨åˆ›å»ºBeançš„è¿‡ç¨‹ä¸­æ ¹æ®æ­¤å±æ€§æ¥åˆ¤æ–­å®ä¾‹åŒ–å¯¹è±¡å…·ä½“çš„ç±»ç±»å‹</li><li>scopeï¼šä½œç”¨åŸŸï¼Œ[singletonã€prototype]ï¼Œå•ä¾‹æˆ–è€…åŸå‹bean</li><li>isLazyï¼šæ˜¯å¦éœ€è¦æ‡’åŠ è½½ï¼ŒåŸå‹Beançš„æ‡’åŠ è½½ä¸å¥æ•ˆã€‚æ‡’åŠ è½½çš„å•ä¾‹beanï¼Œä¼šåœ¨ç¬¬ä¸€æ¬¡getBeançš„æ—¶å€™ç”Ÿæˆè¯¥beanï¼Œéæ‡’åŠ è½½çš„å•ä¾‹beanï¼Œåˆ™ä¼šåœ¨Spring.å¯åŠ¨è¿‡ç¨‹ä¸­ç›´æ¥ç”Ÿæˆå¥½ã€‚</li><li>dependsOnï¼šè¡¨ç¤ºä¸€ä¸ªbeanåœ¨åˆ›å»ºä¹‹å‰æ‰€ä¾é¢—çš„å…¶ä»–beanï¼Œåœ¨ä¸€ä¸ªbeanåˆ›å»ºä¹‹å‰ï¼Œå®ƒæ‰€ä¾èµ–çš„è¿™äº›beanå¾—å…ˆå…¨éƒ¨åˆ›å»ºå¥½ã€‚</li><li>primaryï¼šè¡¨ç¤ºä¸€ä¸ªbeanæ˜¯ä¸»beanï¼Œåœ¨Springä¸­ä¸€ä¸ªç±»å‹å¯ä»¥æœ‰å¤šä¸ªbeanå¯¹è±¡ï¼Œåœ¨è¿›è¡Œä¾èµ–æ³¨å…¥æ—¶ï¼Œå¦‚æœæ ¹æ®ç±»å‹æ‰¾åˆ°äº†å¤šä¸ªbÂ©anï¼Œæ­¤æ—¶ä¼šåˆ¤æ–­è¿™äº›beanä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªä¸»beanï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ç›´æ¥å°†è¿™ä¸ªbeanæ³¨å…¥ç»™å±æ€§ã€‚</li><li>initMethodNameï¼š è¡¨ç¤ºä¸€ä¸ªbeançš„åˆå§‹åŒ–æ–¹æ³•ï¼Œä¸€ä¸ªbeançš„ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹ä¸­æœ‰ä¸€ä¸ªæ­¥éª¤å«åˆå§‹åŒ–ï¼ŒSpringä¼šåœ¨è¿™ä¸ªæ­¥éª¤ä¸­å»è°ƒç”¨beançš„åˆå§‹åŒ–æ–¹æ³•ã€‚åˆå§‹åŒ–é€»è¾‘ç”±ç¨‹åºå‘˜è‡ªå·±æ§åˆ¶ï¼Œä½¿å¾—ç¨‹åºå‘˜å¯ä»¥è‡ªå®šä¹‰é€»è¾‘å¯¹beanè¿›è¡ŒåŠ å·¥ã€‚</li></ul><p>é€šè¿‡<code>&lt;bean&gt;&lt;/bean&gt;</code>ã€<code>@Bean</code>ã€<code>@Component</code>æ ‡æ³¨çš„ç±»éƒ½ä¼šè§£æä¸ºBeanDefinitionï¼Œä¾›Springåˆ›å»ºï¼ˆå®ä¾‹åŒ–ï¼‰å…·ä½“çš„Beanã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPerson</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    AnnotationConfigApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(Config.class);</span><br><span class="line">    AbstractBeanDefinition bd = BeanDefinitionBuilder.genericBeanDefinition().getBeanDefinition();</span><br><span class="line">    bd.setBeanClass(User.class);</span><br><span class="line">    <span class="comment">// å°†BeanDefinitionæ³¨å†Œåˆ°ä¸Šä¸‹æ–‡ä¸­</span></span><br><span class="line">    ctx.registerBeanDefinition(<span class="string">"user"</span>, bd);</span><br><span class="line">    <span class="comment">// è·å¾—Beanå¯¹è±¡</span></span><br><span class="line">    User user = (User)ctx.getBean(<span class="string">"user"</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="factorybean"><a class="markdownIt-Anchor" href="#factorybean"></a> FactoryBean</h4><blockquote><p>FactoryBeanæ˜¯Spring.æ‰€æä¾›çš„ä¸€ç§è¾ƒçµæ´»çš„åˆ›å»ºBeançš„æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡å®ç°FactoryBeanï¼šæ¥å£ä¸­çš„getObject()æ–¹æ³•æ¥è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯æœ€ç»ˆçš„Beanå¯¹è±¡ã€‚</p></blockquote><p>FactoryBeanæ¥å£ä¸­çš„æ–¹æ³•</p><ul><li>Object getObject()ï¼šè¿”å›çš„æ˜¯Beanå¯¹è±¡</li><li>boolean isSingleton()ï¼šè¿”å›çš„æ˜¯å¦æ˜¯å•ä¾‹Beanå¯¹è±¡</li><li>Class getObjectType()ï¼šè¿”å›çš„æ˜¯Beanå¯¹è±¡çš„ç±»å‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(<span class="string">"zhouyu"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZhouyuFactoryBean</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getObject</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">"cl"</span>, <span class="number">18</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> User.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ï¼Œå®é™…ä¸Šå¯¹åº”äº†ä¸¤ä¸ªBeanå¯¹è±¡ï¼š<br>1ã€beanNameä¸º&quot;zhouyuâ€™ï¼Œbeanå¯¹è±¡ä¸ºgetObjectæ–¹æ³•æ‰€è¿”å›çš„Userå¯¹è±¡ã€‚=&gt;<code>applicationcontext.getBean(nameï¼š&quot;zhouyu&quot;ï¼ŒZhouyuFactory.class);</code><br>2ã€beanNameä¸º&quot;&amp;zhouyuâ€™ï¼Œbeanå¯¹è±¡ä¸ºZhouyuFactoryBeanç±»çš„å®ä¾‹å¯¹è±¡ã€‚=&gt;<code>applicationcontext.getBean(nameï¼š&quot;&amp;zhouyu&quot;ï¼ŒZhouyuFactoryBean.class);</code></p><p>ä¸BeanFactoryçš„åŒºåˆ«ï¼š</p><ul><li>FactoryBeanå¯¹è±¡æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªBeanï¼ŒåŒæ—¶å®ƒç›¸å½“äºä¸€ä¸ªå°å‹å·¥å‚ï¼Œå¯ä»¥ç”Ÿäº§å‡º<strong>å¦å¤–</strong>çš„Beanã€‚==ã€‹æŒ‡å®šç±»å‹çš„Beanå¯¹è±¡<ul><li>FactoryBeanæœºåˆ¶è¢«å¹¿æ³›çš„åº”ç”¨åœ¨Springå†…éƒ¨å’ŒSpring-ä¸ç¬¬ä¸‰æ–¹æ¡†æ¶æˆ–ç»„ä»¶çš„æ•´åˆè¿‡ç¨‹ä¸­ã€‚</li></ul></li><li>BeanFactoryæ˜¯ä¸€ä¸ªSpringå®¹å™¨ï¼Œæ˜¯ä¸€ä¸ªå¤§å‹å·¥å‚ï¼Œå®ƒå¯ä»¥ç”Ÿäº§å‡º<strong>å„ç§å„æ ·</strong>çš„Beano</li></ul><h4 id="supplier"><a class="markdownIt-Anchor" href="#supplier"></a> Supplier</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPerson</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        AnnotationConfigApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(Config.class);</span><br><span class="line">        ctx.registerBean(User.class, <span class="keyword">new</span> Supplier&lt;User&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> User <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                User userx = <span class="keyword">new</span> User();</span><br><span class="line">                userx.setAge(<span class="number">222</span>);</span><br><span class="line">                userx.setName(<span class="string">"supplier"</span>);</span><br><span class="line">                <span class="keyword">return</span> userx;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        User user = (User)ctx.getBean(<span class="string">"user"</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="beanfactory"><a class="markdownIt-Anchor" href="#beanfactory"></a> BeanFactory</h2><p>BeanFactoryæ˜¯ä¸€ç§â€œSpringå®¹å™¨â€ï¼Œ BeanFactoryç¿»è¯‘è¿‡æ¥å°±æ˜¯Beanå·¥å‚ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒå¯ä»¥ç”¨æ¥åˆ›å»ºBeanã€è·å–Beanã€‚</p><p>æ¦‚å¿µåŒºåˆ†ï¼š</p><ul><li>BeanFactoryå°†åˆ©ç”¨BeanDefinitionï¼šæ¥ç”ŸæˆBeanå¯¹è±¡</li><li>BeanDefinitionç›¸å½“äºBeanFactoryçš„åŸææ–™</li><li>Beanå¯¹è±¡å°±ç›¸å½“äºBeanFactoryï¼‰æ‰€ç”Ÿäº§å‡ºæ¥çš„äº§å“</li></ul><p>BeanFactoryçš„æ ¸å¿ƒå­æ¥å£å’Œå®ç°ç±»ï¼š</p><ul><li>ListableBeanFactory</li><li>ConfigurableBeanFactory</li><li>AutowireCapableBeanFactory</li><li>AbstractBeanFactory</li><li>DefaultListableBeanFactory</li></ul><p>Â·Â·Â·</p><h2 id="beanç”Ÿå‘½å‘¨æœŸ"><a class="markdownIt-Anchor" href="#beanç”Ÿå‘½å‘¨æœŸ"></a> Beanç”Ÿå‘½å‘¨æœŸ</h2><blockquote><p>Beanç”Ÿå‘½å‘¨æœŸæè¿°çš„æ˜¯Springä¸­ä¸€ä¸ªBeanåˆ›å»ºè¿‡ç¨‹å’Œé”€æ¯è¿‡ç¨‹ä¸­æ‰€ç»å†çš„æ­¥éª¤ï¼Œå…¶ä¸­Beanåˆ›å»ºè¿‡ç¨‹æ˜¯é‡ç‚¹ã€‚ç¨‹åºå‘˜å¯ä»¥åˆ©ç”¨Beanç”Ÿå‘½å‘¨æœŸæœºåˆ¶å¯¹Beanè¿›è¡Œè‡ªå®šä¹‰åŠ å·¥ã€‚</p></blockquote><ul><li>Beanå®šä¹‰ï¼šé€šè¿‡xmlæˆ–è€…ç¼–å†™ç±»çš„å½¢å¼æ¥åˆ›å»ºBeanDefinition</li><li>æ„é€ æ–¹æ³•æ¨æ–­ï¼šä»beançš„å¤šä¸ªæ„é€ æ–¹æ³•ä¸­é€‰å‡ºä¸€ä¸ªæ„é€ æ–¹æ³•</li><li>å®ä¾‹åŒ–ï¼šé€šè¿‡æ„é€ æ–¹æ³•åå°„è·å¾—å¯¹è±¡ï¼Œåœ¨Springä¸­å¯ä»¥é€šè¿‡BeanPostProcessoræœºåˆ¶å¯¹å®ä¾‹åŒ–è¿›è¡Œå¹²é¢„</li><li>å±æ€§å¡«å……(è‡ªåŠ¨æ³¨å…¥ã€ä¾èµ–æ³¨å…¥)ï¼šç»™å±æ€§è¿›è¡Œè‡ªåŠ¨å¡«å……ï¼Œæ¯”å¦‚@Valueï¼Œ@AutoWired</li><li>åˆå§‹åŒ–ï¼šåœ¨ä¸€ä¸ªå¯¹è±¡çš„å±æ€§å¡«å……ä¹‹åï¼ŒSpringæä¾›äº†åˆå§‹åŒ–æœºåˆ¶ï¼Œè®©ç¨‹åºå‘˜å¯ä»¥å¯¹å…¶ä»–å±æ€§è¿›è¡Œèµ‹å€¼ã€æ ¡éªŒç­‰è‡ªå®šä¹‰åŠ å·¥(åˆ©ç”¨InitializingBeanæ¥å£)</li><li>åˆå§‹åŒ–åï¼šAopã€ç”Ÿæˆä»£ç†å¯¹è±¡ã€‚å¸¸è¯´çš„Aopæœºåˆ¶å°±æ˜¯åœ¨è¿™ä¸ªæ­¥éª¤ä¸­é€šè¿‡BeanPostProcessoræœºåˆ¶å®ç°çš„ï¼Œè¿™æ­¥ä¹‹åè·å¾—çš„å¯¹è±¡æ‰æ˜¯çœŸæ­£çš„Beanå¯¹è±¡</li></ul><p>åˆ›å»ºè¿‡ç¨‹ï¼š</p><p><img src="/2022/02/27/æ·±å…¥å­¦ä¹ ä½¿ç”¨Spring/E:%5Chexo%5Csource_posts%5C%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0%E4%BD%BF%E7%94%A8Spring%5Cbean%E5%88%9B%E5%BB%BA%E8%BF%87%E7%A8%8B.jpg" alt="beanåˆ›å»ºè¿‡ç¨‹"></p><p>ç”Ÿå‘½å‘¨æœŸå›¾ï¼š</p><p><img src="/2022/02/27/æ·±å…¥å­¦ä¹ ä½¿ç”¨Spring/E:%5Chexo%5Csource_posts%5C%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0%E4%BD%BF%E7%94%A8Spring%5Cbean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F-1.jpg" alt="beanç”Ÿå‘½å‘¨æœŸ-1"></p><h2 id="å±æ€§å¡«å……æ³¨è§£autowired-resource-value"><a class="markdownIt-Anchor" href="#å±æ€§å¡«å……æ³¨è§£autowired-resource-value"></a> å±æ€§å¡«å……æ³¨è§£ï¼š@Autowiredã€@Resourceã€@Value</h2><h3 id="autowired"><a class="markdownIt-Anchor" href="#autowired"></a> @Autowired.</h3><p>è¡¨ç¤ºæŸä¸ªå±æ€§æ˜¯å¦éœ€è¦è¿›è¡Œä¾èµ–æ³¨å…¥ï¼Œå¯ä»¥å†™åœ¨å±æ€§å’Œæ–¹æ³•ä¸Šã€‚æ³¨è§£ä¸­çš„requiredå±æ€§é»˜è®¤ä¸ºtureï¼Œè¡¨ç¤ºå¦‚æœæ²¡æœ‰å¯¹è±¡å¯ä»¥æ³¨å…¥ç»™å±æ€§åˆ™æŠ›å¼‚å¸¸ã€‚</p><ul><li><p>@Autowiredï¼šåŠ åœ¨æŸä¸ª<strong>å±æ€§</strong>ä¸Šï¼ŒSpringåœ¨è¿›è¡ŒBeançš„ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹ä¸­ï¼Œåœ¨<strong>å±æ€§å¡«å……</strong>è¿™ä¸€æ­¥ä¼šåŸºäºå®ä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡ï¼Œå¯¹è¯¥å¯¹è±¡ä¸­åŠ äº†@Autowiredçš„å±æ€§è‡ªåŠ¨ç»™å±æ€§èµ‹å€¼ã€‚å…·ä½“å®ç°ä¸ºï¼š Springä¼šå…ˆæ ¹æ®å±æ€§çš„ç±»å‹å»Springå®¹å™¨ä¸­æ‰¾å‡ºè¯¥ç±»å‹æ‰€æœ‰çš„Beanå¯¹è±¡ï¼Œå¦‚æœæ‰¾å‡ºæ¥å¤šä¸ªï¼Œåˆ™å†æ ¹æ®å±æ€§çš„åå­—ä»å¤šä¸ªä¸­å†ç¡®å®šä¸€ä¸ªã€‚å¦‚æœrequiredå±æ€§ä¸ºtrueï¼Œå¹¶ä¸”æ ¹æ®å±æ€§ä¿¡æ¯æ‰¾ä¸åˆ°å¯¹è±¡ï¼Œåˆ™ç›´æ¥æŠ›å¼‚å¸¸ã€‚</p></li><li><p>å½“@Autowiredæ³¨è§£å†™åœ¨<strong>æŸä¸ªæ–¹æ³•</strong>ä¸Šæ—¶ï¼ŒSpringåœ¨B eanç”Ÿå‘½å‘¨æœŸçš„å±æ€§å¡«å……é˜¶æ®µï¼Œä¼šæ ¹æ®æ–¹æ³•çš„å‚æ•°ç±»å‹ã€å‚æ•°åå­—ä»Springå®¹å™¨æ‰¾åˆ°å¯¹è±¡å½“åšæ–¹æ³•å…¥å‚ï¼Œè‡ªåŠ¨åå°„è°ƒç”¨è¯¥æ–¹æ³•ã€‚</p></li><li><p>@AutowiredåŠ åœ¨<strong>æ„é€ æ–¹æ³•</strong>ä¸Šæ—¶ï¼ŒSpringä¼šåœ¨<strong>æ¨æ–­æ„é€ æ–¹æ³•é˜¶æ®µ</strong>ï¼Œ<u>é€‰æ‹©è¯¥æ„é€ æ–¹æ³•æ¥è¿›è¡Œå®ä¾‹åŒ–</u>ï¼Œåœ¨åå°„è°ƒç”¨æ„é€ æ–¹æ³•ä¹‹å‰ï¼Œä¼šå…ˆæ ¹æ®æ„é€ æ–¹æ³•å‚æ•°ç±»å‹ã€å‚æ•°åä»Springå®¹å™¨ä¸­æ‰¾åˆ°Beanå¯¹è±¡ï¼Œå½“åšæ„é€ æ–¹æ³•å…¥å‚ã€‚</p></li></ul><h3 id="resource"><a class="markdownIt-Anchor" href="#resource"></a> @Resource</h3><p>@Resourceæ³¨è§£ä¸@Autowiredç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç”¨æ¥è¿›è¡Œä¾èµ–æ³¨å…¥çš„ï¼Œ@Resourceæ˜¯<strong>Javaå±‚é¢</strong>æ‰€æä¾›çš„æ³¨è§£ï¼Œ@Autowired.æ˜¯<strong>Spring</strong>æ‰€æä¾›çš„æ³¨è§£ï¼Œå®ƒä»¬ä¾èµ–æ³¨å…¥çš„åº•å±‚å®ç°é€»è¾‘ä¹Ÿä¸åŒã€‚</p><p>@Resourceï¼šæ³¨è§£ä¸­æœ‰ä¸€ä¸ªnameå±æ€§ï¼Œé’ˆå¯¹na meå±æ€§æ˜¯å¦æœ‰å€¼ï¼Œ@Resourceçš„ä¾èµ–æ³¨å…¥åº•å±‚æµç¨‹æ˜¯ä¸åŒçš„ã€‚</p><ul><li>@Reousrceï¼šå¦‚æœnameå±æ€§æœ‰å€¼ï¼Œé‚£ä¹ˆSpringä¼šç›´æ¥æ ¹æ®æ‰€æŒ‡å®šçš„nameå€¼å»Springå®¹å™¨æ‰¾Beanå¯¹è±¡ï¼Œå¦‚æœæ‰¾åˆ°äº†åˆ™æˆåŠŸï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™æŠ¥é”™ã€‚</li><li>å¦‚æœ@Resourceä¸­çš„nameå±æ€§æ²¡æœ‰å€¼ï¼Œåˆ™ï¼š<ol><li>å…ˆåˆ¤æ–­è¯¥å±æ€§åå­—åœ¨Springå®¹å™¨ä¸­æ˜¯å¦å­˜åœ¨Beanå¯¹è±¡ã€‚</li><li>å¦‚æœå­˜åœ¨ï¼Œåˆ™æˆåŠŸæ‰¾åˆ°Beanå¯¹è±¡è¿›è¡Œæ³¨å…¥ã€‚</li><li>å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ ¹æ®å±æ€§ç±»å‹å»Springå®¹å™¨æ‰¾Beanå¯¹è±¡ï¼Œæ‰¾åˆ°ä¸€ä¸ªåˆ™è¿›è¡Œæ³¨å…¥ã€‚</li></ol></li></ul><h3 id="value"><a class="markdownIt-Anchor" href="#value"></a> @Value</h3><p>@Valueæ³¨è§£å’Œ@Resourceã€@Autowiredç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç”¨æ¥å¯¹å±æ€§è¿›è¡Œä¾èµ–æ³¨å…¥çš„ï¼Œåªä¸è¿‡@Valueæ˜¯ç”¨æ¥ä»<strong>Properties.æ–‡ä»¶ä¸­</strong>æ¥è·å–<strong>å€¼</strong>çš„ï¼Œå¹¶ä¸”@Valueå¯ä»¥è§£æSpELï¼ˆSpringè¡¨è¾¾å¼ï¼‰ã€‚</p><ul><li><p><code>@Value(&quot;yuzhou&quot;)</code>: ç›´æ¥å°†å­—ç¬¦ä¸²â€œzhouyuâ€èµ‹å€¼ç»™å±æ€§ï¼Œå¦‚æœå±æ€§ç±»å‹ä¸æ˜¯Stringï¼Œæˆ–æ— æ³•è¿›è¡Œç±»å‹è½¬åŒ–ï¼Œåˆ™æŠ¥é”™ã€‚</p></li><li><p><code>@Value(${&quot;yuzhou&quot;})</code>ï¼š å°†ä¼šæŠŠ<code>${}</code>ä¸­çš„å­—ç¬¦ä¸²å½“åškeyï¼Œä»Propertiesæ–‡ä»¶ä¸­æ‰¾å‡ºå¯¹åº”çš„valueèµ‹å€¼ç»™å±æ€§ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œåˆ™ä¼šæŠŠ<code>${zhouyu}</code>å½“åšæ™®é€šå­—ç¬¦ä¸²æ³¨å…¥ç»™å±æ€§ã€‚</p></li><li><p><code>@Value(#{&quot;yuzhou&quot;})</code>:ä¼šå°†<code>#{}</code>ä¸­çš„å­—ç¬¦ä¸²å½“åšSpringè¡¨è¾¾å¼è¿›è¡Œè§£æï¼ŒSpringä¼šæŠŠ&quot;zhouyu&quot;å½“åšbeanNameï¼Œå¹¶ä»Springå®¹å™¨ä¸­æ‰¾å¯¹åº”beanï¼Œå¦‚æœæ‰¾åˆ°åˆ™è¿›è¡Œå±æ€§æ³¨å…¥ï¼Œæ²¡æ‰¾åˆ°åˆ™æŠ¥é”™ã€‚</p></li><li></li></ul><h2 id="applicationcontext"><a class="markdownIt-Anchor" href="#applicationcontext"></a> ApplicationContext</h2><p>ApplicationContextæ˜¯æ¯”BeanFactoryæ›´åŠ å¼ºå¤§çš„Springå®¹å™¨ï¼Œå®ƒæ—¢å¯ä»¥åˆ›å»ºbeanã€è·å–beanï¼Œè¿˜æ”¯æŒå›½é™…åŒ–ã€äº‹ä»¶å¹¿æ’­ã€è·å–èµ„æºç­‰BeanFactor yä¸å…·å¤‡çš„åŠŸèƒ½ã€‚</p><p>Application Contextï¼Œæ‰€ç»§æ‰¿çš„æ¥å£</p><ul><li>EnvironmentCapableï¼šæ‹¥æœ‰è·å–ç¯å¢ƒå˜é‡çš„èƒ½åŠ›ï¼šæ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡å’ŒJvmç¯å¢ƒå˜é‡</li><li>ListableBeanFactoryï¼šæ‹¥æœ‰äº†è·å–æ‰€æœ‰beanNamesã€åˆ¤æ–­æŸä¸ªbean Nameæ˜¯å¦å­˜åœ¨peanDefinitionå¯¹è±¡ã€ç»Ÿè®¡Be anDefinitionä¸ªæ•°ã€è·å–æŸä¸ªç±»å‹å¯¹åº”çš„æ‰€æœ‰beanNamesç­‰åŠŸèƒ½ã€‚</li><li>HierarchicalBeanFactoryï¼šæ‹¥æœ‰äº†è·å–çˆ¶BeanFactoryã€ã€‚åˆ¤æ–­æŸä¸ªnameæ˜¯å¦å­˜åœ¨beanå¯¹è±¡çš„åŠŸèƒ½ã€‚</li><li>MessageSourceï¼šæ‹¥æœ‰äº†å›½é™…åŒ–åŠŸèƒ½ï¼Œæ¯”å¦‚å¯ä»¥ç›´æ¥åˆ©ç”¨Messa geSourceå¯¹è±¡è·å–æŸä¸ªå›½é™…åŒ–èµ„æºï¼ˆæ¯”å¦‚ä¸åŒå›½å®¶è¯­è¨€æ‰€å¯¹åº”çš„å­—ç¬¦ï¼‰</li><li>ApplicationEventPublisherï¼š æ‹¥æœ‰äº†äº‹ä»¶å‘å¸ƒåŠŸèƒ½ï¼Œå¯ä»¥å‘å¸ƒäº‹ä»¶ï¼Œè¿™æ˜¯Application Contextç›¸å¯¹äºBeanFactoryæ¯”è¾ƒçªå‡ºã€å¸¸ç”¨çš„åŠŸèƒ½ã€‚</li><li>ResourcePatternResolver: æ‹¥æœ‰äº†åŠ è½½å¹¶è·å–èµ„æºçš„åŠŸèƒ½ï¼Œè¿™é‡Œçš„èµ„æºå¯ä»¥æ˜¯æ–‡ä»¶ï¼Œå›¾ç‰‡ç­‰æŸä¸ªURLèµ„æºéƒ½å¯ä»¥ã€‚</li></ul><h3 id="è·å¾—beançš„æ–¹å¼"><a class="markdownIt-Anchor" href="#è·å¾—beançš„æ–¹å¼"></a> è·å¾—beançš„æ–¹å¼ï¼š</h3><blockquote><p><em>getBean() API</em></p></blockquote><ul><li><p>æŒ‰åç§°è·å–Bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Object lion = context.getBean(<span class="string">"lion"</span>);</span><br><span class="line"> </span><br><span class="line">assertEquals(Lion.class, lion.getClass());</span><br></pre></td></tr></table></figure><p>æ ¹æ®beanåç§°è·å–beanï¼Œå¦‚æœåœ¨spring icoå®¹å™¨ä¸­å­˜åœ¨å’Œbeanï¼Œåˆ™è¿”å›<em>Object</em> ç±»çš„å®ä¾‹ã€‚å¦åˆ™ï¼ŒæŠ›å‡ºå¦‚ä¸‹å¼‚å¸¸NoSuchBeanDefinitionExceptionã€‚</p><p>â–²: ä¸»è¦çš„ç¼ºç‚¹æ˜¯ï¼Œåœ¨è·å–beanä¹‹åï¼Œæˆ‘ä»¬<strong>å¿…é¡»å°†å®ƒæŒ‡å®šè½¬æ¢ä¸ºæ‰€éœ€çš„ç±»å‹</strong>ã€‚å¦‚æœè¿”å›çš„beançš„ç±»å‹ä¸æˆ‘ä»¬æœŸæœ›çš„ä¸åŒï¼Œåˆ™å¯èƒ½ä¼šäº§ç”Ÿå¼‚å¸¸ã€‚</p></li><li><p>é€šè¿‡åç§°å’Œç±»å‹è·å–Bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Lion lion = context.getBean(<span class="string">"lion"</span>, Lion.class);</span><br><span class="line"><span class="comment">// ä¸æŒ‰åç§°è·å–Beanç›¸æ¯”ï¼Œæ­¤æ–¹æ³•æ›´å®‰å…¨ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ç¼–è¯‘é˜¶æ®µå°±å‘ç°é”™è¯¯è€Œä¸æ˜¯åœ¨è¿è¡Œé˜¶æ®µã€‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">assertThrows(BeanNotOfRequiredTypeException.class, () -&gt; </span><br><span class="line">    context.getBean(<span class="string">"lion"</span>, Tiger.class));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æŒ‰ç±»å‹è·å–Bean</p></li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// right</span></span><br><span class="line">Lion lion = context.getBean(Lion.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„: åœ¨ä¸‹é¢çš„æƒ…å†µä¸‹ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„å¯èƒ½å­˜åœ¨çš„æ­§ä¹‰ï¼š</span></span><br><span class="line">assertThrows(NoUniqueBeanDefinitionException.class, () -&gt; </span><br><span class="line">    context.getBean(Animal.class));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äº<em>Lion</em>å’Œ<em>Tigeréƒ½</em>å®ç°äº†<em>Animal</em>æ¥å£ï¼Œå› æ­¤ä»…æŒ‡å®šç±»å‹ä¸è¶³ä»¥æ˜ç¡®ç¡®å®šç»“æœã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ª*<code>NoUniqueBeanDefinitionException</code>*ã€‚å³åœ¨<strong>åŒä¸€ä¸ªIOC å®¹å™¨ä¸­ï¼Œå¦‚æœ<u>æœ‰ç›¸åŒç±»å‹çš„å¤šä¸ªbean</u>ï¼Œåˆ™ä¸èƒ½é€šè¿‡ç±»å‹è·å–bean</strong>ã€‚</p><ul><li>æŒ‰åç§°å’Œæ„é€ å‡½æ•°å‚æ•°å¯¹Beanè¿›è¡Œç­›é€‰</li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Tiger tiger = (Tiger) context.getBean(<span class="string">"tiger"</span>, <span class="string">"Siberian"</span>);</span><br><span class="line">Tiger secondTiger = (Tiger) context.getBean(<span class="string">"tiger"</span>, <span class="string">"Striped"</span>);</span><br><span class="line"> </span><br><span class="line">assertEquals(<span class="string">"Siberian"</span>, tiger.getName());</span><br><span class="line">assertEquals(<span class="string">"Striped"</span>, secondTiger.getName());</span><br></pre></td></tr></table></figure><ul><li><p>æŒ‰ç±»å‹å’Œæ„é€ å‡½æ•°å‚æ•°å¯¹Beanè¿›è¡Œç­›é€‰</p><blockquote><p>â–²: è¿™ä¸ªæ–¹æ³•æœ‰ç‚¹ä¸åŒï¼Œå› ä¸ºå®ƒ<strong>åªé€‚ç”¨äºå…·æœ‰åŸå‹ä½œç”¨åŸŸ</strong>çš„beanã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Tiger tiger = context.getBean(Tiger.class, <span class="string">"Shere Khan"</span>);</span><br><span class="line">assertEquals(<span class="string">"Shere Khan"</span>, tiger.getName());</span><br></pre></td></tr></table></figure></li></ul><h2 id="beanpostprocessoræœºåˆ¶"><a class="markdownIt-Anchor" href="#beanpostprocessoræœºåˆ¶"></a> BeanPostProcessoræœºåˆ¶</h2><p>BeanPostProcessoræ˜¯Springæ‰€æä¾›çš„ä¸€ç§æ‰©å±•æœºåˆ¶ï¼Œå¯ä»¥åˆ©ç”¨è¯¥æœºåˆ¶å¯¹Beanè¿›è¡Œå®šåˆ¶åŒ–åŠ å·¥ï¼Œåœ¨Springåº•å±‚æºç å®ç°ä¸­ï¼Œä¹Ÿå¹¿æ³›çš„ç”¨åˆ°äº†è¯¥æœºåˆ¶ï¼ŒBeanPostProcessoré€šå¸¸ä¹Ÿå«åš<strong>Beanåç½®å¤„ç†å™¨</strong>ã€‚</p><p>BeanPostProcessoråœ¨Springä¸­æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåç½®å¤„ç†å™¨ï¼Œå°±æ˜¯æä¾›ä¸€ä¸ªç±»å®ç°è¯¥æ¥å£ï¼Œåœ¨Springä¸­è¿˜å­˜åœ¨ä¸€äº›æ¥å£ç»§æ‰¿äº†BeanPostProcessorï¼Œè¿™äº›å­æ¥å£æ˜¯åœ¨BeanPostProcessorçš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€äº›å…¶ä»–çš„åŠŸèƒ½ã€‚</p><p>BeanPostProcessoriä¸­çš„æ–¹æ³•</p><ul><li>postProcessBeforelnitialization()ï¼šåˆå§‹åŒ–å‰æ–¹æ³•ï¼Œè¡¨ç¤ºå¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–¹æ³•æ¥å¯¹Beanåœ¨åˆå§‹åŒ–å‰è¿›è¡Œè‡ªå®šä¹‰åŠ å·¥ã€‚</li><li>postProcessAfterInitialization()ï¼šåˆå§‹åŒ–åæ–¹æ³•ï¼Œè¡¨ç¤ºå¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–¹æ³•æ¥å¯¹Beanåœ¨åˆå§‹åŒ–åè¿›è¡Œè‡ªå®šä¹‰åŠ å·¥ã€‚</li></ul><h3 id="instantiationawarebeanpostprocessor"><a class="markdownIt-Anchor" href="#instantiationawarebeanpostprocessor"></a> InstantiationAwareBeanPostProcessor</h3><blockquote><p>BeanPostProcessorçš„ä¸€ä¸ªå­æ¥å£</p></blockquote><ul><li>postProcessBeforelnstantiation()ï¼šå®ä¾‹åŒ–å‰</li><li>postProcessAfterInstantiation()ï¼šå®ä¾‹åŒ–å</li><li>postProcessProperties()ï¼šå±æ€§æ³¨å…¥å</li></ul><h2 id="aopæ˜¯ä»€ä¹ˆ"><a class="markdownIt-Anchor" href="#aopæ˜¯ä»€ä¹ˆ"></a> AOPæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>AOPå°±æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œæ˜¯ä¸€ç§éå¸¸é€‚åˆåœ¨<strong>æ— éœ€ä¿®æ”¹ä¸šåŠ¡ä»£ç çš„å‰æ</strong>ä¸‹ï¼Œå¯¹<u>æŸä¸ªæˆ–æŸäº›ä¸šåŠ¡å¢åŠ ç»Ÿä¸€çš„åŠŸèƒ½</u>ï¼ˆæ¨ªå‘å¢åŠ åŠŸèƒ½ï¼‰ï¼Œæ¯”å¦‚æ—¥å¿—è®°å½•ã€æƒé™æ§åˆ¶ã€äº‹åŠ¡ç®¡ç†ç­‰ï¼Œèƒ½å¾ˆå¥½çš„ä½¿å¾—ä»£ç è§£è€¦ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚</p><ul><li></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;From : &lt;a href=&quot;https://www.bilibili.com/video/BV1fr4y1Y7UH?p=6&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.bilibili.com/vid
      
    
    </summary>
    
    
      <category term="Spring" scheme="https://nymrli.top/tags/Spring/"/>
    
      <category term="Web" scheme="https://nymrli.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>ç ”ç©¶ç”Ÿworkâ€”â€”åœ°å›¾åŒ¹é…</title>
    <link href="https://nymrli.top/2022/02/26/%E7%A0%94%E7%A9%B6%E7%94%9Fwork%E2%80%94%E2%80%94%E5%9C%B0%E5%9B%BE%E5%8C%B9%E9%85%8D/"/>
    <id>https://nymrli.top/2022/02/26/ç ”ç©¶ç”Ÿworkâ€”â€”åœ°å›¾åŒ¹é…/</id>
    <published>2022-02-26T07:24:46.000Z</published>
    <updated>2022-03-09T13:33:00.468Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åœ°å›¾åŒ¹é…"><a class="markdownIt-Anchor" href="#åœ°å›¾åŒ¹é…"></a> åœ°å›¾åŒ¹é…</h1><p>æ¦‚å¿µï¼š</p><blockquote><ul><li>åœ°å›¾åŒ¹é…ï¼ˆMap-Matchingï¼‰æ˜¯å°†è¿è¥è½¦è¾†çš„æœ‰åºçš„GPSä½ç½®å…³è”åˆ°ç”µå­åœ°å›¾çš„è·¯ç½‘ä¸Šï¼Œå°†GPSåæ ‡ä¸‹é‡‡æ ·åºåˆ—è½¬æ¢ä¸ºæ•°å­—è·¯ç½‘åæ ‡åºåˆ—çš„è¿‡ç¨‹ï¼›æœ¬è´¨ä¸Šæ˜¯å¹³é¢çº¿æ®µåºåˆ—çš„æ¨¡å¼åŒ¹é…é—®é¢˜ï¼ˆ Altç­‰ï¼Œ2003ï¼‰</li><li>åœ°å›¾åŒ¹é…æ˜¯ä¸€ç§å°†åŸå§‹GPSä½ç½®æ˜ å°„åˆ°è·¯ç½‘ä¸Šçš„è·¯æ®µçš„è¿‡ç¨‹ï¼Œä»¥åˆ›å»ºå¯¹è½¦è¾†æ‰€èµ°è·¯çº¿çš„ä¼°ç®—ã€‚</li></ul></blockquote><p>ä¸¤ä¸ªä¸»è¦çš„åœ°å›¾åŒ¹é…ç”¨ä¾‹</p><ul><li>ä¹˜è½¦ç»“æŸæ—¶ï¼Œè®¡ç®—é©¾é©¶å‘˜è¡Œè¿›çš„è·ç¦»ï¼Œä»¥è®¡ç®—ç¥¨ä»·ã€‚â€”â€”è·¯çº¿å›¾åŒ¹é…(EORMM)</li><li><strong>å®æ—¶</strong> ï¼Œä¸ºETAå›¢é˜Ÿæä¾›å‡†ç¡®çš„ä½ç½®å¹¶åšå‡º<strong>è°ƒåº¦</strong>å†³ç­–ï¼Œå¹¶åœ¨rideråº”ç”¨ç¨‹åºä¸Š<strong>æ˜¾ç¤º</strong>é©¾é©¶å‘˜çš„æ±½è½¦ã€‚â€”â€”å®æ—¶åœ°å›¾åŒ¹é…(RTMM)</li></ul><p>ä¸åŒç‚¹åœ¨äºï¼Œ<em>å®æ—¶åœ°å›¾åŒ¹é…</em>çš„è¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¿…é¡»ä½å»¶æ—¶ï¼Œå› æ­¤ç›¸æ¯”ä¹‹ä¸‹ï¼Œ<em>è·¯çº¿å›¾åŒ¹é…</em>å¯¹ç­‰å¾…æ—¶é—´çš„è¦æ±‚ä¸é‚£ä¹ˆä¸¥æ ¼ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ä¹˜è½¦çš„å…¨éƒ¨å†å²è®°å½•</p><h3 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒï¼š</h3><ul><li><p><a href="https://zhuanlan.zhihu.com/p/83039334" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/83039334</a></p></li><li><p><a href="https://blog.csdn.net/weixin_26713521/article/details/108134220" target="_blank" rel="noopener">Lyftçš„åœ°å›¾åŒ¹é…ç®—æ³•è®ºæ–‡ç¿»è¯‘</a></p><ul><li><p>åœ°å›¾åŒ¹é…ç®—æ³•çš„æ€§èƒ½å–å†³äº<strong>é“è·¯ç½‘ç»œæ•°æ®</strong>çš„<strong>è´¨é‡</strong></p></li><li><p>è§£å†³é—®é¢˜çš„ä¸€ç§å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨<strong>çŠ¶æ€ç©ºé—´æ¨¡å‹</strong> ã€‚ çŠ¶æ€ç©ºé—´æ¨¡å‹æ˜¯æ—¶é—´åºåˆ—æ¨¡å‹ï¼Œå…¶ä¸­ç³»ç»Ÿå…·æœ‰â€œéšè—â€çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€æ— æ³•ç›´æ¥è§‚å¯Ÿåˆ°ï¼Œä½†ä¼šå¼•èµ·å¯è§çš„è§‚å¯Ÿã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çš„éšè—çŠ¶æ€æ˜¯æˆ‘ä»¬è¦ä¼°ç®—çš„æ±½è½¦åœ¨é“è·¯ç½‘ç»œä¸Šçš„å®é™…ä½ç½®ã€‚ æˆ‘ä»¬ä»…è§‚å¯Ÿåˆ°éšè—çŠ¶æ€çš„ä¿®æ”¹ç‰ˆæœ¬ï¼šè§‚å¯Ÿå€¼(åŸå§‹ä½ç½®æ•°æ®)ã€‚ æˆ‘ä»¬å‡è®¾ç³»ç»Ÿçš„çŠ¶æ€ä»¥ä»…å–å†³äºå½“å‰çŠ¶æ€çš„æ–¹å¼æ¼”åŒ–(é©¬å°”å¯å¤«å‡è®¾)ï¼Œå¹¶è¿›ä¸€æ­¥å®šä¹‰äº†ä»éšè—çŠ¶æ€åˆ°éšè—çŠ¶æ€çš„è½¬ç§»å¯†åº¦å’Œä»éšè—çŠ¶æ€åˆ°è§‚å¯Ÿçš„å¯†åº¦ã€‚</p><p>å¸¸ç”¨çš„åœ°å›¾åŒ¹é…çŠ¶æ€ç©ºé—´æ¨¡å‹æ˜¯ç¦»æ•£çŠ¶æ€<strong>éšé©¬å°”å¯å¤«æ¨¡å‹</strong> (Newsonï¼†Krumm [2]ï¼ŒDiDiçš„IJCAI-19æ•™ç¨‹[3]ï¼ŒUberçš„Map Matching [4])ã€‚ åœ¨è¯¥ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æŸ¥çœ‹è·¯æ®µä¸Šçš„æœ€è¿‘ç‚¹æ¥ç”Ÿæˆå€™é€‰å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨<a href="https://en.wikipedia.org/wiki/Viterbi_algorithm" target="_blank" rel="noopener">ç»´ç‰¹æ¯”ç®—æ³•</a>æŸ¥æ‰¾æœ€å¯èƒ½çš„éšè—çŠ¶æ€åºåˆ—ã€‚</p><ul><li>å¯¹äºä¸åŒçš„å»ºæ¨¡é€‰æ‹©å’Œè¾“å…¥æ•°æ®è€Œè¨€ï¼Œå®ƒç›¸å¯¹ä¸çµæ´»</li><li>å®ƒç¼©æ”¾ä¸¥é‡(O(NÂ²)ï¼Œå…¶ä¸­Næ˜¯æ¯ä¸ªçŠ¶æ€ä¸‹å¯èƒ½çš„å€™é€‰æ•°)</li><li>å®ƒä¸èƒ½å¾ˆå¥½åœ°åº”å¯¹é«˜é¢‘è§‚æµ‹(è¯·å‚é˜…Newsonï¼†Krumm [2])ã€‚</li></ul></li></ul></li><li><p><a href="http://qikan.cqvip.com/Qikan/Article/Detail?id=1000359922&amp;from=Qikan_Search_Index" target="_blank" rel="noopener">GPSå®šä½ä¸åœ°å›¾åŒ¹é…æ–¹æ³•ç ”ç©¶</a></p><ul><li>åœ°å›¾åŒ¹é…ç®—æ³•ä»åŸç†ä¸Šå¯ä»¥è§£é‡Šä¸ºä¸¤ä¸ªç‹¬ç«‹çš„è¿‡ç¨‹ï¼šï¼ˆ1ï¼‰æ‰¾åˆ°è½¦è¾†å½“å‰è¡Œä½¿çš„é“è·¯â€”â€”ç¡®å®šå€™é€‰è·¯æ®µï¼ˆ2ï¼‰å°†å½“å‰GPSå®šä½ç‚¹æŠ•å½±åˆ°è½¦è¾†è¡Œä½¿çš„é“è·¯ä¸Šâ€”â€”å€™é€‰è·¯æ®µåŒ¹é…è§„åˆ™<ul><li>åœ†å¿ƒæ‹“å±•åŠå¾„æ‰¾åˆ°æœ€è¿‘çš„è·¯æ®µï¼ˆå”¯ä¸€ï¼‰â€”â€”æ„å»ºç¬¬ä¸€æ¡è¾¹çš„ç®—æ³•</li></ul></li></ul></li><li><p>[1]è‹æ´, å‘¨ä¸œæ–¹, å²³æ˜¥ç”Ÿ. GPSè½¦è¾†å¯¼èˆªä¸­çš„å®æ—¶åœ°å›¾åŒ¹é…ç®—æ³•[J]. æµ‹ç»˜å­¦æŠ¥, 2001, 30(3):5.</p><ul><li>å¦å¤–ï¼Œä¸ºäº†æé«˜ç®—æ³•çš„é²æ£’æ€§ï¼Œå¯¹äºè¯¯å·®å¼•èµ· çš„é€Ÿåº¦å¼‚å¸¸ï¼Œæˆ‘ä»¬åˆ©ç”¨æ¨æµ‹èˆªä½æ³•å’Œçº¿æ€§æ’å€¼æ¥ è¿›è¡Œ GPSæ•°æ®è¡¥å¿ï¼Œä»¥æ¶ˆé™¤éƒ¨åˆ†GPSæ¥æ”¶å¤–éƒ¨ ç²—å·®</li></ul></li><li><p>[1]ææ¸…æ³‰, é»„ç»ƒ. åŸºäºGPSè½¨è¿¹æ•°æ®çš„åœ°å›¾åŒ¹é…ç®—æ³•[J]. æµ‹ç»˜å­¦æŠ¥, 2010(2):6.</p><ul><li>é’ˆå¯¹ä¼ ç»Ÿå¯¼èˆªç³»ç»Ÿçš„åœ°å›¾åŒ¹é…æ–¹æ³•çš„ç ”ç©¶è¾ƒå¤šã€‚å…¶ä¸­ç‚¹åˆ°çº¿çš„åŒ¹é…ç”±äºç¼ºä¹å¯¹æ•´ä½“è½¨è¿¹è¶‹åŠ¿çš„è€ƒè™‘ï¼Œåœ¨å¤æ‚çš„é“è·¯ç½‘ç¯å¢ƒä¸‹çš„åŒ¹é…æ˜“å¯¼è‡´è¯¯åŒ¹é…ã€‚ä¹Ÿæœ‰æ–¹æ³•ä½¿ç”¨DRã€å·®åˆ†GPSç­‰è¾…åŠ©è®¾å¤‡ï¼Œé‡‡ç”¨æ»¤æ³¢ã€æ¨¡ç³Šé€»è¾‘ã€è¯æ®ç†è®ºç­‰æ–¹æ³•æé«˜åœ°å›¾åŒ¹é…çš„å‡†ç¡®ç‡ã€‚GPSæµ®åŠ¨è½¦è½¨è¿¹æ•°æ®æä¾›äº†æ•´ä½“æ›²çº¿çš„å˜åŒ–è¶‹åŠ¿ï¼Œå¯ä»¥é‡‡ç”¨å…¨å±€æ•´ä½“åŒ¹é…çš„æ€æƒ³ï¼Œä¿è¯è½¨è¿¹çš„å®Œæ•´æ€§å’Œå‡†ç¡®æ€§14ï¼Ÿã€‚åŸºäºæ›²çº¿ç›¸ä¼¼åº¦çš„ç®—æ³•ä¸€èˆ¬ è¾ƒä¸ºå¤æ‚ï¼Œä½†åŒ¹é…ç²¾åº¦é«˜ï¼Œåˆ©äºè½¨è¿¹çš„ç›´æ¥æ¢å¤ï¼Œé€‚åˆè¿›è¡Œæ•°æ®çš„åå¤„ç†</li><li>ä¸æ•´ä¸ªè½¨è¿¹ç›¸å¯¹ åº”çš„è·¯å¾„å¿…ç„¶æ˜¯è¿é€š çš„è·¯æ®µé›† ï¼Œå¯ä»¥åŸºäºé“è·¯æ‹“æ‰‘ä¸è¿é€šæ€§è®¾è®¡åœ°å›¾åŒ¹é…ç®—æ³•</li><li>keyï¼šé™¤äº†é“è·¯çš„å‡ ä½•è¿é€šæ€§ï¼Œå®é™…è¡Œè½¦è¿˜ä¼šå—åˆ°äº¤é€šè§„åˆ™çš„é™åˆ¶ï¼Œæœ¬æ–‡åŸºäºé“è·¯ç½‘çš„è¡Œè½¦é™åˆ¶ä¿¡æ¯æå‡ºäº†ä¸€ç§GPSæµ®åŠ¨è½¦è½¨è¿¹æ•°æ®çš„å…¨å±€åœ°å›¾åŒ¹é…ç®—æ³•ï¼Œç»¼åˆè€ƒè™‘å¤‡é€‰è·¯æ®µçš„å‡ ä½•è¿é€šæ€§ä¸äº¤é€šç½‘ç»œæ¡ä»¶çº¦æŸæ„å»ºæ•´ä½“å¤‡é€‰è·¯å¾„ï¼Œç„¶åä½¿ç”¨<strong>æ”¹è¿›çš„æ‰«æçº¿æ³•</strong>åˆ¤æ–­å…¨å±€è½¨è¿¹æ›²çº¿ä¸å¤‡é€‰è·¯å¾„çš„ç›¸ä¼¼åº¦ï¼Œå®Œæˆåœ°å›¾åŒ¹é… ã€‚<ul><li>ä¸€å¥è¯æ¦‚æ‹¬ç®—æ³•ï¼šé€šè¿‡è¡Œè½¦é™åˆ¶å°†å€™é€‰çº¿æ®µæ‰¾å‡ºæ¥åï¼Œé€‰æ‹©æ›²çº¿ç›¸ä¼¼åº¦æœ€é«˜çš„</li></ul></li></ul></li><li><p>[1]é™ˆæ»¨, ç‹å¹³, æ–½æ–‡ç¶,ç­‰. GPSè½¨è¿¹æ•°æ®çš„ç»¼åˆåœ°å›¾åŒ¹é…ç®—æ³•ç ”ç©¶[J]. ç”µå­ç§‘æŠ€, 2014, 27(12):4.</p><ul><li>ä»å®é™…çš„åŒ¹é…æ•ˆæœæ¥çœ‹ï¼Œæ­¤åŒ¹é…ç®—æ³•åœ¨äº¤å‰è·¯å£ç­‰è·¯æ®µè¾ƒå¤æ‚çš„åœ°æ–¹å¯æœ‰è¾ƒé«˜åœ°åŒ¹é…å‡†ç¡®ç‡ï¼Œä½†è¯¥æ–¹æ³•ä¾èµ–äºå‰åGPSå®šä½ç‚¹åŒ¹é…å‡†ç¡®åº¦ï¼Œè‹¥å‰ä¸€å®šä½ç‚¹åŒ¹é…é”™è¯¯å°±ä¼šå‡ºç°è¿é”ååº”ï¼Œä»è€Œå¯¼è‡´åé¢ä¸€ç³»åˆ—ç‚¹åŒ¹é…é”™è¯¯ï¼›ä¸”å†å²è½¨è¿¹æ¨ç®—åŒ¹é…æ³•è®¡ç®—é‡è¾ƒå¤§ï¼ŒåŒ¹é…é€Ÿåº¦è¾ƒæ…¢ï¼Œä¸åˆ©äºé«˜é€Ÿå®æ—¶å®šä½ã€‚å› æ­¤ï¼Œéœ€å’Œå…¶ä»–åœ°å›¾åŒ¹é…æ–¹æ³•ç›¸ç»“åˆä½¿ç”¨æ‰èƒ½å–å¾—è¾ƒå¥½çš„åŒ¹é…æ•ˆæœã€‚</li></ul></li><li><p>æ™ºèƒ½äº¤é€šç³»ç»Ÿä¸­GPSåœ°å›¾åŒ¹é…ç®—æ³•è®¾è®¡ä¸å®ç°_ç½—æ°æ¶›</p><ul><li>æ¨¡ç³Šé€»è¾‘ï¼š æ•ˆç‡é«˜ï¼Œå®æ—¶æ€§å¥½ï¼Œå¯¹ç»å¤§å¤šæ•°çš„è·¯æ®µçŠ¶å†µéƒ½é€‚ç”¨ã€‚ä¸è¿‡åœ¨è½¦ä¿©æ‹å¼¯å¤„ä»¥åŠè½¦é€Ÿè¾ƒæ…¢çš„æƒ…å†µä¸‹åŒ¹é…æ•ˆæœä¸å°½å¦‚äººæ„ï¼Œä¸”ä¸åŒè·¯æ®µå»ºæ¨¡çš„ç³»æ•°å‡­é ç»éªŒå€¼ï¼Œæ²¡æœ‰ç›¸åº”çš„ç¼ºä¹ç†è®ºä¾æ®ã€‚â€”â€”01ã€06ã€08è®ºæ–‡</li></ul></li><li><p>é«˜çº§åœ°å›¾åŒ¹é…ç®—æ³•ï¼šç ”ç©¶ç°çŠ¶å’Œè¶‹åŠ¿[2021]</p><ul><li><p>ä»å®ç°æŠ€æœ¯æˆ–æ¨¡å‹è§’åº¦å¯¹è¿‘åå¹´æå‡ºçš„ç®—æ³•è¿›è¡Œåˆ†ç±»ï¼Œç®­å¤´æ ‡è®°ç®—æ³•é—´çš„ç»§æ‰¿å…³ç³»ã€‚ä»å›¾2å¯è§ï¼ŒHMMæ¨¡å‹æ˜¯ä¸»æµï¼Œå…¶æ¬¡æ˜¯åŸºäºæœ€å¤§æƒé‡çš„æ¨¡å‹.HMM-News-onã€ST-Matching2 3IVMM3å’ŒHRIS8è¢«å¼•ç”¨å¯¹æ¯”æœ€å¤šï¼Œæ˜¯å…·æœ‰å¼€åˆ›æ€§çš„å·¥ä½œã€‚å¦å¤–ï¼Œä»2019å¹´å¼€å§‹ï¼Œæœ‰ç ”ç©¶é‡‡ç”¨æ·±åº¦å­¦ä¹ æŠ€æœ¯æ¥è§£å†³åœ°å›¾åŒ¹é…é—®é¢˜ã€‚</p><p><img src="/2022/02/26/ç ”ç©¶ç”Ÿworkâ€”â€”åœ°å›¾åŒ¹é…/E:%5Chexo%5Csource_posts%5C%E7%A0%94%E7%A9%B6%E7%94%9Fwork%E2%80%94%E2%80%94%E5%9C%B0%E5%9B%BE%E5%8C%B9%E9%85%8D%5C09-20%E5%B9%B4%E5%9C%B0%E5%9B%BE%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%95%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B.jpg" alt="09-20å¹´åœ°å›¾åŒ¹é…ç®—æ³•å‘å±•å†ç¨‹"></p></li></ul></li></ul><h3 id="points"><a class="markdownIt-Anchor" href="#points"></a> Points:</h3><ul><li><p>å¦å¤–ï¼Œä¸€ä¸ªé‡è¦çš„å®é™…é—®é¢˜æ˜¯ï¼Œå³ä½¿è½¦è¾†å®šä½ç²¾åº¦å¯ä»¥ä¿è¯åœ¨10ç±³ä»¥å†…ï¼Œå½“ç”µå­åœ°å›¾ç¼©æ”¾åˆ°è¾ƒå¤§çš„æ¯”ä¾‹å°ºæ—¶ï¼Œä¹Ÿä¼š<br>å‡ºç°è½¦è¾†åç¦»è¡Œä½¿çš„é“è·¯è€Œé€ æˆçš„è§†è§‰æ··ä¹±ç°è±¡.</p></li><li><p>ç”±äºåŸåŒºå†…åœ°ç‰©ç‰¹å¾å¤æ‚ï¼Œå—å¯†é›†çš„é«˜å¤§å»ºç­‘ç‰©ã€éš§é“ã€ç«‹äº¤æ¡¥ã€æ ‘æœ¨ç­‰åœ°ç‰©çš„åå°„å’Œé®è”½ç­‰å½±å“ï¼Œè½¦æ ½GPSæ¥æ”¶æœºæ¥æ”¶åˆ°çš„å«æ˜Ÿä¿¡å·å­˜åœ¨ä¸¥é‡çš„å¤šå¾„æ•ˆåº”ï¼Œåœ¨æŸäº›åŒºåŸŸå†…ç”šè‡³ä¼šå½¢æˆGPSå®šä½è‚²åŒºï¼Œè§£å†³GPSç›²åŒºé—®é¢˜ï¼Œä¸€ç§æ–¹æ³•æ˜¯é‡‡ç”¨èˆªä½æ¨ç®—æ³•ï¼ˆDR-Dead Reckoningï¼‰ï¼Œè¿™ç§æ–¹æ³•éœ€è¦å°†DRè®¾å¤‡è£…åœ¨è½¦è¾†å‰ç«¯ï¼Œä¸€èˆ¬åœ¨GPSæ¥æ”¶æœºå«æ˜Ÿä¿¡å·å—é˜»æ—¶ä¸€æ ·å¯ä»¥å¾—åˆ°æ­£ç¡®çš„ç”¨æˆ·ä½ç½®ï¼Œä½†è¿™ç§æ–¹æ³•éœ€è¦é™„åŠ è®¾å¤‡ã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯åœ¨è®°å¿†æ­£ç¡®GPSä½ç½®ä¿¡æ¯çš„åŸºç¡€ä¸Šåœ¨ä¸€æ®µæ—¶é—´å†…é¢„æµ‹è½¦è¾†ä½ç½®ï¼Œè¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯æ˜“äºå®ç°ï¼Œç¼ºç‚¹æ˜¯ç²¾åº¦ä¸å¤Ÿï¼ˆæ²¡æœ‰ï¼Œä½œè€…ä½¿ç”¨å¡å°”æ›¼æ»¤æ³¢è¿›è¡Œä½ç½®é¢„æµ‹ï¼Œé¢„æµ‹ç»“æœå¦‚å›¾æ‰€ç¤ºã€‚åœ¨è§„åˆ™è¡Œè¿›æ—¶ï¼Œé¢„æµ‹æ•ˆæœè¾ƒå¥½ï¼Œè§å›¾3ã€å›¾4.ä½†æ˜¯å½“è½¦è¾†è½¬å¼¯æ—¶ï¼Œæ•ˆæœå¾ˆå·®ï¼Œè§å›¾5ã€å›¾6</p></li><li><p>åˆ°æŠ˜çº¿çš„è·ç¦»å®šä¹‰ä¸ºç‚¹åˆ°æŠ˜çº¿ä¸Šæ‰€æœ‰ç›´çº¿æ®µçš„æœ€çŸ­è·ç¦»ï¼šç‚¹åˆ°çº¿æ®µçš„è·ç¦»å®šä¹‰ä¸ºå¦‚æœç‚¹åˆ°ç›´çº¿æ®µæ‰€åœ¨ç›´çº¿çš„æŠ•å½±åœ¨ç›´çº¿æ®µä¸Šï¼Œåˆ™ä¸ºå‚çº¿é•¿åº¦ï¼Œå¦åˆ™ä¸ºå…¶åˆ°ä¸¤ä¸ªç«¯ç‚¹çš„æœ€çŸ­è·ç¦»ã€‚</p></li><li><p>å®šä½è¯¯å·®ï¼š GPSè¯¯å·®ã€ç”µå­åœ°å›¾åº“è¯¯å·®ã€åæ ‡æŠ•å½±å˜æ¢æŠ•å½±</p></li><li><p>éš¾ç‚¹ï¼š</p><ul><li><a href="http://qikan.cqvip.com/Qikan/Article/ReadIndex?id=33650279&amp;info=X19Wa%2bQedw8TOqUh1eM7U0SrEn1nIM08tSny4w0YhPo%3d" target="_blank" rel="noopener">Y-junctioné—®é¢˜</a>â€”â€”ç‚¹åˆ°çº¿çš„åŒ¹é…æ–¹å¼ï¼Œæ²¡æœ‰è€ƒè™‘å…¨å±€åŒ¹é…</li><li>å¹³è¡ŒåŒçº¿è·¯</li></ul></li><li><p>MapMatchingå®ç°çš„æ€è·¯</p><ul><li><strong>ç¦»æ•£ç‚¹é›†åŒ¹é…</strong>ï¼šç›¸å¯¹ç®€å•ï¼Œéšæœºç¦»æ•£ç‚¹æ²¡æœ‰å½¢çŠ¶å’Œæ‹“æ‰‘å…³ç³»ï¼Œç”¨æ¬§æ°è·ç¦»ä½œå¸é™„å³å¯ï¼Œå…¸å‹åº”ç”¨å¦‚ç¦»æ•£çƒ­åŠ›å›¾ã€‚</li><li><strong>æ›²çº¿æ‹Ÿåˆ</strong>ï¼š å®é™…ä¸­æ›´æœ‰åº”ç”¨ä»·å€¼çš„æ˜¯æ›²çº¿æ‹ŸåˆåŒ¹é…å…³ç³»ï¼Œæ¯”å¦‚è½¨è¿¹å’Œè·¯ç½‘ï¼ŒGPSåºåˆ—å’Œå¯¼èˆªè·¯çš„ç›¸ä¼¼æ€§ã€‚</li></ul></li><li><p>MapMatchingç®—æ³•çš„åˆ†ç±»ï¼š</p><p><strong>ä»¥ä½¿ç”¨åˆ°çš„ä¿¡æ¯æ¥åˆ’åˆ†</strong></p><p>ç°æœ‰çš„ç®—æ³•å¯è¢«åˆ†æˆå››ç±»ï¼šå‡ ä½•ã€æ‹“æ‰‘ã€æ¦‚ç‡ã€é«˜çº§ã€‚</p><p>aï¼‰åŸºäºå‡ ä½•çš„ç®—æ³•è€ƒè™‘GPSç‚¹ä¸é“è·¯çš„å‡ ä½•ä¿¡æ¯ï¼Œå¦‚è·ç¦»ã€è§’åº¦ç­‰ï¼›</p><p>bï¼‰åŸºäºæ‹“æ‰‘çš„ç®—æ³•ä½¿ç”¨é“è·¯æ‹“æ‰‘ä¿¡æ¯æ¥æ§åˆ¶ï¼›</p><p>cï¼‰æ¦‚ç‡æ–¹æ³•é€šè¿‡è€ƒè™‘GPSç‚¹çš„æ¦‚ç‡ï¼›</p><p>dï¼‰é«˜çº§çš„ç®—æ³•å¾€å¾€ç»¼åˆè€ƒè™‘ä½¿ç”¨å…¨é¢ä¿¡æ¯ï¼Œæœ‰å¡å°”æ›¼æ»¤æ³¢ã€æ¨¡ç³Šé€»è¾‘æ¨¡å‹ã€éšå¼é©¬å°”å¯å¤«æ¨¡å‹ç­‰ç­‰ã€‚</p><p><strong>2.2 ä»¥è€ƒè™‘é‡‡æ ·ç‚¹çš„èŒƒå›´æ¥åˆ’åˆ†</strong></p><p>æ ¹æ®è€ƒè™‘é‡‡æ ·ç‚¹çš„èŒƒå›´ï¼Œå¯åˆ†æˆå±€éƒ¨/å¢é‡ç®—æ³•ã€å…¨å±€ç®—æ³•ã€‚</p><p>aï¼‰å±€éƒ¨/å¢é‡ç®—æ³•æ˜¯è´ªå©ªç®—æ³•ï¼Œæ¯æ¬¡ç¡®å®šä¸€ä¸ªåŒ¹é…ç‚¹ï¼Œä¸‹ä¸ªç‚¹ä»å·²ç»ç¡®å®šçš„åŒ¹é…ç‚¹å¼€å§‹ã€‚è¿™äº›æ–¹æ³•æ ¹æ®è·ç¦»å’Œæ–¹å‘ç›¸ä¼¼æ€§æ¥æ‰¾åˆ°å±€éƒ¨æœ€ä¼˜ç‚¹æˆ–è¾¹ã€‚ï¼ˆåœ¨çº¿åŒ¹é…ï¼‰</p><p>bï¼‰å…¨å±€ç®—æ³•æ˜¯è¦ä»è·¯ç½‘ä¸­æ‰¾åˆ°ä¸€æ¡ä¸é‡‡æ ·è½¨è¿¹æœ€æ¥è¿‘çš„åŒ¹é…è½¨è¿¹ã€‚ä¸ºäº†æµ‹é‡é‡‡æ ·è½¨è¿¹å’ŒåŒ¹é…è½¨è¿¹çš„ç›¸ä¼¼æ€§ï¼Œå¤§å¤šæ•°ç®—æ³•ä½¿ç”¨â€œFrechetè·ç¦»â€æˆ–è€…æ˜¯â€œå¼±Frechetè·ç¦»â€ã€‚è¿˜æœ‰æ—¶ç©ºåŒ¹é…ç®—æ³•ã€æŠ•ç¥¨ç®—æ³•ç­‰ã€‚ï¼ˆç¦»çº¿åŒ¹é…ï¼‰</p><p><strong>ä»¥é‡‡æ ·ç‚¹çš„é¢‘ç‡æ¥åˆ’åˆ†</strong></p><p>æ ¹æ®è½¨è¿¹æ•°æ®çš„é‡‡æ ·é¢‘ç‡ï¼Œç°æœ‰çš„åœ°å›¾åŒ¹é…ç®—æ³•å¯åˆ†æˆï¼š</p><p>aï¼‰é«˜é¢‘é‡‡æ ·ç®—æ³•ï¼ˆæ‰€æœ‰å±€éƒ¨ç®—æ³•ã€éƒ¨åˆ†å…¨å±€ç®—æ³•å¦‚Frechetè·ç¦»åˆ¤åˆ«æ³•ç­‰ï¼‰</p><p>bï¼‰ä½é¢‘é‡‡æ ·ç®—æ³•ï¼ˆST-matchingç®—æ³•ã€IVVMç®—æ³•ï¼‰</p><p>ä¸€èˆ¬è®¤ä¸º30såŠå…¶ä»¥ä¸Šä¸ºä½é¢‘é‡‡æ ·ï¼Œ1sï½10sä¸ºé«˜é¢‘é‡‡æ ·ã€‚</p><p><a href="https://www.cnblogs.com/LBSer/p/4612031.html#!comments" target="_blank" rel="noopener">https://www.cnblogs.com/LBSer/p/4612031.html#!comments</a></p></li><li><p>æ™ºèƒ½äº¤é€šç³»ç»Ÿä¸­GPSåœ°å›¾åŒ¹é…ç®—æ³•è®¾è®¡ä¸å®ç°</p><p><img src="/2022/02/26/ç ”ç©¶ç”Ÿworkâ€”â€”åœ°å›¾åŒ¹é…/E:%5Chexo%5Csource_posts%5C%E7%A0%94%E7%A9%B6%E7%94%9Fwork%E2%80%94%E2%80%94%E5%9C%B0%E5%9B%BE%E5%8C%B9%E9%85%8D%5C%E5%9C%B0%E5%9B%BE%E5%8C%B9%E9%85%8D%E7%BB%84%E4%BB%B6.jpg" alt="åœ°å›¾åŒ¹é…ç»„ä»¶"></p></li></ul><h3 id="ç®—æ³•è¯„ä¼°çš„æ ‡å‡†"><a class="markdownIt-Anchor" href="#ç®—æ³•è¯„ä¼°çš„æ ‡å‡†"></a> ç®—æ³•è¯„ä¼°çš„æ ‡å‡†</h3><ul><li>å®æ—¶æ€§</li><li>å¯é æ€§(é²æ£’æ€§)</li><li>åŒ¹é…çš„ç²¾åº¦</li></ul><h2 id="æœ´ç´ ç®—æ³•"><a class="markdownIt-Anchor" href="#æœ´ç´ ç®—æ³•"></a> æœ´ç´ ç®—æ³•ï¼š</h2><p>å¿«é€ŸåŒ¹é…ç®—æ³•çš„æ‰§è¡Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>æ­¥1æ¥æ”¶GPSå®šä½æ•°æ®ï¼›</li><li>æ­¥2åˆ¤æ–­å®šä½æ•°æ®æ˜¯å¦æ— æ•ˆï¼Œè‹¥æ— æ•ˆï¼Œåˆ™æ ¹æ®å†å²å®šä½æ•°æ®è¿›è¡Œæ¨æµ‹åŒ¹é…ï¼Œç„¶åè½¬ï¼ˆ8ï¼‰ï¼›</li><li>æ­¥3åˆ¤æ–­è½¦è¾†å½“å‰æ˜¯å¦å¤„äºåœæ­¢æˆ–ä½é€Ÿæ»‘è¡ŒçŠ¶æ€ï¼Œè‹¥æ˜¯ï¼Œå¯¹å…¶ä½œç›¸åº”å¤„ç†ï¼Œç„¶åè½¬ï¼ˆ8ï¼‰ï¼›</li><li>æ­¥4ç”±è½¦è¾†å½“å‰ä½ç½®ç‚¹è®¡ç®—å…¶å¯¹åº”çš„å€™é€‰ç½‘æ ¼ï¼Œè¿›è€Œè·å–å…¶ä¸­çš„è·¯æ®µï¼›</li><li>æ­¥5å¯¹æ­¥4å¾—åˆ°çš„è·¯æ®µè¿›è¡Œ<strong>è¿æ¥æ€§æ‹“æ‰‘æ£€æŸ¥</strong>ï¼Œå°†é€šè¿‡æ‹“æ‰‘æ£€æŸ¥çš„è·¯æ®µä½œä¸ºåŒ¹é…å€™é€‰è·¯æ®µï¼›</li><li>æ­¥6åˆ¤æ–­åŒ¹é…å€™é€‰è·¯æ®µæ•°ç›®ï¼Œè‹¥å”¯ä¸€ï¼Œåˆ™ç›´æ¥å°†å…¶ä½œä¸ºåŒ¹é…è·¯æ®µï¼Œå¹¶ç”±å®šä½ç‚¹å‘å…¶ä½œæŠ•å½±ï¼Œç„¶åè½¬ï¼ˆ8ï¼‰ï¼›å¦åˆ™ï¼Œè®¡ç®—æ‰€æœ‰å€™é€‰è·¯æ®µçš„åŒ¹é…åº¦åº¦é‡å€¼fï¼Œï¼ˆi=1,2ï¼Œâ€¦ï¼ŒNï¼‰ï¼Œä»ä¸­é€‰å‡ºæœ€å¤§å€¼fmå’Œæ¬¡å¤§å€¼fmï¼›</li><li>æ­¥7åˆ¤æ–­æœ€å¤§å€¼fmå’Œæ¬¡å¤§å€¼fmä¹‹å·®æ˜¯å¦å¤§äºé˜ˆå€¼fhï¼Œä¸”æœ€å¤§å€¼fmæ˜¯å¦å¤§äºé˜ˆå€¼fhï¼Œå¦‚æœå¤§äºï¼Œåˆ™å°†è·¯æ®µmä½œä¸ºåŒ¹é…è·¯æ®µï¼Œå¹¶ç”±å®šä½ç‚¹å‘å…¶ä½œæŠ•å½±ï¼›å¦åˆ™ï¼Œæš‚ä¸å¯¹æœ¬æ¬¡å®šä½ç»“æœè¿›è¡ŒåŒ¹é…ï¼Œå¾…åé¢å¯¹å…¶è¿›è¡Œå»¶æ—¶åŒ¹é…å¤„ç†ï¼›</li><li>æ­¥8ç»“æŸæœ¬æ¬¡åŒ¹é…</li></ol><p>from : <a href="https://wenku.baidu.com/view/14551bfcfab069dc50220144.html?fr=xueshu_top" target="_blank" rel="noopener">ä¸€ç§é€‚äºè½¦è¾†å¯¼èˆªç³»ç»Ÿçš„å¿«é€Ÿåœ°å›¾åŒ¹é…ç®—æ³•</a>â€”â€”2003</p><h2 id="key"><a class="markdownIt-Anchor" href="#key"></a> Key:</h2><ul><li><p>å‡ºè¡Œæ•°æ®ï¼šé‡‡ç”¨GPSå®šä½ï¼Œé‚£ä¹ˆæ˜¯å¦æ˜¯WGS-84æ•°æ®ï¼Œä½†æ˜¯GISéƒ¨é—¨çš„è·¯ç½‘æ•°æ®åæ ‡æ˜¯ä»€ä¹ˆåæ ‡ç³»ä¸‹çš„</p></li><li><p>åŒçº¿è·¯ï¼š</p></li><li><p>å½“ä¸‹ï¼Œç°åœ¨å¾ˆå¤šç”¨äºMapMatchingçš„æ–¹æ³•ï¼Œå¤§å¤šæ¥è‡ªäºæ¨ç†ã€é¢„æµ‹çš„æ•°å­¦æ–¹æ³•ï¼Œå¦‚éšé©¬å°”å¯å¤«é“¾ã€è´å¶æ–¯æ¨¡å‹ã€ç¥ç»ç½‘ç»œæ¨¡å‹ç­‰ï¼Œä½†åœ¨æ•°æ®ç»“æ„ä¸Šçš„åˆ›æ–°æ¯”è¾ƒå°‘ï¼ŒGISç®—æ³•ï¼Œæ›´å¤šè¦åœ¨è®¡ç®—æœºçš„åŸºç¡€ä¸Šï¼Œç»“åˆæ¯”å¦‚æ—¶ç©ºè§‚å¿µã€æ•°æ®ç‰¹å¾ã€æ‹“æ‰‘å…³ç³»ç­‰å¯¹äºGISç›¸å…³çš„åŸºç¡€ç†è®º</p></li></ul><h2 id="è½¯ä»¶"><a class="markdownIt-Anchor" href="#è½¯ä»¶"></a> è½¯ä»¶</h2><ul><li>mapinfo: å½“ä»Šä¸–ç•Œä¸Šæµè¡Œçš„æ¡Œé¢åœ°ç†ä¿¡æ¯ç³»ç»Ÿ</li><li>graphhopper: è·¯å¾„è§„åˆ’åº“</li><li>arcgis</li><li>openstreetmapâ€”â€”å¼€æºåœ°å›¾ï¼Œç®€ç§°ä¸ºOSM</li></ul><p>çº¿è¦ç´ çš„åŒ¹é…ï¼Œä¸»è¦é€šè¿‡å‡ ä½•ã€æ‹“æ‰‘æˆ–è¯­ä¹‰ç›¸ä¼¼åº¦æ¥è¿›è¡Œè¯†åˆ«ï¼Œå…¶ä¸­é€šè¿‡ç©ºé—´è·ç¦»æ¥è¿›è¡Œè¦ç´ åŒ¹é…çš„å¸¸ç”¨æ–¹å¼æœ‰ï¼š</p><ul><li>é—µå¯å¤«æ–¯åŸºè·ç¦»(Minkowski Distance)</li><li>æ¬§æ°è·ç¦»(Euclidean Distance)</li><li>æ›¼å“ˆé¡¿è·ç¦»(Manhattan Distance)</li><li>åˆ‡æ¯”é›ªå¤«è·ç¦»(Chebyshev Distance)</li><li>æ±‰æ˜è·ç¦»(Hamming distance)</li><li>æ°å¡å¾·ç›¸ä¼¼ç³»æ•°(Jaccard similarity coefficient)</li><li>è±ªæ–¯å¤šå¤«è·ç¦»(Hausdorff Distance)</li><li>å¼—é›·æ­‡è·ç¦»(FrÃ©chetè·ç¦»)</li></ul><p>fromï¼š<a href="http://www.biaozhu.net/9224.html" target="_blank" rel="noopener">é«˜å¾·åœ°å›¾ï¼šåœ°å›¾æ•°æ®å¤„ç†ä¹‹é“è·¯åŒ¹é…ç¯‡</a></p><h1 id="éšé©¬å°”ç§‘å¤«hmm"><a class="markdownIt-Anchor" href="#éšé©¬å°”ç§‘å¤«hmm"></a> éšé©¬å°”ç§‘å¤«HMM</h1><p><strong>HMMæœ‰ä¸‰ä¸ªå…¸å‹(canonical)é—®é¢˜</strong>:</p><ul><li><strong>æ¦‚ç‡è®¡ç®—é—®é¢˜</strong>ï¼šå·²çŸ¥æ¨¡å‹å‚æ•°ï¼Œè®¡ç®—æŸä¸€ç‰¹å®šè¾“å‡ºåºåˆ—çš„æ¦‚ç‡.é€šå¸¸ä½¿ç”¨**<a href="http://en.wikipedia.org/wiki/Forward_algorithm" target="_blank" rel="noopener">Forward</a>ç®—æ³•**è§£å†³ï¼›</li><li><strong>é¢„æµ‹é—®é¢˜æˆ–è€…è§£ç ï¼ˆdecodingï¼‰é—®é¢˜</strong>ï¼šå·²çŸ¥æ¨¡å‹å‚æ•°ï¼Œå¯»æ‰¾æœ€å¯èƒ½çš„èƒ½äº§ç”ŸæŸä¸€ç‰¹å®šè¾“å‡ºåºåˆ—çš„<strong>éšå«çŠ¶æ€</strong>çš„åºåˆ—ã€‚é€šå¸¸ä½¿ç”¨**<a href="http://en.wikipedia.org/wiki/Viterbi_algorithm" target="_blank" rel="noopener">Viterbi</a>ç®—æ³•**è§£å†³ï¼›</li><li><strong>å­¦ä¹ é—®é¢˜</strong>ï¼šå·²çŸ¥è¾“å‡ºåºåˆ—ï¼Œå¯»æ‰¾æœ€å¯èƒ½çš„çŠ¶æ€è½¬ç§»ä»¥åŠè¾“å‡ºæ¦‚ç‡ã€‚é€šå¸¸ä½¿ç”¨**<a href="http://en.wikipedia.org/wiki/Baum-Welch_algorithm" target="_blank" rel="noopener">Baum-Welch</a>ç®—æ³•**ã€‚</li></ul><h2 id="hmmçš„å‡ ä¸ªé‡è¦å…ƒç´ "><a class="markdownIt-Anchor" href="#hmmçš„å‡ ä¸ªé‡è¦å…ƒç´ "></a> HMMçš„å‡ ä¸ªé‡è¦å…ƒç´ ï¼š</h2><ul><li><p>Ï€(startprob_): éšè—çŠ¶æ€åˆå§‹å‘é‡</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Ï€</mi><mo>=</mo><mrow><mo fence="true">(</mo><msub><mi>Ï€</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow><mo>:</mo><msub><mi>Ï€</mi><mi>i</mi></msub><mo>=</mo><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>q</mi><mn>1</mn></msub><mo>=</mo><mi>i</mi><mo fence="true">)</mo></mrow><mo separator="true">,</mo><mn>1</mn><mo>â‰¤</mo><mi>i</mi><mo>â‰¤</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">\pi=\left(\pi_{i}\right): \pi_{i}=P\left(q_{1}=i\right), 1 \leq i \leq N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ï€</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Ï€</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Ï€</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">i</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.79549em;vertical-align:-0.13597em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span></span></p></li><li><p>A(transmat_):  çŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µ:</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><mo>=</mo><msub><mrow><mo fence="true">[</mo><msub><mi>a</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo fence="true">]</mo></mrow><mrow><mi>N</mi><mo>Ã—</mo><mi>N</mi></mrow></msub><mtext>,Â å…¶ä¸­Â </mtext><msub><mi>a</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>q</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>j</mi><mo>âˆ£</mo><msub><mi>q</mi><mi>t</mi></msub><mo>=</mo><mi>i</mi><mo fence="true">)</mo></mrow><mo separator="true">,</mo><mn>1</mn><mo>â‰¤</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>â‰¤</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">A=\left[a_{i j}\right]_{N \times N} \text {, å…¶ä¸­ } a_{i j}=P\left(q_{t+1}=j \mid q_{t}=i\right), 1 \leq i, j \leq N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.144139em;vertical-align:-0.394139em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;">[</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">]</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.14252299999999996em;"><span style="top:-2.364192em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="mbin mtight">Ã—</span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394139em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord text"><span class="mord">,Â </span><span class="mord cjk_fallback">å…¶ä¸­</span><span class="mord">Â </span></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆ£</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">i</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span></span></p></li><li><p>B(emissionprob_): è§‚æµ‹çŠ¶æ€æ¦‚ç‡çŸ©é˜µ</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi><mo>=</mo><msub><mrow><mo fence="true">[</mo><msub><mi>b</mi><mi>j</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo><mo fence="true">]</mo></mrow><mrow><mi>N</mi><mo>Ã—</mo><mi>M</mi></mrow></msub><mi mathvariant="normal">ï¼Œ</mi><mtext>Â å…¶ä¸­Â </mtext><msub><mi>b</mi><mi>j</mi></msub><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo><mo>=</mo><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>o</mi><mi>t</mi></msub><mo>=</mo><msub><mi>o</mi><mi>k</mi></msub><mo>âˆ£</mo><msub><mi>q</mi><mi>t</mi></msub><mo>=</mo><mi>j</mi><mo fence="true">)</mo></mrow><mo separator="true">,</mo><mn>1</mn><mo>â‰¤</mo><mi>j</mi><mo>â‰¤</mo><mi>N</mi><mo separator="true">,</mo><mn>1</mn><mo>â‰¤</mo><mi>k</mi><mo>â‰¤</mo><mi>M</mi></mrow><annotation encoding="application/x-tex">B=\left[b_{j}(k)\right]_{N \times M} ï¼Œ \text { å…¶ä¸­ } b_{j}(k)=P\left(o_{t}=o_{k} \mid q_{t}=j\right), 1 \leq j \leq N, 1 \leq k \leq M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.144139em;vertical-align:-0.394139em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;">[</span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0em;">]</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.14252299999999996em;"><span style="top:-2.364192em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="mbin mtight">Ã—</span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394139em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord text"><span class="mord">Â </span><span class="mord cjk_fallback">å…¶ä¸­</span><span class="mord">Â </span></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆ£</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83041em;vertical-align:-0.13597em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span></span></span></span></span></p></li><li><p>HMMçš„çŠ¶æ€å˜é‡æ•°ç›®ï¼šN</p></li><li><p>HMMçš„è§‚å¯Ÿå˜é‡æ•°ç›®ï¼šM</p></li></ul><p>å¦‚æœè§‚æµ‹åºåˆ—æ˜¯ä¸€ç»´çš„ï¼Œåˆ™è§‚æµ‹çŠ¶æ€çš„æ¦‚ç‡å¯†åº¦å‡½æ•°æ˜¯ä¸€ç»´çš„æ™®é€šé«˜æ–¯åˆ†å¸ƒã€‚å¦‚æœè§‚æµ‹åºåˆ—æ˜¯Nç»´çš„ï¼Œåˆ™éšè—çŠ¶æ€å¯¹åº”çš„è§‚æµ‹çŠ¶æ€çš„æ¦‚ç‡å¯†åº¦å‡½æ•°æ˜¯Nç»´é«˜æ–¯åˆ†å¸ƒã€‚é«˜æ–¯åˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°å‚æ•°å¯ä»¥ç”¨Î¼Î¼è¡¨ç¤ºé«˜æ–¯åˆ†å¸ƒçš„æœŸæœ›å‘é‡ï¼ŒÎ£è¡¨ç¤ºé«˜æ–¯åˆ†å¸ƒçš„åæ–¹å·®çŸ©é˜µã€‚åœ¨GaussianHMMç±»ä¸­ï¼Œâ€œmeansâ€ç”¨æ¥è¡¨ç¤ºå„ä¸ªéšè—çŠ¶æ€å¯¹åº”çš„é«˜æ–¯åˆ†å¸ƒæœŸæœ›å‘é‡Î¼å½¢æˆçš„çŸ©é˜µï¼Œè€Œâ€œcovarsâ€ç”¨æ¥è¡¨ç¤ºå„ä¸ªéšè—çŠ¶æ€å¯¹åº”çš„é«˜æ–¯åˆ†å¸ƒåæ–¹å·®çŸ©é˜µÎ£å½¢æˆçš„ä¸‰ç»´å¼ é‡ã€‚</p><p>from :<a href="https://www.cnblogs.com/pinard/p/7001397.html" target="_blank" rel="noopener">ç”¨hmmlearnå­¦ä¹ éšé©¬å°”ç§‘å¤«æ¨¡å‹HMM</a></p><h2 id="mapmatchingä¸hmm"><a class="markdownIt-Anchor" href="#mapmatchingä¸hmm"></a> MapMatchingä¸Hmm</h2><ul><li>è§‚å¯Ÿå˜é‡ï¼šä»GPSè®¾å¤‡ä¸­å¾—åˆ°çš„ä½ç½®ä¿¡æ¯ï¼ˆç»åº¦ï¼Œçº¬åº¦ï¼‰</li><li>éšè—çŠ¶æ€ï¼šæ‹¥æœ‰GPSè®¾å¤‡çš„ç‰©ä½“ï¼ˆè½¦ï¼Œäººç­‰ï¼‰å®é™…æ‰€åœ¨çš„ä½ç½®è·¯æ®µã€‚</li><li>è§‚æµ‹æ¦‚ç‡ï¼šä¾‹å¦‚ï¼Œç°æµ‹çš„GPSç‚¹ç¦»æ—è¾¹è·¯æ®µä¸Šçš„ä½ç½®è¶Šè¿‘ï¼Œé‚£ä¹ˆè¿™ä¸ªçœŸå®ç‚¹åœ¨è¿™ä¸ªè·¯æ®µä¸Šçš„æ¦‚ç‡è¶Šå¤§çŠ¶æ€ã€‚</li><li>çŠ¶æ€è½¬ç§»æ¦‚ç‡ï¼šä¾‹å¦‚ï¼Œå‰åä¸¤ä¸ªçœŸå®çš„ä½ç½®ç‚¹çš„è·ç¦»è¶Šè¿‘ï¼Œé‚£ä¹ˆçŠ¶æ€è½¬ç§»çš„æ¦‚ç‡è¶Šå¤§</li></ul><p>åœ¨ä¸‹é¢ç›¸å…³è®ºæ–‡å·¥ä½œä¸­ä¼šè¯´æ˜åœ¨è¿™å‡ ç¯‡è®ºæ–‡ä¸­å…¶å®åªç”¨åˆ°äº†é¢„æµ‹é—®é¢˜çš„<a href="http://en.wikipedia.org/wiki/Viterbi_algorithm" target="_blank" rel="noopener">Viterbi</a>ç®—æ³•,ä¸‹é¢ä¹Ÿä¼šå¦å¼€ä¸€å°èŠ‚å…·ä½“æè¿°ä¸‹<a href="http://en.wikipedia.org/wiki/Viterbi_algorithm" target="_blank" rel="noopener">Viterbi</a>ç®—æ³•ã€‚</p><p><strong>Map-Matchingçš„ä¸¤ä¸ªå˜é‡</strong>ï¼š</p><ul><li>ä»GPSè®¾å¤‡ä¸­å¾—åˆ°çš„ä½ç½®ä¿¡æ¯ï¼ˆç»åº¦ï¼Œçº¬åº¦ï¼‰ï¼šHMMä¸­è§‚å¯Ÿå˜é‡ï¼›</li><li>æ‹¥æœ‰GPSè®¾å¤‡çš„ç‰©ä½“ï¼ˆè½¦ï¼Œäººç­‰ï¼‰å®é™…æ‰€åœ¨çš„ä½ç½®ï¼šHMMä¸­çš„éšè—çŠ¶æ€å˜é‡ï¼Œå®é™…åœ°å›¾æ˜¯ä¸çŸ¥é“GPSè®¾å¤‡çš„å‡†ç¡®ä½ç½®çš„ã€‚</li></ul><p>è¿™æ ·å°±æŠŠMap-Matchingé—®é¢˜ä¸HMMç»“åˆèµ·æ¥äº†ã€‚ä¸‰ä¸ªé—®é¢˜åœ¨Map-Matchingä¸­æœ‰ç”¨çš„æ˜¯ä¸¤ä¸ªé—®é¢˜ï¼šï¼ˆ1ï¼‰é¢„æµ‹é—®é¢˜ï¼›ï¼ˆ2ï¼‰å­¦ä¹ é—®é¢˜ã€‚</p><p>åœ¨è®ºæ–‡ä¸­ï¼Œå®šä¹‰çš„è§„åˆ™è¦æ»¡è¶³äººçš„ç›´è§‚ä¸Šçš„æ„Ÿè§‰ï¼Œå³äººçš„å…ˆéªŒçŸ¥è¯†ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š</p><ul><li>è§‚æµ‹æ¦‚ç‡ï¼šè§‚æµ‹çš„GPSç‚¹ç¦»æ—è¾¹è·¯æ®µä¸Šçš„ä½ç½®è¶Šè¿‘ï¼Œé‚£ä¹ˆè¿™ä¸ªçœŸå®ç‚¹åœ¨è¿™ä¸ªè·¯æ®µä¸Šçš„æ¦‚ç‡è¶Šå¤§ã€‚</li><li>çŠ¶æ€è½¬ç§»æ¦‚ç‡ï¼šè¿™é‡Œæœ‰ä¸¤ç§è§£å†³æ€è·¯ï¼šï¼ˆ1ï¼‰å‰åä¸¤ä¸ªçœŸå®çš„ä½ç½®ç‚¹çš„è·ç¦»è¶Šè¿‘ï¼Œé‚£ä¹ˆçŠ¶æ€è½¬ç§»çš„æ¦‚ç‡è¶Šå¤§ï¼›æˆ–è€…ï¼ˆ2ï¼‰çœŸå®è·¯æ®µä¸Šçš„å‰åä¸¤ä¸ªç‚¹çš„è·ç¦»ä¸GPSè§‚æµ‹çš„å‰åä¸¤ä¸ªç‚¹çš„è·ç¦»è¶Šæ¥è¿‘ï¼ŒçŠ¶æ€è½¬ç§»æ¦‚ç‡è¶Šå¤§ã€‚</li></ul><p>from: <a href="https://www.cnblogs.com/mindpuzzle/p/3653043.html" target="_blank" rel="noopener">åŸºäºéšé©¬å°”ç§‘å¤«æ¨¡å‹(HMM)çš„åœ°å›¾åŒ¹é…(Map-Matching)ç®—æ³•</a></p><h3 id="barefoot"><a class="markdownIt-Anchor" href="#barefoot"></a> <a href="https://github.com/bmwcarit/barefoot/wiki#stand-alone-servers" target="_blank" rel="noopener">barefoot</a></h3><ul><li>è§‚æµ‹æ¦‚ç‡: æµ‹é‡ä½ç½®ä¸å…¶çœŸå®ä½ç½®ä¹‹é—´çš„è·ç¦»ï¼Œç”¨äºå¯¹æµ‹é‡è¯¯å·®è¿›è¡Œå»ºæ¨¡ï¼Œæµ‹é‡è¯¯å·®ç”¨å…·æœ‰ä¸€äº›æ ‡å‡†åå·®<em>Ïƒ</em>çš„é«˜æ–¯åˆ†å¸ƒæ¥æè¿°ï¼ˆé»˜è®¤ä¸º<em>Ïƒ = 5 ç±³</em>ï¼‰ã€‚</li><li>è½¬ç§»æ¦‚ç‡: ç”¨å„ä¸ªä½ç½®æµ‹é‡ä¹‹é—´çš„è·¯ç”±è·ç¦»å’Œè§†çº¿è·ç¦»çš„å·®å¼‚æ¥é‡åŒ–çš„ã€‚è½¬ç§»æ¦‚ç‡å‘ˆè´ŸæŒ‡æ•°åˆ†å¸ƒï¼Œé€Ÿç‡å‚æ•°<em>Î»</em>ï¼ˆé»˜è®¤ä¸º<em>Î» = 0.1</em>ï¼‰æ˜¯å‡å€¼çš„å€’æ•°</li></ul><p>==&gt;</p><ul><li><p><em><strong>åºåˆ—æ¦‚ç‡</strong></em>ï¼š å®šä¹‰<em>p(s 0 â€¦ s t |z 0 â€¦ z t )<em>ä¸ºæœ€å¯èƒ½çš„åºåˆ—åˆ°è¾¾åŒ¹é…å€™é€‰</em>s t</em>çš„æ¦‚ç‡ï¼Œç§°ä¸º s t çš„åºåˆ—æ¦‚ç‡ï¼Œ å¯ä»¥é€šè¿‡é€’å½’ç¡®å®š</p></li><li><p><em><strong>è¿‡æ»¤æ¦‚ç‡</strong></em>ï¼šæˆ‘ä»¬çš„ HMM æ»¤æ³¢å™¨ç¡®å®šå¯¹è±¡å½“å‰ä½ç½®çš„ä¼°è®¡å€¼<em>sÌ… t</em>ï¼Œå®ƒæ˜¯æœ€å¯èƒ½åŒ¹é…çš„å€™é€‰å¯¹è±¡<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>s</mi><mi>t</mi></msub><mo>âˆˆ</mo><msub><mi>S</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">s_t âˆˆ S_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6891em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ç»™å®šæµ‹é‡å€¼<code>z0 ... zt</code>ï¼Œå…¶å®šä¹‰ä¸ºï¼š<code>sÌ…t = argmax(st âˆˆ St) p(st|z0 ... zt)</code>, <code>p(st|z0 ... zt)</code>ç§°ä¸º<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>s</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">s_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>çš„è¿‡æ»¤æ¦‚ç‡***ï¼Œå¯ä»¥é€’å½’ç¡®å®šï¼š</p><p><code>p(st|z0...zt) = p(st|zt) Â· Î£(st-1 âˆˆ St-1) p(st|st-1) Â· p(st-1|z0 ... zt-1)</code>ã€‚</p></li></ul><p>from: <a href="https://github.com/bmwcarit/barefoot/wiki#stand-alone-servers" target="_blank" rel="noopener">https://github.com/bmwcarit/barefoot/wiki#stand-alone-servers</a></p><h2 id="coding"><a class="markdownIt-Anchor" href="#coding"></a> Coding</h2><blockquote><p>åœ¨ä¹‹å‰çš„<a href="http://www.cnblogs.com/pinard/p/6945257.html" target="_blank" rel="noopener">HMMç³»åˆ—</a>ä¸­ï¼Œæˆ‘ä»¬å¯¹éšé©¬å°”ç§‘å¤«æ¨¡å‹HMMçš„åŸç†ä»¥åŠä¸‰ä¸ªé—®é¢˜çš„æ±‚è§£æ–¹æ³•åšäº†æ€»ç»“ã€‚æœ¬æ–‡æˆ‘ä»¬å°±ä»å®è·µçš„è§’åº¦ç”¨Pythonçš„<a href="https://hmmlearn.readthedocs.io/en/latest/api.html#hmmlearn-hmm" target="_blank" rel="noopener">hmmlearn</a>åº“æ¥å­¦ä¹ HMMçš„ä½¿ç”¨ã€‚sklearnåº“ä¸­å°†HMMå¼ƒç”¨äº†ï¼Œæ–°å¼€äº†ä¸€ä¸ª<code>hmmlearn</code>çš„æ–°åº“ï¼Œå®‰è£…å‘½ä»¤ä¸ºï¼š<code>pip install hmmlearn</code>ï¼Œå…³äºhmmlearnçš„æ›´å¤šèµ„æ–™åœ¨<a href="http://hmmlearn.readthedocs.io/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>æœ‰ä»‹ç»ã€‚</p></blockquote><p>hmmlearnå®ç°äº†ä¸‰ç§HMMæ¨¡å‹ç±»ï¼ŒæŒ‰ç…§è§‚æµ‹çŠ¶æ€æ˜¯è¿ç»­çŠ¶æ€è¿˜æ˜¯ç¦»æ•£çŠ¶æ€ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ç±»ã€‚</p><ol><li>GaussianHMM è§‚æµ‹çŠ¶æ€è¿ç»­å‹ä¸”ç¬¦åˆé«˜æ–¯åˆ†å¸ƒ</li><li>GMMHMM è§‚æµ‹çŠ¶æ€è¿ç»­å‹ä¸”ç¬¦åˆæ··åˆé«˜æ–¯åˆ†å¸ƒ</li><li>MultinomialHMM è§‚æµ‹çŠ¶æ€ç¦»æ•£å‹</li></ol><p><strong>HMMä¸»è¦è§£å†³çš„ä¸‰ä¸ªé—®é¢˜</strong><br>å‡è®¾éšè—çŠ¶æ€åºåˆ—å’Œè§‚æµ‹çŠ¶æ€åºåˆ—åˆ†åˆ«ä½¿ç”¨Zå’ŒXè¡¨ç¤ºï¼Œåˆ™è§£å†³çš„3ä¸ªé—®é¢˜å¯è¡¨ç¤ºä¸º:<br>1.è§£ç é—®é¢˜ï¼šå·²çŸ¥æ¨¡å‹å‚æ•°å’ŒXï¼Œä¼°è®¡æœ€å¯èƒ½çš„Zï¼›ç»´ç‰¹æ¯”ç®—æ³•<br>2.æ¦‚ç‡é—®é¢˜ï¼šå·²çŸ¥æ¨¡å‹å‚æ•°å’ŒXï¼Œä¼°è®¡Xå‡ºç°çš„æ¦‚ç‡ï¼›å‘å‰-å‘åç®—æ³•<br>3.å­¦ä¹ é—®é¢˜ï¼šä»…ç»™å‡ºXå’Œéšè—å±‚ä¸ªæ•°ï¼Œä¼°è®¡æ¨¡å‹å‚æ•°ã€‚ B-Wç®—æ³•ï¼Œé€šå¸¸æ˜¯ç»è¿‡ä¸€å®šæ•°é‡çš„è®­ç»ƒä»¥åï¼Œå¾—åˆ°æ¨¡å‹ï¼Œç„¶åè§£å†³é—®é¢˜1å’Œ2ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Created on 2017-12-4</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">è§£ç é—®é¢˜ï¼šæœ¬ä¾‹ä¸ºå¤©æ°”å’Œè¡Œä¸ºçš„å…³ç³»</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="comment"># hmmlearnå¯ä»¥åœ¨å®‰è£…numpyä»¥åï¼Œå†ä½¿ç”¨pip install hmmlearnå®‰è£…</span></span><br><span class="line"><span class="keyword">from</span> hmmlearn <span class="keyword">import</span> hmm</span><br><span class="line"></span><br><span class="line">states = [<span class="string">"Rainy"</span>, <span class="string">"Sunny"</span>]<span class="comment">##éšè—çŠ¶æ€</span></span><br><span class="line">n_states = len(states)<span class="comment">##éšè—çŠ¶æ€é•¿åº¦</span></span><br><span class="line"></span><br><span class="line">observations = [<span class="string">"walk"</span>, <span class="string">"shop"</span>, <span class="string">"clean"</span>]<span class="comment">##å¯è§‚å¯Ÿçš„çŠ¶æ€</span></span><br><span class="line">n_observations = len(observations)<span class="comment">##å¯è§‚å¯Ÿåºåˆ—çš„é•¿åº¦</span></span><br><span class="line"></span><br><span class="line">start_probability = np.array([<span class="number">0.6</span>, <span class="number">0.4</span>])<span class="comment">##å¼€å§‹è½¬ç§»æ¦‚ç‡ï¼Œå³å¼€å§‹æ˜¯Rainyå’ŒSunnyçš„æ¦‚ç‡</span></span><br><span class="line"><span class="comment">##éšè—é—´å¤©æ°”è½¬ç§»æ··æ·†çŸ©é˜µï¼Œå³Rainyå’ŒSunnyä¹‹é—´çš„è½¬æ¢å…³ç³»ï¼Œä¾‹å¦‚[0,0]è¡¨ç¤ºä»Šå¤©Rainyï¼Œæ˜å¤©Rainyçš„æ¦‚ç‡</span></span><br><span class="line">transition_probability = np.array([</span><br><span class="line">  [<span class="number">0.7</span>, <span class="number">0.3</span>],</span><br><span class="line">  [<span class="number">0.4</span>, <span class="number">0.6</span>]</span><br><span class="line">])</span><br><span class="line"><span class="comment">##éšè—çŠ¶æ€å¤©æ°”å’Œå¯è§†è¡Œä¸ºæ··æ·†çŸ©é˜µï¼Œä¾‹å¦‚[0,0]è¡¨ç¤ºä»Šå¤©Rainyï¼Œwalkè¡Œä¸ºçš„æ¦‚ç‡ä¸º0.1</span></span><br><span class="line">emission_probability = np.array([</span><br><span class="line">  [<span class="number">0.1</span>, <span class="number">0.4</span>, <span class="number">0.5</span>],</span><br><span class="line">  [<span class="number">0.6</span>, <span class="number">0.3</span>, <span class="number">0.1</span>]</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ„å»ºäº†ä¸€ä¸ªMultinomialHMMæ¨¡å‹ï¼Œè¿™æ¨¡å‹åŒ…æ‹¬å¼€å§‹çš„è½¬ç§»æ¦‚ç‡ï¼Œéšè—é—´å¤©æ°”è½¬æ¢æ··æ·†çŸ©é˜µï¼ˆtransmatï¼‰ï¼Œéšè—çŠ¶æ€å¤©æ°”å’Œå¯è§†è¡Œä¸ºæ··æ·†çŸ©é˜µemissionprobï¼Œå¯¹æ¨¡å‹å‚æ•°åˆå§‹åŒ–</span></span><br><span class="line">model = hmm.MultinomialHMM(n_components=n_states)</span><br><span class="line">model.startprob_= start_probability</span><br><span class="line">model.transmat_ = transition_probability</span><br><span class="line">model.emissionprob_ = emission_probability</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»™å‡ºä¸€ä¸ªå¯è§åºåˆ—</span></span><br><span class="line">bob_Actions = np.array([[<span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>]]).T</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å†³é—®é¢˜1,è§£ç é—®é¢˜,å·²çŸ¥æ¨¡å‹å‚æ•°å’ŒXï¼Œä¼°è®¡æœ€å¯èƒ½çš„Zï¼› ç»´ç‰¹æ¯”ç®—æ³• </span></span><br><span class="line">logprob, weathers = model.decode(bob_Actions, algorithm=<span class="string">"viterbi"</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Bob Actions:"</span>, <span class="string">", "</span>.join(map(<span class="keyword">lambda</span> x: observations[x], bob_Actions))</span><br><span class="line"><span class="keyword">print</span> <span class="string">"weathers:"</span>, <span class="string">", "</span>.join(map(<span class="keyword">lambda</span> x: states[x], weathers))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">è§£ç é—®é¢˜ï¼š ç›’å­</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> hmmlearn <span class="keyword">import</span> hmm</span><br><span class="line"></span><br><span class="line">states = [<span class="string">"box 1"</span>, <span class="string">"box 2"</span>, <span class="string">"box3"</span>]</span><br><span class="line">n_states = len(states)</span><br><span class="line"></span><br><span class="line">observations = [<span class="string">"red"</span>, <span class="string">"white"</span>]</span><br><span class="line">n_observations = len(observations)</span><br><span class="line"></span><br><span class="line">start_probability = np.array([<span class="number">0.2</span>, <span class="number">0.4</span>, <span class="number">0.4</span>])</span><br><span class="line"></span><br><span class="line">transition_probability = np.array([</span><br><span class="line">  [<span class="number">0.5</span>, <span class="number">0.2</span>, <span class="number">0.3</span>],</span><br><span class="line">  [<span class="number">0.3</span>, <span class="number">0.5</span>, <span class="number">0.2</span>],</span><br><span class="line">  [<span class="number">0.2</span>, <span class="number">0.3</span>, <span class="number">0.5</span>]</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">emission_probability = np.array([</span><br><span class="line">  [<span class="number">0.5</span>, <span class="number">0.5</span>],</span><br><span class="line">  [<span class="number">0.4</span>, <span class="number">0.6</span>],</span><br><span class="line">  [<span class="number">0.7</span>, <span class="number">0.3</span>]</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">model = hmm.MultinomialHMM(n_components=n_states)</span><br><span class="line">model.startprob_=start_probability</span><br><span class="line">model.transmat_=transition_probability</span><br><span class="line">model.emissionprob_=emission_probability</span><br><span class="line"></span><br><span class="line">seen = np.array([[<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>]]).T</span><br><span class="line">logprob, box = model.decode(seen, algorithm=<span class="string">"viterbi"</span>)</span><br><span class="line">print(<span class="string">"The ball picked:"</span>, <span class="string">", "</span>.join(map(<span class="keyword">lambda</span> x: observations[x], seen)))</span><br><span class="line">print(<span class="string">"The hidden box"</span>, <span class="string">", "</span>.join(map(<span class="keyword">lambda</span> x: states[x], box)))</span><br><span class="line">(<span class="string">'The ball picked:'</span>, <span class="string">'red, white, red'</span>)</span><br><span class="line">(<span class="string">'The hidden box'</span>, <span class="string">'box3, box3, box3'</span>)</span><br></pre></td></tr></table></figure><h2 id="é™åˆ¶"><a class="markdownIt-Anchor" href="#é™åˆ¶"></a> é™åˆ¶</h2><ul><li>å¯¹äºä¸åŒçš„å»ºæ¨¡é€‰æ‹©å’Œè¾“å…¥æ•°æ®è€Œè¨€ï¼Œå®ƒç›¸å¯¹ä¸çµæ´»</li><li>å®ƒç¼©æ”¾ä¸¥é‡(O(NÂ²)ï¼Œå…¶ä¸­Næ˜¯æ¯ä¸ªçŠ¶æ€ä¸‹å¯èƒ½çš„å€™é€‰æ•°)</li><li>å®ƒä¸èƒ½å¾ˆå¥½åœ°åº”å¯¹é«˜é¢‘è§‚æµ‹(è¯·å‚é˜…Newsonï¼†Krumm [2])ã€‚</li></ul><p>åŸºäº(æ— å‘³)å¡å°”æ›¼æ»¤æ³¢å™¨çš„æ–°æ¨¡å‹â€”â€”<a href="https://blog.csdn.net/weixin_26713521/article/details/108134220" target="_blank" rel="noopener">https://blog.csdn.net/weixin_26713521/article/details/108134220</a></p><h1 id="help-code"><a class="markdownIt-Anchor" href="#help-code"></a> help Code:</h1><ul><li><a href="https://github.com/bmwcarit/barefoot" target="_blank" rel="noopener">https://github.com/bmwcarit/barefoot</a></li><li><a href="https://github.com/oldrev/mapmatchingkit" target="_blank" rel="noopener">https://github.com/oldrev/mapmatchingkit</a></li></ul><h1 id="ç½‘ç»œæ–‡ç« "><a class="markdownIt-Anchor" href="#ç½‘ç»œæ–‡ç« "></a> ç½‘ç»œæ–‡ç« </h1><ul><li><a href="https://blog.csdn.net/weixin_42599077/article/details/114801735" target="_blank" rel="noopener">åœ°å›¾åŒ¹é…å®ä¾‹-å‡ ä½•åŒ¹é…</a>â€”â€”æ•ˆæœå›¾</li><li><a href="https://blog.csdn.net/weixin_26713521/article/details/108134220" target="_blank" rel="noopener">å®šä½åŒ¹é… æ¨¡æ¿åŒ¹é… åœ°å›¾_ä»€ä¹ˆæ˜¯åœ°å›¾åŒ¹é…ï¼Ÿ</a></li><li><a href="https://blog.csdn.net/Feng512275/article/details/96199675?spm=1001.2014.3001.5502" target="_blank" rel="noopener">å‡ºç§Ÿè½¦è½¨è¿¹ç‚¹åœ°å›¾åŒ¹é…ç ”ç©¶</a></li><li><a href="https://blog.csdn.net/yixianfeng41/article/details/73010792" target="_blank" rel="noopener">åœ°å›¾åŒ¹é…å°ç»“</a></li><li><a href="https://www.cnblogs.com/mindpuzzle/p/3653043.html" target="_blank" rel="noopener">åŸºäºéšé©¬å°”ç§‘å¤«æ¨¡å‹(HMM)çš„åœ°å›¾åŒ¹é…(Map-Matching)ç®—æ³•</a></li></ul><h1 id="å·¥ä½œå®‰æ’"><a class="markdownIt-Anchor" href="#å·¥ä½œå®‰æ’"></a> å·¥ä½œå®‰æ’</h1><p>ä½ çš„å·¥ä½œä¸»è¦å®Œæˆä»€ä¹ˆï¼ˆæ¦‚æ‹¬è¯´æ˜å°±è¡Œï¼‰ï¼Œåˆ†ä¸ºé‚£å‡ æ­¥ï¼Œæ¯ä¸€æ­¥å®Œæˆä»€ä¹ˆï¼ˆæ¦‚æ‹¬è¯´æ˜å°±è¡Œï¼‰ï¼Œæ¯ä¸€æ­¥çš„å·¥ä½œé‡ï¼ˆé¢„è®¡å®Œæˆè¿™æ­¥å·¥ä½œéœ€è¦å¤šå°‘ä¸ªå°æ—¶ï¼‰ï¼Œæ¯ä¸€æ­¥å·¥ä½œé¢„è®¡åœ¨ä»€ä¹ˆæ—¶å€™å®Œæˆï¼ˆæ¯”å¦‚ 3.5ï¼‰</p><ul><li>å·¥ä½œåŒ…å«ï¼šåœ°å›¾åŒ¹é…ï¼Œå°†è½¦è¾†çš„æœ‰åºGPSä½ç½®æ•°æ®å…³è”åˆ°ç”µå­åœ°å›¾çš„è·¯ç½‘ä¸Šï¼Œå°†GPSåæ ‡ä¸‹é‡‡æ ·åºåˆ—è½¬æ¢ä¸ºæ•°å­—è·¯ç½‘è·¯å¾„åºåˆ—çš„è¿‡ç¨‹ã€‚å·¥ä½œå†…å®¹ï¼šè§£æè¿‡æ»¤ç‚¹å¹¶è¿›è¡Œåæ ‡è½¬æ¢-&gt;ç‚¹è¿‡æ»¤(ç‚¹ç¨€ç–)-&gt;åœ°å›¾åŒ¹é…ç®—æ³•-&gt;ç‚¹æ˜ å°„</li></ul><table><thead><tr><th>å†…å®¹</th><th>é¢„ä¼°æ—¶é—´</th></tr></thead><tbody><tr><td>æŸ¥é˜…åœ°å›¾åŒ¹é…ç®—æ³•ç›¸å…³çš„è®ºæ–‡-&gt;æ‰¾åˆ°è§£å†³æ–¹æ¡ˆ(16å°æ—¶)</td><td>2022å¹´2æœˆ28æ—¥</td></tr><tr><td>å­¦ä¹ éšé©¬å°”ç§‘å¤«æ¨¡å‹ç›¸å…³ç†è®ºçŸ¥è¯† (6å°æ—¶)</td><td>2022å¹´3æœˆ2æ—¥</td></tr><tr><td>æ‰¾å¯»éšé©¬å°”ç§‘å¤«æ¨¡å‹èµ„æ–™ã€ä»£ç (8å°æ—¶)â€”â€”barefootã€graphhopper</td><td>2022å¹´3æœˆ4æ—¥</td></tr><tr><td>ç†Ÿæ‚‰é¡¹ç›®ä¸­æœ‰å…³åœ°å›¾å¯¹è±¡çš„ä»£ç ï¼ˆ4å°æ—¶ï¼‰</td><td>2022å¹´3æœˆ5æ—¥</td></tr><tr><td>ç§»æ¤éšé©¬å°”ç§‘å¤«æ¨¡å‹åˆ°é¡¹ç›®ä¸­ï¼Œç›®å‰å‚è€ƒï¼šå¼€æº<a href="https://github.com/bmwcarit/barefoot/wiki#stand-alone-servers" target="_blank" rel="noopener">barefoot</a>å®ç°ï¼šç†Ÿæ‚‰ä»£ç (16å°æ—¶)ã€åæ ‡è½¬æ¢ï¼ˆ3å°æ—¶ï¼‰ã€è¾“å…¥è¾“å‡ºæ•°æ®æ ¼å¼æ”¹é€ (10å°æ—¶)ã€é€‚é…ç±»(56å°æ—¶)ã€æ•ˆæœæ£€éªŒï¼ˆ10å°æ—¶ï¼‰</td><td>2022å¹´3æœˆ20æ—¥</td></tr><tr><td>ç‚¹è¿‡æ»¤ï¼ˆ24å°æ—¶ï¼‰: æ …æ ¼åŒ–ï¼ˆ16å°æ—¶ï¼‰ + åŒé˜Ÿåˆ—ï¼ˆ8å°æ—¶ï¼‰</td><td>2022å¹´3æœˆ24æ—¥</td></tr><tr><td>ç‚¹æ˜ å°„ï¼ˆ6å°æ—¶ï¼‰</td><td>2022å¹´3æœˆ25æ—¥</td></tr></tbody></table><h1 id="åº“"><a class="markdownIt-Anchor" href="#åº“"></a> åº“ï¼š</h1><ul><li><a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-geometry-geometryEngine.html" target="_blank" rel="noopener">geometryEngine</a></li><li>net.sf.geographiclib</li><li>com.esri.core.geometryâ€”â€”QuadTree</li><li>graphhopperâ€”â€”org.locationtech.jts.geom  ==&gt; Envelope --&gt; findCandidateSnapsInBBox</li></ul><hr><h1 id="ç®€å•ç‰ˆå®ç°æ€è·¯"><a class="markdownIt-Anchor" href="#ç®€å•ç‰ˆå®ç°æ€è·¯"></a> ç®€å•ç‰ˆå®ç°æ€è·¯</h1><ol><li>æ‰¾åˆ°èµ·å§‹ç‚¹Oå’Œç»ˆç‚¹Dï¼Œä»¥ä¸¤ç‚¹ä¸ºåŠå¾„ç”»åœ†ï¼ŒæŠŠæ‰€æœ‰èŒƒå›´å†…çš„NormalEdgeå…¨éƒ¨åŠ å…¥Listï¼ˆåªè¦èµ·å§‹ç‚¹orç»ˆæ­¢ç‚¹æœ‰ä¸€ä¸ªåœ¨èŒƒå›´å†…ï¼‰</li><li>ç¡®å®šç¬¬ä¸€æ¡===&gt; æ‰¾ç¦»ç¬¬ä¸€ä¸ªGPSç‚¹æœ€è¿‘çš„è¾¹</li><li>likelyRoute.forEachä»ä¸Šä¸€æ¡çš„lowerNormalEdgeä¸­(ä¿è¯æ‹“æ‰‘å¯è¾¾è¿æ¥)ï¼Œä»ä¸­é€‰æ‹©å¾—åˆ†æœ€é«˜ï¼ˆè·ç¦»å’Œæ–¹å‘ï¼‰çš„è¾¹ä½œä¸ºåç»­è¾¹ ã€‚  å¦‚æœæ²¡æœ‰lowerNormalEdgeï¼ˆå¦‚æœæ‰€æœ‰å‰©ä½™çš„ç‚¹éƒ½èƒ½æ˜ å°„åˆ°æœ€åçš„è¿™æ¡è¾¹ä¸Šï¼Œåˆ™è®¤ä¸ºæ˜¯ç»ˆç‚¹ï¼Œæ­¤æ—¶ä¸åœ¨æ„æ­»è·¯ï¼‰ï¼Œ å¹³å¸¸å¦‚æœæ˜¯æ­»è·¯ï¼Œåˆ™æ”¾å¼ƒè¿™æ¡åºåˆ—è·¯å¾„ã€‚TODOï¼šæ²¡æœ‰åç»­è·¯å¾„æ—¶æ˜¯å¦è¦è€ƒè™‘å¢åŠ å¯èƒ½è¾¹é›†ï¼Ÿ</li><li>åˆ°è¾¾ç»ˆç‚¹è¾¹ç»“æŸ</li><li>ä»likelyRouteä¸­é€‰æ‹©å¾—åˆ†æœ€é«˜çš„è·¯å¾„</li></ol><p>ç”¨åˆ°çš„ç»“æ„ï¼š</p><ul><li><code>likelyRoute: list[list]</code>, å­˜æ”¾å¤šæ¡å¯èƒ½</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;åœ°å›¾åŒ¹é…&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#åœ°å›¾åŒ¹é…&quot;&gt;&lt;/a&gt; åœ°å›¾åŒ¹é…&lt;/h1&gt;
&lt;p&gt;æ¦‚å¿µï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;åœ°å›¾åŒ¹é…ï¼ˆMap-Matchingï¼‰æ˜¯å°†è¿è¥è½¦è¾†çš„æœ‰åºçš„GPSä½ç½®å…³è”åˆ°
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ç§æœ‰Gitlabé…ç½®SSHè¿æ¥</title>
    <link href="https://nymrli.top/2022/02/25/%E7%A7%81%E6%9C%89Gitlab%E9%85%8D%E7%BD%AESSH%E8%BF%9E%E6%8E%A5/"/>
    <id>https://nymrli.top/2022/02/25/ç§æœ‰Gitlabé…ç½®SSHè¿æ¥/</id>
    <published>2022-02-25T05:38:19.000Z</published>
    <updated>2022-02-25T06:04:05.992Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>SSHè¿æ¥å¹¶ä¸æ˜¯åƒ<a href="https://so.csdn.net/so/search?q=http&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener">http</a>è¿æ¥ä¸€æ ·ï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç å°±å¯ä»¥äº†ã€‚SSHè¿æ¥éœ€è¦ä¸€äº›é¢å¤–çš„é…ç½®</p></blockquote><h1 id="ç”Ÿæˆsshç§˜é’¥å’Œå…¬é’¥"><a class="markdownIt-Anchor" href="#ç”Ÿæˆsshç§˜é’¥å’Œå…¬é’¥"></a> ç”ŸæˆSSHç§˜é’¥å’Œå…¬é’¥</h1><h2 id="æŸ¥è¯¢æœ‰æ•ˆé‚®ç®±"><a class="markdownIt-Anchor" href="#æŸ¥è¯¢æœ‰æ•ˆé‚®ç®±"></a> æŸ¥è¯¢æœ‰æ•ˆé‚®ç®±</h2><p>é¦–å…ˆè¦ç¡®å®šä½¿ç”¨çš„é‚®ç®±ï¼Œæ˜¯ä¸æ˜¯è‡ªå·±è®¤ä¸ºçš„é‚®ç®±ï¼Œæ¯”å¦‚æˆ‘ä»¥ä¸ºæ˜¯<code>chenli@sucsoft.com</code>ç»“æœï¼Œå´å‘ç°æ˜¯<code>399-chenli@sucsoft.com</code>ï¼Œé‚£ä¹ˆæŒ‰ç…§è‡ªè®¤ä¸ºçš„é‚®ç®±ç”³è¯·çš„keysé‚£è‡ªç„¶ä¸ä¼šworkã€‚â€”â€”ä¸€èˆ¬æƒ…å†µä¸ä¼šæœ‰æ­§ä¹‰é‚®ç®±å‡ºç°ï¼Œä½†æˆ‘è¿™è¾¹ç¡®å®è·Ÿæƒ³çš„ä¸å¤ªä¸€æ ·</p><h3 id="æŸ¥è¯¢æ–¹æ³•ä¸€æ–°å»ºé¡¹ç›®"><a class="markdownIt-Anchor" href="#æŸ¥è¯¢æ–¹æ³•ä¸€æ–°å»ºé¡¹ç›®"></a> æŸ¥è¯¢æ–¹æ³•(ä¸€)â€”â€”æ–°å»ºé¡¹ç›®</h3><p>åˆ›å»ºç©ºçš„ä»“åº“ï¼Œæç¤ºä¸­æåŠçš„é‚®ç®±å°±æ˜¯æœ‰æ•ˆé‚®ç®±</p><p><img src="/2022/02/25/ç§æœ‰Gitlabé…ç½®SSHè¿æ¥/gitlab-ssh.jpg" alt="gitlab-ssh"></p><h3 id="æŸ¥è¯¢æ–¹æ³•äºŒä¸ªäººpreference"><a class="markdownIt-Anchor" href="#æŸ¥è¯¢æ–¹æ³•äºŒä¸ªäººpreference"></a> æŸ¥è¯¢æ–¹æ³•(äºŒ)â€”â€”ä¸ªäººPreference</h3><ol><li>æ‰“å¼€<code>User Settings-&gt;Profile</code>ï¼Œå…¶ä¸­æœ‰<code>Email</code>ã€<code>public email</code>å’Œ<code>commit email</code>ä¸‰ä¸ªé‚®ç®±ï¼Œå…¶ä¸­è·Ÿæˆ‘ä»¬å¼€å‘å‘½ä»¤æ¯”è¾ƒæœ‰å…³çš„å°±æ˜¯è¿™ä¸ªCommit Emailï¼Œä¹‹å‰æˆ‘çš„é»˜è®¤æ˜¯<code>399-chenli@sucsoft.com</code>ï¼Œè¿™è¾¹è¦è®¾ç½®è‡ªå·±æƒ³è¦çš„ï¼Œæ¯”å¦‚<code>chenli@sucsoft.com</code></li></ol><p><img src="/2022/02/25/ç§æœ‰Gitlabé…ç½®SSHè¿æ¥/email_settings.jpg" alt="email_settings"></p><p>â–²é€‰æ‹©å®Œæˆåï¼Œæ»‘åˆ°æœ€ä¸‹é¢é€‰æ‹©Update profile settings</p><ol start="2"><li>æ‰“å¼€<code>User Settings-&gt;Emails</code>å¯ä»¥çœ‹åˆ°ï¼Œ<code>chenli@sucsoft@sucsoft.com</code>çš„æ ‡ç­¾ä¸­æœ‰commit emailï¼Œå³è®¾ç½®æˆåŠŸ</li></ol><p><img src="/2022/02/25/ç§æœ‰Gitlabé…ç½®SSHè¿æ¥/preference_email.jpg" alt="preference_email"></p><h2 id="gitlabè®¾ç½®å…¬é’¥"><a class="markdownIt-Anchor" href="#gitlabè®¾ç½®å…¬é’¥"></a> Gitlabè®¾ç½®å…¬é’¥</h2><p>ç¡®ä¿é‚®ç®±æ˜¯æœ‰æ•ˆçš„åå°±å¯ä»¥ç”Ÿæˆç§˜é’¥äº†ã€‚</p><ol><li>è®¾ç½®gitä¿¡æ¯</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. è®¾ç½®gitä¿¡æ¯</span></span><br><span class="line">git config --global user.name <span class="string">"chenli"</span></span><br><span class="line">git config --global user.email <span class="string">"chenli@sucsoft.com"</span></span><br><span class="line"><span class="comment"># 2. ç”Ÿæˆç§˜é’¥å’Œå…¬é’¥</span></span><br><span class="line">$ ssh-keygen -t rsa -C chenli@sucsoft.com</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/c/Users/mrli/.ssh/id_rsa):</span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase):</span><br><span class="line">Enter same passphrase again:</span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /c/Users/mrli/.ssh/id_rsa</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /c/Users/mrli/.ssh/id_rsa.pub</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:zKPeKkm0bNzDqZcHUEDcvvDqPG2znRqDrD30yoBb8MM chenli@sucsoft.com</span><br><span class="line">The key<span class="string">'s randomart image is:</span></span><br><span class="line"><span class="string">+---[RSA 3072]----+</span></span><br><span class="line"><span class="string">|   ooo           |</span></span><br><span class="line"><span class="string">|    . o          |</span></span><br><span class="line"><span class="string">|     o           |</span></span><br><span class="line"><span class="string">|    + .o         |</span></span><br><span class="line"><span class="string">|.  + B oS        |</span></span><br><span class="line"><span class="string">| = .B.O. .       |</span></span><br><span class="line"><span class="string">|. E+o*++         |</span></span><br><span class="line"><span class="string">| o BB.B=..       |</span></span><br><span class="line"><span class="string">|. ..*B=*+        |</span></span><br><span class="line"><span class="string">+----[SHA256]-----+</span></span><br></pre></td></tr></table></figure><p>æ ¹æ®å‘½ä»¤è¾“å‡ºç»“æœå¯ä»¥çœ‹åˆ°ï¼Œç”Ÿæˆçš„ç»“æœåœ¨<code>C:\Users\mrli\.ssh</code>è·¯å¾„ä¸‹ï¼Œæœ‰<code>id_rsa</code>ã€<code>id_rsa.pub</code>ï¼Œå…¶ä¸­<code>id_rsa.pub</code>ä¸ºå…¬é’¥ã€‚</p><ol start="2"><li><p>å°†SSHå…¬é’¥æ·»åŠ åˆ°GitHubè´¦æˆ·</p><ol><li>å¤åˆ¶æ–‡ä»¶è·¯å¾„å†….pubåç¼€é‡Œçš„å†…å®¹</li><li>è¿›å…¥SSH Keysçš„è®¾ç½®é¡µé¢ï¼ˆç™»å½•GitHubï¼Œåœ¨å³ä¸Šè§’å¤´åƒç‚¹å‡»è®¾ç½®ï¼‰</li></ol><p><img src="/2022/02/25/ç§æœ‰Gitlabé…ç½®SSHè¿æ¥/add_ssh.jpg" alt="add_ssh"></p><ol start="3"><li>ç²˜è´´åï¼ŒTitleä¼šè‡ªåŠ¨æå–ç”Ÿæˆï¼Œç‚¹å‡»<code>Add key</code>åˆ™å®Œæˆæ·»åŠ </li></ol></li></ol><h2 id="æµ‹è¯•"><a class="markdownIt-Anchor" href="#æµ‹è¯•"></a> æµ‹è¯•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -T git@gitlab.sucsoft.com</span><br><span class="line">Welcome to GitLab, @chenli!</span><br></pre></td></tr></table></figure><h1 id="more"><a class="markdownIt-Anchor" href="#more"></a> More</h1><h2 id="é…ç½®å¤šä¸ªgitä¿¡æ¯"><a class="markdownIt-Anchor" href="#é…ç½®å¤šä¸ªgitä¿¡æ¯"></a> é…ç½®å¤šä¸ªGitä¿¡æ¯</h2><ol><li>å°†é»˜è®¤çš„<code>id_rsa</code>å’Œ<code>id_rsa.pub</code>æ”¹æˆæŒ‡å®šçš„å¦‚<code>id_rsa_sucsoft.pub</code></li><li><code>.ssh/</code>è·¯å¾„ä¸‹æ·»åŠ <code>config</code>é…ç½®æ–‡ä»¶ï¼Œå¯¹åº”å¡«å†™</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Host github.com                 </span><br><span class="line">    HostName github.com</span><br><span class="line">    IdentityFile C:\\Users\\mrli\\.ssh\\id_rsa_github</span><br><span class="line">    PreferredAuthentications publickey</span><br><span class="line">    User Freedomisgood</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Host gitlab.sucsoft.com</span><br><span class="line">    HostName gitlab.sucsoft.com</span><br><span class="line">    IdentityFile C:\\Users\\mrli\\.ssh\\id_rsa_sucsoft</span><br><span class="line">    PreferredAuthentications publickey</span><br><span class="line">    User chenli</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šHoståå†™çš„å°±æ˜¯<code>ssh -T git@gitlab.sucsoft.com</code>ä¸­@åé¢çš„å†…å®¹ï¼Œå¦‚æœå†™çš„æ˜¯<code>sucsoft</code>ï¼Œåˆ™å†™æˆ<code>ssh -T git@sucsoft</code>ï¼Œä½†æ˜¯è¿™æ ·å…¶å®è·ŸGitlabé¡µé¢ä¸­ç›´æ¥æä¾›çš„ä¸ä¸€æ ·: <code>git@gitlab.sucsoft.com:suc-frame/xxxx.git</code>ï¼Œæ‰€ä»¥æœ€å¥½è¿˜æ˜¯è§„èŒƒçš„å†™<code>gitlab.sucsoft.com</code></p><p>â˜…é…ç½®å®Œæˆåæœ€ç»ˆæ–‡ä»¶å¤¹ä¸­çš„å†…å®¹ï¼š</p><p><img src="/2022/02/25/ç§æœ‰Gitlabé…ç½®SSHè¿æ¥/more-1.jpg" alt="more-1"></p><p>æ³¨ï¼š known_hostæ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œå¦‚æœç¬¬ä¸€æ¬¡SSHè¿æ¥ç½‘ç«™ï¼Œåˆ™ä¼šå°†hostæ·»åŠ åˆ°è¿™ä¸ªæ–‡ä»¶ä¸­</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;SSHè¿æ¥å¹¶ä¸æ˜¯åƒ&lt;a href=&quot;https://so.csdn.net/so/search?q=http&amp;amp;spm=1001.2101.3001.7020&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http&lt;/a&gt;è¿
      
    
    </summary>
    
    
      <category term="git" scheme="https://nymrli.top/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>Golang protocçš„ä½¿ç”¨</title>
    <link href="https://nymrli.top/2022/02/22/protoc%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>https://nymrli.top/2022/02/22/protocçš„ä½¿ç”¨/</id>
    <published>2022-02-22T04:04:33.000Z</published>
    <updated>2022-02-22T06:11:07.536Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½¿ç”¨Grpcéœ€è¦æœ‰protocçš„æ”¯æŒ, ä½†é»˜è®¤å®‰è£…çš„<code>/Go/bin</code>ç›®å½•ä¸‹åªæœ‰<code>go.exe</code>ã€<code>gofmt.exe</code>ä¸¤ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå› æ­¤è¦ä½¿ç”¨<code>protoc</code>çš„è¯ï¼Œéœ€è¦è‡ªå·±å»ä¸‹è½½</p></blockquote><ol><li><p>åœ¨<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fprotocolbuffers%2Fprotobuf%2Freleases" target="_blank" rel="noopener">https://github.com/protocolbuffers/protobuf/releases</a>ä¸­ä¸‹è½½Windows64çš„å‹ç¼©åŒ…ï¼Œä¸º<code>$protoc -go_out=. *.proto</code>ä½¿ç”¨åˆ°çš„å‘½ä»¤å¯æ‰§è¡Œæ–‡ä»¶</p></li><li><p>ç¼–å†™<code>.proto</code>æ–‡ä»¶ï¼Œ å¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">syntax = &quot;proto3&quot;;</span><br><span class="line"></span><br><span class="line"># æ³¨æ„, è¿™è¾¹ä½¿ç”¨çš„æ˜¯go_package, ç±»ä¼¼çš„è¿˜æœ‰java_package, åé¢çš„å‚æ•°æ˜¯output_pathå’ŒåŒ…å</span><br><span class="line">option go_package = &quot;.;geecachepb&quot;;</span><br><span class="line"></span><br><span class="line">message Request&#123;</span><br><span class="line">  string group = 1;</span><br><span class="line">  string key = 2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message Response&#123;</span><br><span class="line">  bytes value = 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">service GroupCache&#123;</span><br><span class="line">  rpc Get(Request) returns (Response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨<code>protoc -go_out=. *.proto</code>å‘½ä»¤ï¼Œå°†<code>.proto</code>è½¬æ¢æˆè¦ä½¿ç”¨çš„goæ–‡ä»¶</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Code generated by protoc-gen-go. DO NOT EDIT.</span></span><br><span class="line"><span class="comment">// versions:</span></span><br><span class="line"><span class="comment">// protoc-gen-go v1.27.1</span></span><br><span class="line"><span class="comment">// protoc        v3.19.4</span></span><br><span class="line"><span class="comment">// source: geecachepb.proto</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> geecachepb</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">protoreflect <span class="string">"google.golang.org/protobuf/reflect/protoreflect"</span></span><br><span class="line">protoimpl <span class="string">"google.golang.org/protobuf/runtime/protoimpl"</span></span><br><span class="line">reflect <span class="string">"reflect"</span></span><br><span class="line">sync <span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line"><span class="comment">// Verify that this generated code is sufficiently up-to-date.</span></span><br><span class="line">_ = protoimpl.EnforceVersion(<span class="number">20</span> - protoimpl.MinVersion)</span><br><span class="line"><span class="comment">// Verify that runtime/protoimpl is sufficiently up-to-date.</span></span><br><span class="line">_ = protoimpl.EnforceVersion(protoimpl.MaxVersion - <span class="number">20</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Request <span class="keyword">struct</span> &#123;</span><br><span class="line">state         protoimpl.MessageState</span><br><span class="line">sizeCache     protoimpl.SizeCache</span><br><span class="line">unknownFields protoimpl.UnknownFields</span><br><span class="line"></span><br><span class="line">Group <span class="keyword">string</span> <span class="string">`protobuf:"bytes,1,opt,name=group,proto3" json:"group,omitempty"`</span></span><br><span class="line">Key   <span class="keyword">string</span> <span class="string">`protobuf:"bytes,2,opt,name=key,proto3" json:"key,omitempty"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... çœç•¥æ›´å¤š</span></span><br></pre></td></tr></table></figure></li><li><p><code>go get -u github.com/golang/protobuf/protoc-gen-go</code>å®‰è£…ä½¿ç”¨<code>xxxx.pb.go</code>æ–‡ä»¶çš„åº“</p></li><li><p>åœ¨ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> PeerGetter <span class="keyword">interface</span> &#123;</span><br><span class="line">Get(in *pb.Request, out *pb.Response) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *HttpPool)</span> <span class="title">ServeHTTP</span><span class="params">(w http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    body, err := proto.Marshal(&amp;pb.Response&#123;Value: view.ByteSlice()&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        http.Error(w, err.Error(), http.StatusInternalServerError)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *httpGetter)</span> <span class="title">Get</span><span class="params">(in *pb.Request, out *pb.Response)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">u := fmt.Sprintf(</span><br><span class="line"><span class="string">"%v%v/%v"</span>,</span><br><span class="line">h.baseURL,</span><br><span class="line">url.QueryEscape(in.GetGroup()),</span><br><span class="line">url.QueryEscape(in.GetKey()),</span><br><span class="line">)</span><br><span class="line">res, err := http.Get(u)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> res.Body.Close()</span><br><span class="line"><span class="keyword">if</span> res.StatusCode != http.StatusOK &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">"server return %v"</span>, res.Status)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bytes, err := ioutil.ReadAll(res.Body)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err = proto.Unmarshal(bytes, out); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">"decoding response body: %v"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¨èé£æ ¼"><a class="markdownIt-Anchor" href="#æ¨èé£æ ¼"></a> æ¨èé£æ ¼</h2><ul><li>æ–‡ä»¶(Files)<ul><li>æ–‡ä»¶åä½¿ç”¨å°å†™ä¸‹åˆ’çº¿çš„å‘½åé£æ ¼ï¼Œä¾‹å¦‚ lower_snake_case.proto</li><li>æ¯è¡Œä¸è¶…è¿‡ 80 å­—ç¬¦</li><li>ä½¿ç”¨ 2 ä¸ªç©ºæ ¼ç¼©è¿›</li></ul></li><li>åŒ…(Packages)<ul><li>åŒ…ååº”è¯¥å’Œç›®å½•ç»“æ„å¯¹åº”ï¼Œä¾‹å¦‚æ–‡ä»¶åœ¨<code>my/package/</code>ç›®å½•ä¸‹ï¼ŒåŒ…ååº”ä¸º <code>my.package</code></li></ul></li><li>æ¶ˆæ¯å’Œå­—æ®µ(Messages &amp; Fields)<ul><li>æ¶ˆæ¯åä½¿ç”¨é¦–å­—æ¯å¤§å†™é©¼å³°é£æ ¼(CamelCase)ï¼Œä¾‹å¦‚<code>message StudentRequest { ... }</code></li><li>å­—æ®µåä½¿ç”¨å°å†™ä¸‹åˆ’çº¿çš„é£æ ¼ï¼Œä¾‹å¦‚ <code>string status_code = 1</code></li><li>æšä¸¾ç±»å‹ï¼Œæšä¸¾åä½¿ç”¨é¦–å­—æ¯å¤§å†™é©¼å³°é£æ ¼ï¼Œä¾‹å¦‚ <code>enum FooBar</code>ï¼Œæšä¸¾å€¼ä½¿ç”¨å…¨å¤§å†™ä¸‹åˆ’çº¿éš”å¼€çš„é£æ ¼(CAPITALS_WITH_UNDERSCORES )ï¼Œä¾‹å¦‚ FOO_DEFAULT=1</li></ul></li><li>æœåŠ¡(Services)<ul><li>RPC æœåŠ¡åå’Œæ–¹æ³•åï¼Œå‡ä½¿ç”¨é¦–å­—æ¯å¤§å†™é©¼å³°é£æ ¼ï¼Œä¾‹å¦‚<code>service FooService{ rpc GetSomething() }</code></li></ul></li></ul></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;ä½¿ç”¨Grpcéœ€è¦æœ‰protocçš„æ”¯æŒ, ä½†é»˜è®¤å®‰è£…çš„&lt;code&gt;/Go/bin&lt;/code&gt;ç›®å½•ä¸‹åªæœ‰&lt;code&gt;go.exe&lt;/code&gt;ã€&lt;code&gt;gofmt.exe&lt;/code&gt;ä¸¤ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå› æ­¤è¦ä½¿ç”¨&lt;code&gt;protoc&lt;/code
      
    
    </summary>
    
    
      <category term="Go" scheme="https://nymrli.top/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>è¯­ä¹‰åŒ–çš„ç‰ˆæœ¬æ§åˆ¶</title>
    <link href="https://nymrli.top/2022/01/26/%E8%AF%AD%E4%B9%89%E5%8C%96%E7%9A%84%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/"/>
    <id>https://nymrli.top/2022/01/26/è¯­ä¹‰åŒ–çš„ç‰ˆæœ¬æ§åˆ¶/</id>
    <published>2022-01-26T14:30:00.000Z</published>
    <updated>2022-01-26T14:40:45.998Z</updated>
    
    <content type="html"><![CDATA[<p>è¯­ä¹‰åŒ–çš„ç‰ˆæœ¬æ§åˆ¶ï¼š ç”¨ä¸€ç»„ç®€å•çš„è§„åˆ™åŠæ¡ä»¶æ¥çº¦æŸç‰ˆæœ¬å·çš„é…ç½®å’Œå¢é•¿</p><blockquote><p>ä½œä¸ºä¸€ä½è´Ÿè´£ä»»çš„å¼€å‘è€…ï¼Œä½ ç†å½“ç¡®ä¿æ¯æ¬¡åŒ…å‡çº§çš„è¿ä½œä¸ç‰ˆæœ¬å·çš„è¡¨è¿°ä¸€è‡´ã€‚ç°å®ä¸–ç•Œæ˜¯å¤æ‚çš„ï¼Œæˆ‘ä»¬é™¤äº†æé«˜è­¦è§‰å¤–èƒ½åšçš„ä¸å¤šã€‚ä½ æ‰€èƒ½åšçš„å°±æ˜¯è®©è¯­ä¹‰åŒ–çš„ç‰ˆæœ¬æ§åˆ¶ä¸ºä½ æä¾›ä¸€ä¸ªå¥å…¨çš„æ–¹å¼æ¥å‘è¡Œä»¥åŠå‡çº§åŒ…ï¼Œè€Œæ— éœ€æ¨å‡ºæ–°çš„ä¾èµ–åŒ…ï¼ŒèŠ‚çœä½ çš„æ—¶é—´åŠçƒ¦æ¼ã€‚</p><p>å¦‚æœæ²¡æœ‰æŸä¸ªæ­£å¼çš„è§„èŒƒå¯å¾ªï¼Œç‰ˆæœ¬å·å¯¹äºä¾èµ–çš„ç®¡ç†å¹¶æ— å®è´¨æ„ä¹‰ã€‚å°†ä¸Šè¿°çš„æƒ³æ³•å‘½åå¹¶ç»™äºˆæ¸…æ¥šçš„å®šä¹‰ï¼Œè®©ä½ å¯¹è½¯ä»¶ä½¿ç”¨è€…ä¼ è¾¾æ„å‘å˜å¾—å®¹æ˜“ã€‚ä¸€æ—¦è¿™äº›æ„å‘å˜å¾—æ¸…æ¥šï¼Œå¼¹æ€§ï¼ˆä½†åˆä¸ä¼šå¤ªå¼¹æ€§ï¼‰çš„ä¾èµ–è§„èŒƒå°±èƒ½è¾¾æˆã€‚</p><p>å¦‚æœä½ å¯¹æ­¤è®¤åŒï¼Œå¸Œæœ›ç«‹å³å¼€å§‹ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶ï¼Œä½ åªéœ€å£°æ˜ä½ çš„å‡½æ•°åº“æ­£åœ¨ä½¿ç”¨å®ƒå¹¶éµå¾ªè¿™äº›è§„åˆ™å°±å¯ä»¥äº†ã€‚è¯·åœ¨ä½ çš„ README æ–‡ä»¶ä¸­ä¿ç•™<a href="https://semver.org/lang/zh-CN/" target="_blank" rel="noopener">æ­¤é¡µé“¾æ¥</a>ï¼Œè®©åˆ«äººä¹ŸçŸ¥é“è¿™äº›è§„åˆ™å¹¶ä»ä¸­å—ç›Šã€‚</p></blockquote><h2 id="target"><a class="markdownIt-Anchor" href="#target"></a> Target:</h2><p>ç‰ˆæœ¬æ ¼å¼ï¼šä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·ï¼Œç‰ˆæœ¬å·é€’å¢è§„åˆ™å¦‚ä¸‹ï¼š</p><ol><li>ä¸»ç‰ˆæœ¬å·ï¼šå½“ä½ åšäº†ä¸å…¼å®¹çš„ API ä¿®æ”¹ï¼Œ</li><li>æ¬¡ç‰ˆæœ¬å·ï¼šå½“ä½ åšäº†å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢ï¼Œ</li><li>ä¿®è®¢å·ï¼šå½“ä½ åšäº†å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£ã€‚</li></ol><p>å…ˆè¡Œç‰ˆæœ¬å·åŠç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯å¯ä»¥åŠ åˆ°â€œä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·â€çš„åé¢ï¼Œä½œä¸ºå»¶ä¼¸ã€‚</p><h2 id="è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶è§„èŒƒsemver"><a class="markdownIt-Anchor" href="#è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶è§„èŒƒsemver"></a> è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶è§„èŒƒï¼ˆSemVerï¼‰</h2><p>ä»¥ä¸‹å…³é”®è¯ MUSTã€MUST NOTã€REQUIREDã€SHALLã€SHALL NOTã€SHOULDã€SHOULD NOTã€ RECOMMENDEDã€MAYã€OPTIONAL ä¾ç…§ RFC 2119 çš„å™è¿°è§£è¯»ã€‚</p><ol><li>ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶çš„è½¯ä»¶å¿…é¡»ï¼ˆMUSTï¼‰å®šä¹‰å…¬å…± APIã€‚è¯¥ API å¯ä»¥åœ¨ä»£ç ä¸­è¢«å®šä¹‰æˆ–å‡ºç°äºä¸¥è°¨çš„æ–‡ä»¶å†…ã€‚æ— è®ºä½•ç§å½¢å¼éƒ½åº”è¯¥åŠ›æ±‚ç²¾ç¡®ä¸”å®Œæ•´ã€‚</li><li>æ ‡å‡†çš„ç‰ˆæœ¬å·å¿…é¡»ï¼ˆMUSTï¼‰é‡‡ç”¨ X.Y.Z çš„æ ¼å¼ï¼Œå…¶ä¸­ Xã€Y å’Œ Z ä¸ºéè´Ÿçš„æ•´æ•°ï¼Œä¸”ç¦æ­¢ï¼ˆMUST NOTï¼‰åœ¨æ•°å­—å‰æ–¹è¡¥é›¶ã€‚X æ˜¯ä¸»ç‰ˆæœ¬å·ã€Y æ˜¯æ¬¡ç‰ˆæœ¬å·ã€è€Œ Z ä¸ºä¿®è®¢å·ã€‚æ¯ä¸ªå…ƒç´ å¿…é¡»ï¼ˆMUSTï¼‰ä»¥æ•°å€¼æ¥é€’å¢ã€‚ä¾‹å¦‚ï¼š1.9.1 -&gt; 1.10.0 -&gt; 1.11.0ã€‚</li><li>æ ‡è®°ç‰ˆæœ¬å·çš„è½¯ä»¶å‘è¡Œåï¼Œç¦æ­¢ï¼ˆMUST NOTï¼‰æ”¹å˜è¯¥ç‰ˆæœ¬è½¯ä»¶çš„å†…å®¹ã€‚ä»»ä½•ä¿®æ”¹éƒ½å¿…é¡»ï¼ˆMUSTï¼‰ä»¥æ–°ç‰ˆæœ¬å‘è¡Œã€‚</li><li>ä¸»ç‰ˆæœ¬å·ä¸ºé›¶ï¼ˆ0.y.zï¼‰çš„è½¯ä»¶å¤„äºå¼€å‘åˆå§‹é˜¶æ®µï¼Œä¸€åˆ‡éƒ½å¯èƒ½éšæ—¶è¢«æ”¹å˜ã€‚è¿™æ ·çš„å…¬å…± API ä¸åº”è¯¥è¢«è§†ä¸ºç¨³å®šç‰ˆã€‚</li><li>1.0.0 çš„ç‰ˆæœ¬å·ç”¨äºç•Œå®šå…¬å…± API çš„å½¢æˆã€‚è¿™ä¸€ç‰ˆæœ¬ä¹‹åæ‰€æœ‰çš„ç‰ˆæœ¬å·æ›´æ–°éƒ½åŸºäºå…¬å…± API åŠå…¶ä¿®æ”¹å†…å®¹ã€‚</li><li><strong>ä¿®è®¢å·</strong> Zï¼ˆx.y.Z <code>|</code> x &gt; 0ï¼‰å¿…é¡»ï¼ˆMUSTï¼‰åœ¨åªåšäº†å‘ä¸‹å…¼å®¹çš„ä¿®æ­£æ—¶æ‰é€’å¢ã€‚è¿™é‡Œçš„ä¿®æ­£æŒ‡çš„æ˜¯é’ˆå¯¹ä¸æ­£ç¡®ç»“æœè€Œè¿›è¡Œçš„å†…éƒ¨ä¿®æ”¹ã€‚</li><li><strong>æ¬¡ç‰ˆæœ¬å·</strong> Yï¼ˆx.Y.z <code>|</code> x &gt; 0ï¼‰å¿…é¡»ï¼ˆMUSTï¼‰åœ¨æœ‰å‘ä¸‹å…¼å®¹çš„æ–°åŠŸèƒ½å‡ºç°æ—¶é€’å¢ã€‚åœ¨ä»»ä½•å…¬å…± API çš„åŠŸèƒ½è¢«æ ‡è®°ä¸ºå¼ƒç”¨æ—¶ä¹Ÿå¿…é¡»ï¼ˆMUSTï¼‰é€’å¢ã€‚ä¹Ÿå¯ä»¥ï¼ˆMAYï¼‰åœ¨å†…éƒ¨ç¨‹åºæœ‰å¤§é‡æ–°åŠŸèƒ½æˆ–æ”¹è¿›è¢«åŠ å…¥æ—¶é€’å¢ï¼Œå…¶ä¸­å¯ä»¥ï¼ˆMAYï¼‰åŒ…æ‹¬ä¿®è®¢çº§åˆ«çš„æ”¹å˜ã€‚æ¯å½“æ¬¡ç‰ˆæœ¬å·é€’å¢æ—¶ï¼Œä¿®è®¢å·å¿…é¡»ï¼ˆMUSTï¼‰å½’é›¶ã€‚</li><li><strong>ä¸»ç‰ˆæœ¬å·</strong> Xï¼ˆX.y.z <code>|</code> X &gt; 0ï¼‰å¿…é¡»ï¼ˆMUSTï¼‰åœ¨æœ‰ä»»ä½•ä¸å…¼å®¹çš„ä¿®æ”¹è¢«åŠ å…¥å…¬å…± API æ—¶é€’å¢ã€‚å…¶ä¸­å¯ä»¥ï¼ˆMAYï¼‰åŒ…æ‹¬æ¬¡ç‰ˆæœ¬å·åŠä¿®è®¢çº§åˆ«çš„æ”¹å˜ã€‚æ¯å½“ä¸»ç‰ˆæœ¬å·é€’å¢æ—¶ï¼Œæ¬¡ç‰ˆæœ¬å·å’Œä¿®è®¢å·å¿…é¡»ï¼ˆMUSTï¼‰å½’é›¶ã€‚</li><li><strong>å…ˆè¡Œç‰ˆæœ¬å·</strong>ï¼šå¯ä»¥ï¼ˆMAYï¼‰è¢«æ ‡æ³¨åœ¨ä¿®è®¢ç‰ˆä¹‹åï¼Œå…ˆåŠ ä¸Š<strong>ä¸€ä¸ªè¿æ¥å·</strong>å†åŠ ä¸Š<strong>ä¸€è¿ä¸²ä»¥å¥ç‚¹åˆ†éš”</strong>çš„æ ‡è¯†ç¬¦æ¥ä¿®é¥°ã€‚æ ‡è¯†ç¬¦å¿…é¡»ï¼ˆMUSTï¼‰ç”± ASCII å­—æ¯æ•°å­—å’Œè¿æ¥å· [0-9A-Za-z-] ç»„æˆï¼Œä¸”ç¦æ­¢ï¼ˆMUST NOTï¼‰ç•™ç™½ã€‚æ•°å­—å‹çš„æ ‡è¯†ç¬¦ç¦æ­¢ï¼ˆMUST NOTï¼‰åœ¨å‰æ–¹è¡¥é›¶ã€‚å…ˆè¡Œç‰ˆçš„ä¼˜å…ˆçº§ä½äºç›¸å…³è”çš„æ ‡å‡†ç‰ˆæœ¬ã€‚è¢«æ ‡ä¸Šå…ˆè¡Œç‰ˆæœ¬å·åˆ™è¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬å¹¶éç¨³å®šè€Œä¸”å¯èƒ½æ— æ³•æ»¡è¶³é¢„æœŸçš„å…¼å®¹æ€§éœ€æ±‚ã€‚èŒƒä¾‹ï¼š1.0.0-alphaã€1.0.0-alpha.1ã€1.0.0-0.3.7ã€1.0.0-x.7.z.92ã€‚</li><li><strong>ç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯</strong>å¯ä»¥ï¼ˆMAYï¼‰è¢«æ ‡æ³¨åœ¨ä¿®è®¢ç‰ˆæˆ–å…ˆè¡Œç‰ˆæœ¬å·ä¹‹åï¼Œå…ˆåŠ ä¸Š<strong>ä¸€ä¸ªåŠ å·</strong>å†åŠ ä¸Šä¸€è¿ä¸²ä»¥<strong>å¥ç‚¹åˆ†éš”</strong>çš„æ ‡è¯†ç¬¦æ¥ä¿®é¥°ã€‚æ ‡è¯†ç¬¦å¿…é¡»ï¼ˆMUSTï¼‰ç”± ASCII å­—æ¯æ•°å­—å’Œè¿æ¥å· [0-9A-Za-z-] ç»„æˆï¼Œä¸”ç¦æ­¢ï¼ˆMUST NOTï¼‰ç•™ç™½ã€‚å½“åˆ¤æ–­ç‰ˆæœ¬çš„ä¼˜å…ˆå±‚çº§æ—¶ï¼Œç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯å¯ï¼ˆSHOULDï¼‰è¢«å¿½ç•¥ã€‚å› æ­¤å½“ä¸¤ä¸ªç‰ˆæœ¬åªæœ‰åœ¨ç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯æœ‰å·®åˆ«æ—¶ï¼Œå±äºç›¸åŒçš„ä¼˜å…ˆå±‚çº§ã€‚èŒƒä¾‹ï¼š1.0.0-alpha+001ã€1.0.0+20130313144700ã€1.0.0-beta+exp.sha.5114f85ã€‚</li><li>ç‰ˆæœ¬çš„ä¼˜å…ˆå±‚çº§æŒ‡çš„æ˜¯ä¸åŒç‰ˆæœ¬åœ¨æ’åºæ—¶å¦‚ä½•æ¯”è¾ƒã€‚åˆ¤æ–­ä¼˜å…ˆå±‚çº§æ—¶ï¼Œå¿…é¡»ï¼ˆMUSTï¼‰æŠŠç‰ˆæœ¬ä¾åºæ‹†åˆ†ä¸ºä¸»ç‰ˆæœ¬å·ã€æ¬¡ç‰ˆæœ¬å·ã€ä¿®è®¢å·åŠå…ˆè¡Œç‰ˆæœ¬å·åè¿›è¡Œæ¯”è¾ƒï¼ˆç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯ä¸åœ¨è¿™ä»½æ¯”è¾ƒçš„åˆ—è¡¨ä¸­ï¼‰ã€‚ç”±å·¦åˆ°å³ä¾åºæ¯”è¾ƒæ¯ä¸ªæ ‡è¯†ç¬¦ï¼Œç¬¬ä¸€ä¸ªå·®å¼‚å€¼ç”¨æ¥å†³å®šä¼˜å…ˆå±‚çº§ï¼šä¸»ç‰ˆæœ¬å·ã€æ¬¡ç‰ˆæœ¬å·åŠä¿®è®¢å·ä»¥æ•°å€¼æ¯”è¾ƒï¼Œä¾‹å¦‚ï¼š1.0.0 &lt; 2.0.0 &lt; 2.1.0 &lt; 2.1.1ã€‚å½“ä¸»ç‰ˆæœ¬å·ã€æ¬¡ç‰ˆæœ¬å·åŠä¿®è®¢å·éƒ½ç›¸åŒæ—¶ï¼Œæ”¹ä»¥ä¼˜å…ˆå±‚çº§æ¯”è¾ƒä½çš„å…ˆè¡Œç‰ˆæœ¬å·å†³å®šã€‚ä¾‹å¦‚ï¼š1.0.0-alpha &lt; 1.0.0ã€‚æœ‰ç›¸åŒä¸»ç‰ˆæœ¬å·ã€æ¬¡ç‰ˆæœ¬å·åŠä¿®è®¢å·çš„ä¸¤ä¸ªå…ˆè¡Œç‰ˆæœ¬å·ï¼Œå…¶ä¼˜å…ˆå±‚çº§å¿…é¡»ï¼ˆMUSTï¼‰é€è¿‡ç”±å·¦åˆ°å³çš„æ¯ä¸ªè¢«å¥ç‚¹åˆ†éš”çš„æ ‡è¯†ç¬¦æ¥æ¯”è¾ƒï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªå·®å¼‚å€¼åå†³å®šï¼šåªæœ‰æ•°å­—çš„æ ‡è¯†ç¬¦ä»¥æ•°å€¼é«˜ä½æ¯”è¾ƒï¼Œæœ‰å­—æ¯æˆ–è¿æ¥å·æ—¶åˆ™é€å­—ä»¥ ASCII çš„æ’åºæ¥æ¯”è¾ƒã€‚æ•°å­—çš„æ ‡è¯†ç¬¦æ¯”éæ•°å­—çš„æ ‡è¯†ç¬¦ä¼˜å…ˆå±‚çº§ä½ã€‚è‹¥å¼€å¤´çš„æ ‡è¯†ç¬¦éƒ½ç›¸åŒæ—¶ï¼Œæ ä½æ¯”è¾ƒå¤šçš„å…ˆè¡Œç‰ˆæœ¬å·ä¼˜å…ˆå±‚çº§æ¯”è¾ƒé«˜ã€‚èŒƒä¾‹ï¼š1.0.0-alpha &lt; 1.0.0-alpha.1 &lt; 1.0.0-alpha.beta &lt; 1.0.0-beta &lt; 1.0.0-beta.2 &lt; 1.0.0-beta.11 &lt; 1.0.0-rc.1 &lt; 1.0.0ã€‚</li></ol><h2 id="faq"><a class="markdownIt-Anchor" href="#faq"></a> FAQ</h2><p><strong>åœ¨ 0.y.z åˆå§‹å¼€å‘é˜¶æ®µï¼Œæˆ‘è¯¥å¦‚ä½•è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Ÿ</strong></p><p>æœ€ç®€å•çš„åšæ³•æ˜¯ä»¥ 0.1.0 ä½œä¸ºä½ çš„åˆå§‹åŒ–å¼€å‘ç‰ˆæœ¬ï¼Œå¹¶åœ¨åç»­çš„æ¯æ¬¡å‘è¡Œæ—¶é€’å¢æ¬¡ç‰ˆæœ¬å·ã€‚</p><p><strong>å¦‚ä½•åˆ¤æ–­å‘å¸ƒ 1.0.0 ç‰ˆæœ¬çš„æ—¶æœºï¼Ÿ</strong></p><p>å½“ä½ çš„è½¯ä»¶è¢«ç”¨äºæ­£å¼ç¯å¢ƒï¼Œå®ƒåº”è¯¥å·²ç»è¾¾åˆ°äº† 1.0.0 ç‰ˆã€‚å¦‚æœä½ å·²ç»æœ‰ä¸ªç¨³å®šçš„ API è¢«ä½¿ç”¨è€…ä¾èµ–ï¼Œä¹Ÿä¼šæ˜¯ 1.0.0 ç‰ˆã€‚å¦‚æœä½ å¾ˆæ‹…å¿ƒå‘ä¸‹å…¼å®¹çš„é—®é¢˜ï¼Œä¹Ÿåº”è¯¥ç®—æ˜¯ 1.0.0 ç‰ˆäº†ã€‚</p><p><strong>è¿™ä¸ä¼šé˜»ç¢å¿«é€Ÿå¼€å‘å’Œè¿­ä»£å—ï¼Ÿ</strong></p><p>ä¸»ç‰ˆæœ¬å·ä¸ºé›¶çš„æ—¶å€™å°±æ˜¯ä¸ºäº†åšå¿«é€Ÿå¼€å‘ã€‚å¦‚æœä½ æ¯å¤©éƒ½åœ¨æ”¹å˜ APIï¼Œé‚£ä¹ˆä½ åº”è¯¥ä»åœ¨ä¸»ç‰ˆæœ¬å·ä¸ºé›¶çš„é˜¶æ®µï¼ˆ0.y.zï¼‰ï¼Œæˆ–æ˜¯æ­£åœ¨ä¸‹ä¸ªä¸»ç‰ˆæœ¬çš„ç‹¬ç«‹å¼€å‘åˆ†æ”¯ä¸­ã€‚</p><p><strong>å¯¹äºå…¬å…± APIï¼Œè‹¥å³ä½¿æ˜¯æœ€å°ä½†ä¸å‘ä¸‹å…¼å®¹çš„æ”¹å˜éƒ½éœ€è¦äº§ç”Ÿæ–°çš„ä¸»ç‰ˆæœ¬å·ï¼Œå²‚ä¸æ˜¯å¾ˆå¿«å°±è¾¾åˆ° 42.0.0 ç‰ˆï¼Ÿ</strong></p><p>è¿™æ˜¯å¼€å‘çš„è´£ä»»æ„Ÿå’Œå‰ç»æ€§çš„é—®é¢˜ã€‚ä¸å…¼å®¹çš„æ”¹å˜ä¸åº”è¯¥è½»æ˜“è¢«åŠ å…¥åˆ°æœ‰è®¸å¤šä¾èµ–ä»£ç çš„è½¯ä»¶ä¸­ã€‚å‡çº§æ‰€ä»˜å‡ºçš„ä»£ä»·å¯èƒ½æ˜¯å·¨å¤§çš„ã€‚è¦é€’å¢ä¸»ç‰ˆæœ¬å·æ¥å‘è¡Œä¸å…¼å®¹çš„æ”¹ç‰ˆï¼Œæ„å‘³ç€ä½ å¿…é¡»ä¸ºè¿™äº›æ”¹å˜æ‰€å¸¦æ¥çš„å½±å“æ·±æ€ç†Ÿè™‘ï¼Œå¹¶ä¸”è¯„ä¼°æ‰€æ¶‰åŠçš„æˆæœ¬åŠæ•ˆç›Šæ¯”ã€‚</p><p><strong>ä¸ºæ•´ä¸ªå…¬å…± API å†™æ–‡ä»¶å¤ªè´¹äº‹äº†ï¼</strong></p><p>ä¸ºä¾›ä»–äººä½¿ç”¨çš„è½¯ä»¶ç¼–å†™é€‚å½“çš„æ–‡ä»¶ï¼Œæ˜¯ä½ ä½œä¸ºä¸€åä¸“ä¸šå¼€å‘è€…åº”å°½çš„èŒè´£ã€‚ä¿æŒä¸“æ¡ˆé«˜æ•ˆä¸€ä¸ªéå¸¸é‡è¦çš„éƒ¨ä»½æ˜¯æŒæ§è½¯ä»¶çš„å¤æ‚åº¦ï¼Œå¦‚æœæ²¡æœ‰äººçŸ¥é“å¦‚ä½•ä½¿ç”¨ä½ çš„è½¯ä»¶æˆ–ä¸çŸ¥é“å“ªäº›å‡½æ•°çš„è°ƒç”¨æ˜¯å¯é çš„ï¼Œè¦æŒæ§å¤æ‚åº¦ä¼šæ˜¯å›°éš¾çš„ã€‚é•¿è¿œæ¥çœ‹ï¼Œä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶ä»¥åŠå¯¹äºå…¬å…± API æœ‰è‰¯å¥½è§„èŒƒçš„åšæŒï¼Œå¯ä»¥è®©æ¯ä¸ªäººåŠæ¯ä»¶äº‹éƒ½è¿è¡Œé¡ºç•…ã€‚</p><p><strong>ä¸‡ä¸€ä¸å°å¿ƒæŠŠä¸€ä¸ªä¸å…¼å®¹çš„æ”¹ç‰ˆå½“æˆäº†æ¬¡ç‰ˆæœ¬å·å‘è¡Œäº†è¯¥æ€ä¹ˆåŠï¼Ÿ</strong></p><p>ä¸€æ—¦å‘ç°è‡ªå·±ç ´åäº†è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶çš„è§„èŒƒï¼Œå°±è¦ä¿®æ­£è¿™ä¸ªé—®é¢˜ï¼Œå¹¶å‘è¡Œä¸€ä¸ªæ–°çš„æ¬¡ç‰ˆæœ¬å·æ¥æ›´æ­£è¿™ä¸ªé—®é¢˜å¹¶ä¸”æ¢å¤å‘ä¸‹å…¼å®¹ã€‚å³ä½¿æ˜¯è¿™ç§æƒ…å†µï¼Œä¹Ÿä¸èƒ½å»ä¿®æ”¹å·²å‘è¡Œçš„ç‰ˆæœ¬ã€‚å¯ä»¥çš„è¯ï¼Œå°†æœ‰é—®é¢˜çš„ç‰ˆæœ¬å·è®°å½•åˆ°æ–‡ä»¶ä¸­ï¼Œå‘Šè¯‰ä½¿ç”¨è€…é—®é¢˜æ‰€åœ¨ï¼Œè®©ä»–ä»¬èƒ½å¤Ÿæ„è¯†åˆ°è¿™æ˜¯æœ‰é—®é¢˜çš„ç‰ˆæœ¬ã€‚</p><p><strong>å¦‚æœæˆ‘æ›´æ–°äº†è‡ªå·±çš„ä¾èµ–ä½†æ²¡æœ‰æ”¹å˜å…¬å…± API è¯¥æ€ä¹ˆåŠï¼Ÿ</strong></p><p>ç”±äºæ²¡æœ‰å½±å“åˆ°å…¬å…± APIï¼Œè¿™å¯ä»¥è¢«è®¤å®šæ˜¯å…¼å®¹çš„ã€‚è‹¥æŸä¸ªè½¯ä»¶å’Œä½ çš„åŒ…æœ‰å…±åŒä¾èµ–ï¼Œåˆ™å®ƒä¼šæœ‰è‡ªå·±çš„ä¾èµ–è§„èŒƒï¼Œä½œè€…ä¹Ÿä¼šå‘ŠçŸ¥å¯èƒ½çš„å†²çªã€‚è¦åˆ¤æ–­æ”¹ç‰ˆæ˜¯å±äºä¿®è®¢ç­‰çº§æˆ–æ˜¯æ¬¡ç‰ˆç­‰çº§ï¼Œæ˜¯ä¾æ®ä½ æ›´æ–°çš„ä¾èµ–å…³ç³»æ˜¯ä¸ºäº†ä¿®å¤é—®é¢˜æˆ–æ˜¯åŠ å…¥æ–°åŠŸèƒ½ã€‚å¯¹äºåè€…ï¼Œæˆ‘ç»å¸¸ä¼šé¢„æœŸä¼´éšç€æ›´å¤šçš„ä»£ç ï¼Œè¿™æ˜¾ç„¶ä¼šæ˜¯ä¸€ä¸ªæ¬¡ç‰ˆæœ¬å·çº§åˆ«çš„é€’å¢ã€‚</p><p><strong>å¦‚æœæˆ‘å˜æ›´äº†å…¬å…± API ä½†æ— æ„ä¸­æœªéµå¾ªç‰ˆæœ¬å·çš„æ”¹åŠ¨æ€ä¹ˆåŠå‘¢ï¼Ÿï¼ˆæ„å³åœ¨ä¿®è®¢ç­‰çº§çš„å‘å¸ƒä¸­ï¼Œè¯¯å°†é‡å¤§ä¸”ä¸å…¼å®¹çš„æ”¹å˜åŠ åˆ°ä»£ç ä¹‹ä¸­ï¼‰</strong></p><p>è‡ªè¡Œåšæœ€ä½³çš„åˆ¤æ–­ã€‚å¦‚æœä½ æœ‰åºå¤§çš„ä½¿ç”¨è€…ç¾¤åœ¨ä¾ç…§å…¬å…± API çš„æ„å›¾è€Œå˜æ›´è¡Œä¸ºåä¼šå¤§å—å½±å“ï¼Œé‚£ä¹ˆæœ€å¥½åšä¸€æ¬¡ä¸»ç‰ˆæœ¬çš„å‘å¸ƒï¼Œå³ä½¿ä¸¥æ ¼æ¥è¯´è¿™ä¸ªä¿®å¤ä»…æ˜¯ä¿®è®¢ç­‰çº§çš„å‘å¸ƒã€‚è®°ä½ï¼Œ è¯­ä¹‰åŒ–çš„ç‰ˆæœ¬æ§åˆ¶å°±æ˜¯é€è¿‡ç‰ˆæœ¬å·çš„æ”¹å˜æ¥ä¼ è¾¾æ„ä¹‰ã€‚è‹¥è¿™äº›æ”¹å˜å¯¹ä½ çš„ä½¿ç”¨è€…æ˜¯é‡è¦çš„ï¼Œé‚£å°±é€è¿‡ç‰ˆæœ¬å·æ¥å‘ä»–ä»¬è¯´æ˜ã€‚</p><p><strong>æˆ‘è¯¥å¦‚ä½•å¤„ç†å³å°†å¼ƒç”¨çš„åŠŸèƒ½ï¼Ÿ</strong></p><p>å¼ƒç”¨ç°å­˜çš„åŠŸèƒ½æ˜¯è½¯ä»¶å¼€å‘ä¸­çš„å®¶å¸¸ä¾¿é¥­ï¼Œä¹Ÿé€šå¸¸æ˜¯å‘å‰å‘å±•æ‰€å¿…é¡»çš„ã€‚å½“ä½ å¼ƒç”¨éƒ¨ä»½å…¬å…± API æ—¶ï¼Œä½ åº”è¯¥åšä¸¤ä»¶äº‹ï¼šï¼ˆ1ï¼‰æ›´æ–°ä½ çš„æ–‡ä»¶è®©ä½¿ç”¨è€…çŸ¥é“è¿™ä¸ªæ”¹å˜ï¼Œï¼ˆ2ï¼‰åœ¨é€‚å½“çš„æ—¶æœºå°†å¼ƒç”¨çš„åŠŸèƒ½é€è¿‡æ–°çš„æ¬¡ç‰ˆæœ¬å·å‘å¸ƒã€‚åœ¨æ–°çš„ä¸»ç‰ˆæœ¬å®Œå…¨ç§»é™¤å¼ƒç”¨åŠŸèƒ½å‰ï¼Œè‡³å°‘è¦æœ‰ä¸€ä¸ªæ¬¡ç‰ˆæœ¬åŒ…å«è¿™ä¸ªå¼ƒç”¨ä¿¡æ¯ï¼Œè¿™æ ·ä½¿ç”¨è€…æ‰èƒ½å¹³é¡ºåœ°è½¬ç§»åˆ°æ–°ç‰ˆ APIã€‚</p><p><strong>è¯­ä¹‰åŒ–ç‰ˆæœ¬å¯¹äºç‰ˆæœ¬çš„å­—ä¸²é•¿åº¦æ˜¯å¦æœ‰é™åˆ¶å‘¢ï¼Ÿ</strong></p><p>æ²¡æœ‰ï¼Œè¯·è‡ªè¡Œåšé€‚å½“çš„åˆ¤æ–­ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œé•¿åˆ° 255 ä¸ªå­—å…ƒçš„ç‰ˆæœ¬å·²è¿‡åº¦å¤¸å¼ ã€‚å†è€…ï¼Œç‰¹å®šçš„ç³»ç»Ÿå¯¹äºå­—ä¸²é•¿åº¦å¯èƒ½ä¼šæœ‰ä»–ä»¬è‡ªå·±çš„é™åˆ¶ã€‚</p><h2 id="ç‰ˆæœ¬alpha-beta-rc"><a class="markdownIt-Anchor" href="#ç‰ˆæœ¬alpha-beta-rc"></a> ç‰ˆæœ¬ï¼šAlphaã€betaã€RC</h2><blockquote><p>è¿™äº›å«åšå…ˆè¡Œç‰ˆæœ¬å·ã€‚è¢«æ ‡æ³¨åœ¨ä¿®è®¢ç‰ˆä¹‹åï¼Œå…ˆåŠ ä¸Šä¸€ä¸ªè¿æ¥å·å†åŠ ä¸Šä¸€è¿ä¸²ä»¥å¥ç‚¹åˆ†éš”çš„æ ‡è¯†ç¬¦æ¥ä¿®é¥°ï¼Œå¦‚1.0.0-alphaã€1.0.0-alpha.1ã€1.0.0-0.3.7ã€1.0.0-x.7.z.92</p></blockquote><p>å¸¸è§çš„ RC ç‰ˆæœ¬ï¼Œå…¨ç§°æ˜¯ Release Candidateã€‚å…¶ä¸­ Release æ˜¯å‘è¡Œã€å‘å¸ƒçš„æ„æ€ã€‚Candidate æ˜¯å€™é€‰äººçš„æ„æ€ï¼Œç”¨åœ¨è½¯ä»¶æˆ–è€…æ“ä½œç³»ç»Ÿä¸Šå°±æ˜¯å€™é€‰ç‰ˆæœ¬ã€‚å› æ­¤ Release Candidate å°±æ˜¯å‘è¡Œå€™é€‰ç‰ˆæœ¬ã€‚</p><table><thead><tr><th>ç‰ˆæœ¬åç§°</th><th>ä»‹ç»</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Alpha</td><td>å†…æµ‹ç‰ˆæœ¬</td><td>å†…éƒ¨æµ‹è¯•ç‰ˆæœ¬ã€‚</td></tr><tr><td>Beta</td><td>å…¬æµ‹ç‰ˆæœ¬</td><td>Beta é˜¶æ®µä¼šä¸€ç›´åŠ å…¥æ–°çš„åŠŸèƒ½ã€‚</td></tr><tr><td>RC</td><td>å€™é€‰ç‰ˆæœ¬</td><td>å‡ ä¹å°±ä¸ä¼šåŠ å…¥æ–°çš„åŠŸèƒ½äº†ï¼Œè€Œä¸»è¦ç€é‡äºé™¤é”™ã€‚</td></tr><tr><td>Release</td><td>æ­£å¼ç‰ˆæœ¬</td><td>ç¨³å®šç‰ˆæœ¬ã€‚</td></tr></tbody></table><p>RC ç‰ˆæœ¬å’Œ Beta ç‰ˆæœ€å¤§çš„å·®åˆ«åœ¨äº Beta é˜¶æ®µä¼š<strong>ä¸€ç›´åŠ å…¥æ–°çš„åŠŸèƒ½</strong>ï¼Œä½†æ˜¯åˆ°äº† RC é˜¶æ®µï¼Œå‡ ä¹å°±ä¸ä¼šåŠ å…¥æ–°çš„åŠŸèƒ½äº†ï¼Œè€Œä¸»è¦ç€é‡äº<strong>é™¤é”™</strong>ã€‚</p><p>RC ç‰ˆæœ¬ï¼Œå®ƒä¸æ˜¯æœ€ç»ˆçš„ç‰ˆæœ¬ï¼Œè€Œæ˜¯æœ€ç»ˆç‰ˆï¼ˆRTMï¼ŒRelease To Manufactureï¼‰ä¹‹å‰çš„æœ€åä¸€ä¸ªç‰ˆæœ¬ã€‚å¹¿ä¹‰ä¸Šå¯¹æµ‹è¯•æœ‰ä¸‰ä¸ªä¼ ç»Ÿçš„ç§°å‘¼ï¼šAlphaï¼ˆÎ±ï¼‰ã€Betaï¼ˆÎ²ï¼‰ã€Gammaï¼ˆÎ³ï¼‰ï¼Œç”¨æ¥æ ‡è¯†æµ‹è¯•çš„é˜¶æ®µå’ŒèŒƒå›´ã€‚Alpha æ˜¯æŒ‡å†…æµ‹ï¼Œå³ç°åœ¨è¯´çš„ CBï¼ŒæŒ‡å¼€å‘å›¢é˜Ÿå†…éƒ¨æµ‹è¯•çš„ç‰ˆæœ¬æˆ–è€…æœ‰é™ç”¨æˆ·ä½“éªŒæµ‹è¯•ç‰ˆæœ¬ã€‚Beta æ˜¯æŒ‡å…¬æµ‹ï¼Œå³é’ˆå¯¹æ‰€æœ‰ç”¨æˆ·å…¬å¼€çš„æµ‹è¯•ç‰ˆæœ¬ã€‚ç„¶ååšè¿‡ä¸€äº›ä¿®æ”¹ï¼Œæˆä¸ºæ­£å¼å‘å¸ƒçš„å€™é€‰ç‰ˆæœ¬æ—¶å«åš Gammaï¼Œç°åœ¨å«åš RCã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è¯­ä¹‰åŒ–çš„ç‰ˆæœ¬æ§åˆ¶ï¼š ç”¨ä¸€ç»„ç®€å•çš„è§„åˆ™åŠæ¡ä»¶æ¥çº¦æŸç‰ˆæœ¬å·çš„é…ç½®å’Œå¢é•¿&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä½œä¸ºä¸€ä½è´Ÿè´£ä»»çš„å¼€å‘è€…ï¼Œä½ ç†å½“ç¡®ä¿æ¯æ¬¡åŒ…å‡çº§çš„è¿ä½œä¸ç‰ˆæœ¬å·çš„è¡¨è¿°ä¸€è‡´ã€‚ç°å®ä¸–ç•Œæ˜¯å¤æ‚çš„ï¼Œæˆ‘ä»¬é™¤äº†æé«˜è­¦è§‰å¤–èƒ½åšçš„ä¸å¤šã€‚ä½ æ‰€èƒ½åšçš„å°±æ˜¯è®©è¯­ä¹‰åŒ–çš„ç‰ˆæœ¬æ§åˆ¶ä¸ºä½ æä¾›ä¸€ä¸ªå¥å…¨
      
    
    </summary>
    
    
      <category term="è®¡ç®—æœºåŸºç¡€çŸ¥è¯†" scheme="https://nymrli.top/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>Springboot-Kotlin-Mockito</title>
    <link href="https://nymrli.top/2022/01/03/Springboot-Kotlin-Mockito/"/>
    <id>https://nymrli.top/2022/01/03/Springboot-Kotlin-Mockito/</id>
    <published>2022-01-03T09:19:10.000Z</published>
    <updated>2022-01-03T10:50:45.305Z</updated>
    
    <content type="html"><![CDATA[<p>åˆè¯† Mockito è¿™ä¸ªæµ‹è¯•æ¡†æ¶åï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ Mock çš„å±æ€§åˆ›å»ºä¸€ä¸ªè¢«æµ‹è¯•ç±»å®ä¾‹æ—¶ï¼Œå¤§æ¦‚ä¼šä¸‹é¢è¿™ä¹ˆçº¯æ‰‹å·¥æ¥æ‰“é€ ã€‚</p><p>æ‰‹å·¥è¿‡ç¨‹è§: <a href="https://www.jianshu.com/p/bb705a56f620" target="_blank" rel="noopener">https://www.jianshu.com/p/bb705a56f620</a></p><p>å¦‚æœæ‰€æœ‰çš„ Mock å¯¹è±¡å…¨éƒ¨é€šè¿‡æ‰‹å·¥æ¥åˆ›å»ºï¼Œé‚£å°±ä¸å®¹æ˜“ä½“ç°å‡º Mockito çš„ä¼˜è¶Šæ€§å‡ºæ¥ã€‚å› æ­¤å¯¹äºè¢«æµ‹è¯•å¯¹è±¡çš„åˆ›å»ºï¼ŒMock å±æ€§çš„æ³¨å…¥åº”è¯¥è®© @Mock å’Œ @InjectMocksè¿™ä¸¤ä¸ªæ³¨è§£å¤§æ˜¾èº«æ‰‹äº†ã€‚</p><h2 id="mockitoèƒ½åŠ›"><a class="markdownIt-Anchor" href="#mockitoèƒ½åŠ›"></a> Mockitoèƒ½åŠ›</h2><ul><li>@Mockï¼šå¯¹å‡½æ•°çš„è°ƒç”¨å‡æ‰§è¡Œmockï¼ˆå³è™šå‡å‡½æ•°ï¼‰ï¼Œä¸æ‰§è¡ŒçœŸæ­£éƒ¨åˆ†ã€‚</li><li>@Spyï¼šå¯¹å‡½æ•°çš„è°ƒç”¨å‡æ‰§è¡ŒçœŸæ­£éƒ¨åˆ†ã€‚</li><li>@InjectMocksï¼šåˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œå…¶ä½™ç”¨@Mockï¼ˆæˆ–@Spyï¼‰æ³¨è§£åˆ›å»ºçš„mockå°†è¢«æ³¨å…¥åˆ°ç”¨è¯¥å®ä¾‹ä¸­ã€‚</li></ul><p>@Autowird æ–¹å¼æ˜¯åŸºäºSpringbootæ¡†æ¶å¯åŠ¨çš„è‡ªåŠ¨æ³¨å…¥ã€‚åœ¨å•å…ƒæµ‹è¯•ä¸­ï¼Œå¦‚æœæ²¡æœ‰å¯åŠ¨ spring æ¡†æ¶ï¼Œæ­¤æ—¶å°±éœ€è¦é€šè¿‡ @ InjectMockså®Œæˆä¾èµ–æ³¨å…¥ï¼š @InjectMocksä¼šå°†å¸¦æœ‰@Spy å’Œ@Mock æ³¨è§£çš„å¯¹è±¡å°è¯•æ³¨å…¥åˆ°è¢« æµ‹è¯•çš„ç›®æ ‡ç±»ä¸­ã€‚è®°ä½ä¸‹é¢è¿™ä¸¤å¥è¯å³å¯ï¼š</p><ul><li>Usually when you are unit testing, you shouldnâ€™t initialize Spring context. So remove Autowiring.</li><li>Usually when you do integration testing, you should use real dependencies. So remove mocking.</li></ul><p>è¿™è¾¹ä¹Ÿè§£é‡Šäº†ï¼Œ<code>@RunWith(MockitoJUnitRunner::class)</code>çš„å«ä¹‰ï¼Œå…¶å®æ˜¯ç»™ä¸‹é¢Mockitoæ³¨å…¥çš„æˆå‘˜æä¾›ä¸€ä¸ªè¿è¡Œç¯å¢ƒï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨<code>@SpringBootTest</code>çš„åŸå› ä¸»è¦è¿˜æ˜¯å¯åŠ¨å¤ªå¤šï¼Œè¿è¡Œå¤ªé‡çš„è€ƒè™‘ã€‚é‚£ä»€ä¹ˆæ—¶å€™å¾—ç”¨<code>@SpringBootTest</code>å‘¢ï¼Ÿâ€”â€”æœ€ç®€å•çš„æƒ…å†µï¼Œå³è¦æ³¨å…¥controlleråˆè¦æ³¨å…¥serviceï¼ŒåŒæ—¶éœ€è¦<code>@mock</code>å­˜å‚¨å±‚çš„repositoryï¼Œç”±äºcontrollerå’Œserviceéƒ½éœ€è¦æ ‡æ³¨<code>@InjectMocks</code>, ä½†<strong>InjectMockså­—æ®µæ˜¯æ— æ³•æ³¨å…¥å…¶ä»–InjectMockså­—æ®µçš„</strong>ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨Springæ¥åšå®¹å™¨ç®¡ç†ã€‚</p><h2 id="mockå’ŒmockbeanåŒºåˆ«"><a class="markdownIt-Anchor" href="#mockå’ŒmockbeanåŒºåˆ«"></a> <code>@Mock</code>å’Œ<code>@MockBean</code>åŒºåˆ«</h2><p><strong>MockBean</strong>çš„ä»‹ç»ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åœ¨åšå•å…ƒæµ‹è¯•æ—¶ï¼Œå¦‚æœæƒ³è¦ mock UserRepository çš„é€»è¾‘ï¼Œåªéœ€è¦å£°æ˜ä¸€ä¸ªå˜é‡å¹¶åœ¨ä¸Šé¢åŠ ä¸Š @MockBean çš„æ³¨é‡Šå³å¯ï¼Œ</span><br><span class="line">ä¹‹åä½¿ç”¨ when().thenReturn() æ¥è®¾å®š mock UserRepository çš„è¡Œä¸ºã€‚</span><br><span class="line">åœ¨è¿è¡Œæ—¶ SpringBoot ä¼šæ‰«æåˆ°ä½ æ³¨é‡Šçš„ mock ï¼Œå¹¶è‡ªåŠ¨è£…é…åˆ°è¢«æµ‹è¯•çš„ controller é‡Œé¢ã€‚</span><br><span class="line">è¿™ä¹Ÿæ˜¯å’Œ @Mock æ³¨é‡Šä¸åŒçš„åœ°æ–¹ï¼Œåè€…åªèƒ½ç”Ÿæˆä¸€ä¸ª Mock ç±»ï¼Œä½†æ˜¯å¹¶ä¸èƒ½è‡ªåŠ¨è£…é…åˆ°å…¶å®ƒç±»é‡Œé¢ã€‚</span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œ<code>@Mock</code>æ–¹ä¾¿æ¥åšå•å…ƒæµ‹è¯•ï¼Œ<code>@MockBean</code>å¤§å¤šç”¨æ¥åšæœ‰ä¾èµ–å…³ç³»çš„é›†æˆæµ‹è¯•</p><h2 id="vertify"><a class="markdownIt-Anchor" href="#vertify"></a> vertify</h2><blockquote><p>éªŒè¯è¡Œä¸ºæ˜¯å¦å‘ç”Ÿ</p></blockquote><p><strong>verifyæ–¹æ³•ç”¨äºéªŒè¯ mock bean çš„æ–¹æ³•è°ƒç”¨ï¼Œè¦æ±‚å¿…é¡»æ˜¯mockå¯¹è±¡</strong></p><ul><li><code>Mockito . *verify* (mockBean ).someMethod();</code>è¡¨ç¤ºï¼šsomeMethodæ–¹æ³•è°ƒç”¨äº†ä¸€æ¬¡ï¼Œç›¸å½“äºtimes(1)</li><li><code>Mockito . *verify* (mock Bean, Mockito.times(n) ).someMethod();</code>è¡¨ç¤ºï¼šsomeMethodæ–¹æ³•è°ƒç”¨äº†næ¬¡</li><li><code>Mockito . *verify* (mock Bean, Mockito.never() ).someMethod();</code>è¡¨ç¤ºï¼šsomeMethodæ–¹æ³•æœªæ‰§è¡Œ</li><li><code>Mockito . *verify* (mock Bean, Mockito. atLeastOnce() ).someMethod();</code>è¡¨ç¤ºï¼šsomeMethodæ–¹æ³•è‡³å°‘æ‰§è¡Œè¿‡ä¸€æ¬¡,ç›¸å½“äºatLeast(1)</li></ul><p><strong>éœ€è¦æ³¨æ„çš„ï¼š</strong><code>Mockito.*verify* (mock Bean, Mockito.only() ).someMethod();</code>è¡¨ç¤ºï¼š <strong>ä»…æœ‰someMethodæ–¹æ³•æ‰§è¡Œï¼Œä¸”åªæœ‰ä¸€æ¬¡ï¼Œä¸èƒ½æœ‰å…¶ä»–æ–¹æ³•æ‰§è¡Œ</strong></p><p>more: <a href="https://www.jianshu.com/p/0e6a868b9da0" target="_blank" rel="noopener">https://www.jianshu.com/p/0e6a868b9da0</a></p><h2 id="å¸¸ç”¨çš„-mockito-æ–¹æ³•"><a class="markdownIt-Anchor" href="#å¸¸ç”¨çš„-mockito-æ–¹æ³•"></a> å¸¸ç”¨çš„ Mockito æ–¹æ³•ï¼š</h2><p>Mockitoçš„ä½¿ç”¨ï¼Œä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ç§ç»„åˆï¼šå‚è€ƒé“¾æ¥</p><p>do/whenï¼šåŒ…æ‹¬doThrow(â€¦).when(â€¦)/doReturn(â€¦).when(â€¦)/doAnswer(â€¦).when(â€¦)<br>given/willï¼šåŒ…æ‹¬given(â€¦).willReturn(â€¦)/given(â€¦).willAnswer(â€¦)<br>when/then: åŒ…æ‹¬when(â€¦).thenReturn(â€¦)/when(â€¦).thenAnswer(â€¦)</p><table><thead><tr><th><strong>æ–¹æ³•å</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>Mockito.mock(classToMock)</td><td>æ¨¡æ‹Ÿå¯¹è±¡</td></tr><tr><td>Mockito.verify(mock)</td><td>éªŒè¯è¡Œä¸ºæ˜¯å¦å‘ç”Ÿ</td></tr><tr><td>Mockito.when(methodCall).thenReturn(value1).thenReturn(value2)</td><td>è§¦å‘æ—¶ç¬¬ä¸€æ¬¡è¿”å›value1ï¼Œç¬¬næ¬¡éƒ½è¿”å›value2</td></tr><tr><td>Mockito.doThrow(toBeThrown).when(mock).[method]</td><td>æ¨¡æ‹ŸæŠ›å‡ºå¼‚å¸¸ã€‚</td></tr><tr><td>Mockito.mock(classToMock,defaultAnswer)</td><td>ä½¿ç”¨é»˜è®¤Answeræ¨¡æ‹Ÿå¯¹è±¡</td></tr><tr><td>Mockito.when(methodCall).thenReturn(value)</td><td>å‚æ•°åŒ¹é…</td></tr><tr><td>Mockito.doReturn(toBeReturned).when(mock).[method]</td><td>å‚æ•°åŒ¹é…ï¼ˆç›´æ¥æ‰§è¡Œä¸åˆ¤æ–­ï¼‰</td></tr><tr><td>Mockito.when(methodCall).thenAnswer(answer))</td><td>é¢„æœŸå›è°ƒæ¥å£ç”ŸæˆæœŸæœ›å€¼</td></tr><tr><td>Mockito.doAnswer(answer).when(methodCall).[method]</td><td>é¢„æœŸå›è°ƒæ¥å£ç”ŸæˆæœŸæœ›å€¼ï¼ˆç›´æ¥æ‰§è¡Œä¸åˆ¤æ–­ï¼‰</td></tr><tr><td>Mockito.spy(Object)</td><td>ç”¨spyç›‘æ§çœŸå®å¯¹è±¡,è®¾ç½®çœŸå®å¯¹è±¡è¡Œä¸º</td></tr><tr><td>Mockito.doNothing().when(mock).[method]</td><td>ä¸åšä»»ä½•è¿”å›</td></tr><tr><td>Mockito.doCallRealMethod().when(mock).[method] <a href="//xn--Mockito-lr4ko4ay553a.when">//ç­‰ä»·äºMockito.when</a>(mock.[method]).thenCallRealMethod();</td><td>è°ƒç”¨çœŸå®çš„æ–¹æ³•</td></tr><tr><td>reset(mock)</td><td>é‡ç½®mock</td></tr></tbody></table><h2 id="matchers"><a class="markdownIt-Anchor" href="#matchers"></a> Matchers</h2><ul><li><p>åŒ¹é…ä»»æ„å‚æ•°</p></li><li><p><code>Mockito.anyInt()</code> ä»»ä½• int å€¼ ï¼›</p></li><li><p><code>Mockito.anyLong()</code> ä»»ä½• long å€¼ ï¼›</p></li><li><p><code>Mockito.anyString()</code> ä»»ä½• String å€¼ ï¼›</p></li><li><p><code>Mockito.any(XXX.class)</code> ä»»ä½• XXX ç±»å‹çš„å€¼ ç­‰ç­‰ã€‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">with_unspecified_arguments</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List list = Mockito.mock(List.class);</span><br><span class="line">    <span class="comment">//åŒ¹é…ä»»æ„å‚æ•°</span></span><br><span class="line">    Mockito.when(list.get(Mockito.anyInt())).thenReturn(<span class="number">1</span>);</span><br><span class="line">    Mockito.when(list.contains(Mockito.argThat(<span class="keyword">new</span> IsValid()))).thenReturn(<span class="keyword">true</span>);</span><br><span class="line">    Assert.assertEquals(<span class="number">1</span>,list.get(<span class="number">1</span>));</span><br><span class="line">    Assert.assertEquals(<span class="number">1</span>,list.get(<span class="number">999</span>));</span><br><span class="line">    Assert.assertTrue(list.contains(<span class="number">1</span>));</span><br><span class="line">    Assert.assertTrue(!list.contains(<span class="number">3</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IsValid</span> <span class="keyword">extends</span> <span class="title">ArgumentMatcher</span>&lt;<span class="title">List</span>&gt;</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> obj.equals(<span class="number">1</span>) || obj.equals(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Moreï¼š</p><table><thead><tr><th style="text-align:left">å‡½æ•°å</th><th style="text-align:left">åŒ¹é…ç±»å‹</th></tr></thead><tbody><tr><td style="text-align:left">any()</td><td style="text-align:left">æ‰€æœ‰å¯¹è±¡ç±»å‹</td></tr><tr><td style="text-align:left">anyInt()</td><td style="text-align:left">åŸºæœ¬ç±»å‹ intã€é null çš„ Integer ç±»å‹</td></tr><tr><td style="text-align:left">anyChar()</td><td style="text-align:left">åŸºæœ¬ç±»å‹ charã€é null çš„ Character ç±»å‹</td></tr><tr><td style="text-align:left">anyShort()</td><td style="text-align:left">åŸºæœ¬ç±»å‹ shortã€é null çš„ Short ç±»å‹</td></tr><tr><td style="text-align:left">anyBoolean()</td><td style="text-align:left">åŸºæœ¬ç±»å‹ booleanã€é null çš„ Boolean ç±»å‹</td></tr><tr><td style="text-align:left">anyDouble()</td><td style="text-align:left">åŸºæœ¬ç±»å‹ doubleã€é null çš„ Double ç±»å‹</td></tr><tr><td style="text-align:left">anyFloat()</td><td style="text-align:left">åŸºæœ¬ç±»å‹ floatã€é null çš„ Float ç±»å‹</td></tr><tr><td style="text-align:left">anyLong()</td><td style="text-align:left">åŸºæœ¬ç±»å‹ longã€é null çš„ Long ç±»å‹</td></tr><tr><td style="text-align:left">anyByte()</td><td style="text-align:left">åŸºæœ¬ç±»å‹ byteã€é null çš„ Byte ç±»å‹</td></tr><tr><td style="text-align:left">anyString()</td><td style="text-align:left">String ç±»å‹(ä¸èƒ½æ˜¯ null)</td></tr><tr><td style="text-align:left">anyList()</td><td style="text-align:left">List<t> ç±»å‹(ä¸èƒ½æ˜¯ null)</t></td></tr><tr><td style="text-align:left">anyMap()</td><td style="text-align:left">Map&lt;K, V&gt;ç±»å‹(ä¸èƒ½æ˜¯ null)</td></tr></tbody></table><h1 id="é™„å½•"><a class="markdownIt-Anchor" href="#é™„å½•"></a> é™„å½•</h1><h2 id="junitä¸­çš„åŸºæœ¬æ³¨è§£"><a class="markdownIt-Anchor" href="#junitä¸­çš„åŸºæœ¬æ³¨è§£"></a> Junitä¸­çš„åŸºæœ¬æ³¨è§£ï¼š</h2><p>@Testï¼šä½¿ç”¨è¯¥æ³¨è§£æ ‡æ³¨çš„public voidæ–¹æ³•ä¼šè¡¨ç¤ºä¸ºä¸€ä¸ªæµ‹è¯•æ–¹æ³•ï¼›<br>@BeforeClassï¼šè¡¨ç¤ºåœ¨ç±»ä¸­çš„ä»»æ„public static voidæ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œï¼›<br>@AfterClassï¼šè¡¨ç¤ºåœ¨ç±»ä¸­çš„ä»»æ„public static voidæ–¹æ³•ä¹‹åæ‰§è¡Œï¼›<br>@Beforeï¼šè¡¨ç¤ºåœ¨ä»»æ„ä½¿ç”¨@Testæ³¨è§£æ ‡æ³¨çš„public voidæ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œï¼›<br>@Afterï¼šè¡¨ç¤ºåœ¨ä»»æ„ä½¿ç”¨@Testæ³¨è§£æ ‡æ³¨çš„public voidæ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œï¼›</p><p>demoï¼š</p><ul><li><a href="https://github.com/enesacikoglu/SpringBootKotlinApi/blob/master/src/test/kotlin/com/cengenes/kotlin/api/service/HotelServiceManagerTest.kt" target="_blank" rel="noopener">https://github.com/enesacikoglu/SpringBootKotlinApi/blob/master/src/test/kotlin/com/cengenes/kotlin/api/service/HotelServiceManagerTest.kt</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åˆè¯† Mockito è¿™ä¸ªæµ‹è¯•æ¡†æ¶åï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ Mock çš„å±æ€§åˆ›å»ºä¸€ä¸ªè¢«æµ‹è¯•ç±»å®ä¾‹æ—¶ï¼Œå¤§æ¦‚ä¼šä¸‹é¢è¿™ä¹ˆçº¯æ‰‹å·¥æ¥æ‰“é€ ã€‚&lt;/p&gt;
&lt;p&gt;æ‰‹å·¥è¿‡ç¨‹è§: &lt;a href=&quot;https://www.jianshu.com/p/bb705a56f620&quot; target=&quot;_blank
      
    
    </summary>
    
    
      <category term="å¼€å‘ç¬”è®°" scheme="https://nymrli.top/tags/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
</feed>

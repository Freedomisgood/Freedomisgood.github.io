<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><meta name="author" content="Mrli"><meta name="renderer" content="webkit"><meta name="copyright" content="Mrli"><meta name="keywords" content="Mrli's Blog"><meta name="description" content="想和你讲，说了会心动 ，缄默会心安。"><meta name="Cache-Control" content="no-cache"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>自动化运维工具Ansible · Mr.li's Blog</title><link rel="stylesheet" href="/css/style.css?v=2018.7.9"><link rel="stylesheet" href="/css/animation.css?v=2018.7.9"><link rel="icon" href="/img/assets/favicon.ico"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.6"><!-- scripts--><script>(function( w ){
  "use strict";
  // rel=preload support test
  if( !w.loadCSS ){
    w.loadCSS = function(){};
  }
  // define on the loadCSS obj
  var rp = loadCSS.relpreload = {};
  // rel=preload feature support test
  // runs once and returns a function for compat purposes
  rp.support = (function(){
    var ret;
    try {
      ret = w.document.createElement( "link" ).relList.supports( "preload" );
    } catch (e) {
      ret = false;
    }
    return function(){
      return ret;
    };
  })();

  // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
  // then change that media back to its intended value on load
  rp.bindMediaToggle = function( link ){
    // remember existing media attr for ultimate state, or default to 'all'
    var finalMedia = link.media || "all";

    function enableStylesheet(){
      link.media = finalMedia;
    }

    // bind load handlers to enable media
    if( link.addEventListener ){
      link.addEventListener( "load", enableStylesheet );
    } else if( link.attachEvent ){
      link.attachEvent( "onload", enableStylesheet );
    }

    // Set rel and non-applicable media type to start an async request
    // note: timeout allows this to happen async to let rendering continue in IE
    setTimeout(function(){
      link.rel = "stylesheet";
      link.media = "only x";
    });
    // also enable media after 3 seconds,
    // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
    setTimeout( enableStylesheet, 3000 );
  };

  // loop through link elements in DOM
  rp.poly = function(){
    // double check this to prevent external calls from running
    if( rp.support() ){
      return;
    }
    var links = w.document.getElementsByTagName( "link" );
    for( var i = 0; i < links.length; i++ ){
      var link = links[ i ];
      // qualify links to those with rel=preload and as=style attrs
      if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
        // prevent rerunning on link
        link.setAttribute( "data-loadcss", true );
        // bind listeners to toggle media back
        rp.bindMediaToggle( link );
      }
    }
  };

  // if unsupported, run the polyfill
  if( !rp.support() ){
    // run once at least
    rp.poly();

    // rerun poly on an interval until onload
    var run = w.setInterval( rp.poly, 500 );
    if( w.addEventListener ){
      w.addEventListener( "load", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    } else if( w.attachEvent ){
      w.attachEvent( "onload", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    }
  }


  // commonjs
  if( typeof exports !== "undefined" ){
    exports.loadCSS = loadCSS;
  }
  else {
    w.loadCSS = loadCSS;
  }
}( typeof global !== "undefined" ? global : this ) );</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" defer></script><script src="/js/main.js?v=2018.7.9" defer></script><!-- fancybox--><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script><!-- busuanzi--><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></head><body><section class="profile-close" id="cxo-profile"><div class="profile-avatar"><i class="fa fa-caret-left"></i><img src="https://avatars1.githubusercontent.com/u/31088082?s=400&amp;u=7a99ff83916afb3f4c5312bd78a1be17fe0e34ed&amp;v=4"></div><!--.profile-saying
  i.fa.fa-comment
  .saying--><div class="cxo-profile-inner"><div class="profile-name">Mrli</div><div class="profile-signature">别装作很努力,<br>因为结局不会陪你演戏。</div><div class="contacts"><div>Contacts:</div><span><a href="http://sighttp.qq.com/msgrd?v=1&amp;uin=1063052964" target="_black">QQ</a></span><span><a href="https://www.cnblogs.com/nymrli/" target="_black">博客园</a></span></div><div class="read-progress"></div></div></section><header id="cxo-intro" style="height: 60vh;background-image: url(/img/intro/index-bg.png);"><nav id="cxo-intro-nav"><section><div class="intro-nav-title"><a href="/">Mr.li's Blog</a></div><div class="intro-nav-label-box"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div><i class="fa fa-bars intro-nav-menu"><div class="intro-nav-drop"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div></i><div class="clear"></div></section></nav><h1 class="post-title">自动化运维工具Ansible</h1><div class="post-intros"><div class="post-intro-meta"><span class="post-intro-time"><i class="post-intro-calendar fa fa-edit"></i><span>2019/12/16</span></span><span class="busuanzi-pv" id="busuanzi_container_page_pv"><i class="post-intro-calendar fa fa-user-o"></i><span id="busuanzi_value_page_pv"></span></span><span class="post-intro-tags"><a class="intro-tag fa fa-tag" href="javascript:void(0)" date-tags="运维"> 运维</a><a class="intro-tag fa fa-tag" href="javascript:void(0)" date-tags="Python"> Python</a></span></div><div class="post-intro-read"><span> Word count: <span class="post-count">5,021</span> | Reading time: <span class="post-count">23</span>min</span></div></div></header><article class="cxo-up" id="cxo-content-outer"><section id="cxo-content-inner"><article class="article-entry" id="post"><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>​        ansible是新出现的自动化运维工具，基于Python开发，集合了众多运维工具（puppet、chef、func、fabric）的优点，实现了批量系统配置、批量程序部署、批量运行命令等功能。<br>　　ansible是基于 paramiko 开发的,并且基于模块化工作，本身没有批量部署的能力。真正具有批量部署的是ansible所运行的模块，ansible只是提供一种框架。ansible不需要在远程主机上安装client/agents，因为它们是基于ssh来和远程主机通讯的。ansible目前已经已经被红帽官方收购，是自动化运维工具中大家认可度最高的，并且上手容易，学习简单。是每位运维工程师必须掌握的技能之一。</p>
<h1 id="ansible-特点"><a href="#ansible-特点" class="headerlink" title="ansible 特点"></a>ansible 特点</h1><ol>
<li>部署简单，只需在主控端部署Ansible环境，被控端无需做任何操作；</li>
<li>默认使用<strong>SSH协议</strong>对设备进行管理；</li>
<li>有大量常规运维操作模块，可实现日常绝大部分操作；</li>
<li>配置简单、功能强大、扩展性强；</li>
<li>支持API及自定义模块，<strong>可通过Python轻松扩展</strong>；</li>
<li>通过Playbooks来定制强大的配置、状态管理；</li>
<li>轻量级，<strong>无需在客户端安装agent(代理)</strong>，更新时，只需在操作机上进行一次更新即可；</li>
<li>提供一个功能强大、操作性强的<strong>Web管理界面和REST API接口</strong>——AWX平台。</li>
<li>Ansible适用于中小型应用环境；SaltStack适合大型（Ansible由于不需要代理,只是通过ssh,因此只能性能不如Saltstack高）</li>
</ol>
<h1 id="Ansible安装"><a href="#Ansible安装" class="headerlink" title="Ansible安装"></a>Ansible安装</h1><p>法1.在已有<code>python-pip</code>的情况下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pip install ansible</span></span><br></pre></td></tr></table></figure>
<p>法2:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install software-properties-common</span><br><span class="line">sudo apt-add-repository ppa:ansible/ansible</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install ansible</span><br></pre></td></tr></table></figure>
<p>如果安装失败请换源<code>sudo sed  -i  -re  &#39;s/\w+\.archive\.ubuntu\.com/archive.ubuntu.com/g&#39;  /etc/apt/sources.list</code>,更新安装库<code>sudo apt-get update</code></p>
<h1 id="ansible-架构图"><a href="#ansible-架构图" class="headerlink" title="ansible 架构图"></a>ansible 架构图</h1><p><img src="https://images2017.cnblogs.com/blog/1204916/201712/1204916-20171205163000628-69838828.png" alt="img"><br>　　上图中我们看到的主要模块如下：</p>
<blockquote>
<p><code>Ansible</code>：Ansible核心程序。<br><code>HostInventory</code>：<strong>主机清单</strong> , 记录由Ansible管理的主机信息，包括端口、密码、ip等。<br><code>Playbooks</code>：“剧本”YAML格式文件，多个任务定义在一个文件中，定义主机需要调用哪些模块来完成的功能。<br><code>CoreModules</code>：<strong>核心模块</strong>，主要操作是通过调用核心模块来完成管理任务。<br><code>CustomModules</code>：自定义模块，完成核心模块无法完成的功能，支持多种语言。<br><code>ConnectionPlugins</code>：连接插件，Ansible和Host通信使用</p>
</blockquote>
<h1 id="ansible配置文件查找顺序"><a href="#ansible配置文件查找顺序" class="headerlink" title="ansible配置文件查找顺序"></a>ansible配置文件查找顺序</h1><ol>
<li>检查环境变量<code>ANSIBLE_CONFIG</code>指向的路径文件(export ANSIBLE_CONFIG=/etc/ansible.cfg)；</li>
<li>HOME目录下的配置文件<code>~/.ansible.cfg</code></li>
<li>检查当前目录下的ansible.cfg配置文件；</li>
<li><code>/etc/ansible.cfg</code>检查etc目录的配置文件。</li>
</ol>
<h1 id="使用特性"><a href="#使用特性" class="headerlink" title="使用特性"></a>使用特性</h1><ul>
<li>模块化：调用特定的模块，完成特定任务</li>
<li>有Paramiko，PyYAML，Jinja2（模板语言）三个关键模块支持自定义模块</li>
<li>基于Python语言实现</li>
<li>部署简单，基于python和SSH（默认已安装），agentless安全，基于OpenSSH支持playbook编排任务</li>
<li><strong>幂等性</strong>：一个任务执行1遍和执行n遍效果一样，不因重复执行带来意外情况</li>
<li>无需代理不依赖PKI（无需ssl）可使用任何编程语言写模块</li>
<li>YAML格式，编排任务，支持丰富的数据结构</li>
<li>较强大的多层解决方案</li>
</ul>
<h1 id="管理方式"><a href="#管理方式" class="headerlink" title="管理方式:"></a>管理方式:</h1><ul>
<li>Ad-Hoc，及Ansible命令，主要用于临时命令使用场景</li>
<li>Ansible-Playbook，脚本，用于长期规划好，大型项目的场景，需要有提前的规划</li>
</ul>
<p>Ansible-playbook（剧本）执行过程：</p>
<ul>
<li>将已有编排好的任务集写入Ansible-Playbook</li>
<li>通过ansible-playbook命令分拆任务集至逐条ansible命令，按预定规则逐条执行</li>
</ul>
<h1 id="相关文件"><a href="#相关文件" class="headerlink" title="相关文件"></a>相关文件</h1><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>/etc/ansible/ansible.cfg 主配置文件，配置ansible工作特性<br>/etc/ansible/hosts 主机清单<br>/etc/ansible/roles/存放角色的目录</p>
<h2 id="程序"><a href="#程序" class="headerlink" title="程序"></a>程序</h2><p>/usr/bin/ansible 主程序，临时命令执行工具<br>/usr/bin/ansible-doc 查看配置文档，模块功能查看工具<br>/usr/bin/ansible-galaxy 下载/上传优秀代码或Roles模块的官网平台<br>/usr/bin/ansible-playbook定制自动化任务，编排剧本工具/usr/bin/ansible-pull远程执行命令的工具<br>/usr/bin/ansible-vault 文件加密工具<br>/usr/bin/ansible-console 基于console界面与用户交互的执行工具</p>
<p>1.设置被管理的主机清单<code>vim /etc/ansible/hosts</code></p>
<p>2.1口令验证方式.<code>ansible 192.168.30.101 -m ping -k</code>用账号密码去确认受控端的身份</p>
<p>▲如果出现了这样的情况,需要先安装sshpass , <code>sudo apt install sshpass</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">192.168.100.180 | FAILED! =&gt; &#123;</span><br><span class="line">    "failed": true, </span><br><span class="line">    "msg": "ERROR! to use the 'ssh' connection type with passwords, you must install the sshpass program"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.2基于key验证</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ssh-keygen</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ssh-copy-id 192.168.30.101</span></span><br><span class="line"></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/xxxxxx/): </span><br><span class="line">Enter passphrase (empty for no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved in xxxxxxxxx.</span><br><span class="line">Your public key has been saved in xxxxx.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:xxxxxxxxxxxxxx</span><br><span class="line">The key's randomart image is:</span><br></pre></td></tr></table></figure>
<p>如果设置了passphrase,那么链接时需要输入passphrase,如果是ad-hoc就相当麻烦,而playbooks中有解决方法</p>
<h1 id="ad-hoc使用"><a href="#ad-hoc使用" class="headerlink" title="ad-hoc使用"></a>ad-hoc使用</h1><p>将<code>host_key_checking</code>取消注释,否则链接对象必须在known_hosts中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo vim /etc/ansible/ansible.cfg</span></span><br><span class="line"> uncomment this to disable SSH key host checking</span><br><span class="line"><span class="meta">#</span><span class="bash">host_key_checking = False</span></span><br></pre></td></tr></table></figure>
<p>显示日志,取消注释<code>log_path = /var/log/ansible.log</code></p>
<p>△.ansible不是长期执行的服务,不长期执行,因此修改配置后不需要重启服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ansible &lt;host-pattern&gt;[-m module_name][-a args]</span><br><span class="line"></span><br><span class="line">ansible dbsrvs -m command -a 'ls /root'-u wang-k -b-K</span><br><span class="line"> -u 以wang的身份登录,-b将wang切换成root,-K 输入root密码.</span><br><span class="line"> -m 指定模块名,-a指定模块参数</span><br></pre></td></tr></table></figure>
<h1 id="ansible的Host-pattern即匹配主机的列表"><a href="#ansible的Host-pattern即匹配主机的列表" class="headerlink" title="ansible的Host-pattern即匹配主机的列表"></a>ansible的Host-pattern即匹配主机的列表</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">All：表示所有Inventory中的所有主机</span><br><span class="line">ansible all-m ping</span><br><span class="line">：通配符</span><br><span class="line">ansible&quot;&quot;-m ping</span><br><span class="line">ansible 192.168.1.-m ping</span><br><span class="line">ansible&quot;srvs&quot;-m ping</span><br><span class="line">或关系</span><br><span class="line">ansible&quot;websrvsiappsrvs&quot;-m ping</span><br><span class="line">ansible&quot;192.168.1.10：192.168.1.20&quot;-m ping</span><br></pre></td></tr></table></figure>
<p>逻辑与<br><code>ansible &quot;websrvs:&amp;dbsrvs&quot;  -m ping</code>在websrvs组并且在dbsrvs组中的主机,单引号、双引号都行</p>
<p>逻辑非<br><code>ansible &#39;websrvs:ldbsrvs&#39;-m ping</code>在websrvs组，但不在dbsrvs组中的主机<br>注意：<strong>此处为单引号</strong></p>
<p>综合逻辑<br><code>ansible &#39;websrvs:dbsrvs:&amp;appsrvs:lftpsrvs&#39;-m ping</code></p>
<p>正则表达式<br><code>ansible &quot;websrvs:&amp;dbsrvs&quot; -m ping</code></p>
<p><code>ansible &quot;~（webldb）.*\.magedu\.com&quot; -m ping</code></p>
<hr>
<h1 id="ansible-command"><a href="#ansible-command" class="headerlink" title="ansible command"></a>ansible command</h1><ul>
<li>creates=<ul>
<li>存在,不执行</li>
</ul>
</li>
<li>removes=<ul>
<li>不存在,不执行</li>
</ul>
</li>
<li>chdir=<ul>
<li>切换目录后执行</li>
</ul>
</li>
</ul>
<h2 id="命令返回颜色说明"><a href="#命令返回颜色说明" class="headerlink" title="命令返回颜色说明"></a><strong>命令返回颜色说明</strong></h2><p>绿色： 表示查看信息，对远程主机未做改动的命令<br>红色： 批量管理产生错误信息<br>黄色： 对远程主机做了相应改动<br>紫色： 对操作提出建议或忠告</p>
<h1 id="常用模块"><a href="#常用模块" class="headerlink" title="常用模块"></a>常用模块</h1><ul>
<li>command</li>
<li>shell :  远程节点执行模块 <ul>
<li><code>ansible all -m shel1 -a &#39;getenforce&#39;</code></li>
</ul>
</li>
<li>script:  在远程执行本地的脚本 <ul>
<li><code>ansible test -m script -a &quot;/sh/test.sh&quot;</code></li>
</ul>
</li>
<li>copy :  复制模块 <ul>
<li><code>ansible all -m copy -a &#39;src=/root/ansible/selinux dest=/etc/selinux/config backup=yes&#39;</code></li>
<li><code>ansible all -m copy-a &#39;src=/etc/shadow dest=/data/mode=000 owner=wang&#39;</code></li>
</ul>
</li>
<li>fetch :  远程获取 <ul>
<li><code>ansible srv-m fetch -a &#39;src=/root/a. sh dest=/data/scripts&#39;</code></li>
</ul>
</li>
<li>file : 文件操作,删除、创建<ul>
<li><code>ansible test -m file -a &quot;dest=/tmp/hello state=touch&quot;</code></li>
</ul>
</li>
<li>unarchieve、achieve : 压缩解压<ul>
<li><code>ansible test -m unarchive -a &#39;src=/srv/tomcat8/apache-tomcat-8.0.29.tar.gz dest=/usr/local copy=no mode=0755&#39;</code></li>
</ul>
</li>
<li>cron<ul>
<li>开启<code>ansible all-m cron -a &#39;minute=* weekday=1,3,5 jcb=&quot;/usr/bin/wall FBI warning&quot; name=warningcron&#39;</code></li>
<li>禁用<code>ansible all -m cron -a &#39;disabled=true job=&quot;/usr/bin/wall FBI warning&quot;name=warningcron&#39;</code>、启用<code>ansible all -m cron -a &#39;disabled=falsejob=&quot;/usr/bin/wall FBI warning&quot;name=warningcron&#39;</code></li>
<li>删除<code>ansible all -m cron -a &#39;job=&quot;/usr/bin/wall FBI warning&quot;name=warningcron state=absent&#39;</code></li>
</ul>
</li>
<li>apt、yum<ul>
<li><code>ansible all -m apt &#39;name=vim update_cache=yes&#39;</code></li>
</ul>
</li>
<li>user</li>
<li>group</li>
<li>service<ul>
<li><code>service:name=httpd state=started enabled=yes</code></li>
</ul>
</li>
<li>setup<ul>
<li><code>ansible websrvs -m setup -a &#39;filter=*address*&#39;</code></li>
</ul>
</li>
<li>template(不能放在ad-hoc)中,只能在playbook中使用</li>
</ul>
<p>command模块在针对<strong>管道</strong>、<strong>重定向有*…</strong>有问题==&gt;使用shell模块</p>
<p><a href="https://www.cnblogs.com/ExzaiTin/p/7918415.html" target="_blank" rel="noopener">常用模块介绍</a></p>
<p>▲一般 present 表示生成、下载, absent 表示删除或卸载。</p>
<hr>
<h1 id="系列命令"><a href="#系列命令" class="headerlink" title="系列命令"></a>系列命令</h1><h2 id="galaxy"><a href="#galaxy" class="headerlink" title="galaxy"></a>galaxy</h2><p><code>ansible-galaxy install geerlingguy.nginx</code>    其中<code>geerlingguy</code>为角色在<code>./ansible/roles/</code></p>
<h2 id="playbooks"><a href="#playbooks" class="headerlink" title="playbooks"></a>playbooks</h2><blockquote>
<p>Yaml</p>
<p>YAML Ain’t Markup Language，即YAML不是XML。不过，在开发的这种语言时，YAML的意思其实是：”Yet Another Markup Language”（仍是一种标记语言）</p>
</blockquote>
<h3 id="核心元素"><a href="#核心元素" class="headerlink" title="核心元素"></a>核心元素</h3><ul>
<li>Hosts 执行的远程主机列表</li>
<li>Tasks 任务集</li>
<li>Varniables 内置变量或自定义变量在playbook中调用Templates 模板，可替换模板文件中的变量并实现一些简单逻辑的文件Handlers 和notity结合使用，由特定条件触发的操作，满足条件方才执行，否则不执行</li>
<li>tags 标签指定某条任务执行，用于选择运行playbook中的部分代码。<ul>
<li>ansible具有幂等性，因此会自动跳过没有变化的部分，即便如此，有些代码为测试其确实没有发生变化的时间依然会非常地长。此时，如果确信其没有变化，就可以通过tags跳过此些代码片断<br>ansible-playbook-t tagsname useradd.yml</li>
</ul>
</li>
</ul>
<h2 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h2><p>加密<code>ansible-vault encrypt hello.yml</code></p>
<p>解密查看<code>ansible-vault view hello.yml</code></p>
<p>重新制定口令<code>ansible-vault rekey hello.yml</code></p>
<h2 id="基础组件"><a href="#基础组件" class="headerlink" title="基础组件"></a>基础组件</h2><p>如果命令或脚本的退出码不为零，可以使用如下方式替代</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tasks:</span></span><br><span class="line"><span class="attr">  - name:</span><span class="string">run</span> <span class="string">this</span> <span class="string">command</span> <span class="string">and</span> <span class="string">ignore</span> <span class="string">the</span> <span class="string">result</span></span><br><span class="line"><span class="attr">    shell:</span> <span class="string">/usr/bin/somecommand</span> <span class="string">||</span> <span class="string">/bin/true</span></span><br></pre></td></tr></table></figure>
<p>或者使用ignore_errors来忽略错误信息：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">tasks：</span></span><br><span class="line"><span class="attr">  - name:</span><span class="string">run</span> <span class="string">this</span> <span class="string">command</span> <span class="string">and</span> <span class="string">ignore</span> <span class="string">the</span> <span class="string">result</span></span><br><span class="line"><span class="attr">    shell:</span><span class="string">/usr/bin/somecommand</span></span><br><span class="line"><span class="attr">ignore_errors:</span><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<h2 id="运行playbook的方式"><a href="#运行playbook的方式" class="headerlink" title="运行playbook的方式"></a>运行playbook的方式</h2><p><code>ansible-playbook &lt;filename.yml&gt;..[options]</code><br>常见选项<br><code>-check(-C)</code>只检测可能会发生的改变，但不真正执行操作<br><code>--list-hosts</code>列出运行任务的主机<br><code>--limit</code>主机列表只针对主机列表中的主机执行<br><code>-V</code>显示过程-vw-vwv更详细</p>
<h2 id="handlers和notify"><a href="#handlers和notify" class="headerlink" title="handlers和notify"></a>handlers和notify</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tasks:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">install</span> <span class="string">httpd</span> <span class="string">package</span> </span><br><span class="line"><span class="attr">    yum:</span> <span class="string">name=httpd</span> </span><br><span class="line"><span class="attr">  - name:</span> <span class="string">copy</span> <span class="string">conf</span> <span class="string">file</span> <span class="attr">copy:src=files/httpd.conf</span> <span class="string">dest=/etc/httpd/conf/backup=yes</span> </span><br><span class="line"><span class="attr">    notify:</span> <span class="string">restart</span> <span class="string">service</span> </span><br><span class="line"><span class="attr">  - name:</span> <span class="string">start</span> <span class="string">service</span></span><br><span class="line"><span class="attr">    service:</span> <span class="string">name=httpd</span> <span class="string">state=started</span> <span class="string">enabled=yes</span> </span><br><span class="line"><span class="attr">  handlers:</span></span><br><span class="line"><span class="attr">    - name:</span><span class="string">restart</span> <span class="string">service</span> </span><br><span class="line"><span class="attr">      service:</span><span class="string">name=httpd</span> <span class="string">state=restarted</span></span><br></pre></td></tr></table></figure>
<p>标签</p>
<blockquote>
<p>指定标签来执行指定任务</p>
</blockquote>
<p><code>ansible-playbook -t  rshttp,xxxx httpd.yml</code></p>
<h2 id="变量使用"><a href="#变量使用" class="headerlink" title="变量使用"></a>变量使用</h2><p>jinjia2语法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; var &#125;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>法一：ansible setup facts 远程主机的所有变量都可直接调用</li>
<li>法二：在<code>/etc/ansible/hosts</code>中定义普通变量：主机组中主机单独定义，优先级高于公共变量公共（组）变量：针对主机组中所有主机定义统一变量</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[websrvs]</span><br><span class="line">192.168.30.101 http_port=81</span><br><span class="line">192.168.30.102 http_port=82</span><br><span class="line">[websrvs:vars]</span><br><span class="line">nodename=www </span><br><span class="line">domainname=magedu.com</span><br></pre></td></tr></table></figure>
<ul>
<li>法三：<code>ansible-playbook -e &#39;var=xxx&#39; app.html</code>，优先级比法二高</li>
<li>法四:</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">- hosts:</span> </span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  vars:</span> </span><br><span class="line"><span class="attr">    - var:</span> <span class="string">xxx</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">    - name:</span> </span><br><span class="line"><span class="attr">       yum:</span> <span class="string">...</span></span><br></pre></td></tr></table></figure>
<h2 id="迭代机制"><a href="#迭代机制" class="headerlink" title="迭代机制"></a>迭代机制</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tasks:</span><br><span class="line">  - name:</span><br><span class="line">    file: name=/data/&#123;&#123; item &#125;&#125;</span><br><span class="line">    with_items: </span><br><span class="line">      - file1</span><br><span class="line">      - file2</span><br><span class="line">      - file3</span><br></pre></td></tr></table></figure>
<h3 id="迭代嵌套自变量"><a href="#迭代嵌套自变量" class="headerlink" title="迭代嵌套自变量"></a>迭代嵌套自变量</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">- hosts:</span> <span class="string">websrvs</span> </span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span> </span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">add</span> <span class="string">some</span> <span class="string">groups</span> </span><br><span class="line"><span class="attr">    group:</span> <span class="string">name=&#123;&#123;</span> <span class="string">item</span> <span class="string">]&#125;</span> <span class="string">state=present</span> </span><br><span class="line"><span class="attr">    with_items:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">group1</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">group2</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">group3</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">add</span> <span class="string">some</span> <span class="string">users</span> </span><br><span class="line"><span class="attr">      user:</span> <span class="string">name=&#123;&#123;</span> <span class="string">item.</span> <span class="string">name</span> <span class="string">]&#125;</span> <span class="string">group=&#123;&#123;</span> <span class="string">item.</span> <span class="string">group</span> <span class="string">)&#125;</span> <span class="string">state=present</span> </span><br><span class="line">      <span class="string">with</span> <span class="attr">items:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">&#123;</span> <span class="attr">name:</span> <span class="string">user1,</span> <span class="attr">group:'</span> <span class="string">group1'&#125;</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">&#123;</span> <span class="attr">name:</span> <span class="string">'user2, group:'</span> <span class="string">group2'&#125;</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">&#123;</span> <span class="attr">name:</span> <span class="string">'user3'</span><span class="string">,</span> <span class="attr">group:'</span> <span class="string">group3'&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for vhost in nginx_vhosts%&#125;</span><br><span class="line">server&#123;</span><br><span class="line">listen&#123;&#123; vhost &#125;&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">- hosts:</span> <span class="string">websrvs</span> </span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  vars:</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="attr">      - listen_port:</span> <span class="number">81</span></span><br><span class="line"><span class="attr">      - listen_port:</span> <span class="number">82</span></span><br><span class="line"><span class="attr">      - listen_port:</span> <span class="number">83</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">copy</span> <span class="string">conf</span> </span><br><span class="line"><span class="attr">    template:</span> <span class="string">src=forl.conf.j2</span> <span class="string">dest=/data/for1.conf</span></span><br></pre></td></tr></table></figure>
<h2 id="条件判断"><a href="#条件判断" class="headerlink" title="条件判断"></a>条件判断</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">- hosts:</span> <span class="string">all</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="comment">#如果系统中存在主机名为nfs或者backup的主机，则创建文件</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">Create</span> <span class="string">File</span></span><br><span class="line"><span class="attr">      file:</span> <span class="string">path=/tmp/this_is_&#123;&#123;</span> <span class="string">ansible_hostname</span> <span class="string">&#125;&#125;_file</span> <span class="string">state=touch</span></span><br><span class="line"><span class="attr">      when:</span> <span class="string">(ansible_hostname</span> <span class="string">==</span> <span class="string">"nfs"</span><span class="string">)</span> <span class="string">or</span> <span class="string">(ansible_hostname</span> <span class="string">==</span> <span class="string">"backup"</span><span class="string">)</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#系统为centos的主机才会执行</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">Centos</span> <span class="string">Install</span> <span class="string">httpd</span></span><br><span class="line"><span class="attr">      yum:</span> <span class="string">name=httpd</span> <span class="string">state=present</span></span><br><span class="line"><span class="attr">      when:</span> <span class="string">(ansible_distribution</span> <span class="string">==</span> <span class="string">"CentOS"</span><span class="string">)</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#系统为ubuntu的主机才会执行</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">Ubuntu</span> <span class="string">Install</span> <span class="string">httpd</span></span><br><span class="line"><span class="attr">      yum:</span> <span class="string">name=httpd2</span> <span class="string">state=present</span></span><br><span class="line"><span class="attr">      when:</span> <span class="string">(ansible_distribution</span> <span class="string">==</span> <span class="string">"Ubuntu"</span><span class="string">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tasks:</span> </span><br><span class="line"><span class="attr">  - name:</span> <span class="string">run</span> <span class="string">df</span> <span class="bullet">-h</span></span><br><span class="line"><span class="attr">    sudo_user:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">    sudo:</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">    shell:</span> <span class="string">name=df</span> <span class="bullet">-h</span></span><br></pre></td></tr></table></figure>
<p> ansible sudo 即将变更为become</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[s21]</span><br><span class="line">#代替原来192.168.1.21  ansible_ssh_user=i  ansible_ssh_pass=i的写法</span><br><span class="line">192.168.1.21  ansible_ssh_user=i  </span><br><span class="line">ansible_ssh_private_key_file=/home/i/.ssh/id_rsa </span><br><span class="line">ansible_become=true </span><br><span class="line">ansible_become_user=root  </span><br><span class="line">ansible_become_pass=&apos;i&apos;</span><br></pre></td></tr></table></figure>
<p>获取执行命令的输出 –Register<a href="https://blog.csdn.net/U201017971/article/details/81630097" target="_blank" rel="noopener">[转]</a></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">- name:</span> <span class="string">echo</span> <span class="string">date</span> </span><br><span class="line"><span class="attr">  command:</span> <span class="string">date</span> </span><br><span class="line"><span class="attr">  register:</span> <span class="string">date_output</span> </span><br><span class="line"></span><br><span class="line"><span class="attr"> - name:</span> <span class="string">echo</span> <span class="string">date_output</span> </span><br><span class="line"><span class="attr">  command:</span> <span class="string">echo</span> <span class="string">"30"</span></span><br><span class="line"><span class="attr">  when:</span> <span class="string">date_output.stdout.split('</span> <span class="string">')[2] == "30"</span></span><br></pre></td></tr></table></figure>
<p>判断文件是否存在<a href="https://blog.csdn.net/yushi6310/article/details/78679799" target="_blank" rel="noopener">[转]</a></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">- name:</span> <span class="string">judge</span> <span class="string">a</span> <span class="string">file</span> <span class="string">or</span> <span class="string">dir</span> <span class="string">is</span> <span class="string">exits</span></span><br><span class="line"><span class="attr">  shell:</span> <span class="string">ls</span> <span class="string">/home/sfy</span></span><br><span class="line"><span class="attr">  ignore_errors:</span> <span class="literal">True</span></span><br><span class="line"><span class="attr">  register:</span> <span class="string">result</span></span><br><span class="line"></span><br><span class="line"><span class="attr">- shell:</span> <span class="string">echo</span> <span class="string">"file exit"</span></span><br><span class="line"><span class="attr">  when:</span> <span class="string">result|succeeded</span></span><br><span class="line"></span><br><span class="line"><span class="attr">- shell:</span> <span class="string">echo</span> <span class="string">"file not exit"</span></span><br><span class="line"><span class="attr">  when:</span> <span class="string">result|failed</span></span><br></pre></td></tr></table></figure>
<h2 id="权限问题"><a href="#权限问题" class="headerlink" title="权限问题"></a>权限问题</h2><p>关于权限问题，可以通过<code>ansible -h</code>查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Privilege Escalation Options:</span><br><span class="line">  control how and which user you become as on target hosts</span><br><span class="line"></span><br><span class="line">  -s, --sudo          run operations with sudo (nopasswd) (deprecated, use</span><br><span class="line">                      become)</span><br><span class="line">  -U SUDO_USER, --sudo-user=SUDO_USER</span><br><span class="line">                      desired sudo user (default=root) (deprecated, use</span><br><span class="line">                      become)</span><br><span class="line">  -S, --su            run operations with su (deprecated, use become)</span><br><span class="line">  -R SU_USER, --su-user=SU_USER</span><br><span class="line">                      run operations with su as this user (default=None)</span><br><span class="line">                      (deprecated, use become)</span><br><span class="line">  -b, --become        run operations with become (does not imply password</span><br><span class="line">                      prompting)</span><br><span class="line">  --become-method=BECOME_METHOD</span><br><span class="line">                      privilege escalation method to use (default=sudo),</span><br><span class="line">                      valid choices: [ sudo | su | pbrun | pfexec | doas |</span><br><span class="line">                      dzdo | ksu | runas | pmrun ]</span><br><span class="line">  --become-user=BECOME_USER</span><br><span class="line">                      run operations as this user (default=root)</span><br><span class="line">  --ask-sudo-pass     ask for sudo password (deprecated, use become)</span><br><span class="line">  --ask-su-pass       ask for su password (deprecated, use become)</span><br><span class="line">  -K, --ask-become-pass</span><br><span class="line">                      ask for privilege escalation password</span><br></pre></td></tr></table></figure>
<p>▲其中deprecated表示是将被弃用的，将全部被become代替，（即参数-b）</p>
<p>关于-b和-K的作用，可以通过如下命令进行测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ansible <span class="built_in">test</span> -m shell -a <span class="string">"whoami"</span>  -K</span></span><br><span class="line"> mrli身份使用sudo权限</span><br><span class="line"><span class="meta">$</span><span class="bash"> ansible <span class="built_in">test</span> -m shell -a <span class="string">"whoami"</span>  -b</span></span><br><span class="line"> 切换到root身份</span><br><span class="line"><span class="meta">$</span><span class="bash"> ansible <span class="built_in">test</span> -m shell -a <span class="string">"whoami"</span>  -b -K</span></span><br></pre></td></tr></table></figure>
<p>▲这个权限问题在ansible执行shell脚本的时候需要特别注意</p>
<h2 id="个人写过的Playbook-demo"><a href="#个人写过的Playbook-demo" class="headerlink" title="个人写过的Playbook-demo"></a>个人写过的Playbook-demo</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">- hosts:</span> <span class="number">192.168</span><span class="number">.100</span><span class="number">.190</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">apollo3d</span></span><br><span class="line"><span class="attr">  become:</span> <span class="literal">yes</span></span><br><span class="line"><span class="attr">  vars:</span></span><br><span class="line"><span class="attr">    spark:</span> <span class="string">/home/apollo3d/SimSpark/spark/build</span></span><br><span class="line"><span class="attr">    rcssserver3d:</span> <span class="string">/home/apollo3d/SimSpark/rcssserver3d/build</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">judge</span> <span class="string">former</span> <span class="string">platform</span> <span class="string">directory</span> <span class="string">Exsit</span></span><br><span class="line"><span class="attr">    shell:</span> <span class="string">'ls /home/apollo3d/simspark-0.3.0/build'</span></span><br><span class="line"><span class="attr">    ignore_errors:</span> <span class="literal">True</span></span><br><span class="line"><span class="attr">    register:</span> <span class="string">formerDirExsit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">uninstall</span></span><br><span class="line"><span class="attr">    command:</span> <span class="string">'chdir=<span class="template-variable">&#123;&#123; item &#125;&#125;</span> make uninstall'</span></span><br><span class="line"><span class="attr">    with_items:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">/home/apollo3d/simspark-0.3.0/build</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">/home/apollo3d/rcssserver3d-0.7.1/build</span></span><br><span class="line"><span class="attr">    when:</span> <span class="string">formerDirExsit|succeeded</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">remove</span></span><br><span class="line"><span class="attr">    file:</span></span><br><span class="line"><span class="attr">      dest:</span> <span class="string">'<span class="template-variable">&#123;&#123; item &#125;&#125;</span>'</span></span><br><span class="line"><span class="attr">      state:</span> <span class="string">absent</span></span><br><span class="line"><span class="attr">    with_items:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">/home/apollo3d/simspark-0.3.0/</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">/home/apollo3d/rcssserver3d-0.7.1/</span></span><br><span class="line"><span class="attr">    when:</span> <span class="string">formerDirExsit|succeeded</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">judge</span> <span class="string">new</span> <span class="string">zip</span></span><br><span class="line"><span class="attr">    shell:</span> <span class="string">ls</span> <span class="string">/home/apollo3d/SimSpark.tar.gz</span></span><br><span class="line"><span class="attr">    ignore_errors:</span> <span class="literal">True</span></span><br><span class="line"><span class="attr">    register:</span> <span class="string">zipExsit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">jieya</span></span><br><span class="line"><span class="attr">    unarchive:</span> </span><br><span class="line"><span class="attr">      src:</span> <span class="string">/home/apollo3d/SimSpark.tar.gz</span></span><br><span class="line"><span class="attr">      dest:</span> <span class="string">/home/apollo3d/</span></span><br><span class="line"><span class="attr">      copy:</span> <span class="literal">no</span></span><br><span class="line"><span class="attr">      mode:</span> <span class="number">0755</span></span><br><span class="line"><span class="attr">    when:</span> <span class="string">zipExsit|succeeded</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">mk</span> <span class="string">dirs</span></span><br><span class="line"><span class="attr">    file:</span> <span class="string">"dest=<span class="template-variable">&#123;&#123; item &#125;&#125;</span> state=directory"</span></span><br><span class="line"><span class="attr">    with_items:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">/home/apollo3d/SimSpark/spark/build</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">/home/apollo3d/SimSpark/rcssserver3d/build</span></span><br><span class="line"><span class="attr">    when:</span> <span class="string">zipExsit|succeeded</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">install1</span></span><br><span class="line"><span class="attr">    command:</span> <span class="string">'chdir=<span class="template-variable">&#123;&#123; spark &#125;&#125;</span> <span class="template-variable">&#123;&#123; item &#125;&#125;</span>'</span></span><br><span class="line"><span class="attr">    with_items:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">cmake</span> <span class="string">..</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">make</span> <span class="bullet">-j4</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">make</span> <span class="string">install</span></span><br><span class="line"><span class="attr">    when:</span> <span class="string">zipExsit|succeeded</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">  - name:</span> <span class="string">install2</span></span><br><span class="line"><span class="attr">    command:</span> <span class="string">'chdir=<span class="template-variable">&#123;&#123; rcssserver3d &#125;&#125;</span> <span class="template-variable">&#123;&#123; item &#125;&#125;</span>'</span></span><br><span class="line"><span class="attr">    with_items:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">cmake</span> <span class="string">..</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">make</span> <span class="bullet">-j4</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">make</span> <span class="string">install</span></span><br><span class="line"><span class="attr">    when:</span> <span class="string">zipExsit|succeeded</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">config</span></span><br><span class="line"><span class="attr">    shell:</span> <span class="string">'<span class="template-variable">&#123;&#123; item &#125;&#125;</span>'</span></span><br><span class="line"><span class="attr">    with_items:</span> </span><br><span class="line"><span class="bullet">      -</span> <span class="string">echo</span> <span class="string">'/usr/local/lib/simspark\n/usr/local/lib/rcssserver3d'</span> <span class="string">| sudo tee /etc/ld.so.conf.d/spark.conf</span></span><br><span class="line"><span class="string">      - ldconfig</span></span><br><span class="line"><span class="string"></span><span class="attr">    when:</span> <span class="string">zipExsit|succeeded</span></span><br></pre></td></tr></table></figure>
<hr>
<h1 id="roles"><a href="#roles" class="headerlink" title="roles"></a>roles</h1><blockquote>
<p>ansilbe自1.2版本引入的新特性，用于层次性、结构化地组织playbook。roles能够根据层次型结构自动装载变量文件、tasks以及handlers等。要使用roles只需要在playbook中使用<strong>include</strong>指令即可。简单来讲，roles就是通过分别将<strong>变量</strong>、<strong>文件</strong>、<strong>任务</strong>、<strong>模板</strong>及处理器放置于单独的目录中，并可以便捷地include它们的一种机制。角色一般用于基于主机构建服务的场景中，但也可以是用于构建守护进程等场景中</p>
</blockquote>
<p>复杂场景：建议使用roles，代码复用度高</p>
<ul>
<li>变更指定主机或主机组</li>
<li>如命名不规范维护和传承成本大</li>
<li>某些功能需多个Playbook，通过Includes即可实现</li>
</ul>
<p>roles目录结构：<br>playbook.yml<br>roles/<br>project/<br>tasks/<br>files/<br>vars/不常用<br>default/不常用<br>templates/<br>handlers/<br>meta/不常用</p>
<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><h2 id="Ansible-配置SSH公钥认证"><a href="#Ansible-配置SSH公钥认证" class="headerlink" title="Ansible 配置SSH公钥认证"></a>Ansible 配置SSH公钥认证</h2><p>安装好Ansible之后，要开始工作，还需要创建一个被控制主机列表清单.默认读取/etc/ansible/hosts,如果该文件不存在，则要收到进行创建.</p>
<p> 也可以通过环境变量 <strong>ANSIBLE_INVENTORY</strong> 来设置默认清单文件,1.9版本之前用 <strong>ANSIBLE_HOSTS</strong><code>export ANSIBLE_INVENTORY=~/ansible_hosts</code>  </p>
<p><strong>创建SSH认证文件</strong></p>
<blockquote>
<p>该操作是在控制主机中进行。</p>
</blockquote>
<p>SSH认证文件创建成功之后，将控制主机的公钥文件 id_rsa.pub 添加到被控制主机的~/.ssh/authorized_keys。</p>
<p><code>\  ~</code>指的是控制主机和被控制主机通信的用户家目录。</p>
<p><code>\  id_rsa</code> 是控制主机的私钥文件，要严格保管。</p>
<p><code>\  id_rsa.pub</code>是控制主机的公钥文件，可随意分发。</p>
<p>法一:<code>ansible all -m shell -a &quot;cat /tmp/authorized_keys &gt;&gt; /root/.ssh/authorized_keys&quot; -k</code></p>
<p>▲注意</p>
<blockquote>
<p><strong>如果被控制主机中用户家目录中不存在.ssh目录，就创建。</strong></p>
<p><strong>然后将上传的公钥文件追加到用户的authorized_keys文件中</strong></p>
</blockquote>
<p>法二: (亲测)</p>
<p>通过authorized_key模块来进行添加</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible para -i /tmp/inventory.txt -m authorized_key -a <span class="string">"user=root key='&#123;&#123; lookup('file','/root/.ssh/id_rsa.pub') &#125;&#125;'"</span> -k</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>lookup(&#39;file&#39;,&#39;/root/.ssh/id_rsa.pub&#39;)</code> 是读取/root/.ssh/id_rsa.pub的内容</p>
</blockquote>
<h3 id="使用公钥密钥对验证的方法登录"><a href="#使用公钥密钥对验证的方法登录" class="headerlink" title="使用公钥密钥对验证的方法登录"></a>使用公钥密钥对验证的方法登录</h3><p><strong>1. 在本地也创建一个 apple 用户,并创建 /home/apple/.ssh/ 目录</strong></p>
<p><code>$ useradd apple -s  /bin/bash  -d  /home/apple/</code></p>
<p>创建 .ssh 目录<code>mkdir   /home/apple/.ssh</code></p>
<p> 修改 .ssh 目录的权限<code>chmod  700  /home/apple/.ssh</code></p>
<p><code>创建 /home/apple/.ssh/known_hosts 文件</code></p>
<p><strong>2.收集所有远程主机的公钥</strong>，保存在上 /home/apple/.ssh/known_hosts 文件。这一步的作用，是为了在后面第一次ssh 连接时，不需要再输密码。</p>
<p>收集所有远程主机的 公钥，主要是利用 ssh-keyscan 命令：<code>ssh-keyscan   -f   ip.txt  &gt;&gt; /home/apple/.ssh/known_hosts</code>   说明： ip.txt 文件存放所有的远程主机 ip 地址，一行代表一台主机。</p>
<p><strong>3.创建公钥私钥对：</strong></p>
<p>一般在对应用户的 /home/apple/.ssh/ 目录下创建。这也不是强制的，因为在ssh 发起连接时，可以指定使用的私钥文件。 ssk-keygen  -t  rsa    一直按回车键就可以了。但要注意生成的 id_rsa 和 id_rsa.pub 存放的路径。</p>
<p><strong>4.将公钥推送到所有的远程主机</strong></p>
<p>我们编写playbook 文件，利用authorized_key 模块就可以快速完成：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@centos_7 roles]$   cat ssh-addkey.yml ---- hosts: apps         对apps 组里的所有远程主机  </span><br><span class="line">gather_facts: False  </span><br><span class="line">tasks:    </span><br><span class="line">- name: install sshkey      </span><br><span class="line">authorized_key:         </span><br><span class="line">user: apple        </span><br><span class="line">key: "&#123;&#123; lookup('file', '/home/apple/.ssh/id_rsa.pub') &#125;&#125;"        </span><br><span class="line">state: present</span><br></pre></td></tr></table></figure>
<p>说明： 在前面1,2,3步中，我们已经准备好了公私钥对了。推送到远程主机，可以手动推送，或者使用scp 复制到远程主机。但是利用scp 复制之后，还需要修改远程主机上的 /home/apple/.ssh/authorize_keys 文件的权限等等。 ansible 的 authorized_key 模块就自动帮我们做了这些工作。 执行， ansible-playbook   ssh-addkye.yml</p>
<h2 id="在多台远程主机中创建用户"><a href="#在多台远程主机中创建用户" class="headerlink" title="在多台远程主机中创建用户"></a>在多台远程主机中创建用户</h2><p>不用ansible，单个操作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> 在 root 用户下运行这条命令创建一个新用户，yangxg 是用户名</span><br><span class="line"> 因为我叫杨学光，所以我取的用户名是 yangxg</span><br><span class="line"> 选择一个你喜欢的用户名，不一定非得和我的相同</span><br><span class="line">root@localhost:~ useradd -m -s /bin/bash yangxg</span><br><span class="line"> </span><br><span class="line"> 把新创建的用户加入超级权限组</span><br><span class="line">root@localhost:~ usermod -a -G sudo yangxg</span><br><span class="line"> </span><br><span class="line"> 为新用户设置密码</span><br><span class="line"> 注意在输密码的时候不会有字符显示，不要以为键盘坏了，正常输入即可</span><br><span class="line">root@localhost:~ passwd yangxg</span><br><span class="line"> </span><br><span class="line"> 切换到创建的新用户</span><br><span class="line">root@localhost:~ su - yangxg</span><br><span class="line"> </span><br><span class="line"> 切换成功，@符号前面已经是新用户名而不是 root 了</span><br><span class="line">yangxg@localhost:~$</span><br></pre></td></tr></table></figure>
<p>ansible</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">all</span></span><br><span class="line"><span class="attr">  vars:</span></span><br><span class="line"><span class="attr">    user:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">"$6$rounds=100000$O2BHfT2XIF6oDb9w$8Hhv4vOrLN6JF/nRVYDd8zZdnn9TNkQutyYYywIcPF2kRiHgkwAjqHIN7sDUkd1DcjLRABWT9ULHZPBOF2bZS/"</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">Add</span> <span class="string">user</span> <span class="string">&#123;&#123;</span> <span class="string">user</span> <span class="string">&#125;&#125;</span></span><br><span class="line"><span class="attr">    user:</span> <span class="string">name=&#123;&#123;user&#125;&#125;</span> <span class="string">comment="ceph</span> <span class="string">user"</span> <span class="string">password=&#123;&#123;</span> <span class="string">password</span> <span class="string">&#125;&#125;</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">Config</span> <span class="string">/etc/sudoers</span></span><br><span class="line"><span class="attr">    lineinfile:</span> <span class="string">dest=/etc/sudoers</span> <span class="string">state=present</span>  <span class="string">line='&#123;&#123;item&#125;&#125;'</span> <span class="string">validate='visudo</span> <span class="bullet">-cf</span> <span class="string">%s'</span></span><br><span class="line"><span class="attr">    with_items:</span></span><br><span class="line"><span class="bullet">           -</span> <span class="string">"<span class="template-variable">&#123;&#123; user&#125;&#125;</span> ALL=(ALL) NOPASSWD: ALL"</span></span><br><span class="line"><span class="bullet">           -</span> <span class="string">"Defaults: <span class="template-variable">&#123;&#123;user&#125;&#125;</span>  !requiretty"</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python -c <span class="string">'import crypt; print crypt.crypt("rescue", "hadoop")'</span></span></span><br><span class="line"> hadoop为salt，可以改成其他的。rescue是需要加密的内容</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> ansible rescue -m user -a <span class="string">"name=rescue shell=/bin/bash  home=/home/rescue password= state=present"</span> -b -K</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> ansible rescue -m shell -a <span class="string">"usermod -a -G sudo rescue"</span> -b -K</span></span><br><span class="line"></span><br><span class="line"> user模块增加 update_password=always时，可以更新密码</span><br></pre></td></tr></table></figure>
<h2 id="一键挂载NFS"><a href="#一键挂载NFS" class="headerlink" title="一键挂载NFS:"></a>一键挂载NFS:</h2><p><code>ansible full -m mount -a &quot;name=/data src=192.168.100.179:/data fstype=nfs state=mounted&quot; -b -K</code></p>
<p>挂载需要用SUDO权限,所以-K必不可少.同时,在这之前已经使用过ssh进行了配对因此不需要输入登录用户密码.</p>
<hr>
<p>其他命令记录<br><code>ss -ntl | grep 80</code></p>
<p><code>vim /etc/sysconfig/network-scripts/ifcfg-eth0</code>建议可以使用Alias</p>
<p><code>service network restart</code>重启网络服务</p>
</article><!-- lincense--><div class="license-wrapper"><p> <span>Author:  </span><a href="https://nymrli.top">Mrli</a></p><p> <span>Link:  </span><a href="https://nymrli.top/2019/07/08/自动化运维工具Ansible/">https://nymrli.top/2019/07/08/自动化运维工具Ansible/</a></p><p> <span>Copyright:  </span><span>All articles in this blog are licensed under <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/3.0">CC BY-NC-SA 3.0</a> unless stating additionally.</span></p></div><div class="post-paginator"><a class="prevSlogan" href="/2019/07/13/通过XDRP实现Windows远程访问ubuntu桌面/" title="通过XDRP实现Windows远程访问ubuntu桌面"><span>< PreviousPost</span><br><span class="prevTitle">通过XDRP实现Windows远程访问ubuntu桌面</span></a><a class="nextSlogan" href="/2019/07/07/staticmethod和classmethod区别/" title="staticmethod和classmethod区别"><span>NextPost ></span><br><span class="nextTitle">staticmethod和classmethod区别</span></a><div class="clear"></div></div><div id="comment"><div id="container"></div><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script><script>var gitment = new Gitment({
  id: '自动化运维工具Ansible',
  owner: 'Freedomisgood',
  repo: 'Freedomisgood.github.io',
  oauth: {
    client_id: 'bc5a81fe36017dcd8b63',
    client_secret: '949cec3a1b91742c6249c47259791e4b80a6fa69',
  },
})
gitment.render('container')</script></div></section></article><footer id="cxo-footer-outer"><div id="cxo-footer-inner"><p class="footer-container"><span>Site by </span><a href="http://hexo.io"><span>Hexo</span></a><span> | theme </span><a href="https://github.com/Longlongyu/hexo-theme-Cxo"><span>Cxo</span></a></p><p class="beian"><span>备案号:苏ICP备18015439号</span></p><i class="fa fa-user"> </i><span id="busuanzi_value_site_uv"></span><span> | </span><i class="fa fa-eye"> </i><span id="busuanzi_value_site_pv"></span></div></footer><!-- catelog--><div class="toc-wrapper" style="top: 60vh;"><div class="toc-catalog"><i class="fa fa-list"> </i><span>CATALOG</span></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#简介"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ansible-特点"><span class="toc-number">2.</span> <span class="toc-text">ansible 特点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Ansible安装"><span class="toc-number">3.</span> <span class="toc-text">Ansible安装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ansible-架构图"><span class="toc-number">4.</span> <span class="toc-text">ansible 架构图</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ansible配置文件查找顺序"><span class="toc-number">5.</span> <span class="toc-text">ansible配置文件查找顺序</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#使用特性"><span class="toc-number">6.</span> <span class="toc-text">使用特性</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#管理方式"><span class="toc-number">7.</span> <span class="toc-text">管理方式:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#相关文件"><span class="toc-number">8.</span> <span class="toc-text">相关文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#配置文件"><span class="toc-number">8.1.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#程序"><span class="toc-number">8.2.</span> <span class="toc-text">程序</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ad-hoc使用"><span class="toc-number">9.</span> <span class="toc-text">ad-hoc使用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ansible的Host-pattern即匹配主机的列表"><span class="toc-number">10.</span> <span class="toc-text">ansible的Host-pattern即匹配主机的列表</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ansible-command"><span class="toc-number">11.</span> <span class="toc-text">ansible command</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#命令返回颜色说明"><span class="toc-number">11.1.</span> <span class="toc-text">命令返回颜色说明</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#常用模块"><span class="toc-number">12.</span> <span class="toc-text">常用模块</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#系列命令"><span class="toc-number">13.</span> <span class="toc-text">系列命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#galaxy"><span class="toc-number">13.1.</span> <span class="toc-text">galaxy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#playbooks"><span class="toc-number">13.2.</span> <span class="toc-text">playbooks</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#核心元素"><span class="toc-number">13.2.1.</span> <span class="toc-text">核心元素</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#加密"><span class="toc-number">13.3.</span> <span class="toc-text">加密</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基础组件"><span class="toc-number">13.4.</span> <span class="toc-text">基础组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#运行playbook的方式"><span class="toc-number">13.5.</span> <span class="toc-text">运行playbook的方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#handlers和notify"><span class="toc-number">13.6.</span> <span class="toc-text">handlers和notify</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#变量使用"><span class="toc-number">13.7.</span> <span class="toc-text">变量使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#迭代机制"><span class="toc-number">13.8.</span> <span class="toc-text">迭代机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#迭代嵌套自变量"><span class="toc-number">13.8.1.</span> <span class="toc-text">迭代嵌套自变量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#条件判断"><span class="toc-number">13.9.</span> <span class="toc-text">条件判断</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#权限问题"><span class="toc-number">13.10.</span> <span class="toc-text">权限问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#个人写过的Playbook-demo"><span class="toc-number">13.11.</span> <span class="toc-text">个人写过的Playbook-demo</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#roles"><span class="toc-number">14.</span> <span class="toc-text">roles</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#附录"><span class="toc-number">15.</span> <span class="toc-text">附录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible-配置SSH公钥认证"><span class="toc-number">15.1.</span> <span class="toc-text">Ansible 配置SSH公钥认证</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用公钥密钥对验证的方法登录"><span class="toc-number">15.1.1.</span> <span class="toc-text">使用公钥密钥对验证的方法登录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#在多台远程主机中创建用户"><span class="toc-number">15.2.</span> <span class="toc-text">在多台远程主机中创建用户</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一键挂载NFS"><span class="toc-number">15.3.</span> <span class="toc-text">一键挂载NFS:</span></a></li></ol></li></ol></div><!-- top--><i class="fa fa-arrow-up close" id="go-up" aria-hidden="true"></i></body></html>
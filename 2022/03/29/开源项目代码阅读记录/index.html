<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><meta name="author" content="Mrli"><meta name="renderer" content="webkit"><meta name="copyright" content="Mrli"><meta name="keywords" content="Mrli's Blog"><meta name="description" content="想和你讲，说了会心动 ，缄默会心安。"><meta name="Cache-Control" content="no-cache"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>开源项目代码阅读记录 · Mr.li's Blog</title><link rel="stylesheet" href="/css/style.css?v=2018.7.9"><link rel="stylesheet" href="/css/animation.css?v=2018.7.9"><link rel="icon" href="/img/assets/favicon.ico"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.6"><!-- scripts--><script>(function( w ){
  "use strict";
  // rel=preload support test
  if( !w.loadCSS ){
    w.loadCSS = function(){};
  }
  // define on the loadCSS obj
  var rp = loadCSS.relpreload = {};
  // rel=preload feature support test
  // runs once and returns a function for compat purposes
  rp.support = (function(){
    var ret;
    try {
      ret = w.document.createElement( "link" ).relList.supports( "preload" );
    } catch (e) {
      ret = false;
    }
    return function(){
      return ret;
    };
  })();

  // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
  // then change that media back to its intended value on load
  rp.bindMediaToggle = function( link ){
    // remember existing media attr for ultimate state, or default to 'all'
    var finalMedia = link.media || "all";

    function enableStylesheet(){
      link.media = finalMedia;
    }

    // bind load handlers to enable media
    if( link.addEventListener ){
      link.addEventListener( "load", enableStylesheet );
    } else if( link.attachEvent ){
      link.attachEvent( "onload", enableStylesheet );
    }

    // Set rel and non-applicable media type to start an async request
    // note: timeout allows this to happen async to let rendering continue in IE
    setTimeout(function(){
      link.rel = "stylesheet";
      link.media = "only x";
    });
    // also enable media after 3 seconds,
    // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
    setTimeout( enableStylesheet, 3000 );
  };

  // loop through link elements in DOM
  rp.poly = function(){
    // double check this to prevent external calls from running
    if( rp.support() ){
      return;
    }
    var links = w.document.getElementsByTagName( "link" );
    for( var i = 0; i < links.length; i++ ){
      var link = links[ i ];
      // qualify links to those with rel=preload and as=style attrs
      if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
        // prevent rerunning on link
        link.setAttribute( "data-loadcss", true );
        // bind listeners to toggle media back
        rp.bindMediaToggle( link );
      }
    }
  };

  // if unsupported, run the polyfill
  if( !rp.support() ){
    // run once at least
    rp.poly();

    // rerun poly on an interval until onload
    var run = w.setInterval( rp.poly, 500 );
    if( w.addEventListener ){
      w.addEventListener( "load", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    } else if( w.attachEvent ){
      w.attachEvent( "onload", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    }
  }


  // commonjs
  if( typeof exports !== "undefined" ){
    exports.loadCSS = loadCSS;
  }
  else {
    w.loadCSS = loadCSS;
  }
}( typeof global !== "undefined" ? global : this ) );</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" defer></script><script src="/js/main.js?v=2018.7.9" defer></script><!-- fancybox--><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script><!-- busuanzi--><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></head><body><section class="profile-close" id="cxo-profile"><div class="profile-avatar"><i class="fa fa-caret-left"></i><img src="https://avatars1.githubusercontent.com/u/31088082?s=400&amp;u=7a99ff83916afb3f4c5312bd78a1be17fe0e34ed&amp;v=4"></div><!--.profile-saying
  i.fa.fa-comment
  .saying--><div class="cxo-profile-inner"><div class="profile-name">Mrli</div><div class="profile-signature">别装作很努力,<br>因为结局不会陪你演戏。</div><div class="contacts"><div>Contacts:</div><span><a href="http://sighttp.qq.com/msgrd?v=1&amp;uin=1063052964" target="_black">QQ</a></span><span><a href="https://www.cnblogs.com/nymrli/" target="_black">博客园</a></span></div><div class="read-progress"></div></div></section><header id="cxo-intro" style="height: 60vh;background-image: url(/img/intro/index-bg.png);"><nav id="cxo-intro-nav"><section><div class="intro-nav-title"><a href="/">Mr.li's Blog</a></div><div class="intro-nav-label-box"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div><i class="fa fa-bars intro-nav-menu"><div class="intro-nav-drop"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div></i><div class="clear"></div></section></nav><h1 class="post-title">开源项目代码阅读记录</h1><div class="post-intros"><div class="post-intro-meta"><span class="post-intro-time"><i class="post-intro-calendar fa fa-edit"></i><span>2022/05/29</span></span><span class="busuanzi-pv" id="busuanzi_container_page_pv"><i class="post-intro-calendar fa fa-user-o"></i><span id="busuanzi_value_page_pv"></span></span><span class="post-intro-tags"><a class="intro-tag fa fa-tag" href="javascript:void(0)" date-tags="代码阅读"> 代码阅读</a></span></div><div class="post-intro-read"><span> Word count: <span class="post-count">15,047</span> | Reading time: <span class="post-count">68</span>min</span></div></div></header><article class="cxo-up" id="cxo-content-outer"><section id="cxo-content-inner"><article class="article-entry" id="post"><h1 id="爬虫系列"><a class="markdownIt-Anchor" href="#爬虫系列"></a> 爬虫系列</h1>
<h2 id="抢购-秒杀"><a class="markdownIt-Anchor" href="#抢购-秒杀"></a> 抢购、秒杀</h2>
<h3 id="taobao_seckill"><a class="markdownIt-Anchor" href="#taobao_seckill"></a> <strong><a href="https://github.com/jerry3747/taobao_seckill" target="_blank" rel="noopener"> taobao_seckill</a></strong></h3>
<blockquote>
<p>淘宝秒杀物品：分为selenium版和request网络请求版，微小的区别在于，api先请求的是购物车的物品信息，selenium则是勾选选择框。</p>
<p>流程大致都相同：①keep_wait等待临近抢购时间-----&gt;②将需要的信息缓存住，不再刷新（比如要抢购的物品信息、cookies…）-----&gt;③进行结算(/点击按钮)-----&gt;④提交订单(/点击按钮)-----&gt;⑤支付订单(/点击按钮)；</p>
</blockquote>
<ul>
<li>
<p><a href="https://www.cnblogs.com/amiza/p/10175543.html" target="_blank" rel="noopener">使用browsercookie来管理浏览器cookies</a>——从浏览器提取保存的cookies的工具。它是一个很有用的爬虫工具，通过加载你浏览器的cookies到一个cookiejar对象里面，让你轻松下载需要登录的网页内容。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>cj = browsercookie.chrome()	<span class="comment"># browsercookie.load() 在不知道或者不关心浏览器时使用</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(url, cookies=cj)</span><br></pre></td></tr></table></figure>
<p>一般情况下，作为开发者的我们都是将cookies手动写入或者是传入程序的，而browsercookie用途，我想可以是将需要传入cookies的程序打包给不会提取Cookies的用户使用。（类似通过selenium登陆后，拿取cookies再发送网络请求，这边是让/借助用户自己的浏览器来拿取cookies）</p>
</li>
<li>
<p>使用tkinter搭建简单的GUI：点击“开始”的按钮后会将密码框和抢购设置时间框的内容传入，作为实例化ChromeDriverSpider的参数，并运行实例的sec_kill方法开始执行抢购</p>
</li>
<li>
<p>配置chromeDriver启动配置项</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_chrome_options</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""配置启动项"""</span></span><br><span class="line">    chrome_options = webdriver.ChromeOptions()</span><br><span class="line">    chrome_options.accept_untrusted_certs = <span class="keyword">True</span></span><br><span class="line">    chrome_options.assume_untrusted_cert_issuer = <span class="keyword">True</span></span><br><span class="line">    arguments = [<span class="string">'--no-sandbox'</span>, <span class="string">'--disable-impl-side-painting'</span>, <span class="string">'--disable-setuid-sandbox'</span>, <span class="string">'--disable-seccomp-filter-sandbox'</span>,</span><br><span class="line">    <span class="string">'--disable-breakpad'</span>, <span class="string">'--disable-client-side-phishing-detection'</span>, <span class="string">'--disable-cast'</span>,</span><br><span class="line">    <span class="string">'--disable-cast-streaming-hw-encoding'</span>, <span class="string">'--disable-cloud-import'</span>, <span class="string">'--disable-popup-blocking'</span>,</span><br><span class="line">    <span class="string">'--ignore-certificate-errors'</span>, <span class="string">'--disable-session-crashed-bubble'</span>, <span class="string">'--disable-ipv6'</span>,</span><br><span class="line">    <span class="string">'--allow-http-screen-capture'</span>, <span class="string">'--start-maximized'</span>]</span><br><span class="line">    <span class="keyword">for</span> arg <span class="keyword">in</span> arguments:</span><br><span class="line">    chrome_options.add_argument(arg)</span><br><span class="line">    chrome_options.add_argument(<span class="string">f'--user-agent=<span class="subst">&#123;choice(get_useragent_data())&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">return</span> chrome_options</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="taobao_api"><a class="markdownIt-Anchor" href="#taobao_api"></a> <strong><a href="https://github.com/gaoxt/taobao_api" target="_blank" rel="noopener">taobao_api</a></strong></h3>
<blockquote>
<p>selenium和api结合：登陆逻辑使用了selenium，刷新购物车和下单调用了手机淘宝taobao_api，自动付款也使用了selenium，能自动模拟触摸输入密码付款，接口签名sign生成方法参考get_sign_val。</p>
</blockquote>
<ul>
<li>
<p>同步阿里云时间服务器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#一次性设置</span></span><br><span class="line">sudo sntp -sS ntp.aliyun.com</span><br><span class="line"><span class="comment">#永久设置</span></span><br><span class="line">sudo systemsetup -setnetworktimeserver ntp.aliyun.com</span><br><span class="line">sudo systemsetup -setusingnetworktime on</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>展示QRCode</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment"># 找到二维码图片的链接</span></span><br><span class="line">   img = WebDriverWait(browser, <span class="number">2</span>, <span class="number">0.1</span>).until(</span><br><span class="line">       EC.presence_of_element_located((By.XPATH, <span class="string">"//div[@id='J_QRCodeImg']/img"</span>))).get_attribute(<span class="string">'src'</span>)</span><br><span class="line">   <span class="comment"># 获得图片字节流内容</span></span><br><span class="line">   img_content = requests.get(img, timeout=<span class="number">5</span>).content</span><br><span class="line">   <span class="comment"># 保存到本地图片中</span></span><br><span class="line">   file_name = <span class="string">'taobao_qrcode.png'</span></span><br><span class="line">   fp = open(file_name, <span class="string">'wb'</span>)</span><br><span class="line">   fp.write(img_content)</span><br><span class="line">   fp.close()</span><br><span class="line"><span class="comment"># 将其解码成链接， pyzbar为二维码和条形码库 ==&gt; 个人觉得保存后可以直接转成PIL的Image然后img.show()</span></span><br><span class="line">   <span class="keyword">from</span> pyzbar.pyzbar <span class="keyword">import</span> decode</span><br><span class="line">   barcode_url = <span class="string">''</span></span><br><span class="line">   barcodes = decode(Image.open(file_name))</span><br><span class="line">   <span class="keyword">for</span> barcode <span class="keyword">in</span> barcodes:</span><br><span class="line">       <span class="comment"># 解析获得二维码后的内容；如果是条形码，则返回条形码数</span></span><br><span class="line">       barcode_url = barcode.data.decode(<span class="string">"utf-8"</span>)</span><br><span class="line"><span class="comment"># 生成二维码并通过控制台打印</span></span><br><span class="line">   qr = qrcode.QRCode()</span><br><span class="line">   qr.add_data(barcode_url)</span><br><span class="line">   qr.print_ascii(invert=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure>
<p>注：<a href="http://zbar.sourceforge.net/" target="_blank" rel="noopener">ZBar</a>是一个开源软件套件，用于从各种来源（如视频流、图像文件和原始强度传感器）读取条形码；<code>pyzbar</code> 是通过 <code>Python2</code>和<code>3</code>接口，使用 <code>ZBar</code> 库读取一维条形码和QR码 。=&gt;<a href="https://blog.csdn.net/qq_37924224/article/details/109582507" target="_blank" rel="noopener">读取条形码</a>、<a href="https://blog.csdn.net/hxj0323/article/details/112969622" target="_blank" rel="noopener">读取二维码</a></p>
</li>
</ul>
<h3 id="jd_seckill"><a class="markdownIt-Anchor" href="#jd_seckill"></a> <strong><a href="https://github.com/andyzys/jd_seckill" target="_blank" rel="noopener">jd_seckill</a></strong></h3>
<blockquote>
<ol>
<li>预约商品</li>
<li>秒杀抢购商品: ①<strong>访问</strong>商品的抢购<strong>链接</strong>（用于设置cookie等—&gt;②访问抢购订单<strong>结算页面</strong>----&gt;③<strong>提交抢</strong>购（秒杀）<strong>订单</strong> [_get_seckill_order_data生成提交抢购订单所需的请求体参数、获取秒杀初始化信息（包括：地址，发票，token）]</li>
</ol>
</blockquote>
<ul>
<li>
<p>从UAList中通过<code>random.choice(USER_AGENTS)</code>随机UA</p>
</li>
<li>
<p>使用内置configparser模块解析config.ini</p>
<ul>
<li>RawConfigParser是最基础的INI文件读取类；ConfigParser、SafeConfigParser<a href="https://blog.csdn.net/miner_k/article/details/77857292" target="_blank" rel="noopener">支持对%(value)s变量的解析</a>，SafeConfigParser类实现了ConfigParser相同的接口，新增如下方法：set存在保存的方法</li>
<li>section下的option(key)可以不填value值，即为空。</li>
<li>from: <a href="https://blog.csdn.net/tianzhu123/article/details/6893755" target="_blank" rel="noopener">python中RawConfigParser类、ConfigParser类、SafeConfigParser类中函数介绍</a>、</li>
</ul>
</li>
<li>
<p>多进程池：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ProcessPoolExecutor</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> ProcessPoolExecutor(work_count) <span class="keyword">as</span> pool:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(work_count):</span><br><span class="line">        pool.submit(self.seckill)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>秒杀时间比较</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">buy_time = datetime.strptime(global_config.getRaw(<span class="string">'config'</span>,<span class="string">'buy_time'</span>), <span class="string">"%Y-%m-%d %H:%M:%S.%f"</span></span><br><span class="line">now_time = datetime.now</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="keyword">if</span> now_time() &gt;= buy_time:</span><br><span class="line">        logger.info(<span class="string">'时间到达，开始执行……'</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		time.sleep(self.sleep_interval)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><a href="https://github.com/woxiqingxian/jd_seckill/pull/2/commits/63a41a0609912d5643bc11f3419fe7dd8e84a00a" target="_blank" rel="noopener">获取京东服务器时间</a>：<code>https://api.m.jd.com/client.action?functionId=queryMaterialProducts&amp;client=wh5</code></p>
</li>
</ul>
<h3 id="jd-assistant"><a class="markdownIt-Anchor" href="#jd-assistant"></a> <strong><a href="https://github.com/tychxn/jd-assistant" target="_blank" rel="noopener">jd-assistant★</a></strong></h3>
<blockquote>
<p>是<a href="#jd_seckill">jd_seckill</a>的优化进阶版本</p>
<ul>
<li>
<p>普通商品购买主要流程：<code>(1)清空购物车</code> --&gt; <code>(2)添加商品到购物车</code> --&gt; <code>(3)提交订单</code></p>
</li>
<li>
<p>预约抢购商品特点：</p>
<ol>
<li>需要提前点击预约</li>
<li>大部分此类商品在预约后自动加入购物车，但是无法勾选✓，也无法️进入到结算页面</li>
<li>到了抢购的时间点后将商品加入购物车，此时才能勾选并下单</li>
</ol>
</li>
<li>
<p>普通商品：能加入购物车🛒，然后进入购物车结算下单.</p>
</li>
<li>
<p>抢购商品：需提提前预约，开始抢购时有“立即抢购”按钮🔘，点击按钮后商品加入购物车，然后结算下单.</p>
</li>
</ul>
<p>⭐️抢购受多种因素影响：<strong>网速、账号质量、运气</strong>等等，仅供娱乐，认真就输了.</p>
</blockquote>
<ul>
<li>
<p>deprecated、check_login装饰器：传入了self参数，并通过self实例调用了类的其他成员方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_login</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="string">"""用户登陆态校验装饰器。若用户未登陆，则调用扫码登陆"""</span></span><br><span class="line"><span class="meta">    @functools.wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">new_func</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.is_login:</span><br><span class="line">            logger.info(<span class="string">"&#123;0&#125; 需登陆后调用，开始扫码登陆"</span>.format(func.__name__))</span><br><span class="line">            self.login_by_QRcode()</span><br><span class="line">        <span class="keyword">return</span> func(self, *args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> new_func</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>密码加密——<strong><a href="https://github.com/Legrandin/pycryptodome" target="_blank" rel="noopener">pycryptodome</a></strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_v1_5 <span class="keyword">as</span> Cipher_pkcs1_v1_5</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt_pwd</span><span class="params">(password, public_key=RSA_PUBLIC_KEY)</span>:</span></span><br><span class="line">    rsa_key = RSA.importKey(public_key)</span><br><span class="line">    encryptor = Cipher_pkcs1_v1_5.new(rsa_key)</span><br><span class="line">    cipher = b64encode(encryptor.encrypt(password.encode(<span class="string">'utf-8'</span>)))</span><br><span class="line">    <span class="keyword">return</span> cipher.decode(<span class="string">'utf-8'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>提供JS脚本文件来获取商品的信息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下代码在订单结算页面的开发者工具Console中执行，用于获取必要的参数</span></span><br><span class="line"><span class="keyword">var</span> eid = $(<span class="string">'#eid'</span>).val();</span><br><span class="line"><span class="keyword">var</span> fp = $(<span class="string">'#fp'</span>).val();</span><br><span class="line"><span class="keyword">var</span> trackId = getTakId();</span><br><span class="line"><span class="keyword">var</span> riskControl = $(<span class="string">'#riskControl'</span>).val();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`eid = <span class="subst">$&#123;eid&#125;</span>\nfp = <span class="subst">$&#123;fp&#125;</span>\ntrack_id = <span class="subst">$&#123;trackId&#125;</span>\nrisk_control = <span class="subst">$&#123;riskControl&#125;</span>`</span>);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>cookies验证-通过读取本地保存的cookies时要先验证下cookies是否有效：requests库的使用方式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_validate_cookies</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""验证cookies是否有效（是否登陆）</span></span><br><span class="line"><span class="string">    通过访问用户订单列表页进行判断：若未登录，将会重定向到登陆页面。</span></span><br><span class="line"><span class="string">    :return: cookies是否有效 True/False</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    url = <span class="string">'https://order.jd.com/center/list.action'</span></span><br><span class="line">    payload = &#123;</span><br><span class="line">        <span class="string">'rid'</span>: str(int(time.time() * <span class="number">1000</span>)),</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        resp = self.sess.get(url=url, params=payload, allow_redirects=<span class="keyword">False</span>)</span><br><span class="line">        <span class="keyword">if</span> resp.status_code == requests.codes.OK:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        logger.error(e)</span><br><span class="line">    <span class="comment"># 创建新的session</span></span><br><span class="line">    self.sess = requests.session()</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">False</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>二维码登录：下载二维码<code>_get_QRcode</code>–&gt;询问获取二维码扫描状态<code>_get_QRcode_ticket</code>—&gt;验证二维码信息(<code>_validate_QRcode_ticket</code>)–&gt;设置<code>is_login=True和save_cookies</code>（二维码有效期约120s，浏览器大约2s发送一个请求询问扫描状态）——看代码是assistant参考了2018年的**<a href="https://github.com/adyzng/jd-autobuy" target="_blank" rel="noopener">jd-autobuy</a>**</p>
</li>
<li>
<p>扫描二维码：写入图片和打开图片</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_image</span><span class="params">(resp, image_file)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(image_file, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="comment"># 从网络请求中下载内容</span></span><br><span class="line">        <span class="keyword">for</span> chunk <span class="keyword">in</span> resp.iter_content(chunk_size=<span class="number">1024</span>):</span><br><span class="line">            f.write(chunk)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">open_image</span><span class="params">(image_file)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> os.name == <span class="string">"nt"</span>:</span><br><span class="line">        os.system(<span class="string">'start '</span> + image_file)  <span class="comment"># for Windows</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> os.uname()[<span class="number">0</span>] == <span class="string">"Linux"</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">"deepin"</span> <span class="keyword">in</span> os.uname()[<span class="number">2</span>]:</span><br><span class="line">                os.system(<span class="string">"deepin-image-viewer "</span> + image_file)  <span class="comment"># for deepin</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                os.system(<span class="string">"eog "</span> + image_file)  <span class="comment"># for Linux</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            os.system(<span class="string">"open "</span> + image_file)  <span class="comment"># for Mac</span></span><br></pre></td></tr></table></figure>
<p>注：判断操作系统还可以借助内置的platform库<code>platform.system().lower()</code>得到[linux、windows、mac]</p>
</li>
</ul>
<p>▲cookies和二维码结合使用：</p>
<ol>
<li>如果登陆成功则吧cookies持久化</li>
<li>使用二维码登陆前，先加载验证之前持久化的cookies是否有效，如果有效则无需再次扫码登陆(在QRCode_login的起始位置判断validation中修改的is_login是否为True)</li>
</ol>
<h3 id="jd-seckill-maotai"><a class="markdownIt-Anchor" href="#jd-seckill-maotai"></a> <strong><a href="https://github.com/hello8817/jd-seckill-maotai" target="_blank" rel="noopener"> jd-seckill-maotai</a></strong></h3>
<blockquote>
<ul>
<li>
<h2 id="主要功能"><a class="markdownIt-Anchor" href="#主要功能"></a> 主要功能</h2>
<ul>
<li>登陆京东商城（<a href="http://www.jd.com" target="_blank" rel="noopener">www.jd.com</a>）
<ul>
<li>用京东APP扫码给出的二维码</li>
</ul>
</li>
<li>预约茅台
<ul>
<li>定时自动预约</li>
</ul>
</li>
<li>秒杀预约后等待抢购
<ul>
<li>定时开始自动抢购</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>特别声明：</strong></p>
<ul>
<li>本仓库发布的<code>jd_seckill_maotai</code>项目中涉及的任何脚本，仅用于测试和学习研究，禁止用于商业用途，不能保证其合法性，准确性，完整性和有效性，请根据情况自行判断。</li>
<li>本项目内所有资源文件，禁止任何公众号、自媒体进行任何形式的转载、发布。</li>
<li><code>ChinaVolvocars</code> 对任何脚本问题概不负责，包括但不限于由任何脚本错误导致的任何损失或损害.</li>
<li>请勿将<code>jd_seckill_maotai</code>项目的任何内容用于商业或非法目的，否则后果自负。</li>
<li>如果任何单位或个人认为该项目的脚本可能涉嫌侵犯其权利，则应及时通知并提供身份证明，所有权证明，我们将在收到认证文件后删除相关脚本。</li>
<li>您必须在下载后的24小时内从计算机或手机中完全删除以上内容。</li>
<li>本项目遵循<code>GPL-3.0 License</code>协议，如果本特别声明与<code>GPL-3.0 License</code>协议有冲突之处，以本特别声明为准。</li>
<li><em><strong>您使用或者复制了本仓库且本人制作的任何代码或项目，则视为<code>已接受</code>此声明，请仔细阅读</strong></em><br>
<em><strong>您在本声明未发出之时点使用或者复制了本仓库且本人制作的任何代码或项目且此时还在使用，则视为<code>已接受</code>此声明，请仔细阅读</strong></em></li>
</ul>
</blockquote>
<blockquote>
<p>根据12月14日以来抢茅台的日志分析，大胆推断再接再厉返回Json消息中<code>resultCode</code>与<strong>小白信用</strong>的关系。<br>
这里主要分析出现频率最高的<code>90016</code>和<code>90008</code>。</p>
<table>
<thead>
<tr>
<th>案例</th>
<th>小白信用</th>
<th>90016</th>
<th>90008</th>
<th>抢到耗时</th>
</tr>
</thead>
<tbody>
<tr>
<td>张三</td>
<td>63.8</td>
<td>59.63%</td>
<td>40.37%</td>
<td>暂未抢到</td>
</tr>
<tr>
<td>李四</td>
<td>92.9</td>
<td>72.05%</td>
<td>27.94%</td>
<td>4天</td>
</tr>
<tr>
<td>王五</td>
<td>99.6</td>
<td>75.70%</td>
<td>24.29%</td>
<td>暂未抢到</td>
</tr>
<tr>
<td>赵六</td>
<td>103.4</td>
<td>91.02%</td>
<td>8.9%</td>
<td>2天</td>
</tr>
</tbody>
</table>
<p>风控放行后才会进行抢购，这时候用的应该是水库计数模型，假设无法一次性拿到所有数据的情况下来尽量的做到抢购成功用户的均匀分布，这样就和概率相关了。</p>
<p><strong>抢购结果确认</strong></p>
<p>抢购是否成功通常在程序开始的一分钟内可见分晓！<br>
搜索日志，出现“抢购成功，订单号xxxxx&quot;，代表成功抢到了，务必半小时内支付订单！程序暂时不支持自动停止，需要手动STOP！<br>
若两分钟还未抢购成功，基本上就是没抢到！程序暂时不支持自动停止，需要手动STOP！</p>
</blockquote>
<ul>
<li>
<p>在程序开始运行后，会检测本地时间与京东服务器时间，输出的差值为【本地时间-京东服务器时间】，即-50为本地时间比京东服务器时间慢50ms。 本代码的执行的抢购时间以本地电脑/服务器时间为准</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, ...)</span>:</span></span><br><span class="line">    <span class="comment"># 初始化误差</span></span><br><span class="line">	self.diff_time = self.local_time() - self.jd_time()</span><br><span class="line"><span class="comment"># ....</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="comment"># 本地时间减去与京东的时间差(ms)，能够将时间误差提升到0.1秒附近, 具体精度依赖获取京东服务器时间的网络时间损耗</span></span><br><span class="line">    <span class="keyword">if</span> self.local_time() - self.diff_time &gt;= self.buy_time_ms:</span><br><span class="line">        logger.info(<span class="string">'时间到达，开始执行……'</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            time.sleep(self.sleep_interval)</span><br></pre></td></tr></table></figure>
<p>补充：Python的时间戳默认都是秒级别的，如果要ms级别的，则要乘以1000</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">通过time，以元组（struct_time）为核心实现时间戳和格式化时间字符串的相互转换。</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="comment"># 获得10位秒级时间戳</span></span><br><span class="line">seconds = time.time()</span><br><span class="line"><span class="comment"># 获得13位毫秒级时间戳==&gt;java默认13位</span></span><br><span class="line">millis = int(round(time.time() * <span class="number">1000</span>))</span><br><span class="line"><span class="comment"># 同样，time下的mktime也需要*1000</span></span><br><span class="line">time.mktime(self.buy_time.timetuple()) * <span class="number">1000.0</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">通过datetime，以datetime类实例对象为核心实现时间戳和格式化时间字符串的相互转换。</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="comment"># 获得当前时间</span></span><br><span class="line">now = datetime.now()</span><br><span class="line">timestamp = datetime.timestamp(now)</span><br><span class="line">print(<span class="string">"时间戳 ="</span>, timestamp)</span><br><span class="line"><span class="comment"># 也是10位s级</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1648622589.624272</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="jd_mask"><a class="markdownIt-Anchor" href="#jd_mask"></a> <strong><a href="https://github.com/Lasx/jd_mask" target="_blank" rel="noopener">jd_mask</a></strong></h3>
<blockquote>
<p>此tool只单独支持<strong>预约-抢购-成功后直接提交订单</strong>的商品，如[口罩]，只提供学习参考用途.</p>
</blockquote>
<p>Ⓜ️阅读了多份京东抢购的代码后，发现基本都是从一个模板里不断优化发展出来的，反应了开源的意义，也反应了京东部分细节的修改，同时也能得到一个告示：在实现相同功能前，不妨多看看、借鉴下以往可行的代码。</p>
<h3 id="automatic_ticket_purchase"><a class="markdownIt-Anchor" href="#automatic_ticket_purchase"></a> <strong><a href="https://github.com/MakiNaruto/Automatic_ticket_purchase" target="_blank" rel="noopener">Automatic_ticket_purchase</a></strong></h3>
<p>大麦网抢购流程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A[开始] --&gt; B(登陆)</span><br><span class="line">    B --&gt; C&#123;是否利用cookies登陆&#125;</span><br><span class="line">    C --&gt; |否| D[页面登陆]</span><br><span class="line">    C --&gt; |是| E[登陆验证]</span><br><span class="line">    D --&gt; E</span><br><span class="line">    E --&gt; G&#123;是否登陆成功&#125;</span><br><span class="line">    G --&gt; |是| F[获取购票必要信息]</span><br><span class="line">    G --&gt; |否|ED</span><br><span class="line">    F --&gt; L[检测抢票现在购票状态]</span><br><span class="line">    L --&gt; M&#123;目标票可进行抢购&#125;</span><br><span class="line">    M --&gt; |即将开抢|L</span><br><span class="line">    M --&gt; |缺货登记|ED((结束))</span><br><span class="line">	M --&gt; |立刻购买|N&#123;抢购&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>跟限时、定时秒杀不同的是，大麦网的抢购信息是靠不断刷新的，需要通过不断检测页面内容，判断目前票的可否购买情况。如果刷新为可购买则进行抢购购买。</p>
</blockquote>
<ul>
<li>
<p>点击购买是对指定接口发送请求，并更新cookies(cookies嫌少不嫌多)：step2_click_buy_now</p>
</li>
<li>
<p>提交订单：step3_submit_order</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">response = self.session.post(<span class="string">'https://buy.damai.cn/multi/trans/createOrder'</span>,</span><br><span class="line">                             headers=headers,</span><br><span class="line">                             params=params,</span><br><span class="line">                             data=submit_order_info,</span><br><span class="line">                             cookies=self.login_cookies)</span><br><span class="line">buy_status = json.loads(response.text)</span><br><span class="line"><span class="keyword">if</span> buy_status.get(<span class="string">'success'</span>) <span class="keyword">is</span> <span class="keyword">True</span> <span class="keyword">and</span> buy_status.get(<span class="string">'module'</span>).get(<span class="string">'alipayOrderId'</span>):</span><br><span class="line">    print(<span class="string">'-'</span> * <span class="number">10</span>, <span class="string">'抢票成功, 请前往 大麦网-&gt;我的大麦-&gt;交易中心-&gt;订单管理 确认订单'</span>, <span class="string">'-'</span> * <span class="number">10</span>)</span><br><span class="line">    print(<span class="string">'alipayOrderId: '</span>, buy_status.get(<span class="string">'module'</span>).get(<span class="string">'alipayOrderId'</span>))</span><br><span class="line">    print(<span class="string">'支付宝支付链接: '</span>, buy_status.get(<span class="string">'module'</span>).get(<span class="string">'alipayWapCashierUrl'</span>))</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="nikerobot"><a class="markdownIt-Anchor" href="#nikerobot"></a> <strong><a href="https://github.com/cxiaoer/NikeRobot" target="_blank" rel="noopener"> NikeRobot</a></strong></h3>
<ul>
<li>
<p>pdb调试断点：==&gt;实际上Pycharm的调试更加好用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> DEBUG:</span><br><span class="line">	pdb.set_trace()</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>将类成员属性转成字典形式: <code>NikeLoginParam().__dict__</code></p>
</li>
<li>
<p>自己管理线程：创建继承Thread的执行类，重写run方法，在main中进行创建多个实例MyThread().start()，并join住。</p>
</li>
</ul>
<h3 id="hpv4g"><a class="markdownIt-Anchor" href="#hpv4g"></a> <strong><a href="https://github.com/xiangmingzhe0928/hpv4g" target="_blank" rel="noopener">hpv4g</a>★</strong></h3>
<ul>
<li>
<p>是否使用代理：<code>init_ip_proxy_pool</code></p>
</li>
<li>
<p>多线程参数设置: python3.8中ThreadPoolExecutor的默认worker：<code>max_workers = min(32, os.cpu_count() + 4)</code></p>
</li>
<li>
<p>线程池：ThreadPoolExecutor</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor, wait, FIRST_COMPLETED</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> ThreadPoolExecutor(max_workers=max_workers) <span class="keyword">as</span> t:</span><br><span class="line">    fs = [t.submit(sec_kill_task, miao_miao, params[i % _params_len],</span><br><span class="line">                   <span class="keyword">None</span> <span class="keyword">if</span> <span class="keyword">not</span> _ip_proxys_len <span class="keyword">else</span> &#123;</span><br><span class="line">                       <span class="string">'http'</span>: <span class="keyword">None</span> <span class="keyword">if</span> (index := i % _ip_proxys_len) == <span class="number">0</span> <span class="keyword">else</span> ip_proxys[index]&#125;) <span class="keyword">for</span> i <span class="keyword">in</span></span><br><span class="line">          range(max_workers + <span class="number">5</span>)]</span><br><span class="line">    <span class="comment"># 120S后结束任务, 有一个完成则完成</span></span><br><span class="line">    wait(fs, <span class="number">120</span>, return_when=FIRST_COMPLETED)</span><br><span class="line">    <span class="keyword">global</span> KILL_FLAG</span><br><span class="line">    KILL_FLAG = <span class="keyword">True</span></span><br><span class="line">    print(<span class="string">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;本轮未成功秒杀到疫苗&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>缓存配置——非默认参数的装饰器：考虑提前缓存疫苗列表 秒杀开始后跳过查询列表等操作 直接调用秒杀接口</p>
</li>
<li>
<p>获取服务器当前时间戳</p>
</li>
<li>
<p>直接设置logging中的log</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="comment"># 设置配置</span></span><br><span class="line">logging.basicConfig(handlers=[logging.FileHandler(filename=LOG_NAME,</span><br><span class="line">                                                  encoding=<span class="string">'utf-8'</span>, mode=<span class="string">'a+'</span>)],</span><br><span class="line">                    format=<span class="string">'%(asctime)s %(message)s'</span>,</span><br><span class="line">                    level=getattr(logging, args.log))</span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">logging.info(<span class="string">"xxx"</span>)</span><br><span class="line">logging.debug(<span class="string">"yyy"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>argueparser使用：</p>
<ul>
<li>
<p>action参数: <code>parser.add_argument('-reload_cache', action='store_true', help='刷新--region_code疫苗列表本地缓存')</code>，出现reload_cache参数则为true，所以默认为false</p>
</li>
<li>
<p><code>parser.add_argument('--log', default='WARNING', choices=['DEBUG', 'INFO', 'WARNING', 'ERROR'],help='日志级别 默认WARNING')</code></p>
</li>
<li>
<p>add_argument中的type实际上是个类型转化器，如type=int，如果无法转成int则报错，因此可以借此参数对输入进行约束</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_valid_int_type</span><span class="params">(i)</span>:</span></span><br><span class="line">    valid_int = int(i)</span><br><span class="line">    <span class="keyword">if</span> valid_int &lt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> argparse.ArgumentTypeError(<span class="string">f'invalid int argument:<span class="subst">&#123;i&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">return</span> valid_int</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>requests使用：</p>
<ul>
<li>
<p><code>raise_for_status</code>状态码非成功时抛出异常</p>
</li>
<li>
<p>自定义<code>_get(url, params=None, error_exit=True, **kwargs)</code>方法，添加参数：error_exit:返回4XX 5XX错误时 是否退出</p>
</li>
<li>
<p>cookies除了放在requests.get(cookies=xxxCookieDict)，还可以作为字符串设置在header[“<strong>cookie</strong>”]中（无s），如<code>self._headers[&quot;cookie&quot;]=&quot;k1=v1;_xxhm_=%7B%2x%7D;k3=wxapptoken:v3&quot;</code>，通过<code>;</code>来分割</p>
</li>
<li>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># disable ssl warnings</span></span><br><span class="line">requests.packages.urllib3.disable_warnings()</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="抢购型代码总结"><a class="markdownIt-Anchor" href="#抢购型代码总结"></a> 抢购型代码总结：</h3>
<ul>
<li>
<p>实现主要分为selenium(自动测试工具)模拟点击；api模拟网络请求</p>
</li>
<li>
<p>登陆之后会对cookies进行持久化，使用pickle的好处是无法明文看懂、复制</p>
</li>
<li>
<p>可以通过持久化的cookies来登陆，但会检测cookies是否仍然有效</p>
</li>
<li>
<p>定时抢购会等待sleep到临近时间(while True+sleep(time)的方式 or sleepUntil+while try)，然后再进行多次抢购请求（如果抢购的2分钟内没抢到，大多没希望了，只好等待下次）；如果是<a href="#Automatic_ticket_purchase">等待页面刷新的</a>，则不断请求页面，等到结果改变。</p>
<ul>
<li>注意：等待间隔不要超过时间阈值，如180s前检查，如果不符合不能让其等待190s</li>
</ul>
</li>
<li>
<p>推送工具：提供一个自己写的</p>
<p>config.ini</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[pusher]</span></span><br><span class="line"><span class="attr">pusher_type</span> = pushplus</span><br><span class="line"><span class="attr">push_title</span> = 飞鱼秒杀</span><br><span class="line"></span><br><span class="line"><span class="comment"># https://sct.ftqq.com/</span></span><br><span class="line"><span class="section">[serverchan]</span></span><br><span class="line"><span class="attr">sec_key</span> = SCU35113Te369cebc21f6e483c03fffc400c4c5c05bdad63995c32</span><br><span class="line"></span><br><span class="line"><span class="comment"># https://open.dingtalk.com/document/group/custom-robot-access</span></span><br><span class="line"><span class="section">[dingding]</span></span><br><span class="line"><span class="attr">access_token</span> =</span><br><span class="line"><span class="attr">secret</span> =</span><br><span class="line"></span><br><span class="line"><span class="comment"># http://www.pushplus.plus/</span></span><br><span class="line"><span class="section">[pushplus]</span></span><br><span class="line"><span class="attr">pushplus_token</span> = fedcf6b08f6f4aaeb2948b7d7010eb93</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">__author__ = <span class="string">'Mrli'</span></span><br><span class="line"></span><br><span class="line">CONFIG_INI_FILENAME = <span class="string">"push_config.ini"</span></span><br><span class="line">CONFIG_INI_PATH = Path(__file__).resolve().parent.with_name(<span class="string">"push_config.ini"</span>)</span><br><span class="line"></span><br><span class="line">REMIND_MSG = <span class="string">"""</span></span><br><span class="line"><span class="string">[pusher]</span></span><br><span class="line"><span class="string">pusher_type = pushplus</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[serverchan]</span></span><br><span class="line"><span class="string">sec_key =</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[dingding]</span></span><br><span class="line"><span class="string">access_token =</span></span><br><span class="line"><span class="string">secret =</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[pushplus]</span></span><br><span class="line"><span class="string">pushplus_token = </span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PusherException</span><span class="params">(Exception)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, message)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        super().__init__(message)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IPushUtil</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, content: str, title: str = <span class="string">""</span>)</span> -&gt; bool:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PushplusPush</span><span class="params">(IPushUtil)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, push_title, options: dict)</span>:</span></span><br><span class="line">        self.pushplus_token = options.get(<span class="string">"pushplus_token"</span>)</span><br><span class="line">        self.push_title = push_title</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, content: str, title: str = <span class="string">""</span>)</span> -&gt; bool:</span></span><br><span class="line">        d = &#123;</span><br><span class="line">            <span class="string">"token"</span>: self.pushplus_token,</span><br><span class="line">            <span class="string">"template"</span>: <span class="string">"markdown"</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"&#123;push_title&#125;-&#123;title&#125;"</span>.format(push_title=self.push_title, title=title),</span><br><span class="line">            <span class="string">"content"</span>: content</span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(<span class="string">"http://www.pushplus.plus/send"</span>, data=d)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> (<span class="number">200</span> &lt;= res.json().get(<span class="string">"code"</span>) &lt; <span class="number">300</span>):</span><br><span class="line">            print(res.json())</span><br><span class="line">        <span class="keyword">return</span> <span class="number">200</span> &lt;= res.json().get(<span class="string">"code"</span>) &lt; <span class="number">300</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServerChanPush</span><span class="params">(IPushUtil)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, push_title, options: dict)</span>:</span></span><br><span class="line">        self.sec_key = options.get(<span class="string">"sec_key"</span>)</span><br><span class="line">        self.push_title = push_title</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, content: str, title: str = <span class="string">""</span>)</span> -&gt; bool:</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">'text'</span>: <span class="string">"&#123;push_title&#125;-&#123;title&#125;"</span>.format(push_title=self.push_title, title=title),</span><br><span class="line">            <span class="string">'desp'</span>: content</span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(url=<span class="string">'https://sc.ftqq.com/&#123;&#125;.send'</span>.format(self.sec_key), data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> (res.json().get(<span class="string">"errmsg"</span>) == <span class="string">"success"</span>):</span><br><span class="line">            print(res.json())</span><br><span class="line">        <span class="keyword">return</span> res.json().get(<span class="string">"errmsg"</span>) == <span class="string">"success"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DingDingPush</span><span class="params">(IPushUtil)</span>:</span></span><br><span class="line">    URL = <span class="string">"https://oapi.dingtalk.com/robot/send"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, push_title, options: dict)</span>:</span></span><br><span class="line">        self.access_token = options.get(<span class="string">"access_token"</span>)</span><br><span class="line">        self.secret = options.get(<span class="string">"secret"</span>)</span><br><span class="line">        self.target_url = self.get_url()</span><br><span class="line">        self.push_title = push_title</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_url</span><span class="params">(self)</span>:</span></span><br><span class="line">        timestamp = round(time.time() * <span class="number">1000</span>)</span><br><span class="line">        secret_enc = bytes(self.secret, encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">        string_to_sign = <span class="string">"&#123;&#125;\n&#123;&#125;"</span>.format(timestamp, self.secret)</span><br><span class="line">        string_to_sign_enc = bytes(string_to_sign, encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">        hmac_code = hmac.new(</span><br><span class="line">            secret_enc, string_to_sign_enc, digestmod=hashlib.sha256</span><br><span class="line">        ).digest()</span><br><span class="line">        sign = urllib.parse.quote_plus(base64.b64encode(hmac_code))</span><br><span class="line">        <span class="keyword">return</span> self.URL + <span class="string">"?access_token=&#123;access_token&#125;&amp;timestamp=&#123;timestamp&#125;&amp;sign=&#123;sign&#125;"</span>.format(</span><br><span class="line">            access_token=self.access_token, timestamp=timestamp, sign=sign)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, content: str, title: str = <span class="string">""</span>)</span> -&gt; bool:</span></span><br><span class="line">        msg = self.gen_markdown_msg(title, content)</span><br><span class="line">        <span class="keyword">return</span> self.send(msg)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send</span><span class="params">(self, message)</span>:</span></span><br><span class="line">        resp = requests.post(self.target_url, json=message)</span><br><span class="line">        <span class="keyword">return</span> resp.json()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gen_text_msg</span><span class="params">(content, at=None, at_all=False)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> at <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            at = []</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">"msgtype"</span>: <span class="string">"text"</span>,</span><br><span class="line">            <span class="string">"text"</span>: &#123;<span class="string">"content"</span>: content&#125;,</span><br><span class="line">            <span class="string">"at"</span>: &#123;<span class="string">"atMobiles"</span>: at, <span class="string">"isAtAll"</span>: at_all&#125;,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gen_markdown_msg</span><span class="params">(self, title, text, at=None, at_all=False)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">generateText</span><span class="params">()</span>:</span></span><br><span class="line">            res = <span class="string">""</span></span><br><span class="line">            <span class="comment"># 最顶行显示标题</span></span><br><span class="line">            res += <span class="string">"# "</span> + <span class="string">"&#123;&#125;-"</span>.format(self.push_title) + title + <span class="string">"\n"</span></span><br><span class="line">            <span class="comment"># 内容</span></span><br><span class="line">            res += text</span><br><span class="line">            <span class="comment"># at对象</span></span><br><span class="line">            res += reduce(<span class="keyword">lambda</span> x, y: x + <span class="string">"@"</span> + y, at, <span class="string">""</span>)</span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">"msgtype"</span>: <span class="string">"markdown"</span>,</span><br><span class="line">            <span class="string">"markdown"</span>: &#123;</span><br><span class="line">                <span class="string">"title"</span>: title,</span><br><span class="line">                <span class="string">"text"</span>: generateText()</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"at"</span>: &#123;<span class="string">"atMobiles"</span>: at, <span class="string">"isAtAll"</span>: at_all&#125;,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pusher</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, logger=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> logger:</span><br><span class="line">            self.cout = logger.info</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.cout = <span class="keyword">print</span></span><br><span class="line">        self._pusher = self.init()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        实例化pusher</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">from</span> configparser <span class="keyword">import</span> RawConfigParser</span><br><span class="line">        cp = RawConfigParser()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(CONFIG_INI_PATH):</span><br><span class="line">            <span class="keyword">raise</span> PusherException(</span><br><span class="line">                <span class="string">"请创建&#123;filename&#125;配置文件\npusher配置信息如下:\n&#123;msg&#125;"</span>.format(filename=CONFIG_INI_FILENAME, msg=REMIND_MSG))</span><br><span class="line">        cp.read(CONFIG_INI_PATH, encoding=<span class="string">"utf8"</span>)</span><br><span class="line">        pusher_type = cp.get(<span class="string">"pusher"</span>, <span class="string">"pusher_type"</span>).lower()</span><br><span class="line">        push_title = cp.get(<span class="string">"pusher"</span>, <span class="string">"push_title"</span>)</span><br><span class="line">        <span class="comment"># 是否使用了pusher</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> pusher_type:</span><br><span class="line">            self.cout(<span class="string">"初始化Pusher: 当前未配置Pusher, 如果需要推送功能, 则在&#123;filename&#125;"</span>.format(filename=CONFIG_INI_FILENAME))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">        generator_info = dict(cp.items(pusher_type))</span><br><span class="line">        <span class="comment"># 检查pusher配置</span></span><br><span class="line">        <span class="keyword">if</span> pusher_type <span class="keyword">and</span> <span class="keyword">not</span> self._valid(generator_info):</span><br><span class="line">            <span class="keyword">raise</span> PusherException(<span class="string">"&#123;&#125;_pusher配置错误，不能为空~"</span>.format(pusher_type))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> pusher_type == <span class="string">"serverchan"</span>:</span><br><span class="line">            <span class="keyword">return</span> ServerChanPush(push_title, generator_info)</span><br><span class="line">        <span class="keyword">elif</span> pusher_type == <span class="string">"dingding"</span>:</span><br><span class="line">            <span class="keyword">return</span> DingDingPush(push_title, generator_info)</span><br><span class="line">        <span class="keyword">elif</span> pusher_type == <span class="string">"pushplus"</span>:</span><br><span class="line">            <span class="keyword">return</span> PushplusPush(push_title, generator_info)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> PusherException(<span class="string">"不可知pusher类型~"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_valid</span><span class="params">(config_dict: dict)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        判断字典值是否为空</span></span><br><span class="line"><span class="string">        :param dict:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> config_dict.values():</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> v:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, content: str, title: str = <span class="string">""</span>)</span> -&gt; bool:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._pusher:</span><br><span class="line">            self.cout(<span class="string">"当前未配置pusher, 消息无法发送"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">return</span> self._pusher.push(content, title)</span><br></pre></td></tr></table></figure>
<h2 id="weibospider"><a class="markdownIt-Anchor" href="#weibospider"></a> <a href="https://github.com/dataabc/weiboSpider" target="_blank" rel="noopener">weiboSpider</a></h2>
<blockquote>
<p>可以连续爬取<strong>一个</strong>或<strong>多个</strong>新浪微博用户（如<a href="https://weibo.cn/u/1223178222" target="_blank" rel="noopener">胡歌</a>、<a href="https://weibo.cn/u/1669879400" target="_blank" rel="noopener">迪丽热巴</a>、<a href="https://weibo.cn/u/1729370543" target="_blank" rel="noopener">郭碧婷</a>）的数据，并将结果信息写入<strong>文件</strong>或<strong>数据库</strong>。</p>
</blockquote>
<ul>
<li>①允许用户指定自定义配置文件，否则使用默认配置文件；②对配置文件进行校验，并对非法项进行提示</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	config = _get_config()</span><br><span class="line">    config_util.validate_config(config)</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_get_config</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""获取config.json数据"""</span></span><br><span class="line">    src = os.path.split(</span><br><span class="line">        os.path.realpath(__file__))[<span class="number">0</span>] + os.sep + <span class="string">'config_sample.json'</span></span><br><span class="line">    config_path = os.getcwd() + os.sep + <span class="string">'config.json'</span></span><br><span class="line">    <span class="keyword">if</span> FLAGS.config_path:</span><br><span class="line">        config_path = FLAGS.config_path</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validate_config</span><span class="params">(config)</span>:</span></span><br><span class="line">    <span class="string">"""验证配置是否正确"""</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 验证filter、pic_download、video_download</span></span><br><span class="line">    argument_list = [<span class="string">'filter'</span>, <span class="string">'pic_download'</span>, <span class="string">'video_download'</span>]</span><br><span class="line">    <span class="keyword">for</span> argument <span class="keyword">in</span> argument_list:</span><br><span class="line">        <span class="keyword">if</span> config[argument] != <span class="number">0</span> <span class="keyword">and</span> config[argument] != <span class="number">1</span>:</span><br><span class="line">            logger.warning(<span class="string">u'%s值应为0或1,请重新输入'</span>, config[argument])</span><br><span class="line">            sys.exit()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 验证since_date</span></span><br><span class="line">    since_date = config[<span class="string">'since_date'</span>]</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">not</span> _is_date(str(since_date))) <span class="keyword">and</span> (<span class="keyword">not</span> isinstance(since_date, int)):</span><br><span class="line">        logger.warning(<span class="string">u'since_date值应为yyyy-mm-dd形式或整数,请重新输入'</span>)</span><br><span class="line">        sys.exit()</span><br></pre></td></tr></table></figure>
<h2 id="proxy_pool"><a class="markdownIt-Anchor" href="#proxy_pool"></a> <strong><a href="https://github.com/jhao104/proxy_pool" target="_blank" rel="noopener">proxy_pool</a>★</strong></h2>
<blockquote>
<p>爬虫代理IP池项目,主要功能为定时采集网上发布的免费代理验证入库，定时验证入库的代理保证代理的可用性，提供API和CLI两种使用方式。同时你也可以扩展代理源以增加代理池IP的质量和数量。</p>
<p>模块组成：获取功能、存储功能、校验功能、接口管理</p>
<p>⭐️程序主要是启动了<code>startServer</code>的API接口服务、<code>startScheduler</code>定时服务</p>
<ul>
<li><code>startServer-&gt;runFlask</code>：是向外提供了通过<strong>proxyHandler</strong>来获得Redis中的proxy数据</li>
<li><code>startScheduler-&gt;sche.add_task(__runProxyFetch)、sche.add_task(__runProxyCheck)</code>，
<ul>
<li><code>__runProxyFetch:proxy_fetcher.run()-&gt;proxy_queue-&gt;Checker(&quot;raw&quot;, proxy_queue)</code>获得各个代理网站的代理信息后，进行校验，校验成功则入库</li>
<li><code>__runProxyCheck:proxy in proxy_handler.getAll()-&gt;proxy_queue-&gt;Checker(&quot;use&quot;, proxy_queue)</code>：通过proxy_handler拿到库里所有现存的数据后，进行有效性校验，无效的则删除，有效的则更新信息</li>
</ul>
</li>
</ul>
<p>作为存储功能的接口proxyHandler，也是两个API服务与定时服务的中介。程序也是通过存储功能，将核心的两个功能：<u>定时抓取的proxy数据</u>与<u>提供proxy数据给用户使用</u>成功联系在了一起</p>
</blockquote>
<ul>
<li>
<p>通过元类实现单例模式：ConfigHandler，其可以在任意模块中以c = ConfigHandler()的形式获得，而不是<code>ConfigHandler.getInstance()</code></p>
</li>
<li>
<p><code>@LazyProperty</code>懒加载属性的装饰器： 只有用到时才会加载并将值注入到<code>__dict__</code>、加载一次后值就不再变化、；讲解可见：<a href="https://www.jianshu.com/p/708dc26f9b92%E2%80%94%E2%80%94%E6%8F%8F%E8%BF%B0%E7%AC%A6or%E4%BF%AE%E9%A5%B0%E7%AC%A6%E5%AE%9E%E7%8E%B0" target="_blank" rel="noopener">https://www.jianshu.com/p/708dc26f9b92——描述符or修饰符实现</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LazyProperty</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="comment"># 在被注解类方法被解释器运行的时候就会创建LazyProperty实例并返回</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, func)</span>:</span></span><br><span class="line">        self.func = func</span><br><span class="line">    <span class="string">"""通过python描述符来实现"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> instance <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">return</span> self</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 会将结果值通过setattr方法存入到instance对象实例的__dict__中</span></span><br><span class="line">            value = self.func(instance)</span><br><span class="line">            setattr(instance, self.func.__name__, value)</span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConfigHandler</span><span class="params">(withMetaclass<span class="params">(Singleton)</span>)</span>:</span></span><br><span class="line">    <span class="comment"># 返回一个LazyProperty实例 </span></span><br><span class="line"><span class="meta">    @LazyProperty</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">serverHost</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> os.environ.get(<span class="string">"HOST"</span>, setting.HOST)</span><br><span class="line">c = ConfigHandler()</span><br><span class="line"><span class="comment"># 会触发ConfigHandler.__dict__["serverHost"], 然后接而触发LazyProperty的__get__，value = self.func(instance)会得到真正serverHost函数的值后将其设置在ConfigHandler instance对象的__dict__中，由于对象的__dict__["serverHost"]=value优先级高于类的__dict__["serverHost"]=LazyProperty()对象，因此之后调用得到的是value结果</span></span><br><span class="line">print(c.serverHost)</span><br></pre></td></tr></table></figure>
<p><code>__get__</code>只有访问类属性的时候才会生效，这边是通过setattr将serverHost设置成了ConfigHandler的类属性</p>
</li>
<li>
<p>封装了一个请求工具类<code>WebRequest</code>:</p>
<ul>
<li>增加了异常处理的功能</li>
<li>增加了日志功能</li>
<li>请求头会得到随机UA</li>
<li>设置重试</li>
</ul>
</li>
<li>
<p>使用click创建子命令：</p>
<ol>
<li>得到一个click_group</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CONTEXT_SETTINGS = dict(help_option_names=[<span class="string">'-h'</span>, <span class="string">'--help'</span>])</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.group(context_settings=CONTEXT_SETTINGS)</span></span><br><span class="line"><span class="meta">@click.version_option(version=VERSION)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cli</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""ProxyPool cli工具"""</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>指定group下的子命令</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@cli.command(name="server")</span></span><br><span class="line"><span class="comment"># 还可以设置参数: @click.option('--count', default=1, help='Number of greetings.') --&gt; def server(count)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">server</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">""" 启动api服务 """</span></span><br><span class="line">    click.echo(BANNER)</span><br><span class="line">    startServer()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    cli()</span><br></pre></td></tr></table></figure>
<p>然后通过bash脚本同时开启两个进程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line">python proxyPool.py server &amp;</span><br><span class="line">python proxyPool.py schedule</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>DbClient DB工厂类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DbClient</span><span class="params">(withMetaclass<span class="params">(Singleton)</span>)</span>:</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, db_conn)</span>:</span></span><br><span class="line">        self.parseDbConn(db_conn)</span><br><span class="line">        self.__initDbClient()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parseDbConn</span><span class="params">(cls, db_conn)</span>:</span></span><br><span class="line">        <span class="comment"># 可以关注一下urlparse的使用</span></span><br><span class="line">        db_conf = urlparse(db_conn)</span><br><span class="line">        cls.db_type = db_conf.scheme.upper().strip()</span><br><span class="line">        <span class="comment"># _NetlocResultMixinBase对象来获取想要的参数</span></span><br><span class="line">        cls.db_host = db_conf.hostname</span><br><span class="line">        cls.db_port = db_conf.port</span><br><span class="line">        cls.db_user = db_conf.username</span><br><span class="line">        cls.db_pwd = db_conf.password</span><br><span class="line">        cls.db_name = db_conf.path[<span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">return</span> cls</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__initDbClient</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        init DB Client</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        __type = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"SSDB"</span> == self.db_type:</span><br><span class="line">            __type = <span class="string">"ssdbClient"</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">"REDIS"</span> == self.db_type:</span><br><span class="line">            __type = <span class="string">"redisClient"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">assert</span> __type, <span class="string">'type error, Not support DB type: &#123;&#125;'</span>.format(self.db_type)</span><br><span class="line">        self.client = getattr(__import__(__type), <span class="string">"%sClient"</span> % self.db_type.title())(host=self.db_host,</span><br><span class="line">port=self.db_port,</span><br><span class="line">username=self.db_user,</span><br><span class="line">password=self.db_pwd,</span><br><span class="line">db=self.db_name)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>python中使用redis</p>
<blockquote>
<p>Redis中代理存放的结构为hash：hash  是一个键值(key=&gt;value)对集合；是一个 string 类型的 field（字段） 和 value（值） 的<strong>映射表</strong>，hash 特别适合用于存储对象。</p>
<p>本项目中应用：key为ip:port, value为代理属性的字典;</p>
</blockquote>
<ul>
<li>python与创建连接</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pip install redis</span></span><br><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> Redis, BlockingConnectionPool</span><br><span class="line">conn_dict = &#123;</span><br><span class="line">    <span class="string">"host"</span>: <span class="string">"49.235.118.244"</span>,</span><br><span class="line">    <span class="string">"port"</span>: <span class="number">6379</span>,</span><br><span class="line">    <span class="string">"db"</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">r = Redis(connection_pool=BlockingConnectionPool(decode_responses=<span class="keyword">True</span>,</span><br><span class="line">                                                 timeout=<span class="number">5</span>,</span><br><span class="line">                                                 socket_timeout=<span class="number">15</span>,</span><br><span class="line">                                                 **conn_dict)</span><br><span class="line">         )</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://github.com/jhao104/proxy_pool/blob/master/db/redisClient.py" target="_blank" rel="noopener">★hash使用封装</a></li>
</ul>
<blockquote>
<p>添加：set、zset为add、list为push、string和hash为set</p>
</blockquote>
<p>参考:<a href="https://blog.csdn.net/weixin_39576234/article/details/87603701" target="_blank" rel="noopener">Redis基本概念及使用</a>、<a href="https://www.runoob.com/redis/redis-sorted-sets.html%E3%80%81" target="_blank" rel="noopener">https://www.runoob.com/redis/redis-sorted-sets.html、</a><a href="https://www.runoob.com/w3cnote/python-redis-intro.html" target="_blank" rel="noopener">★Python redis 使用介绍</a></p>
<p><img src="/2022/03/29/开源项目代码阅读记录/E:%5Chexo%5Csource_posts%5C%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB%E8%AE%B0%E5%BD%95%5Credis.jpg" alt="redis"></p>
</li>
<li>
<p>继承重写logging.logger，可选参数为<code>name, level=DEBUG, stream=True, file=True</code>，让每个功能函数都能生成单独的日志文件，并进行了可选控制。</p>
<p>相比单例，日志精度更细，但也使用起来也更麻烦，需要考虑什么地方需要。</p>
</li>
<li>
<p>提供&quot;扩展代理&quot;接口</p>
<ol>
<li>
<p>在<a href="https://github.com/jhao104/proxy_pool/blob/1a3666283806a22ef287fba1a8efab7b94e94bac/fetcher/proxyFetcher.py#L21" target="_blank" rel="noopener">ProxyFetcher</a>类中添加自定义的获取代理的静态方法， 该方法需要以生成器(yield)形式返回<code>host:ip</code>格式的代理</p>
</li>
<li>
<p>添加好方法后，修改<a href="https://github.com/jhao104/proxy_pool/blob/1a3666283806a22ef287fba1a8efab7b94e94bac/setting.py#L47" target="_blank" rel="noopener">setting.py</a>文件中的<code>PROXY_FETCHER</code>项下添加自定义方法的名字:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PROXY_FETCHER = [</span><br><span class="line">    <span class="string">"freeProxy01"</span>,    </span><br><span class="line">    <span class="string">"freeProxy02"</span>,</span><br><span class="line">    <span class="comment"># ....</span></span><br><span class="line">    <span class="string">"freeProxyCustom1"</span>  <span class="comment">#  # 确保名字和你添加方法名字一致</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><code>schedule</code> 进程会每隔一段时间抓取一次代理，下次抓取时会自动识别调用你定义的方法。</p>
</li>
</ol>
<p><a href="https://github.com/jhao104/proxy_pool/blob/master/helper/fetch.py" target="_blank" rel="noopener">实现方式</a>：</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">self.log.info(<span class="string">"ProxyFetch : start"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从配置中拿执行函数</span></span><br><span class="line"><span class="keyword">for</span> fetch_source <span class="keyword">in</span> self.conf.fetchers:</span><br><span class="line">    <span class="comment"># 判断ProxyFetcher中是否有定义、是否可调用</span></span><br><span class="line">	fetcher = getattr(ProxyFetcher, fetch_source, <span class="keyword">None</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> fetcher:</span><br><span class="line">		self.log.error(<span class="string">"ProxyFetch - &#123;func&#125;: class method not exists!"</span>.format(func=fetch_source))</span><br><span class="line">		<span class="keyword">continue</span></span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> callable(fetcher):</span><br><span class="line">		self.log.error(<span class="string">"ProxyFetch - &#123;func&#125;: must be class method"</span>.format(func=fetch_source))</span><br><span class="line">		<span class="keyword">continue</span></span><br><span class="line">	thread_list.append(_ThreadFetcher(fetch_source, proxy_dict))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> thread <span class="keyword">in</span> thread_list:</span><br><span class="line">    thread.setDaemon(<span class="keyword">True</span>)</span><br><span class="line">    thread.start()</span><br><span class="line"><span class="keyword">for</span> thread <span class="keyword">in</span> thread_list:</span><br><span class="line">    thread.join()</span><br><span class="line">self.log.info(<span class="string">"ProxyFetch - all complete!"</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>Cpython(默认安装的都是Cpython)中Dict和list、tuple都是<strong>线程安全</strong>的</p>
<ul>
<li>
<p>以装饰器的形式将过滤器将入到容器中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProxyValidator</span><span class="params">(withMetaclass<span class="params">(Singleton)</span>)</span>:</span></span><br><span class="line">    pre_validator = []</span><br><span class="line">    http_validator = []</span><br><span class="line">    https_validator = []</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addPreValidator</span><span class="params">(cls, func)</span>:</span></span><br><span class="line">        cls.pre_validator.append(func)</span><br><span class="line">        <span class="keyword">return</span> func</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实际上执行了 formatValidator=ProxyValidator.addPreValidator(formatValidator)</span></span><br><span class="line"><span class="comment"># 由于addPreValidator返回了func, 所以formatValidator还是原来的addPreValidator, 但在类定义的时候ProxyValidator.pre_validator添加了formatValidator方法</span></span><br><span class="line"><span class="meta">@ProxyValidator.addPreValidator</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">formatValidator</span><span class="params">(proxy)</span>:</span></span><br><span class="line">    <span class="string">"""检查代理格式"""</span></span><br><span class="line">    verify_regex = <span class="string">r"\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;:\d&#123;1,5&#125;"</span></span><br><span class="line">    _proxy = findall(verify_regex, proxy)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">True</span> <span class="keyword">if</span> len(_proxy) == <span class="number">1</span> <span class="keyword">and</span> _proxy[<span class="number">0</span>] == proxy <span class="keyword">else</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DoValidator</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">""" 校验执行器 """</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validator</span><span class="params">(cls, proxy)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        校验入口</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            proxy: Proxy Object</span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            Proxy Object</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        http_r = cls.httpValidator(proxy)</span><br><span class="line">        https_r = <span class="keyword">False</span> <span class="keyword">if</span> <span class="keyword">not</span> http_r <span class="keyword">else</span> cls.httpsValidator(proxy)</span><br><span class="line"></span><br><span class="line">        proxy.check_count += <span class="number">1</span></span><br><span class="line">        proxy.last_time = datetime.now().strftime(<span class="string">"%Y-%m-%d %H:%M:%S"</span>)</span><br><span class="line">        proxy.last_status = <span class="keyword">True</span> <span class="keyword">if</span> http_r <span class="keyword">else</span> <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">if</span> http_r:</span><br><span class="line">            <span class="keyword">if</span> proxy.fail_count &gt; <span class="number">0</span>:</span><br><span class="line">                proxy.fail_count -= <span class="number">1</span></span><br><span class="line">            proxy.https = <span class="keyword">True</span> <span class="keyword">if</span> https_r <span class="keyword">else</span> <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            proxy.fail_count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> proxy</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">preValidator</span><span class="params">(cls, proxy)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> func <span class="keyword">in</span> ProxyValidator.pre_validator:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> func(proxy):</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p><a href="http://www.network-science.de/ascii/" target="_blank" rel="noopener">starter-banner</a>：启动横幅</p>
<ul>
<li>reflection: No、adjustment: cewnter、Stretch: Yes、width: 80</li>
<li>还不错的font：
<ul>
<li>5lineoblique——好看</li>
<li>banner3——清楚</li>
<li>bell——抽象</li>
<li>big——清晰</li>
<li>bigchief——等高线版本、艺术</li>
<li>block——块状</li>
<li>bulbhead——可爱</li>
<li>larry3d——立体3d</li>
<li>ogre——清晰</li>
<li>puffy——清晰+一点可爱</li>
<li>slant——清晰+斜体</li>
</ul>
</li>
</ul>
</li>
<li>
<p>定时器框架apschedule配置:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">scheduler = BlockingScheduler(logger=scheduler_log, timezone=timezone)</span><br><span class="line"></span><br><span class="line">scheduler.add_job(__runProxyCheck, <span class="string">'interval'</span>, minutes=<span class="number">2</span>, id=<span class="string">"proxy_check"</span>, name=<span class="string">"proxy检查"</span>)</span><br><span class="line"></span><br><span class="line">executors = &#123;</span><br><span class="line">    <span class="comment"># job_defaults中的max_instances也受限于max_workers, 所以要大于max_instances；此外max_workers也决定了同时能处理几个同时发生的task</span></span><br><span class="line">    <span class="string">'default'</span>: &#123;<span class="string">'type'</span>: <span class="string">'threadpool'</span>, <span class="string">'max_workers'</span>: <span class="number">20</span>&#125;,</span><br><span class="line">    <span class="string">'processpool'</span>: ProcessPoolExecutor(max_workers=<span class="number">5</span>)</span><br><span class="line">&#125;</span><br><span class="line">job_defaults = &#123;</span><br><span class="line">    <span class="comment"># 合并将所有这些错过的执行合并为一个, 默认为True。 如果是定时的存储任务的话，参数肯定不同，不能合并所以得手动设置False</span></span><br><span class="line">    <span class="comment"># 像本项目每隔一段时间抓取到的数据也不太一样，所以无法直接当作一次错误任务合并</span></span><br><span class="line">    <span class="string">'coalesce'</span>: <span class="keyword">False</span>,</span><br><span class="line">    <span class="comment"># 默认情况下，每个作业只允许同时运行一个实例。这意味着，如果作业即将运行，但前一次运行尚未完成，则认为最近一次运行失败。通过在添加作业时使用关键字参数，可以设置调度程序允许同时运行的特定作业的最大实例数。默认为1</span></span><br><span class="line">    <span class="string">'max_instances'</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="comment"># 框架会检查每个错过的执行时间，如果当前还在misfire_grace_time时间内，则会重新尝试执行任务，设高点就可以避免任务被漏掉执行。默认为1</span></span><br><span class="line">    <span class="comment"># "misfire_grace_time": 5  该项目未使用，而是采用了多任务实例来规避任务错过执行==&gt;即官方给出两种方案中的另一种。任务错过信息：Run time of job "say (trigger: interval[0:00:02])" was missed by 0:00:03.010383</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">scheduler.configure(executors=executors, job_defaults=job_defaults, timezone=timezone)</span><br><span class="line">scheduler.start()</span><br></pre></td></tr></table></figure>
<p>job_defaults参数含义见<a href="https://apscheduler.readthedocs.io/en/3.x/userguide.html?highlight=max_instances#modifying-jobs" target="_blank" rel="noopener">官方文档</a>、<a href="https://blog.csdn.net/weixin_44301439/article/details/124062178" target="_blank" rel="noopener">https://blog.csdn.net/weixin_44301439/article/details/124062178</a></p>
<p>注： 经过测试，在add_task中的func如果起了多个线程，其执行不受限于sche的配置</p>
</li>
<li>
<p>Python中如果只是使用全局变量则不需要用global声明（因为变量搜寻会由内往外），但是如果需要修改则需要用global声明，否则无法找到相应变量</p>
</li>
<li>
<p>生成器：使用了yield关键字的函数就是生成器，生成器是一类特殊的迭代器。</p>
<p>作用：</p>
<ul>
<li>处理大量数据：生成器一次返回一个结果，而不是一次返回所有结果。比如<code>sum([i for i in range(10000000000000)])</code>会卡机；<code>sum(i for i in range(10000000000000))</code>则不会</li>
<li><a href="https://blog.csdn.net/a200822146085/article/details/89388362" target="_blank" rel="noopener">代码更加简洁</a>：可以减少变量、空间</li>
<li>迭代器本身的作用</li>
</ul>
<p>yield关键字有两点作用：</p>
<p>保存当前运行状态（<strong>断点</strong>），然后暂停执行，即将生成器（函数）挂起；可以使用next()函数让生成器从断点处<strong>继续执行</strong>，即唤醒生成器（函数）<br>
将yield关键字后面表达式的值作为<strong>返回值返回</strong>，此时可以理解为起到了return的作用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__runProxyFetch</span><span class="params">()</span>:</span>     </span><br><span class="line">    <span class="keyword">for</span> proxy <span class="keyword">in</span> proxy_fetcher.run():</span><br><span class="line">        proxy_queue.put(proxy)</span><br><span class="line">        </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fetcher</span><span class="params">(object)</span>:</span></span><br><span class="line">    name = <span class="string">"fetcher"</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># ...</span></span><br><span class="line">        <span class="comment"># 相比使用生成推导式 return [p for p in proxy_dict.values() if DoValidator.preValidator(p.proxy)]， 使用yield生成器可以节省空间</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> proxy_dict.values():</span><br><span class="line">                <span class="keyword">if</span> DoValidator.preValidator(_.proxy):</span><br><span class="line">                    <span class="keyword">yield</span> _</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>应用部署：</p>
<p>①对apk换源；②设置时区</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.6</span>-alpine</span><br><span class="line"><span class="comment"># ..</span></span><br><span class="line"><span class="comment"># apk repository</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> sed -i <span class="string">'s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g'</span> /etc/apk/repositories</span></span><br><span class="line"><span class="bash"><span class="comment"># timezone</span></span></span><br><span class="line"><span class="bash">RUN apk add -U tzdata &amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; apk del tzdata</span></span><br><span class="line"><span class="bash"><span class="comment"># ...</span></span></span><br><span class="line"><span class="bash">ENTRYPOINT [ <span class="string">"sh"</span>, <span class="string">"start.sh"</span> ]</span></span><br></pre></td></tr></table></figure>
<p><code>docker-compose.yml</code>： 镜像还没编译好的情况。（如果自己改了功能并启用的话，需要用这种；或者自己发布镜像后用后一种）</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'2'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  proxy_pool:</span></span><br><span class="line"><span class="attr">    build:</span> <span class="string">.</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">proxy_pool</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"5010:5010"</span></span><br><span class="line"><span class="attr">    links:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">proxy_redis</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="attr">      DB_CONN:</span> <span class="string">"redis://@proxy_redis:6379/0"</span></span><br><span class="line"><span class="attr">  proxy_redis:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">"redis"</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">proxy_redis</span></span><br></pre></td></tr></table></figure>
<p><code>docker-compose.yml</code>：别人镜像已经编译好并上传</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3"</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  redis:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">    expose:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">6379</span></span><br><span class="line"><span class="attr">  web:</span></span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">jhao104/proxy_pool</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">DB_CONN=redis://redis:6379/0</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"5010:5010"</span></span><br><span class="line"><span class="attr">    depends_on:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">redis</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="scheduler的逻辑"><a class="markdownIt-Anchor" href="#scheduler的逻辑"></a> scheduler的逻辑</h3>
<p><img src="/2022/03/29/开源项目代码阅读记录/E:%5Chexo%5Csource_posts%5C%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB%E8%AE%B0%E5%BD%95%5Cproxy_pool%E6%97%B6%E5%BA%8F%E5%9B%BE.png" alt="proxy_pool时序图"></p>
<h3 id="项目目录结构默写"><a class="markdownIt-Anchor" href="#项目目录结构默写"></a> 项目目录结构默写：</h3>
<ul>
<li>settings: 配置文件</li>
<li>main：启动文件</li>
<li>api：提供获取proxy数据接口</li>
<li>handler:
<ul>
<li>loggerHandler：日志类</li>
<li>configHandler：单例的配置接口类</li>
<li>ProxyHandler: Proxy CRUD操作类</li>
</ul>
</li>
<li>fetcher: 代理数据获取类</li>
<li>db:
<ul>
<li>dbClinet： 存储功能接口类</li>
<li>redisClient：存储功能实现类</li>
</ul>
</li>
<li>helper
<ul>
<li>scheduler: 定时任务的定义与启动类</li>
<li>validator: proxy有效性校验类</li>
<li>check: 具体执行校验逻辑类</li>
<li>proxy: 获取的proxy数据封装类</li>
</ul>
</li>
<li>utils:
<ul>
<li>lazyProperty： 懒加载描述器</li>
<li>singleton: 单例管理器类</li>
<li>six： python2与python3兼容类</li>
<li>webRequest: 网络请求封装类</li>
</ul>
</li>
</ul>
<h2 id="极验滑块验证码破解与研究三滑块缺口识别"><a class="markdownIt-Anchor" href="#极验滑块验证码破解与研究三滑块缺口识别"></a> 极验滑块验证码破解与研究（三）：滑块缺口识别</h2>
<p>首先我们需要准备两张图片：1. 带缺口的背景图；2. 与之对应的接口图</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> PIL</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">imshow</span><span class="params">(img, winname=<span class="string">'test'</span>, delay=<span class="number">0</span>)</span>:</span></span><br><span class="line">    <span class="string">"""cv2展示图片"""</span></span><br><span class="line">    cv2.imshow(winname, img)</span><br><span class="line">    cv2.waitKey(delay)</span><br><span class="line">    cv2.destroyAllWindows()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pil_to_cv2</span><span class="params">(img)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    pil转cv2图片</span></span><br><span class="line"><span class="string">    :param img: pil图像, &lt;type 'PIL.JpegImagePlugin.JpegImageFile'&gt;</span></span><br><span class="line"><span class="string">    :return: cv2图像, &lt;type 'numpy.ndarray'&gt;</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    img = cv2.cvtColor(np.asarray(img), cv2.COLOR_RGB2BGR)</span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bytes_to_cv2</span><span class="params">(img)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    二进制图片转cv2</span></span><br><span class="line"><span class="string">    :param img: 二进制图片数据, &lt;type 'bytes'&gt;</span></span><br><span class="line"><span class="string">    :return: cv2图像, &lt;type 'numpy.ndarray'&gt;</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># 将图片字节码bytes, 转换成一维的numpy数组到缓存中</span></span><br><span class="line">    img_buffer_np = np.frombuffer(img, dtype=np.uint8)</span><br><span class="line">    <span class="comment"># 从指定的内存缓存中读取一维numpy数据, 并把数据转换(解码)成图像矩阵格式</span></span><br><span class="line">    img_np = cv2.imdecode(img_buffer_np, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> img_np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cv2_open</span><span class="params">(img, flag=None)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    统一输出图片格式为cv2图像, &lt;type 'numpy.ndarray'&gt;</span></span><br><span class="line"><span class="string">    :param img: &lt;type 'bytes'/'numpy.ndarray'/'str'/'Path'/'PIL.JpegImagePlugin.JpegImageFile'&gt;</span></span><br><span class="line"><span class="string">    :param flag: 颜色空间转换类型, default: None</span></span><br><span class="line"><span class="string">        eg: cv2.COLOR_BGR2GRAY（灰度图）</span></span><br><span class="line"><span class="string">    :return: cv2图像, &lt;numpy.ndarray&gt;</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(img, bytes):</span><br><span class="line">        img = bytes_to_cv2(img)</span><br><span class="line">    <span class="keyword">elif</span> isinstance(img, (str, Path)):</span><br><span class="line">        img = cv2.imread(str(img))</span><br><span class="line">    <span class="keyword">elif</span> isinstance(img, np.ndarray):</span><br><span class="line">        img = img</span><br><span class="line">    <span class="keyword">elif</span> isinstance(img, PIL.Image):</span><br><span class="line">        img = pil_to_cv2(img)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">f'输入的图片类型无法解析: <span class="subst">&#123;type(img)&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">if</span> flag <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        img = cv2.cvtColor(img, flag)</span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_distance</span><span class="params">(bg, tp, im_show=False, save_path=None)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    :param bg: 背景图路径或Path对象或图片二进制</span></span><br><span class="line"><span class="string">        eg: 'assets/bg.jpg'</span></span><br><span class="line"><span class="string">            Path('assets/bg.jpg')</span></span><br><span class="line"><span class="string">    :param tp: 缺口图路径或Path对象或图片二进制</span></span><br><span class="line"><span class="string">        eg: 'assets/tp.jpg'</span></span><br><span class="line"><span class="string">            Path('assets/tp.jpg')</span></span><br><span class="line"><span class="string">    :param im_show: 是否显示结果, &lt;type 'bool'&gt;; default: False</span></span><br><span class="line"><span class="string">    :param save_path: 保存路径, &lt;type 'str'/'Path'&gt;; default: None</span></span><br><span class="line"><span class="string">    :return: 缺口位置</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># 读取图片</span></span><br><span class="line">    bg_gray = cv2_open(bg, flag=cv2.COLOR_BGR2GRAY)</span><br><span class="line">    tp_gray = cv2_open(tp, flag=cv2.COLOR_BGR2GRAY)</span><br><span class="line">    <span class="comment"># 边缘检测</span></span><br><span class="line">    tp_gray = cv2.Canny(tp_gray, <span class="number">255</span>, <span class="number">255</span>)</span><br><span class="line">    bg_gray = cv2.Canny(bg_gray, <span class="number">255</span>, <span class="number">255</span>)</span><br><span class="line">    <span class="comment"># 目标匹配</span></span><br><span class="line">    result = cv2.matchTemplate(bg_gray, tp_gray, cv2.TM_CCOEFF_NORMED)</span><br><span class="line">    <span class="comment"># 解析匹配结果</span></span><br><span class="line">    min_val, max_val, min_loc, max_loc = cv2.minMaxLoc(result)</span><br><span class="line"></span><br><span class="line">    distance = max_loc[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> save_path <span class="keyword">or</span> im_show:</span><br><span class="line">        <span class="comment"># 需要绘制的方框高度和宽度</span></span><br><span class="line">        tp_height, tp_width = tp_gray.shape[:<span class="number">2</span>]</span><br><span class="line">        <span class="comment"># 矩形左上角点位置</span></span><br><span class="line">        x, y = max_loc</span><br><span class="line">        <span class="comment"># 矩形右下角点位置</span></span><br><span class="line">        _x, _y = x + tp_width, y + tp_height</span><br><span class="line">        <span class="comment"># 绘制矩形</span></span><br><span class="line">        bg_img = cv2_open(bg)</span><br><span class="line">        cv2.rectangle(bg_img, (x, y), (_x, _y), (<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">2</span>)</span><br><span class="line">        <span class="comment"># 保存缺口识别结果到背景图</span></span><br><span class="line">        <span class="keyword">if</span> save_path:</span><br><span class="line">            save_path = Path(save_path).resolve()</span><br><span class="line">            save_path = save_path.parent / <span class="string">f"<span class="subst">&#123;save_path.stem&#125;</span>.<span class="subst">&#123;distance&#125;</span><span class="subst">&#123;save_path.suffix&#125;</span>"</span></span><br><span class="line">            save_path = save_path.__str__()</span><br><span class="line">            cv2.imwrite(save_path, bg_img)</span><br><span class="line">        <span class="comment"># 显示缺口识别结果</span></span><br><span class="line">        <span class="keyword">if</span> im_show:</span><br><span class="line">            imshow(bg_img)</span><br><span class="line">    <span class="keyword">return</span> distance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    d = get_distance(</span><br><span class="line">        bg=<span class="string">'assets/bg.jpg'</span>,</span><br><span class="line">        tp=<span class="string">'assets/tp.png'</span>,</span><br><span class="line">        im_show=<span class="keyword">True</span>,</span><br><span class="line">        save_path=<span class="string">'assets/bg.jpg'</span></span><br><span class="line">    )</span><br><span class="line">    print(d)</span><br></pre></td></tr></table></figure>
<p>类似代码：<strong><a href="https://github.com/lixi5338619/lxBook" target="_blank" rel="noopener">lxBook</a></strong></p>
<p>相关文章：</p>
<ol>
<li><a href="https://blog.csdn.net/qq_42857999/article/details/121586389" target="_blank" rel="noopener">极验滑块验证码破解与研究（一）：AST还原混淆JS</a></li>
<li><a href="https://blog.csdn.net/qq_42857999/article/details/121628908" target="_blank" rel="noopener">极验滑块验证码破解与研究（二）：缺口图片还原</a></li>
<li><a href="https://blog.csdn.net/qq_42857999/article/details/121635961" target="_blank" rel="noopener">极验滑块验证码破解与研究（三）：滑块缺口识别</a></li>
<li><a href="https://blog.csdn.net/qq_42857999/article/details/121659205" target="_blank" rel="noopener">极验滑块验证码破解与研究（四）：滑块轨迹构造</a></li>
<li><a href="https://blog.csdn.net/qq_42857999/article/details/121674134" target="_blank" rel="noopener">极验滑块验证码破解与研究（五）：请求分析及加密参数破解</a></li>
</ol>
<h1 id="机器学习"><a class="markdownIt-Anchor" href="#机器学习"></a> 机器学习</h1>
<h2 id="cardrecorder"><a class="markdownIt-Anchor" href="#cardrecorder"></a> <strong><a href="https://github.com/ZDZX-T/cardRecorder" target="_blank" rel="noopener">cardRecorder</a></strong></h2>
<blockquote>
<p>通过pyautoGUI实现的斗地主记牌器，提供了tkinter的界面</p>
</blockquote>
<ul>
<li>
<p>使用pyAutoGui找到类似的图片</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment"># 进行截图</span></span><br><span class="line">   img = pyautogui.screenshot(region=myPos)</span><br><span class="line"><span class="comment"># 遍历所有排类型    </span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> myCardsNum.keys():</span><br><span class="line">       <span class="comment"># 进行定位, 找到pics\\m1.png在当前图片img里的位置</span></span><br><span class="line">       result = pyautogui.locateAll(needleImage=<span class="string">'pics\\m'</span> + i + <span class="string">'.png'</span>, haystackImage=img, confidence=myConfidence)</span><br><span class="line">       </span><br><span class="line">       myCardsNum[i] = cardsFilter(list(result), myFilter)</span><br></pre></td></tr></table></figure>
<p>pyautoGUI图片识别功能介绍：</p>
<blockquote>
<p>PyAutoGUI可以截取屏幕截图（截图），将其保存到文件中，并在屏幕中查找图像(定位)。</p>
</blockquote>
<ul>
<li>截图</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 截全屏</span></span><br><span class="line">pg.screenshot()  <span class="comment"># 只会保存到内存，不会缓存到本地</span></span><br><span class="line">pg.screenshot(<span class="string">'data/screenshot.jpg'</span>)  <span class="comment"># 指定路径，则会保存到本地</span></span><br><span class="line"><span class="comment"># 按照指定区域截屏, region(x坐标,y坐标,宽度,高度)，坐标为指定截图的左上角坐标</span></span><br><span class="line">pg.screenshot(imageFilename=<span class="string">'data/screenshot.jpeg'</span>, region=(<span class="number">300</span>, <span class="number">300</span>, <span class="number">500</span>, <span class="number">500</span>))</span><br></pre></td></tr></table></figure>
<ul>
<li>图片定位</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在屏幕中匹配图片，并返回位置相关数据，匹配不到则返回 None</span></span><br><span class="line">locate_1 = pg.locateOnScreen(image=<span class="string">'data/test.png'</span>)</span><br><span class="line">print(locate_1)  <span class="comment"># Box(left=177, top=614, width=43, height=37)</span></span><br><span class="line">print(locate_1.left)  <span class="comment"># 177  可以通过 .left 等属性获取相应的值</span></span><br><span class="line">print(locate_1[<span class="number">0</span>])  <span class="comment"># 177  也可以通过下标获取相应的值</span></span><br><span class="line"><span class="comment"># “模糊”匹配  --  可以使用参数 confidence 来指定模糊程度，默认是 1，范围是 0 - 1（当然，太低就没意义了）, 使用该参数要求已经安装好 openCV</span></span><br><span class="line"><span class="comment"># 这里的路径关键字是 image，和上面的 imageFilename 不同，所以建议不要写关键字，直接写路径就好，防止写错</span></span><br><span class="line">locate_2 = pg.locateOnScreen(image=<span class="string">'data/test.png'</span>, confidence=<span class="number">0.9</span>)</span><br><span class="line"><span class="comment"># 返回匹配到的图片的中心位置坐标</span></span><br><span class="line">center_point_1 = pg.center(locate_1)</span><br><span class="line">print(center_point_1)  <span class="comment"># Point(x=198, y=632)</span></span><br></pre></td></tr></table></figure>
<p>注：屏幕截图功能需要Pillow模块、置信度需要cv</p>
<p>参考：<a href="https://www.cnblogs.com/math98/p/14399644.html" target="_blank" rel="noopener">PyAutoGui 图片识别+定位+截图函数文档</a>、<a href="https://zhuanlan.zhihu.com/p/417147884" target="_blank" rel="noopener">pyautogui 的截图及图片匹配</a>、<a href="https://www.cnblogs.com/gexbooks/p/10790063.html" target="_blank" rel="noopener">pyautogui 文档（五）：截图及定位功能</a></p>
</li>
<li>
<p>tkinter使用:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 变量使用</span></span><br><span class="line">num_8 = tkinter.StringVar()  <span class="comment"># 8</span></span><br><span class="line">num_8.set(strCards[<span class="number">8</span>])</span><br><span class="line"></span><br><span class="line">root = tkinter.Tk()</span><br><span class="line"><span class="comment"># 显示</span></span><br><span class="line">x_start = <span class="number">20</span></span><br><span class="line">y_start = <span class="number">5</span></span><br><span class="line">x_add = <span class="number">30</span></span><br><span class="line">x_dif = <span class="number">2</span></span><br><span class="line">y_dif = <span class="number">25</span></span><br><span class="line"><span class="comment"># 标签</span></span><br><span class="line">tkinter.Label(root, text=<span class="string">'大'</span>, font=(<span class="string">''</span>, <span class="number">14</span>), width=<span class="number">1</span>).place(x=x_start, y=y_start)</span><br><span class="line"><span class="comment"># 输入框</span></span><br><span class="line">tkinter.Entry(root, textvariable=num_dw, font=(<span class="string">''</span>, <span class="number">14</span>), width=<span class="number">1</span>).place(x=x_start + x_dif, y=y_start + y_dif)</span><br><span class="line"><span class="comment"># 进行循环等待事件发生</span></span><br><span class="line">root.main_loop()</span><br></pre></td></tr></table></figure>
<p>布局</p>
<ul>
<li>pack()：将控件放置在父控件内之前，规划此控件在区块内的位置。</li>
<li>grid()：将控件放置在父控件内之前，规划此控件为一个网格类型的架构。</li>
<li>place()：将控件放置在父控件内的特定(指定)位置。</li>
</ul>
</li>
</ul>
<h2 id="wiki_zh_word2vec"><a class="markdownIt-Anchor" href="#wiki_zh_word2vec"></a> <strong><a href="https://github.com/AimeeLee77/wiki_zh_word2vec" target="_blank" rel="noopener">wiki_zh_word2vec</a></strong></h2>
<blockquote>
<p>利用Python构建Wiki中文语料词向量模型试验——找到给定词相似的词语</p>
<p>代码涉及：开发环境准备、数据的获取、数据的预处理、模型构建和模型测试四大内容，对应的是实现模型构建的五个步骤。</p>
</blockquote>
<ol>
<li>
<p>开发环境准备: Python + gensim (NLP神器库) +jieba + <a href="https://bintray.com/package/files/byvoid/opencc/OpenCC" target="_blank" rel="noopener">OpenCC</a>(中文繁体替换成简体)</p>
</li>
<li>
<p>数据获取: 到wiki官网下载<a href="https://dumps.wikimedia.org/zhwiki/latest/zhwiki-latest-pages-articles.xml.bz2" target="_blank" rel="noopener">中文语料</a>、将XML的Wiki数据转换为text格式，使用到了gensim.corpora中的WikiCorpus函数</p>
</li>
<li>
<p>Wiki数据预处理：①使用OpenCC进行繁简转换；②jieba分词</p>
</li>
<li>
<p>Word2Vec模型训练：分好词的文档即可进行word2vec词向量模型的训练了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 训练skip-gram模型</span></span><br><span class="line">model = Word2Vec(LineSentence(inp), size=<span class="number">400</span>, window=<span class="number">5</span>, min_count=<span class="number">5</span>,</span><br><span class="line">                 workers=multiprocessing.cpu_count())</span><br><span class="line">   </span><br><span class="line"><span class="comment"># 保存模型</span></span><br><span class="line">model.save(outp1)</span><br><span class="line">model.wv.save_word2vec_format(outp2, binary=<span class="keyword">False</span>)</span><br></pre></td></tr></table></figure>
<p>代码运行完成后得到如下四个文件，其中wiki.zh.text.model是建好的模型，wiki.zh.text.vector是词向量。</p>
</li>
<li>
<p>模型测试：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">model = gensim.models.Word2Vec.load(fdir + <span class="string">'wiki.zh.text.model'</span>)</span><br><span class="line">word = model.most_similar(<span class="string">u"足球"</span>)</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> word:</span><br><span class="line">    <span class="keyword">print</span> (t[<span class="number">0</span>],t[<span class="number">1</span>])</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">足球运动 0.531202495098</span></span><br><span class="line"><span class="string">国际足球 0.510423064232</span></span><br><span class="line"><span class="string">足球比赛 0.499910503626</span></span><br><span class="line"><span class="string">国家足球队 0.488919615746</span></span><br><span class="line"><span class="string">排球 0.488108128309</span></span><br><span class="line"><span class="string">男体子篮球0.482638418674</span></span><br><span class="line"><span class="string">体育 0.47221454978</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>附：什么是词向量? ——词向量技术是将词转化成为稠密向量，并且对于相似的词，其对应的词向量也相近。</p>
<p>在<a href="https://so.csdn.net/so/search?q=%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener">自然语言处理</a>任务中，首先需要考虑词如何在计算机中表示。通常，有两种表示方式：</p>
<ul>
<li>one-hot representation(离散表示)
<ul>
<li>传统的基于规则或基于统计的自然语义处理方法将单词看作一个原子符号</li>
<li>把每个词表示为一个长向量。这个向量的维度是词表大小，向量中只有一个维度的值为1，其余维度为0，这个维度就代表了当前的词。</li>
<li>one-hot representation相当于给每个词分配一个id，这就导致这种表示方式不能展示词与词之间的关系。另外，one-hot representation将会导致特征空间非常大，但也带来一个好处，就是在高维空间中，很多应用任务线性可分。</li>
</ul>
</li>
<li>distribution representation(分布式表示)
<ul>
<li>word embedding指的是将词转化成一种分布式表示，又称词向量。分布式表示将词表示成一个定长的连续的稠密向量。</li>
<li>分布式表示优点:
<ol>
<li>词之间存在相似关系：是词之间存在“距离”概念，这对很多自然语言处理的任务非常有帮助。</li>
<li>包含更多信息：词向量能够包含更多信息，并且每一维都有特定的含义。在采用one-hot特征时，可以对特征向量进行删减，词向量则不能。</li>
</ol>
</li>
</ul>
</li>
</ul>
<h1 id="系统设计"><a class="markdownIt-Anchor" href="#系统设计"></a> 系统设计</h1>
<h2 id="python-自制屏幕翻译工具"><a class="markdownIt-Anchor" href="#python-自制屏幕翻译工具"></a> <a href="https://pythondict.com/python-work/screen-translate-tools/" target="_blank" rel="noopener">Python 自制屏幕翻译工具</a></h2>
<p>程序的功能主要由3个模块组成</p>
<ol>
<li>
<p>screenshot：截图</p>
<blockquote>
<p>使用Pillow库</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装PIL依赖: pip install pillow</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step1: 从剪切板读取图片</span></span><br><span class="line">img = ImageGrab.grabclipboard()</span><br><span class="line"><span class="comment"># 保存到本地 or 内存中</span></span><br><span class="line">image_result = <span class="string">'./temp.png'</span></span><br><span class="line">img.save(image_result)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>recognition：将截图中的问题识别成文字</p>
<blockquote>
<p>使用easyocr或者pytesseract</p>
</blockquote>
<p>easyocr：</p>
<ul>
<li>编程使用</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> easyocr</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行的过程中会安装所需要的模型文件, 也可以自己下载后放到对应路径下</span></span><br><span class="line"><span class="comment"># Windows：C:\Users\用户名.EasyOCR\model</span></span><br><span class="line"><span class="comment"># Linux：~/ .EasyOCR / model</span></span><br><span class="line">reader = easyocr.Reader([<span class="string">'ch_sim'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用GPU，看是否会有提示 CUDA not available</span></span><br><span class="line"><span class="comment"># reader = easyocr.Reader(['ch_sim'])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 支持同时多个语言, 虽然可以一次性识别许多种语言，</span></span><br><span class="line"><span class="comment"># 但并非所有语言都可以一起用，通常是公共语言和一个特殊语种可以一起识别，相互兼容，比如英语和日语。</span></span><br><span class="line"><span class="comment"># reader = easyocr.Reader(['ch_sim','en'])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 识别</span></span><br><span class="line">resp = requests.get(<span class="string">'https://images.zsxq.com/Fsl4plilMdpd_C8gXVJT1mKJDui9?e=1656604799&amp;token=kIxbL07-8jAj8w1n4s9zv64FuZZNEATmlU_Vm6zD:Pg0990rjMMQUAlf2bJlNL9lmLSU='</span>)</span><br><span class="line">result = reader.readtext(resp.content)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>
<ul>
<li>命令行运行： <code>easyocr -l ch_sim en -f test.png --detail=1 --gpu=True</code></li>
</ul>
<p>图片加载函数<code>readtext</code>接收三种参数</p>
<ul>
<li>文件路径</li>
<li>图片的<code>np_array</code></li>
<li>字节流对象</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> easyocr</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> ImageGrab</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从剪切板中获得图片</span></span><br><span class="line">r = easyocr.Reader([<span class="string">"ch_sim"</span>])</span><br><span class="line"></span><br><span class="line">img = ImageGrab.grabclipboard()</span><br><span class="line">print(img, type(img))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数为: file path or numpy-array or a byte stream object</span></span><br><span class="line"><span class="comment"># 1: file path</span></span><br><span class="line">img_path = <span class="string">"ttt.png"</span></span><br><span class="line">img.save(img_path)</span><br><span class="line">reg_result = r.readtext(img_path)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2: numpy-array</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">np_img = np.array(img)</span><br><span class="line">reg_result = r.readtext(np_img)</span><br><span class="line">print(reg_result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3: a byte stream object</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">resp = requests.get(<span class="string">'https://images.zsxq.com/Fsl4plilMdpd_C8gXVJT1mKJDui9?e=1656604799&amp;token=kIxbL07-8jAj8w1n4s9zv64FuZZNEATmlU_Vm6zD:Pg0990rjMMQUAlf2bJlNL9lmLSU='</span>)</span><br><span class="line">reg_result = r.readtext(resp.content)</span><br><span class="line">print(reg_result)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Translation：将文字翻译</p>
<blockquote>
<p>可以使用网上的有道翻译API、或者直接使用Google提供的翻译库<code>googletrans</code></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Google翻译</span></span><br><span class="line">translator = Translator(service_urls=[<span class="string">'translate.google.cn'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 翻译成中文</span></span><br><span class="line">content_chinese = translator.translate(content_eng, src=<span class="string">'en'</span>, dest=<span class="string">'zh-cn'</span>).text</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>GUI：将翻译后的结果展示</p>
<blockquote>
<p>使用 Python 自带的 GUI tkinker，将识别后的中文显示出来。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始化</span></span><br><span class="line">root = Tk()</span><br><span class="line">root.withdraw()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示翻译后的结果，以对话框的形式</span></span><br><span class="line">tkinter.messagebox.showinfo(<span class="string">'翻译结果'</span>, content_chinese)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>完整代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> easyocr</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> ImageGrab, Image</span><br><span class="line"></span><br><span class="line"><span class="comment"># r = easyocr.Reader(["ch_sim"])</span></span><br><span class="line">r = easyocr.Reader([<span class="string">"en"</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">screenShot</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""1. 从剪切板中获得图片"""</span></span><br><span class="line">    img = ImageGrab.grabclipboard()</span><br><span class="line">    print(img, type(img))</span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">identify</span><span class="params">(img: Image)</span>:</span></span><br><span class="line">    <span class="string">"""2. 识别文字"""</span></span><br><span class="line">    <span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">    np_img = np.array(img)</span><br><span class="line">    reg_result = r.readtext(np_img)</span><br><span class="line">    rs = sorted(reg_result, key=<span class="keyword">lambda</span> x: x[<span class="number">2</span>], reverse=<span class="keyword">True</span>)[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> rs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">translate</span><span class="params">(rs: str)</span>:</span></span><br><span class="line">    <span class="string">"""3. 翻译：googletrans 库"""</span></span><br><span class="line">    <span class="keyword">from</span> googletrans <span class="keyword">import</span> Translator</span><br><span class="line">    <span class="comment"># Google翻译</span></span><br><span class="line">    translator = Translator(service_urls=[<span class="string">'translate.google.cn'</span>])</span><br><span class="line">    <span class="comment"># 翻译成中文</span></span><br><span class="line">    translated_str = translator.translate(rs, src=<span class="string">'en'</span>, dest=<span class="string">'zh-cn'</span>).text</span><br><span class="line">    <span class="keyword">return</span> translated_str</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">showText</span><span class="params">(s: str)</span>:</span></span><br><span class="line">    <span class="string">"""4. tk展示"""</span></span><br><span class="line">    <span class="keyword">import</span> tkinter <span class="keyword">as</span> tk</span><br><span class="line">    <span class="keyword">from</span> tkinter.messagebox <span class="keyword">import</span> showinfo  <span class="comment"># 弹窗库</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 找到主应用</span></span><br><span class="line">    root = tk.Tk()</span><br><span class="line">    <span class="comment"># 隐藏主界面</span></span><br><span class="line">    root.withdraw()</span><br><span class="line">    print(s)</span><br><span class="line">    showinfo(<span class="string">"翻译结果"</span>, s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    img = screenShot()</span><br><span class="line">    <span class="comment"># 识别出来的文字</span></span><br><span class="line">    rs = identify(img)</span><br><span class="line">    translated_str = translate(rs)</span><br><span class="line">    showText(translated_str)</span><br></pre></td></tr></table></figure>
<h2 id="system-design-primer"><a class="markdownIt-Anchor" href="#system-design-primer"></a> <strong><a href="https://github.com/donnemartin/system-design-primer" target="_blank" rel="noopener">system-design-primer</a></strong></h2>
<h2 id="go-package-plantuml"><a class="markdownIt-Anchor" href="#go-package-plantuml"></a> <strong><a href="https://github.com/qquunn/go-package-plantuml" target="_blank" rel="noopener"> go-package-plantuml</a></strong></h2>
<ul>
<li>go中的argueparser：<code>&quot;import github.com/jessevdk/go-flags&quot;</code>。除此之外，还有flag、pflag来处理输入参数</li>
</ul>
<h2 id="id-maker"><a class="markdownIt-Anchor" href="#id-maker"></a> <a href="https://github.com/yongxinz/id-maker" target="_blank" rel="noopener">id-maker</a></h2>
<h2 id="health_checker"><a class="markdownIt-Anchor" href="#health_checker"></a> <a href="https://github.com/Freedomisgood/When_Coding_in_ZJU/blob/main/Health_Checkin/health_checkin_helper_cst.py" target="_blank" rel="noopener">health_checker</a></h2>
<blockquote>
<p>浙大的登陆加密</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python转义实现</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_rsa_encrypt</span><span class="params">(self, password_str, e_str, M_str)</span>:</span></span><br><span class="line">    <span class="comment"># 将str转化为ascii的字节</span></span><br><span class="line">    password_bytes = bytes(password_str, <span class="string">'ascii'</span>)</span><br><span class="line">    <span class="comment"># 大端填充</span></span><br><span class="line">    password_int = int.from_bytes(password_bytes, <span class="string">'big'</span>)</span><br><span class="line">    <span class="comment"># 将其按照16进制的形式转成10进制</span></span><br><span class="line">    e_int = int(e_str, <span class="number">16</span>)</span><br><span class="line">    M_int = int(M_str, <span class="number">16</span>)</span><br><span class="line">    <span class="comment"># password_int^e%M</span></span><br><span class="line">    result_int = pow(password_int, e_int, M_int)</span><br><span class="line">    <span class="comment"># 10进制转成16进制str, 并 rjust() 返回一个原字符串右对齐,并使用空格填充至长度 width 的新字符串。</span></span><br><span class="line">    <span class="comment"># "hello".rjust(8, "0") ==&gt; 000hello</span></span><br><span class="line">    <span class="keyword">return</span> hex(result_int)[<span class="number">2</span>:].rjust(<span class="number">128</span>, <span class="string">'0'</span>)</span><br></pre></td></tr></table></figure>
<p>Js加密</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">RSAUtils.encryptedString = <span class="function"><span class="keyword">function</span>(<span class="params">key, s</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> a = [];</span><br><span class="line">    <span class="comment">// s为反向的password, 如321321aaa</span></span><br><span class="line">	<span class="keyword">var</span> sl = s.length;</span><br><span class="line">	<span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (i &lt; sl) &#123;</span><br><span class="line">		a[i] = s.charCodeAt(i);</span><br><span class="line">		i++;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">// 补足0</span></span><br><span class="line">	<span class="keyword">while</span> (a.length % key.chunkSize != <span class="number">0</span>) &#123;</span><br><span class="line">		a[i++] = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// a ==&gt; 321312aaa000000 的 ascii字符数组</span></span><br><span class="line">	<span class="keyword">var</span> al = a.length;</span><br><span class="line">	<span class="keyword">var</span> result = <span class="string">""</span>;</span><br><span class="line">	<span class="keyword">var</span> j, k, block;</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; al; i += key.chunkSize) &#123;</span><br><span class="line">		block = <span class="keyword">new</span> BigInt();</span><br><span class="line">		j = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (k = i; k &lt; i + key.chunkSize; ++j) &#123;</span><br><span class="line">			block.digits[j] = a[k++];</span><br><span class="line">			block.digits[j] += a[k++] &lt;&lt; <span class="number">8</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">var</span> crypt = key.barrett.powMod(block, key.e);</span><br><span class="line">        </span><br><span class="line">		<span class="keyword">var</span> text = key.radix == <span class="number">16</span> ? RSAUtils.biToHex(crypt) : RSAUtils.biToString(crypt, key.radix);</span><br><span class="line">		result += text + <span class="string">" "</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> result.substring(<span class="number">0</span>, result.length - <span class="number">1</span>); <span class="comment">// Remove last space.</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>new BigInt();</code>得到的是digits.len=130的int数组</li>
</ul>
<h2 id="cookiecutter-golang"><a class="markdownIt-Anchor" href="#cookiecutter-golang"></a> <strong><a href="https://github.com/lacion/cookiecutter-golang" target="_blank" rel="noopener">cookiecutter-golang</a></strong></h2>
<blockquote>
<p>快速生成Go项目的cookiecutter模板</p>
</blockquote>
<ul>
<li><a href="https://github.com/lacion/cookiecutter-golang/blob/master/%7B%7Bcookiecutter.app_name%7D%7D/main.go" target="_blank" rel="noopener">cobar使用</a>与<a href="https://github.com/lacion/cookiecutter-golang/blob/master/%7B%7Bcookiecutter.app_name%7D%7D/cmd/root.go" target="_blank" rel="noopener">cobar命令定义</a>，相当于Python中的Click模块</li>
</ul>
<h2 id="dddd_trainer"><a class="markdownIt-Anchor" href="#dddd_trainer"></a> <strong><a href="https://github.com/sml2h3/dddd_trainer" target="_blank" rel="noopener"> dddd_trainer</a></strong></h2>
<ul>
<li>
<p>Cli命令使用fire库：fire是python中用于生成命令行界面(Command Line Interfaces, CLIs)的工具，不需要做任何额外的工作，只需要从主模块中调用fire.Fire()，它会自动将你的代码转化为CLI，<u>Fire()的参数可以说任何的python对象</u></p>
<p>特点：所有的<strong>子命令</strong>都能以函数、类等形式书写，流程和参数获取都比较清晰；传参可以自动被解析成Python类型：字符串、元组、列表、字典</p>
<p>★使用指南： <a href="https://blog.csdn.net/qq_17550379/article/details/79943740" target="_blank" rel="noopener">https://blog.csdn.net/qq_17550379/article/details/79943740</a></p>
</li>
<li>
<p><a href="https://www.jianshu.com/p/476478c17b8e" target="_blank" rel="noopener">ONNXRuntime</a>： 通常我们在训练模型时可以使用很多不同的框架，比如有的同学喜欢用 <code>Pytorch</code>，有的同学喜欢使用 <code>TensorFLow</code>，也有的喜欢 <code>MXNet</code>，以及深度学习最开始流行的 <code>Caffe</code>等等，这样不同的训练框架就导致了产生不同的模型结果包，在模型进行部署推理时就需要不同的依赖库，而且同一个框架比如<code>tensorflow</code> 不同的版本之间的差异较大， 为了解决这个混乱问题，<a href="https://links.jianshu.com/go?to=https%3A%2F%2Flfaidata.foundation%2F" target="_blank" rel="noopener">LF AI</a> 这个组织联合 Facebook, MicroSoft等公司制定了机器学习模型的标准，这个标准叫做<strong>ONNX, Open Neural Network Exchage</strong>，<em>所有其他框架产生的模型包 (<code>.pth</code>, <code>.pb</code>) 都可以转换成这个标准格式，转换成这个标准格式后，就可以使用统一的 ONNX Runtime等工具进行统一部署。</em></p>
</li>
<li>
<p><a href="https://pythondict.com/life-intelligent/tools/loguru/" target="_blank" rel="noopener">Loguru — 最强大的 Python 日志记录器</a>： 强大的全局日志对象，具有开箱即用的特性、美观的输出，支持<code>f-string</code>、支持在主进程和线程中捕获异常</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">logger.add(<span class="string">"file.log"</span>, rotation=<span class="string">"12:00"</span> , format=<span class="string">"&#123;time:YYYY-MM-DD at HH:mm:ss&#125; | &#123;level&#125; | &#123;message&#125;"</span>, level=<span class="string">"INFO"</span>)</span><br><span class="line">logger.info(<span class="string">"That's it, beautiful and simple logging!"</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="njupt-api"><a class="markdownIt-Anchor" href="#njupt-api"></a> <strong><a href="https://github.com/gaoliang/NJUPT-API" target="_blank" rel="noopener">NJUPT-API</a></strong></h2>
<blockquote>
<p>南京邮电大学网站接口, Python模块</p>
</blockquote>
<ul>
<li>
<p><code>@login_required</code> 装饰器: 由于有些操作必须登录后才会有正确结果，所以相当于在执行前做了一层校验（至于抛出异常or转向登录就看装饰器中怎么写了）—&gt; 由于是封装成了package库，所以在这一层需要进行限制。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login_required</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">    @wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.verified:</span><br><span class="line">            self.login_by_sso()</span><br><span class="line">        <span class="keyword">return</span> func(self, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>setuptools使用</p>
<ul>
<li><a href="http://setup.py" target="_blank" rel="noopener">setup.py</a></li>
<li><a href="http://MANIFEST.in" target="_blank" rel="noopener">MANIFEST.in</a></li>
</ul>
</li>
<li>
<p>模块暴露：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># njupt/__init__.py</span></span><br><span class="line"><span class="keyword">from</span> njupt.card <span class="keyword">import</span> Card  <span class="comment"># noqa</span></span><br><span class="line"><span class="keyword">from</span> njupt.zhengfang <span class="keyword">import</span> Zhengfang  <span class="comment"># noqa</span></span><br><span class="line"><span class="keyword">from</span> njupt.library <span class="keyword">import</span> Library  <span class="comment"># noqa</span></span><br><span class="line"><span class="keyword">from</span> njupt.runningman <span class="keyword">import</span> RunningMan  <span class="comment"># noqa</span></span><br><span class="line"><span class="keyword">from</span> njupt.sso <span class="keyword">import</span> SSO  <span class="comment"># noqa</span></span><br><span class="line"><span class="comment"># 表示njupt模块提供以下5个接口</span></span><br><span class="line">__all__ = [<span class="string">'SSO'</span>, <span class="string">'Card'</span>, <span class="string">'Zhengfang'</span>, <span class="string">'Library'</span>, <span class="string">'RunningMan'</span>]</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>验证码识别</p>
<blockquote>
<p>字符型验证码：把图片去噪、分割、归类。收集了足够多的样本，然后对新的图片也分割。将分隔后的每个字符与样本集匹配，选概率最大的字符，将组合</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CardCaptcha</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    一卡通系统的验证码工具类</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, im)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :param im: PIL.image对象</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.im = im.convert(<span class="string">'L'</span>)</span><br><span class="line">        self.image_pre_process()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">image_pre_process</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 二值化, 去除杂色点</span></span><br><span class="line">        threshold = <span class="number">200</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(self.im.width):</span><br><span class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> range(self.im.height):</span><br><span class="line">                pix = self.im.getpixel((x, y))</span><br><span class="line">                <span class="keyword">if</span> pix &gt; threshold:</span><br><span class="line">                    self.im.putpixel((x, y), BLACK)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.im.putpixel((x, y), WHITE)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_split_image</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 切割验证码，返回包含五个字符图像的列表</span></span><br><span class="line">        y_min, y_max = <span class="number">0</span>, <span class="number">82</span></span><br><span class="line">        <span class="comment"># 字符位置大致固定([7,49], [49, 91], ...)</span></span><br><span class="line">        split_lines = [<span class="number">7</span>, <span class="number">49</span>, <span class="number">91</span>, <span class="number">133</span>, <span class="number">175</span>, <span class="number">217</span>]</span><br><span class="line">        ims = [self.im.crop([u, y_min, v, y_max]) <span class="keyword">for</span> u, v <span class="keyword">in</span> zip(split_lines[:<span class="number">-1</span>], split_lines[<span class="number">1</span>:])]</span><br><span class="line">        <span class="keyword">return</span> ims</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">crack</span><span class="params">(self)</span>:</span></span><br><span class="line">        result = []</span><br><span class="line">        <span class="comment"># 装载训练数据集</span></span><br><span class="line">        <span class="keyword">with</span> open(os.path.join(current_dir, <span class="string">'image_data.json'</span>), <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            image_data = json.load(f)</span><br><span class="line">        <span class="keyword">for</span> letter <span class="keyword">in</span> self.handle_split_image():</span><br><span class="line">            <span class="comment"># build_vector将图片转成一维向量: for pixel in image.getdata():</span></span><br><span class="line">            letter_vector = build_vector(letter)</span><br><span class="line">            guess = []</span><br><span class="line">            <span class="comment"># 在模型数据中, 找一个汉明距离最小(最像的结果)</span></span><br><span class="line">            <span class="keyword">for</span> image <span class="keyword">in</span> image_data:</span><br><span class="line">                <span class="comment"># x为key, 当前匹配的字符; y为向量</span></span><br><span class="line">                <span class="keyword">for</span> x, y <span class="keyword">in</span> image.items():</span><br><span class="line">                    <span class="keyword">if</span> len(y) != <span class="number">0</span>:</span><br><span class="line">                        <span class="comment"># 计算两个一维向量的汉明距（向量只包含0，1时）:(只要元素值不等, 距离就+1)</span></span><br><span class="line">                        guess.append((distance_hanmming(y, letter_vector), x))</span><br><span class="line">            guess.sort()</span><br><span class="line">            <span class="comment"># 找出距离最小的, 即最匹配的字符</span></span><br><span class="line">            result.append(guess[<span class="number">0</span>][<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join(result)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.crack()</span><br></pre></td></tr></table></figure>
<p>注：PIL中image.convert()函数使用</p>
<ol>
<li>模式“1”：为二值图像，非黑即白。但是它每个像素用8个bit表示，0表示黑，255表示白。</li>
<li>模式“L”： 为灰色图像，它的每个像素用8个bit表示，0表示黑，255表示白，其他数字表示不同的灰度。在PIL中，从模式“RGB”转换为“L”模式是按照下面的公式转换的：<code>L = R * 299/1000 + G * 587/1000+ B * 114/1000</code></li>
<li>模式“P”为8位彩色图像、模式“RGBA”(alpha透明度)为32位彩色图像、模式“CMYK”为32位彩色图像</li>
</ol>
</li>
<li>
<p>自制打码工具</p>
<ol>
<li><code>captcha_getter.py</code></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据图片自己输入识别结果, 将图片保存下来, 图片名为正确的打码结果</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CaptchaGUI</span>:</span></span><br><span class="line">    BASE_URL = <span class="string">"http://yktapp.njupt.edu.cn:8070"</span></span><br><span class="line">    CAPTCHA_URL = BASE_URL + <span class="string">"/Login/GetValidateCode"</span></span><br><span class="line">    LOGIN_URL = BASE_URL + <span class="string">"/Login/LoginBySnoQuery"</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.s = requests.session()</span><br><span class="line">        self.r = self.s.get(self.CAPTCHA_URL)</span><br><span class="line">        self.im = Image.open(BytesIO(self.r.content))</span><br><span class="line">        self.root = tkinter.Tk()</span><br><span class="line">        self.tkimg = ImageTk.PhotoImage(self.im)</span><br><span class="line">        self.imgLabel = tkinter.Label(self.root, image=self.tkimg)</span><br><span class="line">        self.imgLabel.pack()</span><br><span class="line">        self.message = tkinter.Entry(self.root)</span><br><span class="line">        self.message.pack()</span><br><span class="line">        self.root.bind(<span class="string">'&lt;Return&gt;'</span>, self.judge_and_save)</span><br><span class="line">        self.root.mainloop()</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">judge_and_save</span><span class="params">(self, event)</span>:</span></span><br><span class="line">        <span class="comment"># 输出输入框的内容</span></span><br><span class="line">        captcha_value = self.message.get()</span><br><span class="line">        print(captcha_value)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"sno"</span>: self.account,</span><br><span class="line">            <span class="string">"pwd"</span>: base64.b64encode(self.pwd.encode(<span class="string">"utf8"</span>)),</span><br><span class="line">            <span class="string">"ValiCode"</span>: captcha_value,</span><br><span class="line">            <span class="string">"remember"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">"uclass"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">"zqcode"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"json"</span>: <span class="keyword">True</span>,</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment"># 只有输入正确的才保存</span></span><br><span class="line">        r = self.s.post(self.LOGIN_URL, data=data)</span><br><span class="line">        <span class="keyword">if</span> r.json()[<span class="string">"IsSucceed"</span>]:</span><br><span class="line">            print(<span class="string">"成功！"</span>)</span><br><span class="line">            <span class="keyword">with</span> open(<span class="string">"captchas/&#123;&#125;.gif"</span>.format(captcha_value), <span class="string">'wb+'</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(self.r.content)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(r.json())</span><br><span class="line">            print(<span class="string">"验证码输错了"</span>)</span><br><span class="line">		<span class="comment"># 刷新, 进行打码下一张</span></span><br><span class="line">        self.r = self.s.get(self.CAPTCHA_URL)</span><br><span class="line">        self.im = Image.open(BytesIO(self.r.content))</span><br><span class="line">        <span class="comment"># 刷新图片框</span></span><br><span class="line">        self.tkimg = ImageTk.PhotoImage(self.im)</span><br><span class="line">        self.imgLabel.config(image=self.tkimg)</span><br><span class="line">        <span class="comment"># ▲. 将输入框清空</span></span><br><span class="line">        self.message.delete(<span class="number">0</span>, <span class="string">'end'</span>)</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><code>captcha_gen.py</code></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">spilt2chars</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    分割已有的数据为字符并保存</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        shutil.rmtree(<span class="string">'captcha_chars'</span>)</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    os.mkdir(<span class="string">"captcha_chars"</span>)</span><br><span class="line">    values = <span class="string">"1234567890"</span></span><br><span class="line">    <span class="comment"># 每个字符创建对应的文件夹</span></span><br><span class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> values:</span><br><span class="line">        os.mkdir(<span class="string">'captcha_chars/&#123;&#125;'</span>.format(value))</span><br><span class="line"></span><br><span class="line">    file_names = os.listdir(<span class="string">'captchas'</span>)</span><br><span class="line">    <span class="comment"># 遍历所有字符文件夹</span></span><br><span class="line">    <span class="keyword">for</span> file_name <span class="keyword">in</span> file_names: </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(<span class="string">'captchas/&#123;&#125;'</span>.format(file_name)) <span class="keyword">and</span> file_name != <span class="string">'.DS_Store'</span>:</span><br><span class="line">            <span class="comment"># 获得打码img的图片名称(正确结果)</span></span><br><span class="line">            values = file_name[:<span class="number">4</span>]</span><br><span class="line">            im = Image.open(<span class="string">'captchas/&#123;&#125;'</span>.format(file_name))</span><br><span class="line">            captcha = CardCaptcha(im)</span><br><span class="line">            <span class="comment"># handle_split_image为切割后的四个字符图片, values为3fgc的值</span></span><br><span class="line">            <span class="keyword">for</span> im_part, value <span class="keyword">in</span> zip(captcha.handle_split_image(), values):</span><br><span class="line">                <span class="comment"># 进行md5随机取名保存</span></span><br><span class="line">                m = hashlib.md5()</span><br><span class="line">                m.update(<span class="string">"&#123;&#125;&#123;&#125;"</span>.format(time.time(), value).encode(<span class="string">'utf8'</span>))</span><br><span class="line">                <span class="comment"># captcha_chars/3/asdz.png</span></span><br><span class="line">                im_part.save(<span class="string">"captcha_chars/&#123;&#125;/&#123;&#125;.png"</span>.format(value, m.hexdigest()))</span><br><span class="line">                </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_models</span><span class="params">()</span>:</span></span><br><span class="line">    iconset = list(<span class="string">'0123456789'</span>)</span><br><span class="line">    <span class="comment"># 将图像数据转为向量数据并保存</span></span><br><span class="line">    image_data = []</span><br><span class="line">    <span class="keyword">for</span> letter <span class="keyword">in</span> iconset:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 遍历字符3下面所有的图片</span></span><br><span class="line">            <span class="keyword">for</span> img <span class="keyword">in</span> os.listdir(<span class="string">'captcha_chars/&#123;&#125;/'</span>.format(letter)):</span><br><span class="line">                <span class="keyword">if</span> img != <span class="string">"Thumbs.db"</span> <span class="keyword">and</span> img != <span class="string">".DS_Store"</span>:</span><br><span class="line">                    <span class="comment"># 得到其图片向量</span></span><br><span class="line">                    temp = build_vector(Image.open(<span class="string">"captcha_chars/&#123;&#125;/&#123;&#125;"</span>.format(letter, img)))</span><br><span class="line">                    <span class="comment"># models_list中添加[&#123;1: [0,1,1...]&#125;]</span></span><br><span class="line">                    image_data.append(&#123;letter: temp&#125;)</span><br><span class="line">        <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">            print(letter)</span><br><span class="line">	image_data = [ &#123;<span class="number">1</span>: [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,...]&#125;, &#123;<span class="number">1</span>: [<span class="number">1</span>,<span class="number">0</span>,...]&#125;, ..., &#123;<span class="number">2</span>: [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,...]&#125;]</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'image_data.json'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        json.dump(image_data, f)</span><br></pre></td></tr></table></figure>
<p>附：找到最合适的旋转角度</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rotate_img</span><span class="params">(image)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    根据图像在x轴方向投影大小确定字符的摆放方向</span></span><br><span class="line"><span class="string">    -45~+45循环, 当x轴上投影得到的白色像素数量最小，此时就是正确的角度</span></span><br><span class="line"><span class="string">    :param image: PIL.Image object</span></span><br><span class="line"><span class="string">    :return: rotated Image object</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    min_count = <span class="number">1000</span></span><br><span class="line">    final_angle = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> angle <span class="keyword">in</span> range(<span class="number">-45</span>, <span class="number">45</span>):</span><br><span class="line">        x_count = <span class="number">0</span></span><br><span class="line">        ti = image.rotate(angle, expand=<span class="keyword">True</span>)</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(ti.width):</span><br><span class="line">            <span class="comment"># 当前y列只要有一个像素为white, 那么就+1结束, 进行下一列判断</span></span><br><span class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> range(ti.height):</span><br><span class="line">                <span class="keyword">if</span> ti.getpixel((x, y)) == WHITE:</span><br><span class="line">                    x_count += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> x_count &lt; min_count:</span><br><span class="line">            min_count = x_count</span><br><span class="line">            final_angle = angle</span><br><span class="line">    image = image.rotate(final_angle, expand=<span class="keyword">False</span>)</span><br><span class="line">    <span class="keyword">return</span> image</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="rss-monitor"><a class="markdownIt-Anchor" href="#rss-monitor"></a> <strong><a href="https://github.com/Freedomisgood/Rss-Monitor" target="_blank" rel="noopener">Rss-Monitor</a></strong></h2>
<blockquote>
<p>一个通用的RSS订阅通知器，和**<a href="https://github.com/DIYgod/RSSHub" target="_blank" rel="noopener">RSSHub</a>**一起食用效果更好哦。<br>
RSS(Really Simple Syndication,简易信息聚合)是一种描述和同步网站内容的格式你可以认为是一种定制个性化推送信息的服务。它能够解决你漫无目的的浏览网页的问题。</p>
</blockquote>
<ul>
<li>
<p>动态导入模块</p>
</li>
<li>
<p>获得Rss链接信息——<a href="https://pypi.python.org/pypi/feedparser/" target="_blank" rel="noopener">feedparser</a>库</p>
<blockquote>
<p>feedparser是一个Python的Feed解析库，可以处理RSS ，CDF，Atom 。使用它我们可从任何 RSS 或 Atom 订阅源得到标题、链接和文章的条目了。</p>
</blockquote>
<p>标准的item格式:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>&lt;![CDATA[厦门公交车放火案死者名单公布&lt;br/&gt;警方公布嫌犯犯罪证据]]&gt;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span>&gt;</span>http://www.infzm.com/content/91404<span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>&lt;![CDATA[6月11日下午，厦门BRT公交车放火案47名死亡者名单公布。厦门政府新闻办6月10日发布消息称，有证据表明，陈水总携带汽油上了闽DY7396公交车。且有多名幸存者指认其在车上纵火，致使整部车引起猛烈燃烧。经笔迹鉴定，陈水总6月7日致妻、女的两封绝笔书系陈水总本人所写。]]&gt;<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">category</span>&gt;</span>南方周末-热点新闻<span class="tag">&lt;/<span class="name">category</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">author</span>&gt;</span>infzm<span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pubDate</span>&gt;</span>2013-06-11 11:24:32<span class="tag">&lt;/<span class="name">pubDate</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>feedparser模块api</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> feedparser</span><br><span class="line">d=feedparser.parse(<span class="string">'http://feed.cnblogs.com/blog/sitehome/rss'</span>)</span><br><span class="line"><span class="comment"># d.feed为数据字典, 与entries相比一个是dict一个是list, 其次entries中是更加凝练点的数据</span></span><br><span class="line"><span class="comment">#   输出字典中的键值有哪些，一共有10中如下：</span></span><br><span class="line">[<span class="string">'feed'</span>, <span class="string">'status'</span>, <span class="string">'version'</span>, <span class="string">'encoding'</span>, <span class="string">'bozo'</span>, <span class="string">'headers'</span>, <span class="string">'href'</span>, <span class="string">'namespaces'</span>, <span class="string">'entries'</span>, <span class="string">'bozo_exception'</span>]</span><br><span class="line">&#123;<span class="string">'feed'</span>: &#123;&#125;, <span class="string">'encoding'</span>: <span class="string">u'utf-8'</span>, <span class="string">'bozo'</span>: <span class="number">1</span>, <span class="string">'version'</span>: <span class="string">u''</span>, <span class="string">'namespaces'</span>: &#123;&#125;, <span class="string">'entries'</span>: [], <span class="string">'bozo_exception'</span>: SAXParseException(<span class="string">'no element found'</span>,)&#125;</span><br><span class="line"><span class="comment"># d.channel下的属性为channel中中的字段，比如title、link、description、generator、webMaster、lastBuildDate</span></span><br><span class="line">&gt;&gt;&gt;d[<span class="string">'feed'</span>][<span class="string">'title'</span>]</span><br><span class="line"><span class="string">'博客园_首页'</span></span><br><span class="line">&gt;&gt;&gt;d.feed.title    <span class="comment">#通过属性的方式访问</span></span><br><span class="line"><span class="string">'博客园_首页'</span></span><br><span class="line">&gt;&gt;&gt;d.feed.subtitle</span><br><span class="line"><span class="string">'代码改变世界'</span></span><br><span class="line">&gt;&gt;&gt;d.feed.link</span><br><span class="line"><span class="string">'uuid:1b90fd0c-6080-4ea5-86b1-b87c64b95d69;id=4466'</span></span><br><span class="line">d.entries <span class="comment">#该属性类型为列表，表示一组文章的条目</span></span><br><span class="line">&gt;&gt;&gt;type(d.entries)    <span class="comment">#类型为列表, 为item标签中的内容</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">list</span>'&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt;<span class="title">len</span><span class="params">(d.entries)</span>   #一共20篇文章</span></span><br><span class="line"><span class="class">20</span></span><br></pre></td></tr></table></figure>
<p>每个RSS和Atom订阅源都包含一个标题（d.feed.title）和一组文章条目(d.entries)</p>
<p><strong>通常</strong>每个文章条目都有一段摘要（d.entries[i].summary）,或者是包含了条目中实际文本的描述性标签（d.entries[i].description）</p>
</li>
<li>
<p>自定义添加Rss链接-&gt;<a href="https://docs.rsshub.app/joinus/quick-start.html%E3%80%81" target="_blank" rel="noopener">https://docs.rsshub.app/joinus/quick-start.html、</a><a href="https://github.com/DIYgod/RSSHub/pull/1768/files#" target="_blank" rel="noopener"><br>
添加浙江工商大学教务处和学校首页通知</a></p>
<blockquote>
<p>除了按照Rsshub来自定义Rss订阅源以外，还可以使用 <a href="https://github.com/huginn/huginn" target="_blank" rel="noopener">Huginn</a>、Feed43等工具，如<a href="https://www.jianshu.com/p/1024956c8396" target="_blank" rel="noopener">用Feed43为教务处网站制作RSS</a></p>
</blockquote>
<ol>
<li>
<p>暴露路由链接：在 <a href="https://github.com/DIYgod/RSSHub/blob/master/lib/router.js" target="_blank" rel="noopener">/lib/router.js (opens new window)</a>里添加路由</p>
</li>
<li>
<p>编写数据源脚本：在 <a href="https://github.com/DIYgod/RSSHub/tree/master/lib/routes" target="_blank" rel="noopener">/lib/routes/ (opens new window)</a>中的路由对应路径下创建新的 js 脚本：</p>
<ol>
<li>使用 got 请求 HTML 数据：</li>
<li>使用 cheerio 解析返回的 HTML:</li>
<li>使用 map 遍历数组，解析出每一个 item 的结果 ——对数据进行进一步处理，生成符合 RSS 规范的对象，把获取的标题、链接、描述、发布时间等数据赋值给 ctx.state.data, <a href="https://docs.rsshub.app/joinus/quick-start.html#%E7%94%9F%E6%88%90-rss-%E6%BA%90" target="_blank" rel="noopener">生成 RSS 源</a>：</li>
</ol>
<blockquote>
<p>生成 RSS 源原理：获取到的数据赋给 ctx.state.data, 然后数据会经过 <a href="https://github.com/DIYgod/RSSHub/blob/master/lib/middleware/template.js" target="_blank" rel="noopener">template.js (opens new window)</a>中间件处理，最后传到 <a href="https://github.com/DIYgod/RSSHub/blob/master/lib/views/rss.art" target="_blank" rel="noopener">/lib/views/rss.art (opens new window)</a>来生成最后的 RSS 结果，每个字段的含义如下：<a href="https://docs.rsshub.app/joinus/quick-start.html#ti-jiao-xin-de-rsshub-gui-ze-bian-xie-jiao-ben" target="_blank" rel="noopener">https://docs.rsshub.app/joinus/quick-start.html#ti-jiao-xin-de-rsshub-gui-ze-bian-xie-jiao-ben</a></p>
</blockquote>
</li>
</ol>
<p>3.添加脚本文档: <code>&lt;Route author=&quot;HenryQW&quot; example=&quot;/github/issue/DIYgod/RSSHub&quot; path=&quot;/github/issue/:user/:repo&quot; :paramsDesc=&quot;['用户名', '仓库名']&quot; /&gt;</code></p>
</li>
</ul>
<h2 id="ddt-sharp-shooter"><a class="markdownIt-Anchor" href="#ddt-sharp-shooter"></a> <strong><a href="https://github.com/boring-plans/ddt-sharp-shooter" target="_blank" rel="noopener"> ddt-sharp-shooter</a></strong></h2>
<blockquote>
<p>使用到的库: <code>screeninfo、pillow、ddddocr、pynput</code></p>
<ul>
<li>pynput: 控制和监视输入设备；类似的有PyHook3（监视键鼠）、pywin32 （模拟键鼠）</li>
<li>ddddocr：识别验证码，这边用来识别数字</li>
</ul>
</blockquote>
<ol>
<li>
<p>进程间通信。 Tkinter界面开启mainloop进程，其中又开辟出一个子线程来侦听其他进程发送的数据消息，然后通过<code>tk.Text</code>控件来展示</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> tkinter</span><br><span class="line"><span class="comment"># 声明全局对象及类型</span></span><br><span class="line">_tk: tkinter.Tk</span><br><span class="line">_text: tkinter.Text</span><br><span class="line">_terminate = <span class="keyword">False</span></span><br><span class="line">_queue: multiprocessing.Queue</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_text</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""子线程侦听进程消息"""</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> _terminate:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> _queue.empty():</span><br><span class="line">            text = _queue.get(<span class="keyword">False</span>)</span><br><span class="line">            append_text(text)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">append_text</span><span class="params">(text)</span>:</span></span><br><span class="line">    _text.config(state=<span class="string">'normal'</span>)</span><br><span class="line">    _text.insert(<span class="string">'end'</span>, <span class="string">f'\n<span class="subst">&#123;text&#125;</span>'</span>)</span><br><span class="line">    _text.see(<span class="string">'end'</span>)</span><br><span class="line">    _text.config(state=<span class="string">'disabled'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(gui_queue)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> _tk, _text, _queue, _screen_size</span><br><span class="line">    _queue = gui_queue</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    threading.Thread(target=update_text).start()</span><br><span class="line">    </span><br><span class="line">    _tk.mainloop()</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>py2app setup</code>，在macos下创建python应用， <code>python setup.py py2app</code></p>
</li>
<li>
<p>对纯数字识别结果进行清洗</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recognize_digits</span><span class="params">(image: bytes)</span>:</span></span><br><span class="line">    ocr = ddddocr.DdddOcr(show_ad=<span class="keyword">False</span>)</span><br><span class="line">    result = ocr.classification(image)</span><br><span class="line">    <span class="keyword">return</span> wash_digits(result)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wash_digits</span><span class="params">(digits: str)</span>:</span></span><br><span class="line">    <span class="string">"""由于不会出现非数字, 所以对易识别错误的字符进行替换"""</span></span><br><span class="line">    washed = digits \</span><br><span class="line">        .replace(<span class="string">'g'</span>, <span class="string">'9'</span>).replace(<span class="string">'q'</span>, <span class="string">'9'</span>) \</span><br><span class="line">        .replace(<span class="string">'l'</span>, <span class="string">'1'</span>).replace(<span class="string">'i'</span>, <span class="string">'1'</span>) \</span><br><span class="line">        .replace(<span class="string">'z'</span>, <span class="string">'2'</span>) \</span><br><span class="line">        .replace(<span class="string">'o'</span>, <span class="string">'0'</span>)</span><br><span class="line">    <span class="keyword">return</span> re.sub(<span class="string">r'\D'</span>, <span class="string">'0'</span>, washed)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="文章记录"><a class="markdownIt-Anchor" href="#文章记录"></a> 文章记录</h1>
<h2 id="github优秀的文章项目"><a class="markdownIt-Anchor" href="#github优秀的文章项目"></a> Github优秀的文章项目</h2>
<ul>
<li><strong><a href="https://github.com/danistefanovic/build-your-own-x" target="_blank" rel="noopener">build-your-own-x</a></strong>——自己造轮子</li>
<li><strong><a href="https://github.com/donnemartin/system-design-primer" target="_blank" rel="noopener">system-design-primer</a></strong>——系统架构设计</li>
<li><strong><a href="https://github.com/doocs/advanced-java" target="_blank" rel="noopener">advanced-java</a></strong>——互联网 Java 工程师进阶知识完全扫盲</li>
<li><a href="https://juejin.cn/post/6844903624062009352" target="_blank" rel="noopener">https://juejin.cn/post/6844903624062009352</a></li>
<li></li>
</ul>
<h2 id="go好用的三方库"><a class="markdownIt-Anchor" href="#go好用的三方库"></a> Go好用的三方库</h2>
<ul>
<li>
<p>丰富原生数据结构map、slice的工具库：<a href="https://github.com/samber/lo" target="_blank" rel="noopener">https://github.com/samber/lo</a></p>
</li>
<li>
<p>输入参数解析库: <a href="https://github.com/jessevdk/go-flags" target="_blank" rel="noopener">go-flags</a></p>
</li>
<li>
<p>操作excel的库：<a href="https://github.com/qax-os/excelize" target="_blank" rel="noopener">excelize</a></p>
</li>
</ul>
</article><!-- lincense--><div class="license-wrapper"><p> <span>Author:  </span><a href="https://nymrli.top">Mrli</a></p><p> <span>Link:  </span><a href="https://nymrli.top/2022/03/29/开源项目代码阅读记录/">https://nymrli.top/2022/03/29/开源项目代码阅读记录/</a></p><p> <span>Copyright:  </span><span>All articles in this blog are licensed under <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/3.0">CC BY-NC-SA 3.0</a> unless stating additionally.</span></p></div><div class="post-paginator"><a class="prevSlogan" href="/2022/04/04/PlantUML作图/" title="PlantUML作图"><span>< PreviousPost</span><br><span class="prevTitle">PlantUML作图</span></a><a class="nextSlogan" href="/2022/03/19/2022年3月19日-20日爬虫项目记录/" title="2022年3月19~20日-爬虫项目记录"><span>NextPost ></span><br><span class="nextTitle">2022年3月19~20日-爬虫项目记录</span></a><div class="clear"></div></div><div id="comment"><div id="container"></div><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script><script>var gitment = new Gitment({
  id: '开源项目代码阅读记录',
  owner: 'Freedomisgood',
  repo: 'Freedomisgood.github.io',
  oauth: {
    client_id: 'bc5a81fe36017dcd8b63',
    client_secret: '949cec3a1b91742c6249c47259791e4b80a6fa69',
  },
})
gitment.render('container')</script></div></section></article><footer id="cxo-footer-outer"><div id="cxo-footer-inner"><p class="footer-container"><span>Site by </span><a href="http://hexo.io"><span>Hexo</span></a><span> | theme </span><a href="https://github.com/Longlongyu/hexo-theme-Cxo"><span>Cxo</span></a></p><p class="beian"><span>备案号:苏ICP备18015439号</span></p><i class="fa fa-user"> </i><span id="busuanzi_value_site_uv"></span><span> | </span><i class="fa fa-eye"> </i><span id="busuanzi_value_site_pv"></span></div></footer><!-- catelog--><div class="toc-wrapper" style="top: 60vh;"><div class="toc-catalog"><i class="fa fa-list"> </i><span>CATALOG</span></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#爬虫系列"><span class="toc-number">1.</span> <span class="toc-text"> 爬虫系列</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#抢购-秒杀"><span class="toc-number">1.1.</span> <span class="toc-text"> 抢购、秒杀</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#taobao_seckill"><span class="toc-number">1.1.1.</span> <span class="toc-text">  taobao_seckill</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#taobao_api"><span class="toc-number">1.1.2.</span> <span class="toc-text"> taobao_api</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jd_seckill"><span class="toc-number">1.1.3.</span> <span class="toc-text"> jd_seckill</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jd-assistant"><span class="toc-number">1.1.4.</span> <span class="toc-text"> jd-assistant★</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jd-seckill-maotai"><span class="toc-number">1.1.5.</span> <span class="toc-text">  jd-seckill-maotai</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#主要功能"><span class="toc-number">1.2.</span> <span class="toc-text"> 主要功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#jd_mask"><span class="toc-number">1.2.1.</span> <span class="toc-text"> jd_mask</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#automatic_ticket_purchase"><span class="toc-number">1.2.2.</span> <span class="toc-text"> Automatic_ticket_purchase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nikerobot"><span class="toc-number">1.2.3.</span> <span class="toc-text">  NikeRobot</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hpv4g"><span class="toc-number">1.2.4.</span> <span class="toc-text"> hpv4g★</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#抢购型代码总结"><span class="toc-number">1.2.5.</span> <span class="toc-text"> 抢购型代码总结：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#weibospider"><span class="toc-number">1.3.</span> <span class="toc-text"> weiboSpider</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#proxy_pool"><span class="toc-number">1.4.</span> <span class="toc-text"> proxy_pool★</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#scheduler的逻辑"><span class="toc-number">1.4.1.</span> <span class="toc-text"> scheduler的逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#项目目录结构默写"><span class="toc-number">1.4.2.</span> <span class="toc-text"> 项目目录结构默写：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#极验滑块验证码破解与研究三滑块缺口识别"><span class="toc-number">1.5.</span> <span class="toc-text"> 极验滑块验证码破解与研究（三）：滑块缺口识别</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#机器学习"><span class="toc-number">2.</span> <span class="toc-text"> 机器学习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#cardrecorder"><span class="toc-number">2.1.</span> <span class="toc-text"> cardRecorder</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#wiki_zh_word2vec"><span class="toc-number">2.2.</span> <span class="toc-text"> wiki_zh_word2vec</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#系统设计"><span class="toc-number">3.</span> <span class="toc-text"> 系统设计</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#python-自制屏幕翻译工具"><span class="toc-number">3.1.</span> <span class="toc-text"> Python 自制屏幕翻译工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#system-design-primer"><span class="toc-number">3.2.</span> <span class="toc-text"> system-design-primer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#go-package-plantuml"><span class="toc-number">3.3.</span> <span class="toc-text">  go-package-plantuml</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#id-maker"><span class="toc-number">3.4.</span> <span class="toc-text"> id-maker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#health_checker"><span class="toc-number">3.5.</span> <span class="toc-text"> health_checker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cookiecutter-golang"><span class="toc-number">3.6.</span> <span class="toc-text"> cookiecutter-golang</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dddd_trainer"><span class="toc-number">3.7.</span> <span class="toc-text">  dddd_trainer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#njupt-api"><span class="toc-number">3.8.</span> <span class="toc-text"> NJUPT-API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rss-monitor"><span class="toc-number">3.9.</span> <span class="toc-text"> Rss-Monitor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ddt-sharp-shooter"><span class="toc-number">3.10.</span> <span class="toc-text">  ddt-sharp-shooter</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#文章记录"><span class="toc-number">4.</span> <span class="toc-text"> 文章记录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#github优秀的文章项目"><span class="toc-number">4.1.</span> <span class="toc-text"> Github优秀的文章项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#go好用的三方库"><span class="toc-number">4.2.</span> <span class="toc-text"> Go好用的三方库</span></a></li></ol></li></ol></div><!-- top--><i class="fa fa-arrow-up close" id="go-up" aria-hidden="true"></i></body></html>
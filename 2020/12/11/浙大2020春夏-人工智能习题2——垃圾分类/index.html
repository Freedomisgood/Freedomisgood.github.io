<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><meta name="author" content="Mrli"><meta name="renderer" content="webkit"><meta name="copyright" content="Mrli"><meta name="keywords" content="Mrli's Blog"><meta name="description" content="想和你讲，说了会心动 ，缄默会心安。"><meta name="Cache-Control" content="no-cache"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>浙大2020春夏-人工智能习题2——垃圾分类 · Mr.li's Blog</title><link rel="stylesheet" href="/css/style.css?v=2018.7.9"><link rel="stylesheet" href="/css/animation.css?v=2018.7.9"><link rel="icon" href="/img/assets/favicon.ico"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.6"><!-- scripts--><script>(function( w ){
  "use strict";
  // rel=preload support test
  if( !w.loadCSS ){
    w.loadCSS = function(){};
  }
  // define on the loadCSS obj
  var rp = loadCSS.relpreload = {};
  // rel=preload feature support test
  // runs once and returns a function for compat purposes
  rp.support = (function(){
    var ret;
    try {
      ret = w.document.createElement( "link" ).relList.supports( "preload" );
    } catch (e) {
      ret = false;
    }
    return function(){
      return ret;
    };
  })();

  // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
  // then change that media back to its intended value on load
  rp.bindMediaToggle = function( link ){
    // remember existing media attr for ultimate state, or default to 'all'
    var finalMedia = link.media || "all";

    function enableStylesheet(){
      link.media = finalMedia;
    }

    // bind load handlers to enable media
    if( link.addEventListener ){
      link.addEventListener( "load", enableStylesheet );
    } else if( link.attachEvent ){
      link.attachEvent( "onload", enableStylesheet );
    }

    // Set rel and non-applicable media type to start an async request
    // note: timeout allows this to happen async to let rendering continue in IE
    setTimeout(function(){
      link.rel = "stylesheet";
      link.media = "only x";
    });
    // also enable media after 3 seconds,
    // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
    setTimeout( enableStylesheet, 3000 );
  };

  // loop through link elements in DOM
  rp.poly = function(){
    // double check this to prevent external calls from running
    if( rp.support() ){
      return;
    }
    var links = w.document.getElementsByTagName( "link" );
    for( var i = 0; i < links.length; i++ ){
      var link = links[ i ];
      // qualify links to those with rel=preload and as=style attrs
      if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
        // prevent rerunning on link
        link.setAttribute( "data-loadcss", true );
        // bind listeners to toggle media back
        rp.bindMediaToggle( link );
      }
    }
  };

  // if unsupported, run the polyfill
  if( !rp.support() ){
    // run once at least
    rp.poly();

    // rerun poly on an interval until onload
    var run = w.setInterval( rp.poly, 500 );
    if( w.addEventListener ){
      w.addEventListener( "load", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    } else if( w.attachEvent ){
      w.attachEvent( "onload", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    }
  }


  // commonjs
  if( typeof exports !== "undefined" ){
    exports.loadCSS = loadCSS;
  }
  else {
    w.loadCSS = loadCSS;
  }
}( typeof global !== "undefined" ? global : this ) );</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" defer></script><script src="/js/main.js?v=2018.7.9" defer></script><!-- fancybox--><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script><!-- busuanzi--><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></head><body><section class="profile-close" id="cxo-profile"><div class="profile-avatar"><i class="fa fa-caret-left"></i><img src="https://avatars1.githubusercontent.com/u/31088082?s=400&amp;u=7a99ff83916afb3f4c5312bd78a1be17fe0e34ed&amp;v=4"></div><!--.profile-saying
  i.fa.fa-comment
  .saying--><div class="cxo-profile-inner"><div class="profile-name">Mrli</div><div class="profile-signature">别装作很努力,<br>因为结局不会陪你演戏。</div><div class="contacts"><div>Contacts:</div><span><a href="http://sighttp.qq.com/msgrd?v=1&amp;uin=1063052964" target="_black">QQ</a></span><span><a href="https://www.cnblogs.com/nymrli/" target="_black">博客园</a></span></div><div class="read-progress"></div></div></section><header id="cxo-intro" style="height: 60vh;background-image: url(/img/intro/index-bg.png);"><nav id="cxo-intro-nav"><section><div class="intro-nav-title"><a href="/">Mr.li's Blog</a></div><div class="intro-nav-label-box"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div><i class="fa fa-bars intro-nav-menu"><div class="intro-nav-drop"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div></i><div class="clear"></div></section></nav><h1 class="post-title">浙大2020春夏-人工智能习题2——垃圾分类</h1><div class="post-intros"><div class="post-intro-meta"><span class="post-intro-time"><i class="post-intro-calendar fa fa-edit"></i><span>2020/12/19</span></span><span class="busuanzi-pv" id="busuanzi_container_page_pv"><i class="post-intro-calendar fa fa-user-o"></i><span id="busuanzi_value_page_pv"></span></span><span class="post-intro-tags"><a class="intro-tag fa fa-tag" href="javascript:void(0)" date-tags="ZJU"> ZJU</a><a class="intro-tag fa fa-tag" href="javascript:void(0)" date-tags="ML"> ML</a></span></div><div class="post-intro-read"><span> Word count: <span class="post-count">6,612</span> | Reading time: <span class="post-count">30</span>min</span></div></div></header><article class="cxo-up" id="cxo-content-outer"><section id="cxo-content-inner"><article class="article-entry" id="post"><blockquote>
<p>homework for ZJU: <a href="https://mo.zju.edu.cn/homework/zju_ai_2020_ss" target="_blank" rel="noopener">https://mo.zju.edu.cn/homework/zju_ai_2020_ss</a></p>
</blockquote>
<h1 id="1-实验介绍"><a class="markdownIt-Anchor" href="#1-实验介绍"></a> 1. 实验介绍</h1>
<h2 id="11-实验背景"><a class="markdownIt-Anchor" href="#11-实验背景"></a> 1.1 实验背景</h2>
<p>自今年 7 月 1 日起，上海市将正式实施 《上海市生活垃圾管理条例》。<br>
垃圾分类，看似是微不足道的“小事”，实则关系到13亿多人生活环境的改善，理应大力提倡。<br>
垃圾识别分类数据集中包括玻璃 (glass) 、硬纸板 (cardboard) 、金属 (metal) 、纸 (paper) 、塑料 (plastic) 、一般垃圾 (trash) ，共6个类别。<br>
生活垃圾由于种类繁多，具体分类缺乏统一标准，大多人在实际操作时会“选择困难”，基于深度学习技术建立准确的分类模型，利用技术手段改善人居环境。</p>
<h2 id="12-实验要求"><a class="markdownIt-Anchor" href="#12-实验要求"></a> 1.2 实验要求</h2>
<p>a）建立深度神经网络模型，并尽可能将其调到最佳状态。<br>
b）绘制深度神经网络模型图、绘制并分析学习曲线。<br>
c）用准确率等指标对模型进行评估。</p>
<h2 id="13-实验环境"><a class="markdownIt-Anchor" href="#13-实验环境"></a> 1.3 实验环境</h2>
<p>可以使用基于 Python 的 OpenCV 库进行图像相关处理，使用 Numpy 库进行相关数值运算，使用 Keras 等框架建立深度学习模型等。</p>
<h1 id="2实验内容"><a class="markdownIt-Anchor" href="#2实验内容"></a> 2.实验内容</h1>
<h2 id="21-介绍数据集"><a class="markdownIt-Anchor" href="#21-介绍数据集"></a> 2.1 介绍数据集</h2>
<p>该数据集包含了 2307 个生活垃圾图片。数据集的创建者将垃圾分为了 6 个类别，分别是：</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>中文名</th>
<th>英文名</th>
<th>数据集大小</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>玻璃</td>
<td>glass</td>
<td>457</td>
</tr>
<tr>
<td>2</td>
<td>纸</td>
<td>paper</td>
<td>540</td>
</tr>
<tr>
<td>3</td>
<td>硬纸板</td>
<td>cardboard</td>
<td>370</td>
</tr>
<tr>
<td>4</td>
<td>塑料</td>
<td>plastic</td>
<td>445</td>
</tr>
<tr>
<td>5</td>
<td>金属</td>
<td>metal</td>
<td>380</td>
</tr>
<tr>
<td>6</td>
<td>一般垃圾</td>
<td>trash</td>
<td>115</td>
</tr>
</tbody>
</table>
<ul>
<li>物品都是放在白板上在日光/室内光源下拍摄的，压缩后的尺寸为 512 * 384</li>
</ul>
<h2 id="22-图片预处理"><a class="markdownIt-Anchor" href="#22-图片预处理"></a> 2.2 图片预处理</h2>
<p>图片生成器 <a href="https://keras.io/preprocessing/image/" target="_blank" rel="noopener">ImageDataGenerator</a>: keras.preprocessing.image 模块中的图片生成器，主要用以生成一个 batch 的图像数据，支持实时数据提升。训练时该函数会无限生成数据，直到达到规定的 epoch 次数为止。同时也可以在 batch 中对数据进行增强，扩充数据集大小，增强模型的泛化能力，比如进行旋转，变形，归一化等等。</p>
<p>图片生成器的主要方法：</p>
<ul>
<li>
<p>fit(x, augment=False, rounds=1)：计算依赖于数据的变换所需要的统计信息(均值方差等)。</p>
</li>
<li>
<p>flow(self, X, y, batch_size=32, shuffle=True, seed=None, save_to_dir=None, save_prefix=’’, save_format=‘png’)：接收 Numpy 数组和标签为参数,生成经过数据提升或标准化后的 batch 数据，并在一个无限循环中不断的返回 batch 数据。</p>
</li>
<li>
<p>flow_from_directory(directory): 以文件夹路径为参数，会从路径推测 label，生成经过数据提升/归一化后的数据，在一个无限循环中无限产生 batch 数据。</p>
</li>
</ul>
<blockquote>
<p>根据上面的介绍和我们数据集的特性，我们主要运用 <code>ImageDataGenerator()</code> 和 <code>flow_from_directory()</code> 方法。我们将数据处理过程封装成为一个函数：</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入图片生成器</span></span><br><span class="line"><span class="keyword">from</span> keras.preprocessing.image <span class="keyword">import</span> ImageDataGenerator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">processing_data</span><span class="params">(data_path, height, width, batch_size=<span class="number">32</span>, validation_split=<span class="number">0.1</span>)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    数据处理</span></span><br><span class="line"><span class="string">    :param data_path: 带有子目录的数据集路径</span></span><br><span class="line"><span class="string">    :param height: 图像形状的行数</span></span><br><span class="line"><span class="string">    :param width: 图像形状的列数</span></span><br><span class="line"><span class="string">    :param batch_size: batch 数据的大小，整数，默认32。</span></span><br><span class="line"><span class="string">    :param validation_split: 在 0 和 1 之间浮动。用作测试集的训练数据的比例，默认0.1。</span></span><br><span class="line"><span class="string">    :return: train_generator, validation_generator: 处理后的训练集数据、验证集数据</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    train_data = ImageDataGenerator(</span><br><span class="line">            <span class="comment"># 对图片的每个像素值均乘上这个放缩因子，把像素值放缩到0和1之间有利于模型的收敛</span></span><br><span class="line">            rescale=<span class="number">1.</span> / <span class="number">255</span>,  </span><br><span class="line">            <span class="comment"># 浮点数，剪切强度（逆时针方向的剪切变换角度）</span></span><br><span class="line">            shear_range=<span class="number">0.1</span>,  </span><br><span class="line">            <span class="comment"># 随机缩放的幅度，若为浮点数，则相当于[lower,upper] = [1 - zoom_range, 1+zoom_range]</span></span><br><span class="line">            zoom_range=<span class="number">0.1</span>,</span><br><span class="line">            <span class="comment"># 浮点数，图片宽度的某个比例，数据提升时图片水平偏移的幅度</span></span><br><span class="line">            width_shift_range=<span class="number">0.1</span>,</span><br><span class="line">            <span class="comment"># 浮点数，图片高度的某个比例，数据提升时图片竖直偏移的幅度</span></span><br><span class="line">            height_shift_range=<span class="number">0.1</span>,</span><br><span class="line">            <span class="comment"># 布尔值，进行随机水平翻转</span></span><br><span class="line">            horizontal_flip=<span class="keyword">True</span>,</span><br><span class="line">            <span class="comment"># 布尔值，进行随机竖直翻转</span></span><br><span class="line">            vertical_flip=<span class="keyword">True</span>,</span><br><span class="line">            <span class="comment"># 在 0 和 1 之间浮动。用作验证集的训练数据的比例</span></span><br><span class="line">            validation_split=validation_split  </span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 接下来生成测试集，可以参考训练集的写法</span></span><br><span class="line">    validation_data = ImageDataGenerator(</span><br><span class="line">            rescale=<span class="number">1.</span> / <span class="number">255</span>,</span><br><span class="line">            validation_split=validation_split)</span><br><span class="line"></span><br><span class="line">    train_generator = train_data.flow_from_directory(</span><br><span class="line">            <span class="comment"># 提供的路径下面需要有子目录</span></span><br><span class="line">            data_path, </span><br><span class="line">            <span class="comment"># 整数元组 (height, width)，默认：(256, 256)。 所有的图像将被调整到的尺寸。</span></span><br><span class="line">            target_size=(height, width),</span><br><span class="line">            <span class="comment"># 一批数据的大小</span></span><br><span class="line">            batch_size=batch_size,</span><br><span class="line">            <span class="comment"># "categorical", "binary", "sparse", "input" 或 None 之一。</span></span><br><span class="line">            <span class="comment"># 默认："categorical",返回one-hot 编码标签。</span></span><br><span class="line">            class_mode=<span class="string">'categorical'</span>,</span><br><span class="line">            <span class="comment"># 数据子集 ("training" 或 "validation")</span></span><br><span class="line">            subset=<span class="string">'training'</span>, </span><br><span class="line">            seed=<span class="number">0</span>)</span><br><span class="line">    validation_generator = validation_data.flow_from_directory(</span><br><span class="line">            data_path,</span><br><span class="line">            target_size=(height, width),</span><br><span class="line">            batch_size=batch_size,</span><br><span class="line">            class_mode=<span class="string">'categorical'</span>,</span><br><span class="line">            subset=<span class="string">'validation'</span>,</span><br><span class="line">            seed=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> train_generator, validation_generator</span><br><span class="line"></span><br><span class="line"><span class="comment"># -------------使用---------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据路径</span></span><br><span class="line">data_path = <span class="string">"./datasets/la1ji1fe1nle4ishu4ju4ji22-momodel/dataset-resized"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 图像数据的行数和列数</span></span><br><span class="line">height, width = <span class="number">384</span>, <span class="number">512</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取训练数据和验证数据集</span></span><br><span class="line">train_generator, validation_generator = processing_data(data_path, height, width)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过属性class_indices可获得文件夹名与类的序号的对应字典。 (类别的顺序将按照字母表顺序映射到标签值)。</span></span><br><span class="line">labels = train_generator.class_indices</span><br><span class="line">print(labels)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换为类的序号与文件夹名对应的字典</span></span><br><span class="line">labels = dict((v, k) <span class="keyword">for</span> k, v <span class="keyword">in</span> labels.items())</span><br><span class="line">print(labels)</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Found 2078 images belonging to 6 classes.</span></span><br><span class="line"><span class="string">Found 229 images belonging to 6 classes.</span></span><br><span class="line"><span class="string">&#123;'trash': 5, 'metal': 2, 'plastic': 4, 'glass': 1, 'cardboard': 0, 'paper': 3&#125;</span></span><br><span class="line"><span class="string">&#123;0: 'cardboard', 1: 'glass', 2: 'metal', 3: 'paper', 4: 'plastic', 5: 'trash'&#125;</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>
<h2 id="23-采用-keras-建立一个简单的深度神经网络模型"><a class="markdownIt-Anchor" href="#23-采用-keras-建立一个简单的深度神经网络模型"></a> 2.3 采用 Keras 建立一个简单的深度神经网络模型</h2>
<p>通过 Keras 构建深度学习模型的步骤如下：</p>
<h3 id="1-定义模型创建一个模型并添加配置层"><a class="markdownIt-Anchor" href="#1-定义模型创建一个模型并添加配置层"></a> 1. 定义模型——创建一个模型并添加配置层</h3>
<blockquote>
<p>Keras 的核心数据结构是 model，一种组织网络层的方式。最简单的模型是 <a href="https://keras.io/getting-started/sequential-model-guide/" target="_blank" rel="noopener">Sequential 顺序模型</a>，它由多个网络层线性堆叠。</p>
</blockquote>
<ol>
<li>方式一: 使用 .add() 方法将各层添加到模型中</li>
</ol>
   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方式一: 使用 .add() 方法将各层添加到模型中</span></span><br><span class="line"><span class="comment"># 导入相关包</span></span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Dense, Activation</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择模型，选择序贯模型（Sequential())</span></span><br><span class="line">model = Sequential()</span><br><span class="line"><span class="comment"># 构建网络层</span></span><br><span class="line"><span class="comment"># 添加全连接层，输入784维,输出空间维度32</span></span><br><span class="line">model.add(Dense(<span class="number">32</span>, input_shape=(<span class="number">784</span>,)))</span><br><span class="line"><span class="comment"># 添加激活层，激活函数是 relu</span></span><br><span class="line">model.add(Activation(<span class="string">'relu'</span>))</span><br><span class="line"><span class="comment"># 打印模型概况</span></span><br><span class="line">model.summary()</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>
<p>方式二：网络层实例的列表构建序贯模型</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方式二：网络层实例的列表构建序贯模型</span></span><br><span class="line"><span class="comment"># 导入相关的包</span></span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Dense, Activation</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择模型，选择序贯模型（Sequential())</span></span><br><span class="line"><span class="comment"># 通过将网络层实例的列表传递给 Sequential 的构造器，来创建一个 Sequential 模型</span></span><br><span class="line">model = Sequential([</span><br><span class="line">    Dense(<span class="number">32</span>, input_shape=(<span class="number">784</span>,)),</span><br><span class="line">    Activation(<span class="string">'relu'</span>)</span><br><span class="line">])</span><br><span class="line"><span class="comment"># 打印模型概况</span></span><br><span class="line">model.summary()</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>方式三：函数式模型</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方式三：函数式模型</span></span><br><span class="line"><span class="comment"># 导入相关的包</span></span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Input, Dense,Activation</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Model</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入层，返回一个张量 tensor</span></span><br><span class="line">inputs = Input(shape=(<span class="number">784</span>,))</span><br><span class="line"><span class="comment"># 全连接层，返回一个张量</span></span><br><span class="line">output_1 = Dense(<span class="number">32</span>)(inputs)</span><br><span class="line"><span class="comment"># 激活函数层</span></span><br><span class="line">predictions= Activation(activation=<span class="string">'relu'</span>)(output_1)</span><br><span class="line"><span class="comment"># 创建一个模型，包含输入层、全连接层和激活层</span></span><br><span class="line">model = Model(inputs=inputs, outputs=predictions)</span><br><span class="line"><span class="comment"># 打印模型概况</span></span><br><span class="line">model.summary()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="2-编译模型指定损失函数和优化器并调用模型的-compile-函数完成模型编译"><a class="markdownIt-Anchor" href="#2-编译模型指定损失函数和优化器并调用模型的-compile-函数完成模型编译"></a> 2. 编译模型——指定损失函数和优化器，并调用模型的 compile() 函数，完成模型编译。</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入相关包</span></span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Input, Dense, Flatten, Dropout, Activation</span><br><span class="line"><span class="keyword">from</span> keras.layers.normalization <span class="keyword">import</span> BatchNormalization</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Model</span><br><span class="line"><span class="keyword">from</span> keras.callbacks <span class="keyword">import</span> TensorBoard</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dnn_model</span><span class="params">(input_shape, train_generator, validation_generator, model_save_path=<span class="string">'results/dnn.h5'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              log_dir=<span class="string">"results/logs/"</span>)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    该函数实现 Keras 创建深度学习模型的过程. ▲.定义模型+编译模型</span></span><br><span class="line"><span class="string">    :param input_shape: 模型数据形状大小，比如:input_shape=(384, 512, 3)</span></span><br><span class="line"><span class="string">    :param train_generator: 训练集</span></span><br><span class="line"><span class="string">    :param validation_generator: 验证集</span></span><br><span class="line"><span class="string">    :param model_save_path: 保存模型的路径</span></span><br><span class="line"><span class="string">    :param log_dir: 保存模型日志路径</span></span><br><span class="line"><span class="string">    :return: 返回已经训练好的模型</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># Input 用于实例化 Keras 张量。</span></span><br><span class="line">    <span class="comment"># shape: 一个尺寸元组（整数），不包含批量大小。 例如，shape=(32,) 表明期望的输入是按批次的 32 维向量。</span></span><br><span class="line">    inputs = Input(shape=input_shape)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将输入展平</span></span><br><span class="line">    dnn = Flatten()(inputs)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Dense 全连接层  实现以下操作：output = activation(dot(input, kernel) + bias)</span></span><br><span class="line">    <span class="comment"># 其中 activation 是按逐个元素计算的激活函数，kernel 是由网络层创建的权值矩阵，</span></span><br><span class="line">    <span class="comment"># 以及 bias 是其创建的偏置向量 (只在 use_bias 为 True 时才有用)。</span></span><br><span class="line">    dnn = Dense(<span class="number">6</span>)(dnn)</span><br><span class="line">    <span class="comment"># 批量标准化层: 在每一个批次的数据中标准化前一层的激活项， 即应用一个维持激活项平均值接近 0，标准差接近 1 的转换。</span></span><br><span class="line">    <span class="comment"># axis: 整数，需要标准化的轴 （通常是特征轴）。默认值是 -1</span></span><br><span class="line">    dnn = BatchNormalization(axis=<span class="number">-1</span>)(dnn)</span><br><span class="line">    <span class="comment"># 将激活函数,输出尺寸与输入尺寸一样，激活函数可以是'softmax'、'sigmoid'等</span></span><br><span class="line">    dnn = Activation(<span class="string">'sigmoid'</span>)(dnn)</span><br><span class="line">    <span class="comment"># Dropout 包括在训练中每次更新时，将输入单元的按比率随机设置为 0, 这有助于防止过拟合。</span></span><br><span class="line">    <span class="comment"># rate: 在 0 和 1 之间浮动。需要丢弃的输入比例。</span></span><br><span class="line">    dnn = Dropout(<span class="number">0.25</span>)(dnn)</span><br><span class="line"></span><br><span class="line">    dnn = Dense(<span class="number">12</span>)(dnn)</span><br><span class="line">    dnn = BatchNormalization(axis=<span class="number">-1</span>)(dnn)</span><br><span class="line">    dnn = Activation(<span class="string">'relu'</span>)(dnn)</span><br><span class="line">    dnn = Dropout(<span class="number">0.5</span>)(dnn)</span><br><span class="line"></span><br><span class="line">    dnn = Dense(<span class="number">6</span>)(dnn)</span><br><span class="line">    dnn = BatchNormalization(axis=<span class="number">-1</span>)(dnn)</span><br><span class="line">    dnn = Activation(<span class="string">'softmax'</span>)(dnn)</span><br><span class="line"></span><br><span class="line">    outputs = dnn</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 生成一个函数型模型</span></span><br><span class="line">    model = Model(inputs=inputs, outputs=outputs)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 编译模型, 采用 compile 函数: https://keras.io/models/model/#compile</span></span><br><span class="line">    model.compile(</span><br><span class="line">            <span class="comment"># 是优化器, 主要有Adam、sgd、rmsprop等方式。</span></span><br><span class="line">            optimizer=<span class="string">'Adam'</span>,</span><br><span class="line">            <span class="comment"># 损失函数,多分类采用 categorical_crossentropy</span></span><br><span class="line">            loss=<span class="string">'categorical_crossentropy'</span>,</span><br><span class="line">            <span class="comment"># 是除了损失函数值之外的特定指标, 分类问题一般都是准确率</span></span><br><span class="line">            metrics=[<span class="string">'accuracy'</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 可视化，TensorBoard 是由 Tensorflow 提供的一个可视化工具。</span></span><br><span class="line">    tensorboard = TensorBoard(log_dir)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 训练模型, fit_generator函数:https://keras.io/models/model/#fit_generator</span></span><br><span class="line">    <span class="comment"># 利用Python的生成器，逐个生成数据的batch并进行训练。</span></span><br><span class="line">    <span class="comment"># callbacks: 实例列表。在训练时调用的一系列回调。详见 https://keras.io/callbacks/。</span></span><br><span class="line">    d = model.fit_generator(</span><br><span class="line">            <span class="comment"># 一个生成器或 Sequence 对象的实例</span></span><br><span class="line">            generator=train_generator,</span><br><span class="line">            <span class="comment"># epochs: 整数，数据的迭代总轮数。</span></span><br><span class="line">            epochs=<span class="number">5</span>,</span><br><span class="line">            <span class="comment"># 一个epoch包含的步数,通常应该等于你的数据集的样本数量除以批量大小。</span></span><br><span class="line">            steps_per_epoch=<span class="number">2076</span> // <span class="number">32</span>,</span><br><span class="line">            <span class="comment"># 验证集</span></span><br><span class="line">            validation_data=validation_generator,</span><br><span class="line">            <span class="comment"># 在验证集上,一个epoch包含的步数,通常应该等于你的数据集的样本数量除以批量大小。</span></span><br><span class="line">            validation_steps=<span class="number">231</span> // <span class="number">32</span>,</span><br><span class="line">            callbacks=[tensorboard])</span><br><span class="line">    <span class="comment"># 模型保存</span></span><br><span class="line">    model.save(model_save_path)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> d, model</span><br></pre></td></tr></table></figure>
<h3 id="3-训练模型通过调用模型的-fit-函数来训练模型"><a class="markdownIt-Anchor" href="#3-训练模型通过调用模型的-fit-函数来训练模型"></a> 3. 训练模型——通过调用模型的 fit() 函数来训练模型。</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开始时间</span></span><br><span class="line">start = time.time()</span><br><span class="line"><span class="comment"># 数据预处理</span></span><br><span class="line">data_path = <span class="string">"./datasets/la1ji1fe1nle4ishu4ju4ji22-momodel/dataset-resized"</span></span><br><span class="line"><span class="comment"># 图像数据的行数和列数</span></span><br><span class="line">height, width = <span class="number">384</span>, <span class="number">512</span></span><br><span class="line"><span class="comment"># 获取训练数据和验证数据</span></span><br><span class="line">train_generator, validation_generator = processing_data(data_path, height, width)</span><br><span class="line"><span class="comment"># 定义模型输入大小</span></span><br><span class="line">input_shape=(<span class="number">384</span>, <span class="number">512</span>, <span class="number">3</span>)</span><br><span class="line"><span class="comment"># 训练模型，获取训练过程和训练后的模型</span></span><br><span class="line">res,model = dnn_model(input_shape, train_generator, validation_generator)</span><br><span class="line"><span class="comment"># 打印模型概况和模型训练总数长</span></span><br><span class="line">model.summary()</span><br><span class="line">print(<span class="string">"模型训练总时长："</span>,time.time()-start)</span><br></pre></td></tr></table></figure>
<ol>
<li>查看模型训练效果</li>
</ol>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_training_history</span><span class="params">(res)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    绘制模型的训练结果</span></span><br><span class="line"><span class="string">    :param res: 模型的训练结果</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># 绘制模型训练过程的损失和平均损失</span></span><br><span class="line">    <span class="comment"># 绘制模型训练过程的损失值曲线，标签是 loss</span></span><br><span class="line">    plt.plot(res.history[<span class="string">'loss'</span>], label=<span class="string">'loss'</span>)</span><br><span class="line">    <span class="comment"># 绘制模型训练过程中的平均损失曲线，标签是 val_loss</span></span><br><span class="line">    plt.plot(res.history[<span class="string">'val_loss'</span>], label=<span class="string">'val_loss'</span>)</span><br><span class="line">    <span class="comment"># 绘制图例,展示出每个数据对应的图像名称和图例的放置位置</span></span><br><span class="line">    plt.legend(loc=<span class="string">'upper right'</span>)</span><br><span class="line">    <span class="comment"># 展示图片</span></span><br><span class="line">    plt.show()</span><br><span class="line">    <span class="comment"># 绘制模型训练过程中的的准确率和平均准确率</span></span><br><span class="line">    <span class="comment"># 绘制模型训练过程中的准确率曲线，标签是 acc</span></span><br><span class="line">    plt.plot(res.history[<span class="string">'accuracy'</span>], label=<span class="string">'accuracy'</span>)</span><br><span class="line">    <span class="comment"># 绘制模型训练过程中的平均准确率曲线，标签是 val_acc</span></span><br><span class="line">    plt.plot(res.history[<span class="string">'val_accuracy'</span>], label=<span class="string">'val_accuracy'</span>)</span><br><span class="line">    <span class="comment"># 绘制图例,展示出每个数据对应的图像名称，图例的放置位置为默认值。</span></span><br><span class="line">    plt.legend()</span><br><span class="line">    <span class="comment"># 展示图片</span></span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>
<h3 id="4-模型预测调用模型的-evaluate或者-predict-等函数对新数据进行预测"><a class="markdownIt-Anchor" href="#4-模型预测调用模型的-evaluate或者-predict-等函数对新数据进行预测"></a> 4. 模型预测——调用模型的 evaluate()或者 predict() 等函数对新数据进行预测。</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_and_model_prediction</span><span class="params">(validation_generator)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    加载模型和模型评估，打印验证集的 loss 和准确度</span></span><br><span class="line"><span class="string">    :param validation_generator: 预测数据</span></span><br><span class="line"><span class="string">    :return: </span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># 加载模型</span></span><br><span class="line">    model = load_model(<span class="string">'results/dnn.h5'</span>)</span><br><span class="line">    <span class="comment"># 获取验证集的 loss 和 accuracy</span></span><br><span class="line">    loss, accuracy = model.evaluate_generator(validation_generator)</span><br><span class="line">    print(<span class="string">"\nLoss: %.2f, Accuracy: %.2f%%"</span> % (loss, accuracy * <span class="number">100</span>))</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 打印模型评估的结果</span></span><br><span class="line">load_and_model_prediction(validation_generator)</span><br></pre></td></tr></table></figure>
<p>(预测可视化)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> load_model</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_load_and_model_prediction</span><span class="params">(validation_generator, labels)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    加载模型、模型预测并展示模型预测结果等</span></span><br><span class="line"><span class="string">    :param validation_generator: 预测数据</span></span><br><span class="line"><span class="string">    :param labels: 数据标签</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># 加载模型</span></span><br><span class="line">    model = load_model(<span class="string">'results/dnn.h5'</span>)</span><br><span class="line">    <span class="comment"># 测试集数据与标签</span></span><br><span class="line">    test_x, test_y = validation_generator.__getitem__(<span class="number">2</span>)</span><br><span class="line">    <span class="comment"># 预测值</span></span><br><span class="line">    preds = model.predict(test_x)</span><br><span class="line">    <span class="comment"># 绘制预测图像的预测值和真实值，定义画布</span></span><br><span class="line">    plt.figure(figsize=(<span class="number">16</span>, <span class="number">16</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">        <span class="comment"># 绘制各个子图</span></span><br><span class="line">        plt.subplot(<span class="number">4</span>, <span class="number">4</span>, i + <span class="number">1</span>)</span><br><span class="line">        <span class="comment"># 图片名称</span></span><br><span class="line">        plt.title(</span><br><span class="line">                <span class="string">'pred:%s / truth:%s'</span> % (labels[np.argmax(preds[i])], labels[np.argmax(test_y[i])]))</span><br><span class="line">        <span class="comment"># 展示图片</span></span><br><span class="line">        plt.imshow(test_x[i])</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 展示模型预测结果</span></span><br><span class="line">plot_load_and_model_prediction(validation_generator, labels)</span><br></pre></td></tr></table></figure>
<h3 id="5-使用模型"><a class="markdownIt-Anchor" href="#5-使用模型"></a> 5. 使用模型</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> load_model</span><br><span class="line"><span class="keyword">from</span> keras.preprocessing <span class="keyword">import</span> image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_and_predict</span><span class="params">(img)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    加载模型并预测一张图片的类别</span></span><br><span class="line"><span class="string">    :param img: PIL.Image 对象</span></span><br><span class="line"><span class="string">    :return: string, 模型识别图片的类别, </span></span><br><span class="line"><span class="string">            共 'cardboard','glass','metal','paper','plastic','trash' 6 个类别</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># 加载模型, 默认'results/dnn.h5',请填写你的最佳模型</span></span><br><span class="line">    model_path = <span class="string">'results/dnn.h5'</span></span><br><span class="line">    model = load_model(model_path)</span><br><span class="line">    <span class="comment"># 把图片转换成为numpy数组</span></span><br><span class="line">    img = image.img_to_array(img)</span><br><span class="line">    <span class="comment"># 图片放缩</span></span><br><span class="line">    img = <span class="number">1.0</span>/<span class="number">255</span> * img</span><br><span class="line">    <span class="comment"># expand_dims的作用是把img.shape转换成(1, img.shape[0], img.shape[1], img.shape[2])</span></span><br><span class="line">    x = np.expand_dims(img, axis=<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># 模型预测, y: [[0.22421867 0.13031775 0.15167782 0.15904953 0.21509506 0.11964121]]</span></span><br><span class="line">    y = model.predict(x)</span><br><span class="line">    <span class="comment"># 获取labels</span></span><br><span class="line">    labels = &#123;<span class="number">0</span>: <span class="string">'cardboard'</span>, <span class="number">1</span>: <span class="string">'glass'</span>, <span class="number">2</span>: <span class="string">'metal'</span>, <span class="number">3</span>: <span class="string">'paper'</span>, <span class="number">4</span>: <span class="string">'plastic'</span>, <span class="number">5</span>: <span class="string">'trash'</span>&#125;</span><br><span class="line">    <span class="comment"># 获取输入图片的类别</span></span><br><span class="line">    y_predict = labels[np.argmax(y)]</span><br><span class="line">    <span class="comment"># 返回图片的类别</span></span><br><span class="line">    <span class="keyword">return</span> y_predict</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> keras.preprocessing <span class="keyword">import</span> image</span><br><span class="line"><span class="comment"># 输入图片路径和名称</span></span><br><span class="line">file_path = <span class="string">'test.jpg'</span></span><br><span class="line"><span class="comment"># 打印该张图片的类别</span></span><br><span class="line">img = image.load_img(file_path)</span><br><span class="line">print(load_and_predict(img))</span><br></pre></td></tr></table></figure>
<h1 id="mycode"><a class="markdownIt-Anchor" href="#mycode"></a> Mycode</h1>
<blockquote>
<p>编写 <strong>数据处理</strong>、<strong>创建模型</strong>、<strong>训练模型</strong>、<strong>保存模型</strong> 和 <strong>评估模型</strong> 等部分的代码</p>
</blockquote>
<h2 id="完成模型"><a class="markdownIt-Anchor" href="#完成模型"></a> 完成模型</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">processing_data</span><span class="params">(data_path)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    数据处理</span></span><br><span class="line"><span class="string">    :param data_path: 数据集路径</span></span><br><span class="line"><span class="string">    :return: train, test:处理后的训练集数据、测试集数据</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># -------------------------- 实现数据处理部分代码 ----------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ------------------------------------------------------------------------</span></span><br><span class="line">    train_data, test_data = <span class="keyword">None</span>, <span class="keyword">None</span></span><br><span class="line">    <span class="keyword">return</span> train_data, test_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">model</span><span class="params">(train_data, test_data, save_model_path)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    创建、训练和保存深度学习模型</span></span><br><span class="line"><span class="string">    :param train_data: 训练集数据</span></span><br><span class="line"><span class="string">    :param test_data: 测试集数据</span></span><br><span class="line"><span class="string">    :param save_model_path: 保存模型的路径和名称</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># --------------------- 实现模型创建、训练和保存等部分的代码 ---------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 保存模型（请写好保存模型的路径及名称）</span></span><br><span class="line">    <span class="comment"># -------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> model</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">evaluate_mode</span><span class="params">(test_data, save_model_path)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    加载模型和评估模型</span></span><br><span class="line"><span class="string">    可以实现，比如: 模型训练过程中的学习曲线，测试集数据的loss值、准确率及混淆矩阵等评价指标！</span></span><br><span class="line"><span class="string">    主要步骤:</span></span><br><span class="line"><span class="string">        1.加载模型(请填写你训练好的最佳模型),</span></span><br><span class="line"><span class="string">        2.对自己训练的模型进行评估</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param test_data: 测试集数据</span></span><br><span class="line"><span class="string">    :param save_model_path: 加载模型的路径和名称,请填写你认为最好的模型</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># ----------------------- 实现模型加载和评估等部分的代码 -----------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    深度学习模型训练流程,包含数据处理、创建模型、训练模型、模型保存、评价模型等。</span></span><br><span class="line"><span class="string">    如果对训练出来的模型不满意,你可以通过调整模型的参数等方法重新训练模型,直至训练出你满意的模型。</span></span><br><span class="line"><span class="string">    如果你对自己训练出来的模型非常满意,则可以提交作业!</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    data_path = <span class="keyword">None</span>  <span class="comment"># 数据集路径</span></span><br><span class="line">    save_model_path = <span class="keyword">None</span>  <span class="comment"># 保存模型路径和名称</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取数据</span></span><br><span class="line">    train_data, test_data = processing_data(data_path)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建、训练和保存模型</span></span><br><span class="line">    model(train_data, test_data, save_model_path)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 评估模型</span></span><br><span class="line">    evaluate_mode(test_data, save_model_path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h2 id="模型预测"><a class="markdownIt-Anchor" href="#模型预测"></a> 模型预测</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> load_model</span><br><span class="line"><span class="keyword">from</span> keras.preprocessing <span class="keyword">import</span> image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># -------------------------- 请加载您最满意的模型 ---------------------------</span></span><br><span class="line"><span class="comment"># 加载模型(请加载你认为的最佳模型)</span></span><br><span class="line"><span class="comment"># 加载模型,加载请注意 model_path 是相对路径, 与当前文件同级。</span></span><br><span class="line"><span class="comment"># 如果你的模型是在 results 文件夹下的 dnn.h5 模型，则 model_path = 'results/dnn.h5'</span></span><br><span class="line">model_path = <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载模型，如果采用keras框架训练模型，则 model=load_model(model_path)</span></span><br><span class="line">model = <span class="keyword">None</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(img)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    加载模型和模型预测</span></span><br><span class="line"><span class="string">    主要步骤:</span></span><br><span class="line"><span class="string">        1.图片处理</span></span><br><span class="line"><span class="string">        2.用加载的模型预测图片的类别</span></span><br><span class="line"><span class="string">    :param img: PIL.Image 对象</span></span><br><span class="line"><span class="string">    :return: string, 模型识别图片的类别, </span></span><br><span class="line"><span class="string">            共 'cardboard','glass','metal','paper','plastic','trash' 6 个类别</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># -------------------------- 实现模型预测部分的代码 ---------------------------</span></span><br><span class="line">    <span class="comment"># 获取图片的类别，共 'cardboard','glass','metal','paper','plastic','trash' 6 个类别</span></span><br><span class="line">    <span class="comment"># 把图片转换成为numpy数组</span></span><br><span class="line">    img = image.img_to_array(img)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取输入图片的类别</span></span><br><span class="line">    y_predict = <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># -------------------------------------------------------------------------</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 返回图片的类别</span></span><br><span class="line">    <span class="keyword">return</span> y_predict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># --------------------------使用-----------------------------</span></span><br><span class="line"><span class="keyword">from</span> keras.preprocessing <span class="keyword">import</span> image</span><br><span class="line"><span class="comment"># 输入图片路径和名称</span></span><br><span class="line">img_path = <span class="string">'test.jpg'</span></span><br><span class="line"><span class="comment"># 打印该张图片的类别</span></span><br><span class="line">img = image.load_img(img_path)</span><br><span class="line">print(predict(img))</span><br></pre></td></tr></table></figure>
<h3 id="mo项目上代码-accuracy为56"><a class="markdownIt-Anchor" href="#mo项目上代码-accuracy为56"></a> Mo项目上代码-&gt; accuracy为56%</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">import</span> random </span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image </span><br><span class="line"><span class="keyword">from</span> torchvision.transforms <span class="keyword">import</span> transforms</span><br><span class="line"><span class="keyword">import</span> torchvision.transforms.functional <span class="keyword">as</span> TF</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> torch.utils.data <span class="keyword">as</span> Data</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCNN</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, image_size, num_classes)</span>:</span></span><br><span class="line">        super(MyCNN, self).__init__()</span><br><span class="line">        <span class="comment"># conv1: Conv2d -&gt; BN -&gt; ReLU -&gt; MaxPool</span></span><br><span class="line">        self.conv1 = nn.Sequential(</span><br><span class="line">            nn.Conv2d(in_channels=<span class="number">3</span>, out_channels=<span class="number">16</span>, kernel_size=<span class="number">3</span>, stride=<span class="number">1</span>, padding=<span class="number">1</span>),</span><br><span class="line">            nn.BatchNorm2d(<span class="number">16</span>),</span><br><span class="line">            nn.ReLU(), </span><br><span class="line">            nn.MaxPool2d(kernel_size=<span class="number">2</span>, stride=<span class="number">2</span>),</span><br><span class="line">        )</span><br><span class="line">        <span class="comment"># conv2: Conv2d -&gt; BN -&gt; ReLU -&gt; MaxPool</span></span><br><span class="line">        self.conv2 = nn.Sequential(</span><br><span class="line">            nn.Conv2d(in_channels=<span class="number">16</span>, out_channels=<span class="number">32</span>, kernel_size=<span class="number">3</span>, stride=<span class="number">1</span>, padding=<span class="number">1</span>),</span><br><span class="line">            nn.BatchNorm2d(<span class="number">32</span>),</span><br><span class="line">            nn.ReLU(),</span><br><span class="line">            nn.MaxPool2d(kernel_size=<span class="number">2</span>, stride=<span class="number">2</span>),</span><br><span class="line">        )</span><br><span class="line">        <span class="comment"># fully connected layer</span></span><br><span class="line">        self.fc = nn.Linear(<span class="number">32</span> * (image_size // <span class="number">4</span>) * (image_size // <span class="number">4</span>), num_classes)</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        input: N * 3 * image_size * image_size</span></span><br><span class="line"><span class="string">        output: N * num_classes</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        x = self.conv1(x)</span><br><span class="line">        x = self.conv2(x)</span><br><span class="line">        <span class="comment"># view(x.size(0), -1): change tensor size from (N ,H , W) to (N, H*W)</span></span><br><span class="line">        x = x.view(x.size(<span class="number">0</span>), <span class="number">-1</span>)</span><br><span class="line">        output = self.fc(x)</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_model</span><span class="params">(model_path, device)</span>:</span></span><br><span class="line">    net = MyCNN(<span class="number">32</span>,<span class="number">6</span>)</span><br><span class="line">    print(<span class="string">'loading the model from %s'</span> % model_path)</span><br><span class="line">    state_dict = torch.load(model_path, map_location=str(device))</span><br><span class="line">    <span class="keyword">if</span> hasattr(state_dict, <span class="string">'_metadata'</span>):</span><br><span class="line">        <span class="keyword">del</span> state_dict._metadata</span><br><span class="line">    net.load_state_dict(state_dict)</span><br><span class="line">    <span class="keyword">return</span> net </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载模型,加载请注意 model_path 是相对路径, 与当前文件同级。</span></span><br><span class="line"><span class="comment"># 如果你的模型是在 results 文件夹下的 dnn.h5 模型，则 model_path = 'results/dnn.h5'</span></span><br><span class="line">model_path = <span class="string">'results/cnn.pth'</span></span><br><span class="line">device = torch.device(<span class="string">'cuda'</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">'cpu'</span>)</span><br><span class="line">model = load_model(model_path, device).to(device)</span><br><span class="line">model.eval()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(img)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    :param img: PIL.Image 对象</span></span><br><span class="line"><span class="string">    :return: string, 模型识别图片的类别, </span></span><br><span class="line"><span class="string">            共 'cardboard','glass','metal','paper','plastic','trash' 6 个类别</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    transform = transforms.Compose([transforms.RandomCrop(size=(<span class="number">384</span>,<span class="number">512</span>), padding=<span class="number">10</span>),</span><br><span class="line">                                transforms.Resize((<span class="number">32</span>,<span class="number">32</span>)),</span><br><span class="line">                                transforms.ToTensor(),</span><br><span class="line">                                transforms.Normalize([<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>], [<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>])</span><br><span class="line">    ])</span><br><span class="line">    img = transform(img)</span><br><span class="line"></span><br><span class="line">    classes=[<span class="string">'glass'</span>,<span class="string">'paper'</span>,<span class="string">'carboard'</span>,<span class="string">'plastic'</span>,<span class="string">'metal'</span>,<span class="string">'trash'</span>]</span><br><span class="line"></span><br><span class="line">    img = img.to(device).unsqueeze(<span class="number">0</span>)</span><br><span class="line">    pred_cate = model(img)</span><br><span class="line">    preds = pred_cate.argmax(dim=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># -------------------------------------------------------------------------</span></span><br><span class="line">    y_predict = classes[preds]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 返回图片的类别</span></span><br><span class="line">    <span class="keyword">return</span> y_predict</span><br></pre></td></tr></table></figure>
<p>VGG16代码：accurary：92%</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment"># 重要: 请务必把任务(jobs)中需要保存的文件存放在 results 文件夹内</span></span><br><span class="line"><span class="comment"># Important : Please make sure your files are saved to the 'results' folder</span></span><br><span class="line"><span class="comment"># in your jobs</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment"># ------------------------------------------提交内容-----------------------------------</span></span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Input, Dense, Flatten, Dropout, Activation </span><br><span class="line"><span class="keyword">from</span> keras.layers.normalization <span class="keyword">import</span> BatchNormalization</span><br><span class="line"><span class="keyword">from</span> keras.preprocessing.image <span class="keyword">import</span> ImageDataGenerator</span><br><span class="line"><span class="keyword">from</span> keras.callbacks <span class="keyword">import</span> TensorBoard</span><br><span class="line"><span class="keyword">from</span> keras.preprocessing <span class="keyword">import</span> image</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> load_model</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Model</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> glob, os, cv2, random,time</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Conv2D,Flatten,MaxPooling2D,Dense </span><br><span class="line"><span class="keyword">from</span> keras.optimizers <span class="keyword">import</span> SGD</span><br><span class="line"><span class="keyword">from</span> keras.applications.vgg16 <span class="keyword">import</span> VGG16</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">processing_data</span><span class="params">(data_path)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    数据处理</span></span><br><span class="line"><span class="string">    :param data_path: 数据集路径</span></span><br><span class="line"><span class="string">    :return: train, test:处理后的训练集数据、测试集数据</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    train_data = ImageDataGenerator(</span><br><span class="line">            <span class="comment"># 对图片的每个像素值均乘上这个放缩因子，把像素值放缩到0和1之间有利于模型的收敛</span></span><br><span class="line">            rescale=<span class="number">1.</span> / <span class="number">225</span>,  </span><br><span class="line">            <span class="comment"># 浮点数，剪切强度（逆时针方向的剪切变换角度）</span></span><br><span class="line">            shear_range=<span class="number">0.1</span>,  </span><br><span class="line">            <span class="comment"># 随机缩放的幅度，若为浮点数，则相当于[lower,upper] = [1 - zoom_range, 1+zoom_range]</span></span><br><span class="line">            zoom_range=<span class="number">0.1</span>,</span><br><span class="line">            <span class="comment"># 浮点数，图片宽度的某个比例，数据提升时图片水平偏移的幅度</span></span><br><span class="line">            width_shift_range=<span class="number">0.1</span>,</span><br><span class="line">            <span class="comment"># 浮点数，图片高度的某个比例，数据提升时图片竖直偏移的幅度</span></span><br><span class="line">            height_shift_range=<span class="number">0.1</span>,</span><br><span class="line">            <span class="comment"># 布尔值，进行随机水平翻转</span></span><br><span class="line">            horizontal_flip=<span class="keyword">True</span>,</span><br><span class="line">            <span class="comment"># 布尔值，进行随机竖直翻转</span></span><br><span class="line">            vertical_flip=<span class="keyword">True</span>,</span><br><span class="line">            <span class="comment"># 在 0 和 1 之间浮动。用作验证集的训练数据的比例</span></span><br><span class="line">            validation_split=<span class="number">0.1</span>  </span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 接下来生成测试集，可以参考训练集的写法</span></span><br><span class="line">    validation_data = ImageDataGenerator(</span><br><span class="line">            rescale=<span class="number">1.</span> / <span class="number">255</span>,</span><br><span class="line">            validation_split=<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line">    train_generator = train_data.flow_from_directory(</span><br><span class="line">            <span class="comment"># 提供的路径下面需要有子目录</span></span><br><span class="line">            data_path, </span><br><span class="line">            <span class="comment"># 整数元组 (height, width)，默认：(256, 256)。 所有的图像将被调整到的尺寸。</span></span><br><span class="line">            target_size=(<span class="number">150</span>, <span class="number">150</span>),</span><br><span class="line">            <span class="comment"># 一批数据的大小</span></span><br><span class="line">            batch_size=<span class="number">16</span>,</span><br><span class="line">            <span class="comment"># "categorical", "binary", "sparse", "input" 或 None 之一。</span></span><br><span class="line">            <span class="comment"># 默认："categorical",返回one-hot 编码标签。</span></span><br><span class="line">            class_mode=<span class="string">'categorical'</span>,</span><br><span class="line">            <span class="comment"># 数据子集 ("training" 或 "validation")</span></span><br><span class="line">            subset=<span class="string">'training'</span>, </span><br><span class="line">            seed=<span class="number">0</span>)</span><br><span class="line">    validation_generator = validation_data.flow_from_directory(</span><br><span class="line">            data_path,</span><br><span class="line">            target_size=(<span class="number">150</span>, <span class="number">150</span>),</span><br><span class="line">            batch_size=<span class="number">16</span>,</span><br><span class="line">            class_mode=<span class="string">'categorical'</span>,</span><br><span class="line">            subset=<span class="string">'validation'</span>,</span><br><span class="line">            seed=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> train_generator, validation_generator</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">model</span><span class="params">(train_generator, validation_generator, save_model_path)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    模型的建立</span></span><br><span class="line"><span class="string">    本次实验采用Vgg16模型</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    vgg16_model = VGG16(weights=<span class="string">'imagenet'</span>,include_top=<span class="keyword">False</span>, input_shape=(<span class="number">150</span>,<span class="number">150</span>,<span class="number">3</span>))</span><br><span class="line">    top_model = Sequential()</span><br><span class="line">    top_model.add(Flatten(input_shape=vgg16_model.output_shape[<span class="number">1</span>:]))</span><br><span class="line">    top_model.add(Dense(<span class="number">256</span>,activation=<span class="string">'relu'</span>))</span><br><span class="line">    top_model.add(Dropout(<span class="number">0.5</span>))</span><br><span class="line">    top_model.add(Dense(<span class="number">6</span>,activation=<span class="string">'softmax'</span>))</span><br><span class="line"></span><br><span class="line">    model = Sequential()</span><br><span class="line">    model.add(vgg16_model)</span><br><span class="line">    model.add(top_model)</span><br><span class="line">    <span class="comment"># 编译模型, 采用 compile 函数: https://keras.io/models/model/#compile</span></span><br><span class="line">    model.compile(</span><br><span class="line">             <span class="comment"># 是优化器, 主要有Adam、sgd、rmsprop等方式。</span></span><br><span class="line">            optimizer=SGD(lr=<span class="number">1e-3</span>,momentum=<span class="number">0.9</span>),</span><br><span class="line">            <span class="comment"># 损失函数,多分类采用 categorical_crossentropy</span></span><br><span class="line">            loss=<span class="string">'categorical_crossentropy'</span>,</span><br><span class="line">            <span class="comment"># 是除了损失函数值之外的特定指标, 分类问题一般都是准确率</span></span><br><span class="line">            metrics=[<span class="string">'accuracy'</span>])</span><br><span class="line"></span><br><span class="line">    model.fit_generator(</span><br><span class="line">            <span class="comment"># 一个生成器或 Sequence 对象的实例</span></span><br><span class="line">            generator=train_generator,</span><br><span class="line">            <span class="comment"># epochs: 整数，数据的迭代总轮数。</span></span><br><span class="line">            epochs=<span class="number">200</span>,</span><br><span class="line">            <span class="comment"># 一个epoch包含的步数,通常应该等于你的数据集的样本数量除以批量大小。</span></span><br><span class="line">            steps_per_epoch=<span class="number">2259</span> // <span class="number">16</span>,</span><br><span class="line">            <span class="comment"># 验证集</span></span><br><span class="line">            validation_data=validation_generator,</span><br><span class="line">             <span class="comment"># 在验证集上,一个epoch包含的步数,通常应该等于你的数据集的样本数量除以批量大小。</span></span><br><span class="line">            validation_steps=<span class="number">248</span> // <span class="number">16</span>,</span><br><span class="line">            )</span><br><span class="line">    model.save(save_model_path)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> model</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">evaluate_mode</span><span class="params">(validation_generator, save_model_path)</span>:</span></span><br><span class="line">     <span class="comment"># 加载模型</span></span><br><span class="line">    model = load_model(<span class="string">'results/Ynnex1.h5'</span>)</span><br><span class="line">    <span class="comment"># 获取验证集的 loss 和 accuracy</span></span><br><span class="line">    loss, accuracy = model.evaluate_generator(validation_generator)</span><br><span class="line">    print(<span class="string">"\nLoss: %.2f, Accuracy: %.2f%%"</span> % (loss, accuracy * <span class="number">100</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(img)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    加载模型和模型预测</span></span><br><span class="line"><span class="string">    主要步骤:</span></span><br><span class="line"><span class="string">        1.加载模型(请加载你认为的最佳模型)</span></span><br><span class="line"><span class="string">        2.图片处理</span></span><br><span class="line"><span class="string">        3.用加载的模型预测图片的类别</span></span><br><span class="line"><span class="string">    :param img: PIL.Image 对象</span></span><br><span class="line"><span class="string">    :return: string, 模型识别图片的类别, </span></span><br><span class="line"><span class="string">            共 'cardboard','glass','metal','paper','plastic','trash' 6 个类别</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># 把图片转换成为numpy数组</span></span><br><span class="line">    img = img.resize((<span class="number">150</span>, <span class="number">150</span>))</span><br><span class="line">    img = image.img_to_array(img)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 加载模型,加载请注意 model_path 是相对路径, 与当前文件同级。</span></span><br><span class="line">    <span class="comment"># 如果你的模型是在 results 文件夹下的 dnn.h5 模型，则 model_path = 'results/dnn.h5'</span></span><br><span class="line">    model_path = <span class="string">'results/Ynnex1.h5'</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 作业提交时测试用, 请勿删除此部分</span></span><br><span class="line">        model_path = os.path.realpath(__file__).replace(<span class="string">'main.py'</span>, model_path)</span><br><span class="line">    <span class="keyword">except</span> NameError:</span><br><span class="line">        model_path = <span class="string">'./'</span> + model_path</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># -------------------------- 实现模型预测部分的代码 ---------------------------</span></span><br><span class="line">    <span class="comment"># 加载模型</span></span><br><span class="line">    model = load_model(model_path)</span><br><span class="line">    <span class="comment"># expand_dims的作用是把img.shape转换成(1, img.shape[0], img.shape[1], img.shape[2])</span></span><br><span class="line">    x = np.expand_dims(img, axis=<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># 模型预测</span></span><br><span class="line">    y = model.predict(x)</span><br><span class="line">    <span class="comment"># 获取labels</span></span><br><span class="line">    labels = &#123;<span class="number">0</span>: <span class="string">'cardboard'</span>, <span class="number">1</span>: <span class="string">'glass'</span>, <span class="number">2</span>: <span class="string">'metal'</span>, <span class="number">3</span>: <span class="string">'paper'</span>, <span class="number">4</span>: <span class="string">'plastic'</span>, <span class="number">5</span>: <span class="string">'trash'</span>&#125;</span><br><span class="line">    <span class="comment"># -------------------------------------------------------------------------</span></span><br><span class="line">    predict = labels[np.argmax(y)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 返回图片的类别</span></span><br><span class="line">    <span class="keyword">return</span> predict</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    深度学习模型训练流程,包含数据处理、创建模型、训练模型、模型保存、评价模型等。</span></span><br><span class="line"><span class="string">    如果对训练出来的模型不满意,你可以通过调整模型的参数等方法重新训练模型,直至训练出你满意的模型。</span></span><br><span class="line"><span class="string">    如果你对自己训练出来的模型非常满意,则可以提交作业!</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    data_path = <span class="string">"./datasets/la1ji1fe1nle4ishu4ju4ji22-momodel/dataset-resized"</span>  <span class="comment"># 数据集路径</span></span><br><span class="line">    save_model_path = <span class="string">'results/Ynnex1.h5'</span>  <span class="comment"># 保存模型路径和名称</span></span><br><span class="line">    <span class="comment"># 获取数据</span></span><br><span class="line">    train_generator, validation_generator = processing_data(data_path)</span><br><span class="line">    <span class="comment"># 创建、训练和保存模型</span></span><br><span class="line">    model(train_generator, validation_generator, save_model_path)</span><br><span class="line">    <span class="comment"># 评估模型</span></span><br><span class="line">    evaluate_mode(validation_generator, save_model_path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据测试</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_result</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">import</span> random,cv2</span><br><span class="line">    <span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">    <span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> PIL <span class="keyword">import</span> Image </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 导入相关包</span></span><br><span class="line">    <span class="keyword">import</span> glob, os</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数据集路径</span></span><br><span class="line">    data_path = <span class="string">"./datasets/la1ji1fe1nle4ishu4ju4ji22-momodel/dataset-resized"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取数据名称列表</span></span><br><span class="line">    img_list = glob.glob(os.path.join(data_path, <span class="string">'*/*.jpg'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 打印数据集总量</span></span><br><span class="line">    print(<span class="string">"数据集总数量:"</span>, len(img_list))</span><br><span class="line">    print(<span class="string">"数据路径和名称:"</span>,img_list[<span class="number">0</span>])</span><br><span class="line">    <span class="comment"># 从数据名称列表 img_list 中随机选取 6 个。</span></span><br><span class="line">    <span class="keyword">for</span> i, img_path <span class="keyword">in</span> enumerate(random.sample(img_list, <span class="number">6</span>)):</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 读取图片</span></span><br><span class="line">        img = cv2.imread(img_path)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 将图片从 BGR 模式转为 RGB 模式</span></span><br><span class="line">        img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)</span><br><span class="line">        img = Image.fromarray(img)</span><br><span class="line">        plt.imshow(img)</span><br><span class="line">        plt.show()</span><br><span class="line">        res = predict(img)</span><br><span class="line">        print(res)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"><span class="comment">#     main()</span></span><br><span class="line">    test_result()</span><br></pre></td></tr></table></figure>
<p>VGG16说明：<a href="https://baijiahao.baidu.com/s?id=1667221544796169037&amp;wfr=spider&amp;for=pc" target="_blank" rel="noopener">https://baijiahao.baidu.com/s?id=1667221544796169037&amp;wfr=spider&amp;for=pc</a></p>
<h1 id="附录"><a class="markdownIt-Anchor" href="#附录"></a> 附录</h1>
<h2 id="csdn"><a class="markdownIt-Anchor" href="#csdn"></a> CSDN</h2>
<ul>
<li><a href="https://blog.csdn.net/weixin_40651515/article/details/105804557" target="_blank" rel="noopener">基于深度学习的垃圾分类识别系统</a></li>
<li><a href="https://blog.csdn.net/qq_34218654/article/details/102885223" target="_blank" rel="noopener">基于深度学习的计算机视觉 - 垃圾分类（附源码）</a></li>
</ul>
<h2 id="github"><a class="markdownIt-Anchor" href="#github"></a> Github</h2>
<ul>
<li><a href="https://github.com/jzx-gooner/DL-wastesort" target="_blank" rel="noopener">基于深度学习的垃圾分类</a></li>
<li><strong><a href="https://github.com/wusaifei/garbage_classify" target="_blank" rel="noopener">garbage_classify</a></strong></li>
<li><strong><a href="https://github.com/Jack-Cherish/Deep-Learning" target="_blank" rel="noopener">Deep-Learning</a></strong></li>
</ul>
</article><!-- lincense--><div class="license-wrapper"><p> <span>Author:  </span><a href="https://nymrli.top">Mrli</a></p><p> <span>Link:  </span><a href="https://nymrli.top/2020/12/11/浙大2020春夏-人工智能习题2——垃圾分类/">https://nymrli.top/2020/12/11/浙大2020春夏-人工智能习题2——垃圾分类/</a></p><p> <span>Copyright:  </span><span>All articles in this blog are licensed under <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/3.0">CC BY-NC-SA 3.0</a> unless stating additionally.</span></p></div><div class="post-paginator"><a class="prevSlogan" href="/2021/01/24/认真学次DP——动态规划/" title="认真学次DP——动态规划"><span>< PreviousPost</span><br><span class="prevTitle">认真学次DP——动态规划</span></a><a class="nextSlogan" href="/2020/12/11/细品单例模式/" title="细品单例模式"><span>NextPost ></span><br><span class="nextTitle">细品单例模式</span></a><div class="clear"></div></div><div id="comment"><div id="container"></div><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script><script>var gitment = new Gitment({
  id: '浙大2020春夏-人工智能习题2——垃圾分类',
  owner: 'Freedomisgood',
  repo: 'Freedomisgood.github.io',
  oauth: {
    client_id: 'bc5a81fe36017dcd8b63',
    client_secret: '949cec3a1b91742c6249c47259791e4b80a6fa69',
  },
})
gitment.render('container')</script></div></section></article><footer id="cxo-footer-outer"><div id="cxo-footer-inner"><p class="footer-container"><span>Site by </span><a href="http://hexo.io"><span>Hexo</span></a><span> | theme </span><a href="https://github.com/Longlongyu/hexo-theme-Cxo"><span>Cxo</span></a></p><p class="beian"><a href="https://beian.miit.gov.cn/"> <span>备案号:苏ICP备18015439号</span></a></p><i class="fa fa-user"> </i><span id="busuanzi_value_site_uv"></span><span> | </span><i class="fa fa-eye"> </i><span id="busuanzi_value_site_pv"></span></div></footer><!-- catelog--><div class="toc-wrapper" style="top: 60vh;"><div class="toc-catalog"><i class="fa fa-list"> </i><span>CATALOG</span></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-实验介绍"><span class="toc-number">1.</span> <span class="toc-text"> 1. 实验介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11-实验背景"><span class="toc-number">1.1.</span> <span class="toc-text"> 1.1 实验背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-实验要求"><span class="toc-number">1.2.</span> <span class="toc-text"> 1.2 实验要求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-实验环境"><span class="toc-number">1.3.</span> <span class="toc-text"> 1.3 实验环境</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2实验内容"><span class="toc-number">2.</span> <span class="toc-text"> 2.实验内容</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#21-介绍数据集"><span class="toc-number">2.1.</span> <span class="toc-text"> 2.1 介绍数据集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-图片预处理"><span class="toc-number">2.2.</span> <span class="toc-text"> 2.2 图片预处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23-采用-keras-建立一个简单的深度神经网络模型"><span class="toc-number">2.3.</span> <span class="toc-text"> 2.3 采用 Keras 建立一个简单的深度神经网络模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-定义模型创建一个模型并添加配置层"><span class="toc-number">2.3.1.</span> <span class="toc-text"> 1. 定义模型——创建一个模型并添加配置层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-编译模型指定损失函数和优化器并调用模型的-compile-函数完成模型编译"><span class="toc-number">2.3.2.</span> <span class="toc-text"> 2. 编译模型——指定损失函数和优化器，并调用模型的 compile() 函数，完成模型编译。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-训练模型通过调用模型的-fit-函数来训练模型"><span class="toc-number">2.3.3.</span> <span class="toc-text"> 3. 训练模型——通过调用模型的 fit() 函数来训练模型。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-模型预测调用模型的-evaluate或者-predict-等函数对新数据进行预测"><span class="toc-number">2.3.4.</span> <span class="toc-text"> 4. 模型预测——调用模型的 evaluate()或者 predict() 等函数对新数据进行预测。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-使用模型"><span class="toc-number">2.3.5.</span> <span class="toc-text"> 5. 使用模型</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mycode"><span class="toc-number">3.</span> <span class="toc-text"> Mycode</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#完成模型"><span class="toc-number">3.1.</span> <span class="toc-text"> 完成模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模型预测"><span class="toc-number">3.2.</span> <span class="toc-text"> 模型预测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mo项目上代码-accuracy为56"><span class="toc-number">3.2.1.</span> <span class="toc-text"> Mo项目上代码-&gt; accuracy为56%</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#附录"><span class="toc-number">4.</span> <span class="toc-text"> 附录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#csdn"><span class="toc-number">4.1.</span> <span class="toc-text"> CSDN</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#github"><span class="toc-number">4.2.</span> <span class="toc-text"> Github</span></a></li></ol></li></ol></div><!-- top--><i class="fa fa-arrow-up close" id="go-up" aria-hidden="true"></i></body></html>
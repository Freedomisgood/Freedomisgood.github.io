<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><meta name="author" content="Mrli"><meta name="renderer" content="webkit"><meta name="copyright" content="Mrli"><meta name="keywords" content="Mrli's Blog"><meta name="description" content="想和你讲，说了会心动 ，缄默会心安。"><meta name="Cache-Control" content="no-cache"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>2022年3月19~20日-爬虫项目记录 · Mr.li's Blog</title><link rel="stylesheet" href="/css/style.css?v=2018.7.9"><link rel="stylesheet" href="/css/animation.css?v=2018.7.9"><link rel="icon" href="/img/assets/favicon.ico"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.6"><!-- scripts--><script>(function( w ){
  "use strict";
  // rel=preload support test
  if( !w.loadCSS ){
    w.loadCSS = function(){};
  }
  // define on the loadCSS obj
  var rp = loadCSS.relpreload = {};
  // rel=preload feature support test
  // runs once and returns a function for compat purposes
  rp.support = (function(){
    var ret;
    try {
      ret = w.document.createElement( "link" ).relList.supports( "preload" );
    } catch (e) {
      ret = false;
    }
    return function(){
      return ret;
    };
  })();

  // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
  // then change that media back to its intended value on load
  rp.bindMediaToggle = function( link ){
    // remember existing media attr for ultimate state, or default to 'all'
    var finalMedia = link.media || "all";

    function enableStylesheet(){
      link.media = finalMedia;
    }

    // bind load handlers to enable media
    if( link.addEventListener ){
      link.addEventListener( "load", enableStylesheet );
    } else if( link.attachEvent ){
      link.attachEvent( "onload", enableStylesheet );
    }

    // Set rel and non-applicable media type to start an async request
    // note: timeout allows this to happen async to let rendering continue in IE
    setTimeout(function(){
      link.rel = "stylesheet";
      link.media = "only x";
    });
    // also enable media after 3 seconds,
    // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
    setTimeout( enableStylesheet, 3000 );
  };

  // loop through link elements in DOM
  rp.poly = function(){
    // double check this to prevent external calls from running
    if( rp.support() ){
      return;
    }
    var links = w.document.getElementsByTagName( "link" );
    for( var i = 0; i < links.length; i++ ){
      var link = links[ i ];
      // qualify links to those with rel=preload and as=style attrs
      if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
        // prevent rerunning on link
        link.setAttribute( "data-loadcss", true );
        // bind listeners to toggle media back
        rp.bindMediaToggle( link );
      }
    }
  };

  // if unsupported, run the polyfill
  if( !rp.support() ){
    // run once at least
    rp.poly();

    // rerun poly on an interval until onload
    var run = w.setInterval( rp.poly, 500 );
    if( w.addEventListener ){
      w.addEventListener( "load", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    } else if( w.attachEvent ){
      w.attachEvent( "onload", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    }
  }


  // commonjs
  if( typeof exports !== "undefined" ){
    exports.loadCSS = loadCSS;
  }
  else {
    w.loadCSS = loadCSS;
  }
}( typeof global !== "undefined" ? global : this ) );</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" defer></script><script src="/js/main.js?v=2018.7.9" defer></script><!-- fancybox--><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script><!-- busuanzi--><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></head><body><section class="profile-close" id="cxo-profile"><div class="profile-avatar"><i class="fa fa-caret-left"></i><img src="https://avatars1.githubusercontent.com/u/31088082?s=400&amp;u=7a99ff83916afb3f4c5312bd78a1be17fe0e34ed&amp;v=4"></div><!--.profile-saying
  i.fa.fa-comment
  .saying--><div class="cxo-profile-inner"><div class="profile-name">Mrli</div><div class="profile-signature">别装作很努力,<br>因为结局不会陪你演戏。</div><div class="contacts"><div>Contacts:</div><span><a href="http://sighttp.qq.com/msgrd?v=1&amp;uin=1063052964" target="_black">QQ</a></span><span><a href="https://www.cnblogs.com/nymrli/" target="_black">博客园</a></span></div><div class="read-progress"></div></div></section><header id="cxo-intro" style="height: 60vh;background-image: url(/img/intro/index-bg.png);"><nav id="cxo-intro-nav"><section><div class="intro-nav-title"><a href="/">Mr.li's Blog</a></div><div class="intro-nav-label-box"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div><i class="fa fa-bars intro-nav-menu"><div class="intro-nav-drop"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div></i><div class="clear"></div></section></nav><h1 class="post-title">2022年3月19~20日-爬虫项目记录</h1><div class="post-intros"><div class="post-intro-meta"><span class="post-intro-time"><i class="post-intro-calendar fa fa-edit"></i><span>2022/04/04</span></span><span class="busuanzi-pv" id="busuanzi_container_page_pv"><i class="post-intro-calendar fa fa-user-o"></i><span id="busuanzi_value_page_pv"></span></span><span class="post-intro-tags"><a class="intro-tag fa fa-tag" href="javascript:void(0)" date-tags="爬虫"> 爬虫</a></span></div><div class="post-intro-read"><span> Word count: <span class="post-count">8,179</span> | Reading time: <span class="post-count">36</span>min</span></div></div></header><article class="cxo-up" id="cxo-content-outer"><section id="cxo-content-inner"><article class="article-entry" id="post"><h1 id="2022年3月20日公告存网站页面到数据库"><a class="markdownIt-Anchor" href="#2022年3月20日公告存网站页面到数据库"></a> 2022年3月20日——公告存网站页面到数据库</h1>
<h2 id="文件存储"><a class="markdownIt-Anchor" href="#文件存储"></a> 文件存储</h2>
<ol>
<li>文件夹不允许出现<code>/\:*?|&lt;&gt;&quot;</code></li>
<li>a标签中href不能有, 因为通过etree.tostring会被转义成%5C===&gt;进行了str.replace(&quot;\&quot;, “/”)</li>
<li>windows下路径分隔符是<code>\\</code>, 所以save_path中会有<code>\\</code>, 因此使用<code>save_path.replace(&quot;\\&quot;, &quot;/&quot;)</code>可以解决</li>
<li>多级创建文件夹<code>os.makedirs()</code>、单层创建<code>os.mkdir()</code><br>
5文件名称问题: 乱码太长报错, 将其取a标签中内容解决</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 乱码太长报错</span></span><br><span class="line">s = <span class="string">".\\attaches\\11963218-2021年09月22日华能能源交通产业控股有限公司集团物资供应中心（甘肃区域）07月份集中物资供应--八零三电厂阀门询价采购（包093）询价书询价公告\\������������������������������������������07������������������������--���������������������������������������093���.wps"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(s, <span class="string">"wb"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">b"ggg"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="数据库表"><a class="markdownIt-Anchor" href="#数据库表"></a> 数据库表</h2>
<p><strong>varchar能存多少汉字、数字？</strong></p>
<p>具体还是要看版本的，一个字符占用3个字节  ，一个汉字（包括数字）占用3个字节=一个字符</p>
<ul>
<li><strong>4.0版本以下</strong>，varchar(100)，指的是<strong>100字节</strong>，如果存放UTF8汉字时，只能存33个（每个汉字3字节）</li>
<li><strong>5.0版本以上</strong>**，varchar(100)，指的是<strong>100字符</strong>，⭐️无论存放的是数字、字母还是UTF8汉字（每个汉字3字节），都可以存放100个。</li>
<li><strong>UTF8编码中一个汉字（包括数字）占用3个字节</strong></li>
<li><em>GBK编码中一个汉字（包括数字）占用2个字节</em>*</li>
</ul>
<p><strong>varchar的最大长度是多少呢？</strong></p>
<p>mysql的vachar字段的类型虽然最大长度是65535，但是并不是能存这么多数据，最大可以到65533，其中需要1到2个字节来存储数据长度（如果列声明的长度超过255，则使用两个字节来存储长度，否则1个）字节，当不允许非空字段的时候（因为要用一个字节来存储不可为空的标识），当允许非空字段的时候只能到65532(省下了存储非空的那个字节)。</p>
<h3 id="mysql字段类型存储需要多少字节"><a class="markdownIt-Anchor" href="#mysql字段类型存储需要多少字节"></a> mysql字段类型存储需要多少字节？</h3>
<p><strong>数字类型</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">列类型</th>
<th style="text-align:left">需要的存储量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">TINYINT</td>
<td style="text-align:left">1 字节</td>
</tr>
<tr>
<td style="text-align:left">SMALLINT</td>
<td style="text-align:left">2 个字节</td>
</tr>
<tr>
<td style="text-align:left">MEDIUMINT</td>
<td style="text-align:left">3 个字节</td>
</tr>
<tr>
<td style="text-align:left">INT</td>
<td style="text-align:left">4 个字节</td>
</tr>
<tr>
<td style="text-align:left">INTEGER</td>
<td style="text-align:left">4 个字节</td>
</tr>
<tr>
<td style="text-align:left">BIGINT</td>
<td style="text-align:left">8 个字节</td>
</tr>
<tr>
<td style="text-align:left">FLOAT(X)</td>
<td style="text-align:left">4 如果 X &lt; = 24 或 8 如果 25 &lt; = X &lt; = 53</td>
</tr>
<tr>
<td style="text-align:left">FLOAT</td>
<td style="text-align:left">4 个字节</td>
</tr>
<tr>
<td style="text-align:left">DOUBLE</td>
<td style="text-align:left">8 个字节</td>
</tr>
<tr>
<td style="text-align:left">DOUBLE PRECISION</td>
<td style="text-align:left">8 个字节</td>
</tr>
<tr>
<td style="text-align:left">REAL</td>
<td style="text-align:left">8 个字节</td>
</tr>
<tr>
<td style="text-align:left">DECIMAL(M,D)</td>
<td style="text-align:left">M字节(D+2 , 如果M &lt; D)</td>
</tr>
<tr>
<td style="text-align:left">NUMERIC(M,D)</td>
<td style="text-align:left">M字节(D+2 , 如果M &lt; D)</td>
</tr>
</tbody>
</table>
<p><strong>日期和时间类型</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">列类型</th>
<th style="text-align:left">需要的存储量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">DATE</td>
<td style="text-align:left">3 个字节</td>
</tr>
<tr>
<td style="text-align:left">DATETIME</td>
<td style="text-align:left">8 个字节</td>
</tr>
<tr>
<td style="text-align:left">TIMESTAMP</td>
<td style="text-align:left">4 个字节</td>
</tr>
<tr>
<td style="text-align:left">TIME</td>
<td style="text-align:left">3 个字节</td>
</tr>
<tr>
<td style="text-align:left">YEAR</td>
<td style="text-align:left">1 字节</td>
</tr>
</tbody>
</table>
<p><strong>串类型</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">列类型</th>
<th style="text-align:left">需要的存储量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">CHAR(M)</td>
<td style="text-align:left">M字节，1 &lt;= M &lt;= 255</td>
</tr>
<tr>
<td style="text-align:left">VARCHAR(M)</td>
<td style="text-align:left">L+1 字节, 在此L &lt;= M和1 &lt;= M &lt;= 255</td>
</tr>
<tr>
<td style="text-align:left">TINYBLOB, TINYTEXT</td>
<td style="text-align:left">L+1 字节, 在此L&lt; 2 ^ 8</td>
</tr>
<tr>
<td style="text-align:left">BLOB, TEXT</td>
<td style="text-align:left">L+2 字节, 在此L&lt; 2 ^ 16</td>
</tr>
<tr>
<td style="text-align:left">MEDIUMBLOB, MEDIUMTEXT</td>
<td style="text-align:left">L+3 字节, 在此L&lt; 2 ^ 24</td>
</tr>
<tr>
<td style="text-align:left">LONGBLOB, LONGTEXT</td>
<td style="text-align:left">L+4 字节, 在此L&lt; 2 ^ 32</td>
</tr>
<tr>
<td style="text-align:left">ENUM(‘value1’,‘value2’,…)</td>
<td style="text-align:left">1 或 2 个字节, 取决于枚举值的数目(最大值65535）</td>
</tr>
<tr>
<td style="text-align:left">SET(‘value1’,‘value2’,…)</td>
<td style="text-align:left">1，2，3，4或8个字节, 取决于集合成员的数量(最多64个成员）</td>
</tr>
</tbody>
</table>
<h3 id="mysql中类型后面的数字含义"><a class="markdownIt-Anchor" href="#mysql中类型后面的数字含义"></a> <a href="https://www.itdaan.com/blog/2019/04/08/7762d501e9d5c7cc0316743eaaab6b54.html" target="_blank" rel="noopener">MySQL中类型后面的数字含义</a></h3>
<p>形式：类型(m)</p>
<ol>
<li>整数型的<strong>数值类型</strong>已经<strong>限制了取值范围</strong>，有符号整型和无符号整型都有，而M值并不代表可以存储的数值字符长度，它代表的是<strong>数据在显示时显示的最小长度</strong>，当存储的字符长度超过M值时，没有任何的影响，只要不超过数值类型限制的范围。当存储的字符长度小于M值时，<u>只有在设置了zerofill用0来填充，才能够看到效果，换句话就是说，没有zerofill，M值就是无用的</u>。</li>
<li>字符型如varchar(50) 可以储存50个字符，表示的是可变不定长的。</li>
</ol>
<h3 id="mysql默认字符集"><a class="markdownIt-Anchor" href="#mysql默认字符集"></a> mySQL默认字符集</h3>
<blockquote>
<p>MySQL对于字符集的指定可以细化到一个数据库，一张表，一列，应该用什么字符集。 但是，传统的程序在创建数据库和数据表时并没有使用那么复杂的配置，它们用的是默认的配置，那么，默认的配置从何而来呢？</p>
</blockquote>
<ol>
<li>编译MySQL 时，指定了一个默认的字符集，这个字符集是 latin1；</li>
<li>安装MySQL 时，可以在配置文件 (my.ini) 中指定一个默认的的字符集，如果没指定，这个值继承自编译时指定的；</li>
<li>启动mysqld 时，可以在命令行参数中指定一个默认的的字符集，如果没指定，这个值继承自配置文件中的配置,此时 character_set_server 被设定为这个默认的字符集；</li>
<li>当创建一个新的数据库时，除非明确指定，这个数据库的字符集被缺省设定为character_set_server；</li>
<li>当选定了一个数据库时，character_set_database被设定为这个数据库默认的字符集；</li>
<li>在这个数据库里创建一张表时，表默认的字符集被设定为 character_set_database，也就是这个数据库默认的字符集；</li>
<li>当在表内设置一栏时，除非明确指定，否则此栏缺省的字符集就是表默认的字符集；</li>
</ol>
<h3 id="最终createsql文件"><a class="markdownIt-Anchor" href="#最终createsql文件"></a> 最终create.sql文件</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8mb4;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">EXISTS</span>  <span class="string">`huaneng`</span> ;</span><br><span class="line"><span class="keyword">use</span> <span class="string">`huaneng`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for quotation_inone</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`quotation_inone`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`quotation_inone`</span>  (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`title`</span> <span class="built_in">varchar</span>(<span class="number">128</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`date`</span> <span class="built_in">varchar</span>(<span class="number">16</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`content`</span> LONGTEXT <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">   <span class="string">`proclamation_url`</span> <span class="built_in">VARCHAR</span>(<span class="number">512</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> (<span class="string">`proclamation_url`</span>),</span><br><span class="line"></span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">InnoDB</span> AUTO_INCREMENT = <span class="number">1</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> = utf8mb4 <span class="keyword">COLLATE</span> = utf8mb4_general_ci ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<h1 id="2022年3月20日-护士题目下载存word"><a class="markdownIt-Anchor" href="#2022年3月20日-护士题目下载存word"></a> 2022年3月20日-护士题目下载存Word</h1>
<h3 id="索引报错"><a class="markdownIt-Anchor" href="#索引报错"></a> 索引报错</h3>
<ul>
<li>MySQL 添加索引报错：<code>BLOB/TEXT column used in key specification without a key length</code>
<ol>
<li>当我们对一个名称为platform的字段，类型为 text 添加unique唯一性约束和索引约束时，会报错。 原因：MySQL只能将BLOB/TEXT类型字段设置索引数据的前N个字符，因此，只需要通过sql在增加索引时指定对应字段的长度即可，如：<br>
<code>ALTER TABLE hello_world ADD INDEX key1(platform(250), platform2(250), type);</code>, 其中，platform 和 platform2 就是 text 类型的数据
<ul>
<li>more: <a href="https://www.cnblogs.com/wqbin/p/11903878.html" target="_blank" rel="noopener">https://www.cnblogs.com/wqbin/p/11903878.html</a></li>
</ul>
</li>
<li>根本原因： 错误发生的原因是因为MySQL只能将BLOB/TEXT类型字段设置索引为BLOB/TEXT数据的前N个字符，因此错误常常发生在字段被定义为TEXT/BLOB类型或者和TEXT/BLOB同质的数据类型，如TINYTEXT,MEDIUMTEXT,LONGTEXT ,TINYBLOB,MEDIUMBLOB 和LONGBLOB，并且当前操作是将这个字段设置成主键或者是索引的操作。在未指定TEXT/BLOB‘键长’的情况下，字段是变动的并且是动态的大小所以MySQL不能够保证字段的唯一性。因此当使用TEXT/BLOB类型字段做为索引时，N的值必须提供出来才可以让MySQL决定键长，但是MySQL不支持在TEXT/BLOB限制，TEXT(88)是不行的。
<ul>
<li>解决方案是<strong>将unique限制和索引从TEXT/BLOB字段中移除</strong>，或者是<strong>设置另一个字段为主键</strong>，如果你不愿意这样做并且想在TEXT/BLOB上加限制，那么你可以尝试将这个字段更改为VARCHAR类型，同时给他一个限制长度，默认VARCHAR最多可以限定在255个字符，并且限制要在声明类型的右边指明，如VARCHAR(200)将会限制仅仅200个字符.(注: 但是mysql不支持对TEXT/BLOB长度的限制。)</li>
<li><a href="https://blog.csdn.net/u012069924/article/details/28858337" target="_blank" rel="noopener">https://blog.csdn.net/u012069924/article/details/28858337</a><br>
▲. 在 varchar 字段上建立索引时，必须指定索引长度，没必要对全字段建立索引，根据 实际文本区分度决定索引长度即可。Java 开发手册 33/44 说明：索引的长度与区分度是一对矛盾体，一般对字符串类型数据，长度为 20 的索引，区分度会高达 90%以上，可以使用 count(distinct left(列名, 索引长度))/count(*)的区分度来确定。</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="数据库插入数据"><a class="markdownIt-Anchor" href="#数据库插入数据"></a> 数据库插入数据</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- \\表示一个\</span></span><br><span class="line"><span class="keyword">use</span> xian_nurse;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="string">`question`</span> (<span class="string">`path`</span>) <span class="keyword">VALUES</span> (<span class="string">'书籍\\C-《传染病护理学习指导与习题集》-选择题'</span>), (<span class="string">'书籍\\C-《传染病护理技术学习指导与习题集》-选择题'</span>), (<span class="string">'书籍\\C-《传染病护理技术学习指导与习题集》-题干题'</span>), (<span class="string">'书籍\\C-《成人护理学学习指导与习题集-人民卫生出版社》-选择题'</span>), (<span class="string">'书籍\\C-《成人护理学学习指导与习题集-人民卫生出版社》-题干题'</span>), (<span class="string">'书籍\\E -《儿科护理学实践与学习指导（十三五）》—选择题'</span>), (<span class="string">'书籍\\E -《儿科护理学实践与学习指导（十三五）》—题干题'</span>);</span><br></pre></td></tr></table></figure>
<h2 id="操作word"><a class="markdownIt-Anchor" href="#操作word"></a> 操作word</h2>
<blockquote>
<p>使用<code>python-docx</code>: <code>python -m pip install python-docx</code>， <a href="https://python-docx.readthedocs.io/en/latest/" target="_blank" rel="noopener">https://python-docx.readthedocs.io/en/latest/</a></p>
</blockquote>
<ol>
<li>添加1-9级标题</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> docx <span class="keyword">import</span> Document</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建新的docx文件</span></span><br><span class="line">document = Document()</span><br><span class="line">document.add_heading(<span class="string">'1级标题'</span>, <span class="number">1</span>)  <span class="comment"># 添加1级标题</span></span><br><span class="line">document.add_heading(<span class="string">'2级标题'</span>, <span class="number">2</span>)  <span class="comment"># 添加2级标题</span></span><br><span class="line">document.add_heading(<span class="string">'3级标题'</span>, <span class="number">3</span>)  <span class="comment"># 添加3级标题</span></span><br><span class="line">document.add_heading(<span class="string">'4级标题'</span>, <span class="number">4</span>)  <span class="comment"># 添加4级标题</span></span><br><span class="line">document.add_heading(<span class="string">'5级标题'</span>, <span class="number">5</span>)  <span class="comment"># 添加5级标题</span></span><br><span class="line">document.add_heading(<span class="string">'6级标题'</span>, <span class="number">6</span>)  <span class="comment"># 添加6级标题</span></span><br><span class="line">document.add_heading(<span class="string">'7级标题'</span>, <span class="number">7</span>)  <span class="comment"># 添加7级标题</span></span><br><span class="line">document.add_heading(<span class="string">'8级标题'</span>, <span class="number">8</span>)  <span class="comment"># 添加8级标题</span></span><br><span class="line">document.add_heading(<span class="string">'9级标题'</span>, <span class="number">9</span>)  <span class="comment"># 添加9级标题</span></span><br><span class="line">document.save(<span class="string">'&#123;&#125;.docx'</span>.format(datetime.now().strftime(<span class="string">'%Y%m%d%H%M%S'</span>)))</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>添加段落</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> docx <span class="keyword">import</span> Document</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建新的docx文件</span></span><br><span class="line">document = Document()</span><br><span class="line">paragraph = <span class="string">"""这是一个段落</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">paragraph2 = <span class="string">"""这是一个新的段落"""</span></span><br><span class="line">paragraph3 = <span class="string">"""这是一个新的段落。</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">document.add_paragraph(paragraph)</span><br><span class="line">document.add_paragraph(paragraph2)</span><br><span class="line">document.add_paragraph(paragraph3)</span><br><span class="line">document.save(<span class="string">'&#123;&#125;.docx'</span>.format(datetime.now().strftime(<span class="string">'%Y%m%d%H%M%S'</span>)))</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>设置字体大小和样式</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> docx <span class="keyword">import</span> Document</span><br><span class="line"><span class="comment"># 创建新的docx文件</span></span><br><span class="line"><span class="keyword">from</span> docx.shared <span class="keyword">import</span> Pt</span><br><span class="line"></span><br><span class="line">document = Document()</span><br><span class="line">document.add_paragraph(<span class="string">"这是一个段落"</span>)  <span class="comment"># 添加段落</span></span><br><span class="line">paragraph = document.add_paragraph(<span class="string">"这是一个段落,"</span>)  <span class="comment"># 添加段落</span></span><br><span class="line">run = paragraph.add_run(<span class="string">'设置了字体的段落'</span>)  <span class="comment"># 在同一段添加内容, 即为了操作段落或单词的子字符串. 概念上讲，您需要为段落/文本的run每个部分创建一个实例。</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Append a run to this paragraph containing *text* and having character</span></span><br><span class="line"><span class="string">style identified by style ID *style*. *text* can contain tab</span></span><br><span class="line"><span class="string">(``\\t``) characters, which are converted to the appropriate XML form</span></span><br><span class="line"><span class="string">for a tab. *text* can also include newline (``\\n``) or carriage</span></span><br><span class="line"><span class="string">return (``\\r``) characters, each of which is converted to a line</span></span><br><span class="line"><span class="string">break.</span></span><br><span class="line"><span class="string">大概意思就是追加一个段落, 包含text, 且设置了格式, 我感觉是这样</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">run.font.name = <span class="string">u'宋体'</span>  <span class="comment"># 设置字体</span></span><br><span class="line">run.font.size = Pt(<span class="number">20</span>)  <span class="comment"># 设置字号</span></span><br><span class="line"><span class="comment"># run.font.color.rgb = RGBColor(255, 0, 0)	# 设置红色</span></span><br><span class="line">run.font.underline = <span class="keyword">True</span>	<span class="comment"># 设置下划线</span></span><br><span class="line"></span><br><span class="line">run1 = paragraph.add_run(<span class="string">'\t粗体'</span>)</span><br><span class="line">run1.bold = <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">run2 = paragraph.add_run(<span class="string">'\t斜体'</span>)</span><br><span class="line">run2.italic = <span class="keyword">True</span></span><br><span class="line"> <span class="comment">#图片居中设置</span></span><br><span class="line">paragraph.alignment = WD_PARAGRAPH_ALIGNMENT.CENTER</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Doc = Document() </span><br><span class="line">Doc.styles[<span class="string">'Normal'</span>].font.name = <span class="string">u'宋体'</span></span><br><span class="line">Doc.styles[<span class="string">'Normal'</span>]._element.rPr.rFonts.set(qn(<span class="string">'w:eastAsia'</span>), <span class="string">u'宋体'</span>)</span><br><span class="line">Doc.styles[<span class="string">'Normal'</span>].font.size = Pt(<span class="number">10.5</span>)</span><br><span class="line">Doc.styles[<span class="string">'Normal'</span>].font.color.rgb = RGBColor(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">Head = Doc.add_heading(<span class="string">""</span>,level=<span class="number">1</span>)<span class="comment"># 这里不填标题内容</span></span><br><span class="line">run  = Head.add_run(<span class="string">"刚来csdn，这就是博客么，I了"</span>)</span><br><span class="line">run.font.name=<span class="string">u'Cambria'</span></span><br><span class="line">run.font.color.rgb = RGBColor(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">run._element.rPr.rFonts.set(qn(<span class="string">'w:eastAsia'</span>), <span class="string">u'Cambria'</span>)</span><br><span class="line">Doc.add_paragraph(<span class="string">"Python "</span>)</span><br><span class="line">Doc.add_paragraph(<span class="string">"Python 对word进行操作"</span>)</span><br><span class="line">Doc.save(<span class="string">"Python_word.docx"</span>)</span><br></pre></td></tr></table></figure>
<p>from : <a href="https://www.pythonheidong.com/blog/article/692569/99875f167810b45f17e8/" target="_blank" rel="noopener">https://www.pythonheidong.com/blog/article/692569/99875f167810b45f17e8/</a></p>
<ol start="4">
<li>有序(无序)列表和引用</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 增加引用</span></span><br><span class="line">document.add_paragraph(<span class="string">'123'</span>, style=<span class="string">'Intense Quote'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加有序列表</span></span><br><span class="line">document.add_paragraph(<span class="string">u'有序列表元素1'</span>, style=<span class="string">'List Number'</span>)</span><br><span class="line">document.add_paragraph(<span class="string">u'有序列别元素2'</span>, style=<span class="string">'List Number'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加无序列表</span></span><br><span class="line">document.add_paragraph(<span class="string">u'无序列表元素1'</span>, style=<span class="string">'List Bullet'</span>)</span><br><span class="line">document.add_paragraph(<span class="string">u'无序列表元素2'</span>, style=<span class="string">'List Bullet'</span>)</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>表格和分页</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 增加图片（此处使用相对位置）</span></span><br><span class="line"><span class="comment"># document.add_picture('jdb.jpg', width=Inches(1.25))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加表格</span></span><br><span class="line">table = document.add_table(rows=<span class="number">3</span>, cols=<span class="number">3</span>)  <span class="comment"># 3行3列</span></span><br><span class="line">hdr_cells1 = table.rows[<span class="number">0</span>].cells  <span class="comment"># 第一行</span></span><br><span class="line">hdr_cells1[<span class="number">0</span>].text = <span class="string">"第一行,第一列"</span></span><br><span class="line">hdr_cells1[<span class="number">1</span>].text = <span class="string">"第一行,第二列"</span></span><br><span class="line">hdr_cells1[<span class="number">2</span>].text = <span class="string">"第一行,第三列"</span></span><br><span class="line"></span><br><span class="line">hdr_cells2 = table.rows[<span class="number">1</span>].cells  <span class="comment"># 第二行</span></span><br><span class="line">hdr_cells2[<span class="number">0</span>].text = <span class="string">"第二行,第一列"</span></span><br><span class="line">hdr_cells2[<span class="number">1</span>].text = <span class="string">"第二行,第二列"</span></span><br><span class="line">hdr_cells2[<span class="number">2</span>].text = <span class="string">"第二行,第三列"</span></span><br><span class="line"></span><br><span class="line">hdr_cells3 = table.rows[<span class="number">2</span>].cells  <span class="comment"># 第三行</span></span><br><span class="line">hdr_cells3[<span class="number">0</span>].text = <span class="string">"第三行,第一列"</span></span><br><span class="line">hdr_cells3[<span class="number">1</span>].text = <span class="string">"第三行,第二列"</span></span><br><span class="line">hdr_cells3[<span class="number">2</span>].text = <span class="string">"第三行,第三列"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加分页</span></span><br><span class="line">document.add_page_break()</span><br></pre></td></tr></table></figure>
<h3 id="提取文字"><a class="markdownIt-Anchor" href="#提取文字"></a> 提取文字</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> docx <span class="keyword">import</span> Document</span><br><span class="line"></span><br><span class="line">path = <span class="string">'/media/bobo/自动化办公/wordOperation/wordDemo/test2.docx'</span></span><br><span class="line"></span><br><span class="line">doc = Document(path)</span><br><span class="line">print(doc.paragraphs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出的是列表，列表中一共有4份内容</span></span><br><span class="line"><span class="comment"># [&lt;docx.text.paragraph.Paragraph object at 0x7fca95f0aba8&gt;,</span></span><br><span class="line"><span class="comment"># &lt;docx.text.paragraph.Paragraph object at 0x7fca95f0abe0&gt;,</span></span><br><span class="line"><span class="comment"># &lt;docx.text.paragraph.Paragraph object at 0x7fca95f0ab70&gt;, </span></span><br><span class="line"><span class="comment">#&lt;docx.text.paragraph.Paragraph object at 0x7fca95f0ac50&gt;,]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> paragraph <span class="keyword">in</span> doc.paragraphs:</span><br><span class="line">	print(paragraph.text)</span><br></pre></td></tr></table></figure>
<p>from :</p>
<ul>
<li><a href="https://www.cnblogs.com/rainbow-tan/p/14981998.html" target="_blank" rel="noopener">https://www.cnblogs.com/rainbow-tan/p/14981998.html</a></li>
<li><a href="https://www.cnblogs.com/wenshi-jj/p/15388808.html" target="_blank" rel="noopener">https://www.cnblogs.com/wenshi-jj/p/15388808.html</a></li>
<li><a href="https://www.cnblogs.com/rencm/p/6285304.html" target="_blank" rel="noopener">https://www.cnblogs.com/rencm/p/6285304.html</a></li>
<li><a href="https://blog.csdn.net/weixin_44576802/article/details/86552550%E2%80%94%E2%80%94%E9%A2%9C%E8%89%B2" target="_blank" rel="noopener">https://blog.csdn.net/weixin_44576802/article/details/86552550——颜色</a></li>
<li>参考：<a href="https://www.cnblogs.com/wenshi-jj/p/15388808.html%E2%80%94%E2%80%94%E9%A1%B5%E8%BE%B9%E8%B7%9D%E3%80%81%E9%A1%B5%E7%9C%89%E5%92%8C%E9%A1%B5%E8%84%9A%E3%80%81%E5%88%86%E6%A0%8F" target="_blank" rel="noopener">https://www.cnblogs.com/wenshi-jj/p/15388808.html——页边距、页眉和页脚、分栏</a></li>
</ul>
<h1 id="共同点处理"><a class="markdownIt-Anchor" href="#共同点处理"></a> 共同点处理</h1>
<h2 id="文件保存"><a class="markdownIt-Anchor" href="#文件保存"></a> 文件保存</h2>
<blockquote>
<p>由于文件夹、文件名不允许有<code>/\:*?|&lt;&gt;&quot;</code>，因此需要保存时如果出现这些字符得特别处理。</p>
</blockquote>
<ol>
<li>项目一：<code>xxxx阻垢剂\反渗透阻垢剂\25KG询价书询价公告\zxc.doc</code> ==&gt; <code>xxx阻垢剂、反渗透阻垢剂、25KG询价书询价公告\zxc.doc</code>，存储在<code>attaches\xxx阻垢剂、反渗透阻垢剂、25KG询价书询价公告\zxc.doc</code></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">format_name</span><span class="params">(name: str)</span> -&gt; [bool, str]:</span></span><br><span class="line">       <span class="string">"""</span></span><br><span class="line"><span class="string">       文件和文件夹名规范化</span></span><br><span class="line"><span class="string">       :param name:</span></span><br><span class="line"><span class="string">       :return:</span></span><br><span class="line"><span class="string">       """</span></span><br><span class="line">   	invalid_char = [<span class="string">"/"</span>, <span class="string">"\\"</span>, <span class="string">":"</span>, <span class="string">"*"</span>, <span class="string">"?"</span>, <span class="string">"|"</span>, <span class="string">"&lt;"</span>, <span class="string">"&gt;"</span>, <span class="string">"\""</span>]</span><br><span class="line">       rename = name</span><br><span class="line">       valid = <span class="keyword">True</span></span><br><span class="line">       <span class="keyword">for</span> ch <span class="keyword">in</span> invalid_char:</span><br><span class="line">           <span class="keyword">if</span> ch <span class="keyword">in</span> rename:</span><br><span class="line">               <span class="keyword">if</span> ch == <span class="string">"?"</span>:</span><br><span class="line">                   rename = rename.replace(<span class="string">"?"</span>, <span class="string">"？"</span>)</span><br><span class="line">               <span class="keyword">elif</span> ch == <span class="string">"&lt;"</span>:</span><br><span class="line">                   rename = rename.replace(<span class="string">"&lt;"</span>, <span class="string">"["</span>)</span><br><span class="line">               <span class="keyword">elif</span> ch == <span class="string">"&gt;"</span>:</span><br><span class="line">                   rename = rename.replace(<span class="string">"&gt;"</span>, <span class="string">"]"</span>)</span><br><span class="line">               <span class="keyword">else</span>:</span><br><span class="line">                   rename = rename.replace(ch, <span class="string">"、"</span>)</span><br><span class="line">               valid = <span class="keyword">False</span></span><br><span class="line">       <span class="keyword">return</span> valid, rename</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>项目二：<code>'.\\docx/专科题库\\儿科\\[书籍]\\S-《实用临床护理三基-&quot;应知应会&quot;》—名词解释、简答(规02）\\something.docx'</code>===&gt;<code>'.\\docx/专科题库\\儿科\\[书籍]\\S-《实用临床护理三基-'应知应会'》—名词解释、简答(规02）\\something.docx'</code></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">format_file_path</span><span class="params">(path: str)</span> -&gt; [bool, str]:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    文件和文件夹名规范化</span></span><br><span class="line"><span class="string">    :param name:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    invalid_char = [<span class="string">"/"</span>, <span class="string">"\\"</span>, <span class="string">":"</span>, <span class="string">"*"</span>, <span class="string">"?"</span>, <span class="string">"|"</span>, <span class="string">"&lt;"</span>, <span class="string">"&gt;"</span>, <span class="string">"\""</span>]</span><br><span class="line">    rename = path</span><br><span class="line">    valid = <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> invalid_char:</span><br><span class="line">        <span class="keyword">if</span> ch <span class="keyword">in</span> rename:</span><br><span class="line">            <span class="keyword">if</span> ch == <span class="string">"?"</span>:</span><br><span class="line">                rename = rename.replace(<span class="string">"?"</span>, <span class="string">"？"</span>)</span><br><span class="line">            <span class="keyword">elif</span> ch == <span class="string">"&lt;"</span>:</span><br><span class="line">                rename = rename.replace(<span class="string">"&lt;"</span>, <span class="string">"["</span>)</span><br><span class="line">            <span class="keyword">elif</span> ch == <span class="string">"&gt;"</span>:</span><br><span class="line">                rename = rename.replace(<span class="string">"&gt;"</span>, <span class="string">"]"</span>)</span><br><span class="line">            <span class="keyword">elif</span> ch == <span class="string">'"'</span>:</span><br><span class="line">                rename = rename.replace(<span class="string">"\""</span>, <span class="string">"\'"</span>)</span><br><span class="line">            <span class="keyword">elif</span> ch == <span class="string">"\\"</span> <span class="keyword">or</span> ch == <span class="string">"/"</span>:</span><br><span class="line">                <span class="comment"># 注意跟 上一个的区别， 由于上一个项目中的/和\都是分隔符，而不是真实的分隔目录，因此需要替换，但本项目是真实路径分隔符，所以不需要转换</span></span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                rename = rename.replace(ch, <span class="string">"、"</span>)</span><br><span class="line">            valid = <span class="keyword">False</span></span><br><span class="line">    <span class="keyword">return</span> valid, rename</span><br></pre></td></tr></table></figure>
<h1 id="附录"><a class="markdownIt-Anchor" href="#附录"></a> 附录</h1>
<h3 id="lxml库的使用"><a class="markdownIt-Anchor" href="#lxml库的使用"></a> lxml库的使用</h3>
<ul>
<li>
<p>提取Element中最近标签中的文本(不包含标签本身): <code>ele.xpath('//*[@id=&quot;xxx&quot;]/text()')</code></p>
</li>
<li>
<p>提取Element中所有标签(标签嵌套)中的文本(不包含标签本身): <code>ele.xpath('//*[@id=&quot;xxx&quot;]/string(.)')</code></p>
<ul>
<li>注：跟<code>//text()</code>区别在于，<code>string(.)</code>的结果为合并后的str，<code>//text()</code>为未合并的list</li>
</ul>
</li>
<li>
<p>提取Element中所有内容(标签本身): <code>etree.tostring(ele, method=&quot;html&quot;)</code></p>
</li>
<li>
<p>修改Element某一属性:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">appendixs = html_content.xpath(<span class="string">'/html/body/div[4]/div/div[4]/div/div/div[1]/div[4]/p/a'</span>)</span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> appendixs:</span><br><span class="line">    href = a.xpath(<span class="string">"@href"</span>)[<span class="number">0</span>]</span><br><span class="line">    save_path = self.download_file(ReUtil.extra_announcement_id(detail_article_url), href, title)</span><br><span class="line">    <span class="comment"># html中会对\进行转义</span></span><br><span class="line">    a.attrib[<span class="string">"href"</span>] = save_path</span><br></pre></td></tr></table></figure>
<p>注: 修改子element的某属性后，root节点tostring的结果中element也会被修改。(root抱有element的引用)</p>
</li>
<li>
<p>Element的XML标记名通过对象的属性访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a = &apos;&lt;a href=&quot;http://baidu.com&quot;&gt;hh&lt;span&gt;gg&lt;/span&gt;&lt;/a&gt;&apos;</span><br><span class="line">res = &#123;_Element: 1&#125; &lt;Element html at 0x1de3a6b9800&gt;</span><br><span class="line">     attrib = &#123;_Attrib: 0&#125; &#123;&#125;</span><br><span class="line">     base = &#123;NoneType&#125; None</span><br><span class="line">     nsmap = &#123;dict: 0&#125; &#123;&#125;</span><br><span class="line">     prefix = &#123;NoneType&#125; None</span><br><span class="line">     sourceline = &#123;int&#125; 1</span><br><span class="line">     tag = &#123;str&#125; &apos;html&apos;</span><br><span class="line">     tail = &#123;NoneType&#125; None</span><br><span class="line">     text = &#123;NoneType&#125; None</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Element被组织在XML树结构中。增加子Element并指定它们的父Element，使用append方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 法一</span></span><br><span class="line">root = etree.Element(<span class="string">"root"</span>)</span><br><span class="line">root.append(etree.Element(<span class="string">"child1"</span>))</span><br><span class="line"><span class="comment"># 法二</span></span><br><span class="line">childNode = etree.SubElement(root, <span class="string">"child"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>删除Element下某一节点内容，与添加相同，也有实例方法和工厂方法两种</p>
<ul>
<li>
<p><code>parentnode.remove(node)</code></p>
</li>
<li>
<p><code>etree.strip_elements(html, 'element_name', with_tag=True/False)</code></p>
</li>
</ul>
</li>
</ul>
<h3 id="timeit模块使用"><a class="markdownIt-Anchor" href="#timeit模块使用"></a> <code>timeit</code>模块使用</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spider = HuaNengSpider(ifend=<span class="string">"in"</span>)</span><br><span class="line"><span class="comment"># 记得setup导入 </span></span><br><span class="line">run_time = timeit.timeit(<span class="string">"spider.run_parallelly()"</span>, <span class="string">"from __main__ import spider"</span>, number=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 输出的单位为s </span></span><br><span class="line">print(<span class="string">"耗时: &#123;&#125;s"</span>.format(run_time))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">run_time = timeit.timeit(<span class="string">'HuaNengSpider(ifend="notin", is_in_one=True).run_with_concurrent()'</span>,</span><br><span class="line">                         <span class="string">"from __main__ import HuaNengSpider"</span>, number=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h3 id="python中操作sqlalchemysqlalchemy中文技术文档"><a class="markdownIt-Anchor" href="#python中操作sqlalchemysqlalchemy中文技术文档"></a> Python中操作SQLAlchemy,SQLAlchemy中文技术文档</h3>
<p>参考：<a href="https://www.jianshu.com/p/0ad18fdd7eed%E3%80%81" target="_blank" rel="noopener">https://www.jianshu.com/p/0ad18fdd7eed、</a><a href="https://www.cnblogs.com/yc-c/p/9627968.html" target="_blank" rel="noopener">python3 SQLAlchemy模块使用</a></p>
<h3 id="argumentparser使用"><a class="markdownIt-Anchor" href="#argumentparser使用"></a> <code>ArgumentParser</code>使用</h3>
<ul>
<li>
<p><code>parser.add_argument(&quot;-o&quot;, &quot;--is_in_one&quot;, action=&quot;store_true&quot;, help=&quot;数据存放在一张表中&quot;)</code>, 其中action的<code>store_true</code>表示，如果出现–is_in_one(action)则设置未true, 所以默认为False</p>
<ul>
<li>参数设置为True、False的最好不使用choice参数：因为</li>
<li><code>parser.add_argument(&quot;-o&quot;, &quot;--is_in_one&quot;, choices=[True, False], help=&quot;数据存放在一张表中&quot;)</code>, choice中为True、False时， 可以选择不填，此时is_in_one为None， 如果必须要这两个则选一个则加上<code>required=True</code>选项</li>
<li>加上required效果===&gt;<code>爬虫脚本: error: argument -o/--is_in_one: invalid choice: 'q' (choose from True, False)</code>， 但是如果输入True同样会报错: 爬虫脚本: error: argument -o/–is_in_one: invalid choice: ‘True’ (choose from True, False)</li>
</ul>
<p>所以只有<code>choices=[&quot;True&quot;, &quot;False&quot;]</code>才能生效， 好在的是Python中对true判断比较宽容，下面三种都可以，因此使得choice传str类型的True也可以成功判定，即能实现相同效果，但是还是存在些歧义的，得谨慎使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">"true"</span></span><br><span class="line">b = <span class="keyword">True</span></span><br><span class="line">c = <span class="string">"True"</span></span><br><span class="line"><span class="keyword">if</span> a:</span><br><span class="line">    print(<span class="string">"a yes"</span>)</span><br><span class="line"><span class="keyword">if</span> b:</span><br><span class="line">    print(<span class="string">"b yes"</span>)</span><br><span class="line"><span class="keyword">if</span> c:</span><br><span class="line">    print(<span class="string">"c yes"</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="其他sql文件"><a class="markdownIt-Anchor" href="#其他sql文件"></a> 其他SQL文件</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`auto_bilibili`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`userid`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'创建的任务名'</span>,</span><br><span class="line">  <span class="string">`sessdata`</span> longtext <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`bili_jct`</span> longtext <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`dedeuserid`</span> longtext <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`taskIntervalTime`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'10'</span> <span class="keyword">COMMENT</span> <span class="string">'任务之间的执行间隔'</span>,</span><br><span class="line">  <span class="string">`numberOfCoins`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'5'</span> <span class="keyword">COMMENT</span> <span class="string">'每日投币数量'</span>,</span><br><span class="line">  <span class="string">`reserveCoins`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'50'</span> <span class="keyword">COMMENT</span> <span class="string">'预留的硬币数'</span>,</span><br><span class="line">  <span class="string">`selectLike`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> <span class="keyword">COMMENT</span> <span class="string">'投币时是否点赞，默认 0, 0：否 1：是'</span>,</span><br><span class="line">  <span class="string">`monthEndAutoCharge`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'true'</span> <span class="keyword">COMMENT</span> <span class="string">'年度大会员月底是否用 B 币券给自己充电，默认 true，即充电对象是你本人。'</span>,</span><br><span class="line">  <span class="string">`giveGift`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'true'</span> <span class="keyword">COMMENT</span> <span class="string">'直播送出即将过期的礼物，默认开启'</span>,</span><br><span class="line">  <span class="string">`upLive`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> <span class="keyword">COMMENT</span> <span class="string">'直播送出即将过期的礼物，指定 up 主，为 0 时则随随机选取一个 up 主'</span>,</span><br><span class="line">  <span class="string">`chargeForLove`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> <span class="keyword">COMMENT</span> <span class="string">'给指定 up 主充电，值为 0 或者充电对象的 uid，默认为 0，即给自己充电'</span>,</span><br><span class="line">  <span class="string">`devicePlatform`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'ios'</span> <span class="keyword">COMMENT</span> <span class="string">'手机端漫画签到时的平台，建议选择你设备的平台 ，默认 ios'</span>,</span><br><span class="line">  <span class="string">`coinAddPriority`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'1'</span> <span class="keyword">COMMENT</span> <span class="string">'0：优先给热榜视频投币，1：优先给关注的 up 投币'</span>,</span><br><span class="line">  <span class="string">`userAgent`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36 Edg/86.0.622.69'</span> <span class="keyword">COMMENT</span> <span class="string">'浏览器 UA'</span>,</span><br><span class="line">  <span class="string">`skipDailyTask`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'false'</span> <span class="keyword">COMMENT</span> <span class="string">'是否跳过每日任务'</span>,</span><br><span class="line">  <span class="string">`webhook`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'推送地址'</span>,</span><br><span class="line">  <span class="string">`enddate`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`match_enable`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'false'</span> <span class="keyword">COMMENT</span> <span class="string">'预测是否开启'</span>,</span><br><span class="line">  <span class="string">`match_predictNumberOfCoins`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'10'</span> <span class="keyword">COMMENT</span> <span class="string">'单次预测投注硬币'</span>,</span><br><span class="line">  <span class="string">`match_minimumNumberOfCoins`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'200'</span> <span class="keyword">COMMENT</span> <span class="string">'预测保留硬币'</span>,</span><br><span class="line">  <span class="string">`match_showHandModel`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'false'</span> <span class="keyword">COMMENT</span> <span class="string">'押注形式'</span>,</span><br><span class="line">  <span class="string">`other`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`userid`</span> (<span class="string">`userid`</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">7</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 ROW_FORMAT=DYNAMIC</span><br></pre></td></tr></table></figure>
<h1 id="2022年3月26日小鸡词典"><a class="markdownIt-Anchor" href="#2022年3月26日小鸡词典"></a> 2022年3月26日——小鸡词典</h1>
<h1 id="抓取指定词条信息"><a class="markdownIt-Anchor" href="#抓取指定词条信息"></a> 抓取指定词条信息</h1>
<blockquote>
<p><a href="https://jikipedia.com/search?phrase=a&amp;category=definition" target="_blank" rel="noopener">https://jikipedia.com/search?phrase=a&amp;category=definition</a></p>
</blockquote>
<p>需求：将包含英文的词条信息保存到excel文件中</p>
<p>难点：</p>
<ul>
<li>由于不断下滑都会产生数据， 因此难以评估数据量</li>
</ul>
<p>思路：通过搜索a-z英文字母，从而找出所有包含英文字母的单词，由于搜索结果的数量是有限的，因此可以确定是否完成。 随着而来的问题是，如果词条为apple，那么搜a/p/l/e都会重复抓取==&gt;防重思路: 通过词条id来判断是否已经爬取过</p>
<h1 id="lookup"><a class="markdownIt-Anchor" href="#lookup"></a> Lookup:</h1>
<ul>
<li>
<p><a href="https://blog.csdn.net/weixin_37577134/article/details/89048798" target="_blank" rel="noopener">【python】xlwings如何设置字体、颜色等属性</a></p>
</li>
<li>
<p><a href="https://zhuanlan.zhihu.com/p/120415076" target="_blank" rel="noopener">全网最详细的xlwings库解析(3) – Python操作工作簿&amp;表</a></p>
</li>
<li>
<p><a href="https://blog.csdn.net/chang1976272446/article/details/84140117" target="_blank" rel="noopener">xlwings获取excel sheet多少行多少列</a></p>
</li>
<li>
<p><a href="https://blog.csdn.net/weixin_44015669/article/details/117637954" target="_blank" rel="noopener">Python：利用xlwings库实现excel进行插入、删除行操作实例</a></p>
</li>
<li>
<p>数据库中create_time既可以指定为DATETIME也可以设置为TIMESTAMP，而对应的在SQL中位db.DateTime、TIMESTAMP</p>
</li>
</ul>
<p>▲. 由于不需要对excel中样式进行修改，所以为了省事，最终直接采用了入库导出Excel的方式，而没用使用xlwings库</p>
<h2 id="日志输出两次"><a class="markdownIt-Anchor" href="#日志输出两次"></a> 日志输出两次</h2>
<p>原因是多个Py文件中引入了<code>LOG</code>, 但引入方式不一样，如main.py中是<code>from logger import LOG</code>, 而spider.py中是<code>from logger import LOG</code>,<br>
saver.oy中是<code>from jikipedia.logger import LOG</code></p>
<p>▲ <a href="http://xn--mainspider-yt2pm7a86yp5bky8aghsszaw517eiuka.py" target="_blank" rel="noopener">问题就出在main中导入了spider.py</a>, <a href="http://xn--spidersaver-ox9qz06chk1b4gzejotb.py" target="_blank" rel="noopener">而spider又引用了saver.py</a>，但是saver中引用的LOG由于导入方式不同，使得跟前两个的使用的LOG不是同一个，但LOG配置都是一样的，所以导致了输出多次。</p>
<h2 id="pytest库使用"><a class="markdownIt-Anchor" href="#pytest库使用"></a> pytest库使用</h2>
<blockquote>
<p><code>pip install pytest</code></p>
</blockquote>
<ul>
<li>测试文件以test_开头（以_test结尾也可以）</li>
<li>测试类以Test开头，并且不能带有 init 方法</li>
<li>测试函数以test_开头</li>
<li>断言使用基本的assert即可</li>
</ul>
<p><strong>pytest 夹具</strong>(fixture)</p>
<blockquote>
<p>测试需要在一组已知对象的背景下进行。 这组对象称为测试夹具(fixture)。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> algo</span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">data</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">-3</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">-2</span>, <span class="number">11</span>, <span class="number">9</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_sel_sort</span><span class="params">(data)</span>:</span></span><br><span class="line">    sorted_vals = algo.sel_sort(data)</span><br><span class="line">    <span class="keyword">assert</span> sorted_vals == sorted(data)</span><br></pre></td></tr></table></figure>
<h3 id="综合测试"><a class="markdownIt-Anchor" href="#综合测试"></a> 综合测试</h3>
<p>接下来，我们展示如何在 Python 包中运行测试。</p>
<ol>
<li>首先把将所有的测试文件全部放在<code>./tests/</code>文件夹下</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">setup.py</span><br><span class="line">utils</span><br><span class="line">│   algo.py</span><br><span class="line">│   srel.py</span><br><span class="line">│   __init__.py</span><br><span class="line">│</span><br><span class="line">└───tests</span><br><span class="line">        algo_test.py</span><br><span class="line">        srel_test.py</span><br><span class="line">        __init__.py</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># tests/algo_test.py</span></span><br><span class="line"><span class="keyword">import</span> utils.algo</span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">data</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">-3</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">-2</span>, <span class="number">11</span>, <span class="number">9</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_sel_sort</span><span class="params">(data)</span>:</span></span><br><span class="line">    sorted_vals = utils.algo.sel_sort(data)</span><br><span class="line">    <span class="keyword">assert</span> sorted_vals == sorted(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_min</span><span class="params">()</span>:</span></span><br><span class="line">    values = (<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">    val = utils.algo.min(values)</span><br><span class="line">    <span class="keyword">assert</span> val == <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_max</span><span class="params">()</span>:</span></span><br><span class="line">    values = (<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">    val = utils.algo.max(values)</span><br><span class="line">    <span class="keyword">assert</span> val == <span class="number">6</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li><code>pytest tests/</code></li>
</ol>
<p>执行文件、文件夹</p>
<ul>
<li>pytest test_mod.py 执行该模块下的测试类测试方法</li>
<li>pytest testing 执行该文件夹下的所有模块</li>
<li>pytest test_cgi.py::test_answer，执行test_answer方法</li>
<li>pytest test_cgi.py::TestMyClass::test_one，执行TestMyClass类下的test_one方法</li>
</ul>
<p>more: <a href="https://www.imooc.com/wiki/pycharmlesson/pytest.html" target="_blank" rel="noopener">在 PyCharm 里使用 Pytest 测试框架</a></p>
<h2 id="requests异常"><a class="markdownIt-Anchor" href="#requests异常"></a> requests异常</h2>
<p>ReadTimeout: 意思是已经建立连接，并开始读取服务端资源。如果到了指定的时间，没有可能的数据被客户端读取，则报异常。<br>
出现的情况是在设置了timeout设置为3秒，服务器在3秒内未给出响应，出现报错<code>requests.exceptions.ReadTimeout</code>。 ConnectTimeout:<br>
意思是用来建立连接的时间。如果到了指定的时间，还没建立连接，则报异常。</p>
<h2 id="附录-2"><a class="markdownIt-Anchor" href="#附录-2"></a> 附录</h2>
<h3 id="导入问题"><a class="markdownIt-Anchor" href="#导入问题"></a> 导入问题：</h3>
<p>在tests/中如果要引工程根目录的文件比较麻烦，得通过相对路径<code>from ..utils import xxx</code>的方式, 但是这样必须把再加上<code>sys.path.append(&quot;..&quot;)</code><br>
，针对这种情况，一个解决方案是所有模块都从根工程为绝对路径开始引，比如main.py中引settings为<code>from jikipedia.settings import xxx</code>,<br>
而tests中引也是同样<code>from jikipedia.settings import xxx</code>==&gt;pycharm中使用alt+enter提示后使用的import也是从根目录导入<code>from jikipedia.xxx import yyy</code></p>
<p>注： 这样需要把工程根目录作为包，所以得在根目录加上<code>__init__.py</code>文件</p>
<h3 id="脚本中相对路径问题"><a class="markdownIt-Anchor" href="#脚本中相对路径问题"></a> 脚本中相对路径问题</h3>
<p>由于settings.py会直接在同级的根目录下创建attaches文件夹，但是如果直接是<code>mkdir(&quot;./attaches&quot;)</code>的话，tests/中只要间接导入了settings.py都会在tests/下创建attaches，因为此时的脚本路径是在tests/下，所以settings中的可执行<code>mkdir(.)</code>就变成了在<code>tests/.</code>所以这边应该指定绝对路径, 下面是一个通过<code>__file__</code>获得脚本绝对路径，然后再获得其所在文件夹的做法：</p>
<p><code>DOWNLOAD_PATH = os.path.join(os.path.dirname(os.path.abspath(__file__)), &quot;attaches&quot;)</code></p>
<p>DOWNLOAD_PATH的值被赋值成了<code>F:\aDevelopment\Python\ShowYourCode\jikipedia</code>从而解决了这个问题</p>
<h3 id="redis使用"><a class="markdownIt-Anchor" href="#redis使用"></a> redis使用</h3>
<blockquote>
<p>特点：</p>
<p>1.基于内存的key-value数据库<br>
2.基于c语言编写的，可以支持多种语言的api //set每秒11万次，取get 81000次<br>
3.支持数据持久化<br>
4.value可以是string，hash， list， set, sorted set</p>
</blockquote>
<h4 id="连接redis服务器"><a class="markdownIt-Anchor" href="#连接redis服务器"></a> <strong>连接redis服务器</strong></h4>
<ul>
<li>本地命令行进入redis： <code>redis-cli</code></li>
<li>远程连接：<code>redis-cli -h host -p port -a password</code></li>
</ul>
<h4 id="命令参数"><a class="markdownIt-Anchor" href="#命令参数"></a> 命令参数：</h4>
<p>key</p>
<ul>
<li>keys * 获取所有的key</li>
<li>select 0 选择第一个库</li>
<li>move myString 1 将当前的数据库key移动到某个数据库,目标库有，则不能移动</li>
<li>flush db      清除指定库</li>
<li>randomkey     随机key</li>
<li>type key      类型</li>
<li>set key1 value1 设置key</li>
<li>get key1    获取key</li>
<li>mset key1 value1 key2 value2 key3 value3</li>
<li>mget key1 key2 key3</li>
<li>del key1   删除key</li>
<li>exists key      判断是否存在key</li>
<li>expire key 10   10过期</li>
<li>pexpire key 1000 毫秒</li>
<li>persist key     删除过期时间</li>
</ul>
<p>string</p>
<ul>
<li>set name cxx</li>
<li>get name</li>
<li>getrange name 0 -1        字符串分段</li>
<li>getset name new_cxx       设置值，返回旧值</li>
<li>mset key1 key2            批量设置</li>
<li>mget key1 key2            批量获取</li>
<li>setnx key value           不存在就插入（not exists）</li>
<li>setex key time value      过期时间（expire）</li>
<li>setrange key index value  从index开始替换value</li>
<li>incr age        递增</li>
<li>incrby age 10   递增</li>
<li>decr age        递减</li>
<li>decrby age 10   递减</li>
<li>incrbyfloat     增减浮点数</li>
<li>append          追加</li>
<li>strlen          长度</li>
<li>getbit/setbit/bitcount/bitop    位操作</li>
</ul>
<p>hash</p>
<ul>
<li>hset myhash name cxx</li>
<li>hget myhash name</li>
<li>hmset myhash name cxx age 25 note “i am notes”</li>
<li>hmget myhash name age note</li>
<li>hgetall myhash               获取所有的</li>
<li>hexists myhash name          是否存在</li>
<li>hsetnx myhash score 100      设置不存在的</li>
<li>hincrby myhash id 1          递增</li>
<li>hdel myhash name             删除</li>
<li>hkeys myhash                 只取key</li>
<li>hvals myhash                 只取value</li>
<li>hlen myhash                  长度</li>
</ul>
<p>list</p>
<ul>
<li>lpush mylist a b c  左插入</li>
<li>rpush mylist x y z  右插入</li>
<li>lrange mylist 0 -1  数据集合</li>
<li>lpop mylist  弹出元素</li>
<li>rpop mylist  弹出元素</li>
<li>llen mylist  长度</li>
<li>lrem mylist count value  删除</li>
<li>lindex mylist 2          指定索引的值</li>
<li>lset mylist 2 n          索引设值</li>
<li>ltrim mylist 0 4         删除key</li>
<li>linsert mylist before a  插入</li>
<li>linsert mylist after a   插入</li>
<li>rpoplpush list list2     转移列表的数据</li>
</ul>
<p>set</p>
<ul>
<li>sadd myset redis</li>
<li>smembers myset       数据集合</li>
<li>srem myset set1         删除</li>
<li>sismember myset set1 判断元素是否在集合中</li>
<li>scard key_name       个数</li>
<li>sdiff | sinter | sunion 操作：集合间运算：差集 | 交集 | 并集</li>
<li>srandmember          随机获取集合中的元素</li>
<li>spop                 从集合中弹出一个元素</li>
<li></li>
</ul>
<p>zset</p>
<ul>
<li>zadd zset 1 one</li>
<li>zadd zset 2 two</li>
<li>zadd zset 3 three</li>
<li>zincrby zset 1 one              增长分数</li>
<li>zscore zset two                 获取分数</li>
<li>zrange zset 0 -1 withscores     范围值</li>
<li>zrangebyscore zset 10 25 withscores 指定范围的值</li>
<li>zrangebyscore zset 10 25 withscores limit 1 2 分页</li>
<li>Zrevrangebyscore zset 10 25 withscores  指定范围的值</li>
<li>zcard zset  元素数量</li>
<li>Zcount zset 获得指定分数范围内的元素个数</li>
<li>Zrem zset one two        删除一个或多个元素</li>
<li>Zremrangebyrank zset 0 1  按照排名范围删除元素</li>
<li>Zremrangebyscore zset 0 1 按照分数范围删除元素</li>
<li>Zrank zset 0 -1    分数最小的元素排名为0</li>
<li>Zrevrank zset 0 -1  分数最大的元素排名为0</li>
<li>Zinterstore</li>
<li>zunionstore rank:last_week 7 rank:20150323 rank:20150324 rank:20150325  weights 1 1 1 1 1 1 1</li>
</ul>
<p>排序：</p>
<ul>
<li>sort mylist  排序</li>
<li>sort mylist alpha desc limit 0 2 字母排序</li>
<li>sort list by it:* desc           by命令</li>
<li>sort list by it:* desc get it:*  get参数</li>
<li>sort list by it:* desc get it:* store sorc:result  sort命令之store参数：表示把sort查询的结果集保存起来</li>
</ul>
<p>订阅与发布：</p>
<ul>
<li>订阅频道：subscribe chat1</li>
<li>发布消息：publish chat1 “hell0 ni hao”</li>
<li>查看频道：pubsub channels</li>
<li>查看某个频道的订阅者数量: pubsub numsub chat1</li>
<li>退订指定频道： unsubscrible chat1   , punsubscribe java.*</li>
<li>订阅一组频道： psubscribe java.*</li>
<li></li>
</ul>
<p>redis事物：</p>
<ul>
<li>隔离性，原子性，</li>
<li>步骤：  开始事务，执行命令，提交事务</li>
<li>
<pre><code>     multi  //开启事务
</code></pre>
</li>
<li>
<pre><code>     sadd myset a b c
</code></pre>
</li>
<li>
<pre><code>     sadd myset e f g
</code></pre>
</li>
<li>
<pre><code>     lpush mylist aa bb cc
</code></pre>
</li>
<li>
<pre><code>     lpush mylist dd ff gg
</code></pre>
</li>
</ul>
<p>服务器管理</p>
<ul>
<li>dump.rdb</li>
<li>appendonly.aof</li>
<li>//BgRewriteAof 异步执行一个aop(appendOnly file)文件重写, 会创建当前一个AOF文件体积的优化版本</li>
<li>//BgSave 后台异步保存数据到磁盘，会在当前目录下创建文件dump.rdb</li>
<li>//save同步保存数据到磁盘，会阻塞主进程，别的客户端无法连接</li>
<li>//client kill 关闭客户端连接</li>
<li>//client list 列出所有的客户端</li>
<li>client setname myclient1 //给客户端设置一个名称</li>
<li>client getname</li>
<li>config get port</li>
<li>//configRewrite 对redis的配置文件进行改写</li>
</ul>
<p>rdb</p>
<ul>
<li>save 900 1</li>
<li>save 300 10</li>
<li>save 60 10000</li>
</ul>
<p>aop备份处理</p>
<ul>
<li>appendonly yes 开启持久化</li>
<li>appendfsync everysec 每秒备份一次</li>
</ul>
<p>命令：</p>
<ul>
<li>bgsave异步保存数据到磁盘（快照保存）</li>
<li>lastsave返回上次成功保存到磁盘的unix的时间戳</li>
<li>shutdown同步保存到服务器并关闭redis服务器</li>
<li>bgrewriteaof文件压缩处理（命令）</li>
</ul>
<h4 id="使用场景"><a class="markdownIt-Anchor" href="#使用场景"></a> 使用场景</h4>
<ol>
<li>去最新n个数据的操作</li>
<li>排行榜，取top n个数据 //最佳人气前10条</li>
<li>精确的设置过期时间</li>
<li>计数器</li>
<li>实时系统， 反垃圾系统</li>
<li>pub， sub发布订阅构建实时消息系统</li>
<li>构建消息队列</li>
<li>缓存</li>
</ol>
<p>Redis在互联网公司一般有以下应用：</p>
<ul>
<li>String：缓存、限流、计数器、分布式锁、分布式Session</li>
<li>Hash：存储用户信息、用户主页访问量、组合查询</li>
<li>List：微博关注人时间轴列表、简单队列</li>
<li>Set：赞、踩、标签、好友关系</li>
<li>Zset：排行榜</li>
</ul>
<h2 id="mysql中时间类型设置"><a class="markdownIt-Anchor" href="#mysql中时间类型设置"></a> MYSQL中时间类型设置</h2>
<ul>
<li>create_time：设置数据类型为：TIMESTAMP，默认值为：<code>CURRENT_TIMESTAMP()</code></li>
<li>modify_time：设置数据类型为：TIMESTAMP，默认值为：<code>CURRENT_TIMESTAMP() ON UPDATE CURRENT_TIMESTAMP()</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`base_name`</span>.<span class="string">`table_name`</span> (</span><br><span class="line">  <span class="string">`create_time`</span> <span class="keyword">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>(),</span><br><span class="line">  <span class="string">`modify_time`</span> <span class="keyword">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>() <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span>());</span><br></pre></td></tr></table></figure>
<p>除了TIMESTAMP以外，也可以设置为DATETIME(0)，对于在SQLAlchemy中为TIMESTAMP和DateTime类型</p>
<h2 id="ip代理池"><a class="markdownIt-Anchor" href="#ip代理池"></a> IP代理池</h2>
<p>爬虫和反爬虫是一对矛和盾，反爬虫很常见的一个方法就是封IP，一个IP短时间内频繁访问，可以做限流或者是加入黑名单。针对这种情况，我们可以采用IP代理池+随机UA的方式来规避。</p>
<p>此外爬虫是一种IO密集型程序，如果全程单线程执行那会很慢，因此可以用多线程来提高数据采集效率，不过自己管理多线程太麻烦，所以可以选择线程池。</p>
<h3 id="代理池"><a class="markdownIt-Anchor" href="#代理池"></a> 代理池</h3>
<p>一个完善的代理池，应该可以实现以下功能</p>
<ul>
<li>批量<strong>采集</strong>代理（或者通过接口导入我们购买的代理，不过偶尔用一用还是免费的就好）</li>
<li>采集到之后自动<strong>验证</strong>代理有效性</li>
<li>将有效代理<strong>存储</strong>起来</li>
<li>提供<u>获取</u>随机代理的<strong>接口</strong>、提供<u>管理</u>（删除、增加）代理的<strong>接口</strong></li>
</ul>
<h3 id="使用代理池"><a class="markdownIt-Anchor" href="#使用代理池"></a> 使用代理池</h3>
<p>之前在就看到过<a href="https://cn.bing.com/search?q=%E7%88%AC%E8%99%AB+%E5%B4%94%E5%BA%86%E6%89%8D&amp;FORM=QSRE1" target="_blank" rel="noopener">崔庆才</a>书中介绍的开源代理池，但没仔细研究，本次搜索过后又发现了一个在GitHub上有14k+ Stars的代理池来用，名字叫<a href="https://github.com/jhao104/proxy_pool" target="_blank" rel="noopener"><code>ProxyPool</code></a>。</p>
<p>官方文档提供了两种部署方式，包括下载代码运行和docker，既然有docker那肯定选最方便的docker啦！</p>
<p>不过官方的docker命令还不够方便，因为这个代理池还需要依赖Redis服务，因此可以用docker-compose配置来用：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3"</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  redis:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">    expose:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">6379</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  web:</span></span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">jhao104/proxy_pool</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">DB_CONN=redis://redis:6379/0</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"5010:5010"</span></span><br><span class="line"><span class="attr">    depends_on:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">redis</span></span><br></pre></td></tr></table></figure>
<p>接口信息：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"url"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"desc"</span>: <span class="string">"get a proxy"</span>,</span><br><span class="line">      <span class="attr">"params"</span>: <span class="string">"type: ''https'|''"</span>,</span><br><span class="line">      <span class="attr">"url"</span>: <span class="string">"/get"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"desc"</span>: <span class="string">"get and delete a proxy"</span>,</span><br><span class="line">      <span class="attr">"params"</span>: <span class="string">""</span>,</span><br><span class="line">      <span class="attr">"url"</span>: <span class="string">"/pop"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"desc"</span>: <span class="string">"delete an unable proxy"</span>,</span><br><span class="line">      <span class="attr">"params"</span>: <span class="string">"proxy: 'e.g. 127.0.0.1:8080'"</span>,</span><br><span class="line">      <span class="attr">"url"</span>: <span class="string">"/delete"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"desc"</span>: <span class="string">"get all proxy from proxy pool"</span>,</span><br><span class="line">      <span class="attr">"params"</span>: <span class="string">"type: ''https'|''"</span>,</span><br><span class="line">      <span class="attr">"url"</span>: <span class="string">"/all"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"desc"</span>: <span class="string">"return proxy count"</span>,</span><br><span class="line">      <span class="attr">"params"</span>: <span class="string">""</span>,</span><br><span class="line">      <span class="attr">"url"</span>: <span class="string">"/count"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="获取随机代理"><a class="markdownIt-Anchor" href="#获取随机代理"></a> 获取随机代理</h4>
<p>封装获取随机代理和删除代理的操作后就可以使用了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment"># IP换成自己服务器的IP</span></span><br><span class="line">PROXY_POOL_URL = <span class="string">'http://127.0.0.1:5010'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_proxy</span><span class="params">()</span>:</span></span><br><span class="line">    proxy = requests.get(<span class="string">f"<span class="subst">&#123;PROXY_POOL_URL&#125;</span>/get/"</span>).json().get(<span class="string">"proxy"</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">'http'</span>: proxy, <span class="string">'https'</span>: proxy&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete_proxy</span><span class="params">(proxy)</span>:</span></span><br><span class="line">    requests.get(<span class="string">f"<span class="subst">&#123;PROXY_POOL_URL&#125;</span>/delete/?proxy=<span class="subst">&#123;proxy&#125;</span>"</span>)</span><br></pre></td></tr></table></figure>
<p>from： <a href="https://www.cnblogs.com/deali/p/15890678.html" target="_blank" rel="noopener">https://www.cnblogs.com/deali/p/15890678.html</a></p>
<h2 id="添加代理装饰器"><a class="markdownIt-Anchor" href="#添加代理装饰器"></a> 添加代理装饰器</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @author: Mrli</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reqCheck</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    目前只支持http代理，https大多无效</span></span><br><span class="line"><span class="string">    :param func:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"><span class="meta">    @wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        rand_proxy = get_proxy()</span><br><span class="line">        <span class="comment"># 给请求加上proxy参数</span></span><br><span class="line">        kwargs[<span class="string">"proxy"</span>] = rand_proxy</span><br><span class="line">        tryTimes = <span class="number">0</span></span><br><span class="line">        resp = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">while</span> tryTimes &lt; MAX_RETRY_COUNT:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                resp = func(*args, **kwargs)</span><br><span class="line">                print(resp.status_code)</span><br><span class="line">                <span class="keyword">if</span> <span class="number">100</span> &lt; resp.status_code &lt; <span class="number">400</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> RequestException <span class="keyword">as</span> e:</span><br><span class="line">                tryTimes += <span class="number">1</span></span><br><span class="line">                LOG.warn(<span class="string">"&#123;&#125;请求失败: e~&#123;&#125;"</span>.format(rand_proxy, e))</span><br><span class="line">                rand_proxy = get_proxy()</span><br><span class="line">                delete_proxy(rand_proxy)</span><br><span class="line">        <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>
</article><!-- lincense--><div class="license-wrapper"><p> <span>Author:  </span><a href="https://nymrli.top">Mrli</a></p><p> <span>Link:  </span><a href="https://nymrli.top/2022/03/19/2022年3月19日-20日爬虫项目记录/">https://nymrli.top/2022/03/19/2022年3月19日-20日爬虫项目记录/</a></p><p> <span>Copyright:  </span><span>All articles in this blog are licensed under <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/3.0">CC BY-NC-SA 3.0</a> unless stating additionally.</span></p></div><div class="post-paginator"><a class="prevSlogan" href="/2022/03/29/开源项目代码阅读记录/" title="开源项目代码阅读记录"><span>< PreviousPost</span><br><span class="prevTitle">开源项目代码阅读记录</span></a><a class="nextSlogan" href="/2022/02/27/深入学习使用Spring/" title="深入学习使用Spring"><span>NextPost ></span><br><span class="nextTitle">深入学习使用Spring</span></a><div class="clear"></div></div><div id="comment"><div id="container"></div><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script><script>var gitment = new Gitment({
  id: '2022年3月19~20日-爬虫项目记录',
  owner: 'Freedomisgood',
  repo: 'Freedomisgood.github.io',
  oauth: {
    client_id: 'bc5a81fe36017dcd8b63',
    client_secret: '949cec3a1b91742c6249c47259791e4b80a6fa69',
  },
})
gitment.render('container')</script></div></section></article><footer id="cxo-footer-outer"><div id="cxo-footer-inner"><p class="footer-container"><span>Site by </span><a href="http://hexo.io"><span>Hexo</span></a><span> | theme </span><a href="https://github.com/Longlongyu/hexo-theme-Cxo"><span>Cxo</span></a></p><p class="beian"><span>备案号:苏ICP备18015439号</span></p><i class="fa fa-user"> </i><span id="busuanzi_value_site_uv"></span><span> | </span><i class="fa fa-eye"> </i><span id="busuanzi_value_site_pv"></span></div></footer><!-- catelog--><div class="toc-wrapper" style="top: 60vh;"><div class="toc-catalog"><i class="fa fa-list"> </i><span>CATALOG</span></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#2022年3月20日公告存网站页面到数据库"><span class="toc-number">1.</span> <span class="toc-text"> 2022年3月20日——公告存网站页面到数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#文件存储"><span class="toc-number">1.1.</span> <span class="toc-text"> 文件存储</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据库表"><span class="toc-number">1.2.</span> <span class="toc-text"> 数据库表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql字段类型存储需要多少字节"><span class="toc-number">1.2.1.</span> <span class="toc-text"> mysql字段类型存储需要多少字节？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql中类型后面的数字含义"><span class="toc-number">1.2.2.</span> <span class="toc-text"> MySQL中类型后面的数字含义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql默认字符集"><span class="toc-number">1.2.3.</span> <span class="toc-text"> mySQL默认字符集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#最终createsql文件"><span class="toc-number">1.2.4.</span> <span class="toc-text"> 最终create.sql文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2022年3月20日-护士题目下载存word"><span class="toc-number">2.</span> <span class="toc-text"> 2022年3月20日-护士题目下载存Word</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#索引报错"><span class="toc-number">2.0.1.</span> <span class="toc-text"> 索引报错</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据库插入数据"><span class="toc-number">2.0.2.</span> <span class="toc-text"> 数据库插入数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#操作word"><span class="toc-number">2.1.</span> <span class="toc-text"> 操作word</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#提取文字"><span class="toc-number">2.1.1.</span> <span class="toc-text"> 提取文字</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#共同点处理"><span class="toc-number">3.</span> <span class="toc-text"> 共同点处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#文件保存"><span class="toc-number">3.1.</span> <span class="toc-text"> 文件保存</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#附录"><span class="toc-number">4.</span> <span class="toc-text"> 附录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#lxml库的使用"><span class="toc-number">4.0.1.</span> <span class="toc-text"> lxml库的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#timeit模块使用"><span class="toc-number">4.0.2.</span> <span class="toc-text"> timeit模块使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#python中操作sqlalchemysqlalchemy中文技术文档"><span class="toc-number">4.0.3.</span> <span class="toc-text"> Python中操作SQLAlchemy,SQLAlchemy中文技术文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#argumentparser使用"><span class="toc-number">4.0.4.</span> <span class="toc-text"> ArgumentParser使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#其他sql文件"><span class="toc-number">4.0.5.</span> <span class="toc-text"> 其他SQL文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2022年3月26日小鸡词典"><span class="toc-number">5.</span> <span class="toc-text"> 2022年3月26日——小鸡词典</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#抓取指定词条信息"><span class="toc-number">6.</span> <span class="toc-text"> 抓取指定词条信息</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lookup"><span class="toc-number">7.</span> <span class="toc-text"> Lookup:</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#日志输出两次"><span class="toc-number">7.1.</span> <span class="toc-text"> 日志输出两次</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pytest库使用"><span class="toc-number">7.2.</span> <span class="toc-text"> pytest库使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#综合测试"><span class="toc-number">7.2.1.</span> <span class="toc-text"> 综合测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#requests异常"><span class="toc-number">7.3.</span> <span class="toc-text"> requests异常</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#附录-2"><span class="toc-number">7.4.</span> <span class="toc-text"> 附录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#导入问题"><span class="toc-number">7.4.1.</span> <span class="toc-text"> 导入问题：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#脚本中相对路径问题"><span class="toc-number">7.4.2.</span> <span class="toc-text"> 脚本中相对路径问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redis使用"><span class="toc-number">7.4.3.</span> <span class="toc-text"> redis使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#连接redis服务器"><span class="toc-number">7.4.3.1.</span> <span class="toc-text"> 连接redis服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#命令参数"><span class="toc-number">7.4.3.2.</span> <span class="toc-text"> 命令参数：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用场景"><span class="toc-number">7.4.3.3.</span> <span class="toc-text"> 使用场景</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql中时间类型设置"><span class="toc-number">7.5.</span> <span class="toc-text"> MYSQL中时间类型设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ip代理池"><span class="toc-number">7.6.</span> <span class="toc-text"> IP代理池</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#代理池"><span class="toc-number">7.6.1.</span> <span class="toc-text"> 代理池</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用代理池"><span class="toc-number">7.6.2.</span> <span class="toc-text"> 使用代理池</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#获取随机代理"><span class="toc-number">7.6.2.1.</span> <span class="toc-text"> 获取随机代理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#添加代理装饰器"><span class="toc-number">7.7.</span> <span class="toc-text"> 添加代理装饰器</span></a></li></ol></li></ol></div><!-- top--><i class="fa fa-arrow-up close" id="go-up" aria-hidden="true"></i></body></html>
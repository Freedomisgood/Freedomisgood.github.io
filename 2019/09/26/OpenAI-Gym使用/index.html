<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><meta name="author" content="Mrli"><meta name="renderer" content="webkit"><meta name="copyright" content="Mrli"><meta name="keywords" content="Mrli's Blog"><meta name="description" content="想和你讲，说了会心动 ，缄默会心安。"><meta name="Cache-Control" content="no-cache"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>OpenAI Gym使用、rendering画图 · Mr.li's Blog</title><link rel="stylesheet" href="/css/style.css?v=2018.7.9"><link rel="stylesheet" href="/css/animation.css?v=2018.7.9"><link rel="icon" href="/img/assets/favicon.ico"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.6"><!-- scripts--><script>(function( w ){
  "use strict";
  // rel=preload support test
  if( !w.loadCSS ){
    w.loadCSS = function(){};
  }
  // define on the loadCSS obj
  var rp = loadCSS.relpreload = {};
  // rel=preload feature support test
  // runs once and returns a function for compat purposes
  rp.support = (function(){
    var ret;
    try {
      ret = w.document.createElement( "link" ).relList.supports( "preload" );
    } catch (e) {
      ret = false;
    }
    return function(){
      return ret;
    };
  })();

  // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
  // then change that media back to its intended value on load
  rp.bindMediaToggle = function( link ){
    // remember existing media attr for ultimate state, or default to 'all'
    var finalMedia = link.media || "all";

    function enableStylesheet(){
      link.media = finalMedia;
    }

    // bind load handlers to enable media
    if( link.addEventListener ){
      link.addEventListener( "load", enableStylesheet );
    } else if( link.attachEvent ){
      link.attachEvent( "onload", enableStylesheet );
    }

    // Set rel and non-applicable media type to start an async request
    // note: timeout allows this to happen async to let rendering continue in IE
    setTimeout(function(){
      link.rel = "stylesheet";
      link.media = "only x";
    });
    // also enable media after 3 seconds,
    // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
    setTimeout( enableStylesheet, 3000 );
  };

  // loop through link elements in DOM
  rp.poly = function(){
    // double check this to prevent external calls from running
    if( rp.support() ){
      return;
    }
    var links = w.document.getElementsByTagName( "link" );
    for( var i = 0; i < links.length; i++ ){
      var link = links[ i ];
      // qualify links to those with rel=preload and as=style attrs
      if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
        // prevent rerunning on link
        link.setAttribute( "data-loadcss", true );
        // bind listeners to toggle media back
        rp.bindMediaToggle( link );
      }
    }
  };

  // if unsupported, run the polyfill
  if( !rp.support() ){
    // run once at least
    rp.poly();

    // rerun poly on an interval until onload
    var run = w.setInterval( rp.poly, 500 );
    if( w.addEventListener ){
      w.addEventListener( "load", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    } else if( w.attachEvent ){
      w.attachEvent( "onload", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    }
  }


  // commonjs
  if( typeof exports !== "undefined" ){
    exports.loadCSS = loadCSS;
  }
  else {
    w.loadCSS = loadCSS;
  }
}( typeof global !== "undefined" ? global : this ) );</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" defer></script><script src="/js/main.js?v=2018.7.9" defer></script><!-- fancybox--><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script><!-- busuanzi--><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></head><body><section class="profile-close" id="cxo-profile"><div class="profile-avatar"><i class="fa fa-caret-left"></i><img src="https://avatars1.githubusercontent.com/u/31088082?s=400&amp;u=7a99ff83916afb3f4c5312bd78a1be17fe0e34ed&amp;v=4"></div><!--.profile-saying
  i.fa.fa-comment
  .saying--><div class="cxo-profile-inner"><div class="profile-name">Mrli</div><div class="profile-signature">别装作很努力,<br>因为结局不会陪你演戏。</div><div class="contacts"><div>Contacts:</div><span><a href="http://sighttp.qq.com/msgrd?v=1&amp;uin=1063052964" target="_black">QQ</a></span><span><a href="https://www.cnblogs.com/nymrli/" target="_black">博客园</a></span></div><div class="read-progress"></div></div></section><header id="cxo-intro" style="height: 60vh;background-image: url(/img/intro/index-bg.png);"><nav id="cxo-intro-nav"><section><div class="intro-nav-title"><a href="/">Mr.li's Blog</a></div><div class="intro-nav-label-box"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div><i class="fa fa-bars intro-nav-menu"><div class="intro-nav-drop"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div></i><div class="clear"></div></section></nav><h1 class="post-title">OpenAI Gym使用、rendering画图</h1><div class="post-intros"><div class="post-intro-meta"><span class="post-intro-time"><i class="post-intro-calendar fa fa-edit"></i><span>2019/10/07</span></span><span class="busuanzi-pv" id="busuanzi_container_page_pv"><i class="post-intro-calendar fa fa-user-o"></i><span id="busuanzi_value_page_pv"></span></span><span class="post-intro-tags"><a class="intro-tag fa fa-tag" href="javascript:void(0)" date-tags="Python"> Python</a><a class="intro-tag fa fa-tag" href="javascript:void(0)" date-tags="RL"> RL</a></span></div><div class="post-intro-read"><span> Word count: <span class="post-count">5,280</span> | Reading time: <span class="post-count">23</span>min</span></div></div></header><article class="cxo-up" id="cxo-content-outer"><section id="cxo-content-inner"><article class="article-entry" id="post"><h1 id="openai-gym使用-rendering画图"><a class="markdownIt-Anchor" href="#openai-gym使用-rendering画图"></a> OpenAI Gym使用、rendering画图</h1>
<blockquote>
<p>gym开源库：包含一个测试问题集，每个问题成为环境（environment），可以用于自己的RL算法开发。这些环境有共享的接口，允许用户设计通用的算法。其包含了deep mind 使用的Atari游戏测试床。</p>
</blockquote>
<p>在强化学习中有2个基本概念，一个是环境（environment），称为外部世界，另一个为智能体agent（<strong>写的算法</strong>）。agent发送action至environment，environment返回观察和回报。</p>
<p><a href="http://gym.openai.com/docs/" target="_blank" rel="noopener">Gym官方文档</a></p>
<h2 id="hello-gym"><a class="markdownIt-Anchor" href="#hello-gym"></a> Hello gym</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gym</span><br><span class="line"><span class="comment"># 创建一个小车倒立摆模型</span></span><br><span class="line">env = gym.make(‘CartPole-v0’)</span><br><span class="line"><span class="comment"># 初始化环境</span></span><br><span class="line">env.reset()</span><br><span class="line"><span class="comment"># 刷新当前环境，并显示</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">1000</span>):</span><br><span class="line">    env.render()</span><br><span class="line">    env.step(env.action_space.sample()) <span class="comment"># take a random action</span></span><br></pre></td></tr></table></figure>
<p><img src="https://gym.openai.com/assets/docs/aeloop-138c89d44114492fd02822303e6b4b07213010bb14ca5856d2d49d6b62d88e53.svg" alt=""></p>
<p>设计理念图,一个环境的step函数返回需要的信息，有4种返回值</p>
<ul>
<li><strong>observation</strong></li>
<li><strong>reward</strong></li>
<li><strong>done</strong> :判断是否到了重新设定(<em>reset</em>)环境</li>
<li><strong>info</strong> :用于调试的诊断信息，有时也用于学习，但智能体（agent ）在正式的评价中不允许使用该信息进行学习。</li>
</ul>
<p>该进程通过调用<strong>reset()<strong>来启动，它返回一个初始</strong>observation</strong>。 所以之前代码的更恰当的方法是遵守<strong>done</strong>的标志：</p>
<h2 id="空间spaces"><a class="markdownIt-Anchor" href="#空间spaces"></a> 空间（Spaces）</h2>
<p>在上面的例子中，已经从环境的动作空间中抽取随机动作。但这些行动究竟是什么呢？ 每个环境都带有<strong>action_space</strong> 和<strong>observation_space</strong>对象。这些属性是<a href="https://github.com/openai/gym/blob/master/gym/core.py" target="_blank" rel="noopener">Space</a>类型，它们描述格式化的有效的行动和观察。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gym</span><br><span class="line">env = gym.make(<span class="string">'CartPole-v0'</span>)</span><br><span class="line"><span class="comment"># 离散空间允许固定范围的非负数，因此在这种情况下，有效的动作是0或1. </span></span><br><span class="line">print(env.action_space)</span><br><span class="line"><span class="comment">#&gt; Discrete(2)</span></span><br><span class="line">print(env.observation_space)</span><br><span class="line"><span class="comment">#&gt; Box(4,)</span></span><br></pre></td></tr></table></figure>
<p>Box空间表示一个n维box，所以有效的观察将是4个数字的数组。 也可以检查Box的范围：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(env.observation_space.high)</span><br><span class="line"><span class="comment">#&gt; array([ 2.4       ,         inf,  0.20943951,         inf])</span></span><br><span class="line">print(env.observation_space.low)</span><br><span class="line"><span class="comment">#&gt; array([-2.4       ,        -inf, -0.20943951,        -inf])</span></span><br></pre></td></tr></table></figure>
<p>这种内省可以帮助编写适用于许多不同环境的通用代码。box和discrete是最常见的空间。你可以从一个空间中取样，或者检查某物是否属于它：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gym <span class="keyword">import</span> spaces</span><br><span class="line">space = spaces.Discrete(<span class="number">8</span>) <span class="comment"># Set with 8 elements &#123;0, 1, 2, ..., 7&#125;</span></span><br><span class="line">x = space.sample()</span><br><span class="line"><span class="keyword">assert</span> space.contains(x)</span><br><span class="line"><span class="keyword">assert</span> space.n == <span class="number">8</span></span><br></pre></td></tr></table></figure>
<h2 id="envrender画图"><a class="markdownIt-Anchor" href="#envrender画图"></a> Env.render画图</h2>
<blockquote>
<p>参考<a href="https://www.jianshu.com/p/b3c4d2b95c58" target="_blank" rel="noopener">Gym 简单画图</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 首先，导入库文件（包括gym模块和gym中的渲染模块）</span></span><br><span class="line"><span class="keyword">import</span> gym</span><br><span class="line"><span class="keyword">from</span> gym.envs.classic_control <span class="keyword">import</span> rendering</span><br><span class="line"></span><br><span class="line"><span class="comment"># 我们生成一个类，该类继承 gym.Env. 同时，可以添加元数据，改变渲染环境时的参数</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span><span class="params">(gym.Env)</span>:</span></span><br><span class="line">    <span class="comment"># 如果你不想改参数，下面可以不用写</span></span><br><span class="line">    metadata = &#123;</span><br><span class="line">        <span class="string">'render.modes'</span>: [<span class="string">'human'</span>, <span class="string">'rgb_array'</span>],</span><br><span class="line">        <span class="string">'video.frames_per_second'</span>: <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment"># 我们在初始函数中定义一个 viewer ，即画板</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.viewer = rendering.Viewer(<span class="number">600</span>, <span class="number">400</span>)   <span class="comment"># 600x400 是画板的长和框</span></span><br><span class="line">	<span class="comment"># 继承Env render函数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">render</span><span class="params">(self, mode=<span class="string">'human'</span>, close=False)</span>:</span></span><br><span class="line">        <span class="comment"># 下面就可以定义你要绘画的元素了</span></span><br><span class="line">        line1 = rendering.Line((<span class="number">100</span>, <span class="number">300</span>), (<span class="number">500</span>, <span class="number">300</span>))</span><br><span class="line">        line2 = rendering.Line((<span class="number">100</span>, <span class="number">200</span>), (<span class="number">500</span>, <span class="number">200</span>))</span><br><span class="line">        <span class="comment"># 给元素添加颜色</span></span><br><span class="line">        line1.set_color(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        line2.set_color(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="comment"># 把图形元素添加到画板中</span></span><br><span class="line">        self.viewer.add_geom(line1)</span><br><span class="line">        self.viewer.add_geom(line2)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.viewer.render(return_rgb_array=mode == <span class="string">'rgb_array'</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 最后运行</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    t = Test()</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        t.render()</span><br></pre></td></tr></table></figure>
<p><strong>△.值得注意的是，画板的水平方向是 x 轴， 垂直方向是 y 轴， 且原点在左下角</strong></p>
<h3 id="画个圆"><a class="markdownIt-Anchor" href="#画个圆"></a> <strong>画个圆</strong></h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">render</span><span class="params">(self, mode=<span class="string">'human'</span>, close=False)</span>:</span></span><br><span class="line">    <span class="comment"># 画一个直径为 30 的园</span></span><br><span class="line">    circle = rendering.make_circle(<span class="number">30</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 添加一个平移操作</span></span><br><span class="line">    circle_transform = rendering.Transform(translation=(<span class="number">100</span>, <span class="number">200</span>))</span><br><span class="line">    <span class="comment"># 让圆添加平移这个属性,</span></span><br><span class="line">    circle.add_attr(circle_transform)</span><br><span class="line">    </span><br><span class="line">    self.viewer.add_geom(circle)</span><br><span class="line">    <span class="keyword">return</span> self.viewer.render(return_rgb_array=mode == <span class="string">'rgb_array'</span>)</span><br></pre></td></tr></table></figure>
<p>△注意.是圆心在平移</p>
<h2 id="ringviewr"><a class="markdownIt-Anchor" href="#ringviewr"></a> RingViewr</h2>
<blockquote>
<p>研究rings时写的render</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gym</span><br><span class="line"><span class="keyword">from</span> gym.envs.classic_control <span class="keyword">import</span> rendering</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ringViewer</span><span class="params">(rendering.Viewer)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    画板,直接继承自rendering.Viewer</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,width, height, display=None)</span>:</span></span><br><span class="line">        super(ringViewer, self).__init__(width, height, display=<span class="keyword">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pos2loc</span><span class="params">(pos=<span class="number">0</span>)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        根据位置索引确定画图坐标</span></span><br><span class="line"><span class="string">        :param pos: 位置索引0-9</span></span><br><span class="line"><span class="string">        :return: loc</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getSize</span><span class="params">(size)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        设置画圆的半径</span></span><br><span class="line"><span class="string">        :param size:[0-2]</span></span><br><span class="line"><span class="string">        :return: radius</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getColor</span><span class="params">(c=<span class="number">0</span>)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        根据颜色索引选择圆圈颜色</span></span><br><span class="line"><span class="string">        :param c:</span></span><br><span class="line"><span class="string">        :return: list</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">drawNewring</span><span class="params">(self, newring:list=None)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        画新生成的圆</span></span><br><span class="line"><span class="string">        :param newring:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(newring)):</span><br><span class="line">            <span class="keyword">if</span> newring[i] != <span class="number">0</span>:</span><br><span class="line">                ring = rendering.make_circle(radius=self.getSize(i),</span><br><span class="line">                                             res=<span class="number">50</span>,</span><br><span class="line">                                             filled=<span class="keyword">False</span>)</span><br><span class="line">                r, g, b = self.getColor(newring[i])</span><br><span class="line">                ring.set_color(r, g, b)</span><br><span class="line">                ring_transform = rendering.Transform(translation=(<span class="number">150</span>,<span class="number">30</span>))</span><br><span class="line">                ring.add_attr(ring_transform)</span><br><span class="line">                self.add_geom(ring)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_drawQG</span><span class="params">(self, qgs: list=None)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        画棋盘上各个棋格的圆圈</span></span><br><span class="line"><span class="string">        :param qgs:</span></span><br><span class="line"><span class="string">        :return: None</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">for</span> num,qg <span class="keyword">in</span> enumerate(qgs):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(qg)):</span><br><span class="line">                <span class="keyword">if</span> qg[i] != <span class="number">0</span>:</span><br><span class="line">                    ring = rendering.make_circle(radius=self.getSize(i),</span><br><span class="line">                                                 res = <span class="number">50</span>,</span><br><span class="line">                                                 filled=<span class="keyword">False</span>)</span><br><span class="line">                    r, g, b = self.getColor(qg[i])</span><br><span class="line">                    ring.set_color(r, g, b)</span><br><span class="line">                    ring_transform = rendering.Transform(translation=self.pos2loc(num))</span><br><span class="line">                    ring.add_attr(ring_transform)</span><br><span class="line">                    self.add_geom(ring)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getQG</span><span class="params">(self, qg: list=None)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        将len=27的list转换为[[],[],...]</span></span><br><span class="line"><span class="string">        :param qg: (27,1)的list</span></span><br><span class="line"><span class="string">        :return: (9,1)的list</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        qgs = []</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">                tmp = []</span><br><span class="line">                <span class="keyword">for</span> z <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">                    tmp.append(qg[<span class="number">9</span>*x+<span class="number">3</span>*y+z])</span><br><span class="line">                qgs.append(tmp)</span><br><span class="line">        self._drawQG(qgs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Testenv</span><span class="params">(gym.Env)</span>:</span></span><br><span class="line">    <span class="comment"># 如果你不想改参数，下面可以不用写</span></span><br><span class="line">    metadata = &#123;</span><br><span class="line">        <span class="string">'render.modes'</span>: [<span class="string">'human'</span>, <span class="string">'rgb_array'</span>],</span><br><span class="line">        <span class="string">'video.frames_per_second'</span>: <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.viewer = ringViewer(<span class="number">300</span>, <span class="number">400</span>)   <span class="comment"># 600x400 是画板的长和框</span></span><br><span class="line">        self.state:list = []</span><br><span class="line">        self.state:list = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setState</span><span class="params">(self, state)</span>:</span></span><br><span class="line">        self.state = state</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setNewring</span><span class="params">(self, newring=None)</span>:</span></span><br><span class="line">        self.newring = newring</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">render</span><span class="params">(self, mode=<span class="string">'human'</span>, close=False)</span>:</span></span><br><span class="line">        <span class="comment"># 由于没有找到viewer源码中删除组件的代码,于是每次在渲染前 清空上一次geoms和onetime_geoms列表 来达到消除的目的</span></span><br><span class="line">        <span class="keyword">if</span> self.state.any():</span><br><span class="line">            self.viewer.geoms.clear()</span><br><span class="line">            self.viewer.onetime_geoms.clear()</span><br><span class="line">            self.viewer.getQG(self.state)</span><br><span class="line">        <span class="keyword">if</span> self.newring:</span><br><span class="line">            self.viewer.drawNewring(self.newring)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.viewer.render(return_rgb_array=mode == <span class="string">'rgb_array'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    v = Testenv()</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        v.setState(np.random.randint(<span class="number">0</span>,<span class="number">6</span>,(<span class="number">27</span>)))</span><br><span class="line">        v.setNewring([random.randint(<span class="number">0</span>,<span class="number">5</span>) <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">3</span>)])</span><br><span class="line">        print(v.state)</span><br><span class="line">        print(v.newring)</span><br><span class="line">        v.render()</span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>△.由于没有找到viewer源码中删除组件的代码,于是每次在渲染前 清空上一次geoms和onetime_geoms列表 来达到消除的目的</p>
<p>效果图如下</p>
<p><img src="/2019/09/26/OpenAI-Gym使用/ring.jpg" alt="ring"></p>
<h2 id="深入剖析gym环境构建转"><a class="markdownIt-Anchor" href="#深入剖析gym环境构建转"></a> <a href="https://blog.csdn.net/WASEFADG/article/details/81043075" target="_blank" rel="noopener">深入剖析gym环境构建[转]</a></h2>
<blockquote>
<p>由于该博客的代码展示实在太乱,于是重新帮他排版了一下</p>
</blockquote>
<p>我们继续讲，从第1小节的尾巴开始。有三个重要的函数：</p>
<ul>
<li>env = gym.make(‘CartPole-v0’)</li>
<li>env.reset()</li>
<li>env.render()</li>
</ul>
<p>第一个函数是创建环境，我们会在第3小节具体讲如何创建自己的环境，所以这个函数暂时不讲。第二个函数env.reset()和第三个函数env.render()是每个环境文件都包含的函数。我们以cartpole为例，对这两个函数进行讲解。</p>
<p>Cartpole的环境文件在~你的gym目录<code>/gym/envs/classic_control/cartpole.py</code>.</p>
<p>该文件定义了一个CartPoleEnv的环境类，该类的成员函数有：seed(), step(),reset()和render(). 第1小节调用的就是CartPoleEnv的两个成员函数reset()和render()。下面，我们先讲讲这两个函数，再介绍step()函数</p>
<h3 id="21-reset函数详解"><a class="markdownIt-Anchor" href="#21-reset函数详解"></a> 2.1 reset()函数详解</h3>
<p>reset()为重新初始化函数。那么这个函数有什么用呢？</p>
<p>在强化学习算法中，智能体需要一次次地尝试，累积经验，然后从经验中学到好的动作。一次尝试我们称之为一条轨迹或一个episode. 每次尝试都要到达终止状态. 一次尝试结束后，智能体需要从头开始，这就需要智能体具有<strong>重新初始化</strong>的功能。函数reset()就是这个作用。</p>
<p>reset()的源代码为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_reset</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	# 利用均匀随机分布初试化环境的状态</span></span><br><span class="line">    self.state = self.np_random.uniform(low=-0.05, high=0.05, size=(4,))</span><br><span class="line">    <span class="comment"># 设置当前步数为None</span></span><br><span class="line">    self.steps_beyond_done = <span class="keyword">None</span></span><br><span class="line">    <span class="comment"># 返回环境的初始化状态</span></span><br><span class="line">    <span class="keyword">return</span> np.array(self.state)</span><br></pre></td></tr></table></figure>
<h3 id="22-render函数详解"><a class="markdownIt-Anchor" href="#22-render函数详解"></a> 2.2 render()函数详解</h3>
<p>render()函数在这里扮演<strong>图像引擎</strong>的角色。一个仿真环境必不可少的两部分是<strong>物理引擎</strong>和<strong>图像引擎</strong>。物理引擎模拟环境中物体的运动规律；图像引擎用来显示环境中的物体图像。其实，对于强化学习算法，该函数可以没有。但是，为了便于直观显示当前环境中物体的状态，图像引擎还是有必要的。另外，加入图像引擎可以方便我们调试代码。下面具体介绍gym如何利用图像引擎来创建图像。</p>
<p>我们直接看源代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gym.envs.classic_control <span class="keyword">import</span> rendering</span><br><span class="line"><span class="comment"># 这一句导入rendering模块，利用rendering模块中的画图函数进行图形的绘制</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myenv</span><span class="params">(gym.Env)</span></span></span><br><span class="line"><span class="class">    <span class="title">def</span> <span class="title">_render</span><span class="params">(self, mode=’human’, close=False)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> close:</span><br><span class="line">        	<span class="keyword">pass</span> <span class="comment">#省略，直接看关键代码部分</span></span><br><span class="line">        <span class="keyword">if</span> self.viewer <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        	<span class="comment"># 如绘制600*400的窗口函数为：</span></span><br><span class="line">            self.viewer = rendering.Viewer(screen_width, screen_height)</span><br><span class="line">        <span class="comment"># 其中screen_width=600， screen_height=400</span></span><br><span class="line">        <span class="comment"># 创建小车的代码为：</span></span><br><span class="line">            l,r,t,b = -cartwidth/<span class="number">2</span>, cartwidth/<span class="number">2</span>, cartheight/<span class="number">2</span>, -cartheight/<span class="number">2</span></span><br><span class="line">            axleoffset =cartheight/<span class="number">4.0</span></span><br><span class="line">            cart = rendering.FilledPolygon([(l,b), (l,t), (r,t), (r,b)])</span><br><span class="line">        <span class="comment"># 其中rendering.FilledPolygon为填充一个矩形。</span></span><br></pre></td></tr></table></figure>
<p>创建完cart的形状，接下来给cart添加平移属性和旋转属性。将车的位移设置到cart的平移属性中，cart就会根据系统的状态变化左右运动。具体代码解释，我已上传到github上面了，<a href="https://link.zhihu.com/?target=https%3A//github.com/gxnk/reinforcement-learning-code" target="_blank" rel="noopener">gxnk/reinforcement-learning-code</a>　。想深入了解的同学可去下载学习。</p>
<h3 id="23-step函数详解"><a class="markdownIt-Anchor" href="#23-step函数详解"></a> 2.3 step()函数详解</h3>
<p>该函数在仿真器中扮演<strong>物理引擎</strong>的角色。其输入是动作a，输出是：下一步状态，立即回报，是否终止，调试项。</p>
<p>该函数描述了智能体与环境交互的所有信息，是环境文件中最重要的函数。在该函数中，一般利用智能体的运动学模型和动力学模型计算下一步的状态和立即回报，并判断是否达到终止状态。</p>
<p>我们直接看源代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_step</span><span class="params">(self, action)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> self.action_space.contains(action), <span class="string">"%r (%s) invalid"</span>%(action, type(action))</span><br><span class="line">    state = self.state</span><br><span class="line">    x, x_dot, theta, theta_dot = state <span class="comment">#系统的当前状态</span></span><br><span class="line">    force = self.force_mag <span class="keyword">if</span> action==<span class="number">1</span> <span class="keyword">else</span> -self.force_mag <span class="comment">#输入动作，即作用到车上的力</span></span><br><span class="line">    costheta = math.cos(theta) <span class="comment">#余弦函数</span></span><br><span class="line">    sintheta = math.sin(theta) <span class="comment">#正弦函数</span></span><br><span class="line">    <span class="comment">#底下是车摆的动力学方程式，即加速度与动作之间的关系。</span></span><br><span class="line">    temp = (force + self.polemass_length * theta_dot * theta_dot * sintheta) / self.total_mass</span><br><span class="line">    thetaacc = (self.gravity * sintheta - costheta* temp) / (self.length * (<span class="number">4.0</span>/<span class="number">3.0</span> - self.masspole * costheta * costheta / self.total_mass)) <span class="comment">#摆的角加速度</span></span><br><span class="line">    xacc = temp - self.polemass_length * thetaacc * costheta / self.total_mass <span class="comment">#小车的平移加速</span></span><br><span class="line">    x = x + self.tau * x_dot</span><br><span class="line">    x_dot = x_dot + self.tau * xacc</span><br><span class="line">    theta = theta + self.tau * theta_dot</span><br><span class="line">    theta_dot = theta_dot + self.tau * thetaacc <span class="comment">#积分求下一步的状态</span></span><br><span class="line">    self.state = (x,x_dot,theta,theta_dot)</span><br></pre></td></tr></table></figure>
<p>2.4 一个简单的demo</p>
<p>下面，我给出一个最简单的demo，让大家体会一下上面三个函数如何使用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gym</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">env = gym.make(<span class="string">'CartPole-v0'</span>)   </span><br><span class="line"><span class="comment">#创造环境observation = env.reset()       </span></span><br><span class="line"><span class="comment">#初始化环境，observation为环境状态</span></span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">100</span>):    </span><br><span class="line">    action = env.action_space.sample()  </span><br><span class="line">    <span class="comment">#随机采样动作    </span></span><br><span class="line">    observation, reward, done, info = env.step(action)  </span><br><span class="line">    <span class="comment">#与环境交互，获得下一步的时刻    </span></span><br><span class="line">    <span class="keyword">if</span> done:                     </span><br><span class="line">        <span class="keyword">break</span>    </span><br><span class="line">    env.render()         </span><br><span class="line">    <span class="comment">#绘制场景    </span></span><br><span class="line">    count+=<span class="number">1</span>    </span><br><span class="line">    time.sleep(<span class="number">0.2</span>)      </span><br><span class="line">    <span class="comment">#每次等待0.2s</span></span><br><span class="line">    print(count)             </span><br><span class="line">    <span class="comment">#打印该次尝试的步数</span></span><br></pre></td></tr></table></figure>
<p>第3小节：创建自己的gym环境并利示例qlearning的方法</p>
<p>在上一小节中以cartpole为例子深入剖析了gym环境文件的重要组成。我们知道，一个gym环境最少的组成需要包括reset()函数和step()函数。当然，图像显示函数render()一般也是需要的。这一节，我会以机器人找金币为例给大家演示如何构建一个全新的gym环境，并以此环境为例，示例最经典的强化学习算法qlearning算法。在3.1节中，给出机器人找金币的问题陈述；第3.2节中，给出构建gym环境的过程；第3.3节中，利用qlearning方法实现机器人找金币的智能决策。全部代码已传到github上。</p>
<p>3.1 机器人找金币的问题陈述</p>
<p><img src="https://pic3.zhimg.com/80/v2-954718f1e5f4246a91f38386db310439_hd.jpg" alt="img"></p>
<p>图1.1 机器人找金币</p>
<p>如图1.1 为机器人在网格世界找金币的示意图。该网格世界一共有８个状态，其中状态６和状态8为死亡区域，状态７为金币区域。机器人的初始位置为网格世界中任意一个状态。机器人从初始状态出发寻找金币。机器人进行一次探索，进入死亡区域或找到金币，本次探测结束。机器人找到金币的回报为１，进入死亡区域回报为－１，机器人在区域１－５之间转换时，回报为０。我们的目标是找到一个策略使得机器人不管处在什么状态（１－５）都能找到金币。对于这个机器人找金币的游戏，我们可以利用强化学习的方法来实现。</p>
<h3 id="构建网格世界的gym环境"><a class="markdownIt-Anchor" href="#构建网格世界的gym环境"></a> 构建网格世界的gym环境</h3>
<blockquote>
<p>该例子的代码,除了本篇博客有以外,<a href="https://blog.csdn.net/extremebingo/article/details/80867486" target="_blank" rel="noopener">OpenAI Gym构建自定义强化学习环境</a>有更仔细和规范的代码贴出</p>
</blockquote>
<p>一个gym的环境文件，其主体是个类，在这里我们定义类名为：GridEnv, 其初始化为环境的基本参数，因为机器人找金币的过程是一个马尔科夫过程，我们在强化学习入门课程的第一讲已经介绍过了一个马尔科夫过程应该包括状态空间，动作空间，回报函数，状态转移概率。因此，我们在类GridEnv的初始化时便给出了相应的定义。网格世界的全部代码在<a href="https://link.zhihu.com/?target=https%3A//github.com/gxnk/reinforcement-learning-code" target="_blank" rel="noopener">gxnk/reinforcement-learning-code</a>,文件名为 grid_mdp.py. 我们看源代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 状态空间为：</span></span><br><span class="line">self.states = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]</span><br><span class="line"><span class="comment"># 动作空间为：</span></span><br><span class="line">　　self.actions = [<span class="string">'n'</span>,<span class="string">'e'</span>,<span class="string">'s'</span>,<span class="string">'w'</span>]</span><br><span class="line"><span class="comment"># 回报函数为：</span></span><br><span class="line">　　self.rewards = dict(); <span class="comment">#回报的数据结构为字典</span></span><br><span class="line">　　self.rewards[<span class="string">'1_s'</span>] = <span class="number">-1.0</span></span><br><span class="line">　　self.rewards[<span class="string">'3_s'</span>] = <span class="number">1.0</span></span><br><span class="line">	self.rewards[<span class="string">'5_s'</span>] = <span class="number">-1.0</span></span><br><span class="line"><span class="comment"># 状态转移概率为：</span></span><br><span class="line">　　self.t = dict(); <span class="comment">#状态转移的数据格式为字典</span></span><br><span class="line">　　self.t[<span class="string">'1_s'</span>] = <span class="number">6</span></span><br><span class="line">　　self.t[<span class="string">'1_e'</span>] = <span class="number">2</span></span><br><span class="line">　　self.t[<span class="string">'2_w'</span>] = <span class="number">1</span></span><br><span class="line">　　self.t[<span class="string">'2_e'</span>] = <span class="number">3</span></span><br><span class="line">　　self.t[<span class="string">'3_s'</span>] = <span class="number">7</span></span><br><span class="line">　　self.t[<span class="string">'3_w'</span>] = <span class="number">2</span></span><br><span class="line">　　self.t[<span class="string">'3_e'</span>] = <span class="number">4</span></span><br><span class="line">　　self.t[<span class="string">'4_w'</span>] = <span class="number">3</span></span><br><span class="line">　　self.t[<span class="string">'4_e'</span>] = <span class="number">5</span></span><br><span class="line">　　self.t[<span class="string">'5_s'</span>] = <span class="number">8</span></span><br><span class="line">　　self.t[<span class="string">'5_w'</span>] = <span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>有了状态空间，动作空间和状态转移概率，我们便可以写step(a)函数了。这里特别注意的是，step()函数的输入是动作，输出为：下一个时刻的动作，回报，是否终止，调试信息。尤其需要注意的是输出的顺序不要弄错了。对于调试信息，可以为空，但不能缺少，否则会报错，常用{}来代替。我们看源代码：</p>
<h4 id="step函数的建立"><a class="markdownIt-Anchor" href="#step函数的建立"></a> step函数的建立:</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_step</span><span class="params">(self, action)</span>:</span></span><br><span class="line">    <span class="comment">#系统当前状态</span></span><br><span class="line">    state = self.state</span><br><span class="line">      ＃判断系统当前状态是否为终止状态</span><br><span class="line">    <span class="keyword">if</span> state <span class="keyword">in</span> self.terminate_states:</span><br><span class="line">    	<span class="keyword">return</span> state, <span class="number">0</span>, <span class="keyword">True</span>, &#123;&#125;</span><br><span class="line">    key = <span class="string">"%d_%s"</span>%(state, action) <span class="comment">#将状态和动作组成字典的键值</span></span><br><span class="line">    <span class="comment">#状态转移</span></span><br><span class="line">    <span class="keyword">if</span> key <span class="keyword">in</span> self.t:</span><br><span class="line">    	next_state = self.t[key]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">    	next_state = state</span><br><span class="line">        self.state = next_state</span><br><span class="line">        is_terminal = <span class="keyword">False</span></span><br><span class="line">    <span class="keyword">if</span> next_state <span class="keyword">in</span> self.terminate_states:</span><br><span class="line">    	is_terminal = <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> self.rewards:</span><br><span class="line">    	r = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">    	r = self.rewards[key]</span><br><span class="line">	<span class="keyword">return</span> next_state, r,is_terminal,&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>step()函数就是这么简单。下面我们重点介绍下如何写render()函数。从图1.1机器人找金币的示意图我们可以看到，网格世界是由一些线和圆组成的。因此，我们可以调用rendering中的画图函数来绘制这些图像。</p>
<h4 id="render函数的建立"><a class="markdownIt-Anchor" href="#render函数的建立"></a> render函数的建立:</h4>
<p>整个图像是一个600*400的窗口，可用如下代码实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gym.envs.classic_control <span class="keyword">import</span> rendering</span><br><span class="line"></span><br><span class="line">self.viewer = rendering.Viewer(screen_width, screen_height)</span><br><span class="line"><span class="comment"># 创建网格世界，一共包括11条直线，事先算好每条直线的起点和终点坐标，然后绘制这些直线，代码如下：</span></span><br><span class="line"><span class="comment">#创建网格世界</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">render</span><span class="params">(self)</span>:</span></span><br><span class="line">    self.line1 = rendering.Line((<span class="number">100</span>,<span class="number">300</span>),(<span class="number">500</span>,<span class="number">300</span>))</span><br><span class="line">    self.line2 = rendering.Line((<span class="number">100</span>, <span class="number">200</span>), (<span class="number">500</span>, <span class="number">200</span>))</span><br><span class="line">    self.line3 = rendering.Line((<span class="number">100</span>, <span class="number">300</span>), (<span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line">    self.line4 = rendering.Line((<span class="number">180</span>, <span class="number">300</span>), (<span class="number">180</span>, <span class="number">100</span>))</span><br><span class="line">    self.line5 = rendering.Line((<span class="number">260</span>, <span class="number">300</span>), (<span class="number">260</span>, <span class="number">100</span>))</span><br><span class="line">    self.line6 = rendering.Line((<span class="number">340</span>, <span class="number">300</span>), (<span class="number">340</span>, <span class="number">100</span>))</span><br><span class="line">    self.line7 = rendering.Line((<span class="number">420</span>, <span class="number">300</span>), (<span class="number">420</span>, <span class="number">100</span>))</span><br><span class="line">    self.line8 = rendering.Line((<span class="number">500</span>, <span class="number">300</span>), (<span class="number">500</span>, <span class="number">100</span>))</span><br><span class="line">    self.line9 = rendering.Line((<span class="number">100</span>, <span class="number">100</span>), (<span class="number">180</span>, <span class="number">100</span>))</span><br><span class="line">    self.line10 = rendering.Line((<span class="number">260</span>, <span class="number">100</span>), (<span class="number">340</span>, <span class="number">100</span>))</span><br><span class="line">    self.line11 = rendering.Line((<span class="number">420</span>, <span class="number">100</span>), (<span class="number">500</span>, <span class="number">100</span>))</span><br><span class="line">    <span class="comment"># 接下来，创建死亡区域，我们用黑色的圆圈代表死亡区域，源代码如下：</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建第一个骷髅</span></span><br><span class="line">    self.kulo1 = rendering.make_circle(<span class="number">40</span>)</span><br><span class="line">    self.circletrans = rendering.Transform(translation=(<span class="number">140</span>,<span class="number">150</span>))</span><br><span class="line">    self.kulo1.add_attr(self.circletrans)</span><br><span class="line">    self.kulo1.set_color(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># 创建第二个骷髅</span></span><br><span class="line">    self.kulo2 = rendering.make_circle(<span class="number">40</span>)</span><br><span class="line">    self.circletrans = rendering.Transform(translation=(<span class="number">460</span>, <span class="number">150</span>))</span><br><span class="line">    self.kulo2.add_attr(self.circletrans)</span><br><span class="line">    self.kulo2.set_color(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="comment"># 创建金币区域，用金色的圆来表示：</span></span><br><span class="line">    <span class="comment"># 创建金条</span></span><br><span class="line">    self.gold = rendering.make_circle(<span class="number">40</span>)</span><br><span class="line">    self.circletrans = rendering.Transform(translation=(<span class="number">300</span>, <span class="number">150</span>))</span><br><span class="line">    self.gold.add_attr(self.circletrans)</span><br><span class="line">    self.gold.set_color(<span class="number">1</span>, <span class="number">0.9</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建机器人，我们依然用圆来表示机器人，为了跟死亡区域和金币区域不同，我们可以设置不同的颜色：</span></span><br><span class="line">    <span class="comment"># 创建机器人</span></span><br><span class="line">    self.robot= rendering.make_circle(<span class="number">30</span>)</span><br><span class="line">    self.robotrans = rendering.Transform()</span><br><span class="line">    self.robot.add_attr(self.robotrans)</span><br><span class="line">    self.robot.set_color(<span class="number">0.8</span>, <span class="number">0.6</span>, <span class="number">0.4</span>)</span><br><span class="line">    <span class="comment"># 创建完之后，给11条直线设置颜色，并将这些创建的对象添加到几何中代码如下：</span></span><br><span class="line">    self.line1.set_color(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    self.line2.set_color(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    self.line3.set_color(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    self.line4.set_color(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    self.line5.set_color(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    self.line6.set_color(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    self.line7.set_color(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    self.line8.set_color(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    self.line9.set_color(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    self.line10.set_color(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    self.line11.set_color(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="comment"># 添加组件到Viewer中</span></span><br><span class="line">    self.viewer.add_geom(self.line1)</span><br><span class="line">    self.viewer.add_geom(self.line2)</span><br><span class="line">    self.viewer.add_geom(self.line3)</span><br><span class="line">    self.viewer.add_geom(self.line4)</span><br><span class="line">    self.viewer.add_geom(self.line5)</span><br><span class="line">    self.viewer.add_geom(self.line6)</span><br><span class="line">    self.viewer.add_geom(self.line7)</span><br><span class="line">    self.viewer.add_geom(self.line8)</span><br><span class="line">    self.viewer.add_geom(self.line9)</span><br><span class="line">    self.viewer.add_geom(self.line10)</span><br><span class="line">    self.viewer.add_geom(self.line11)</span><br><span class="line">    self.viewer.add_geom(self.kulo1)</span><br><span class="line">    self.viewer.add_geom(self.kulo2)</span><br><span class="line">    self.viewer.add_geom(self.gold)</span><br><span class="line">    self.viewer.add_geom(self.robot)</span><br><span class="line">    <span class="comment"># 接下来，开始设置机器人的位置。机器人的位置根据其当前所处的状态不同，所在的位置不同。我们事先计算出每个状态处机器人位置的中心坐标，并存储到两个向量中，并在类初始化中给出：</span></span><br><span class="line">        self.x=[<span class="number">140</span>,<span class="number">220</span>,<span class="number">300</span>,<span class="number">380</span>,<span class="number">460</span>,<span class="number">140</span>,<span class="number">300</span>,<span class="number">460</span>]</span><br><span class="line">        self.y=[<span class="number">250</span>,<span class="number">250</span>,<span class="number">250</span>,<span class="number">250</span>,<span class="number">250</span>,<span class="number">150</span>,<span class="number">150</span>,<span class="number">150</span>]</span><br><span class="line">    <span class="comment"># 根据这两个向量和机器人当前的状态，我们就可以设置机器人当前的圆心坐标了即：</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.state <span class="keyword">is</span> <span class="keyword">None</span>: <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">        self.robotrans.set_translation(self.x[self.state<span class="number">-1</span>], self.y[self.state- <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 最后还需要一个返回语句：</span></span><br><span class="line">        <span class="keyword">return</span> self.viewer.render(return_rgb_array=mode == <span class="string">'rgb_array'</span>)</span><br></pre></td></tr></table></figure>
<p>以上便完成了render()函数的建立</p>
<h4 id="reset函数的建立"><a class="markdownIt-Anchor" href="#reset函数的建立"></a> reset()函数的建立：</h4>
<p>reset()函数常常用随机的方法初始化机器人的状态，即：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_reset</span><span class="params">(self)</span>:</span></span><br><span class="line">    self.state = self.states[int(random.random() * len(self.states))]</span><br><span class="line">    <span class="keyword">return</span> self.state</span><br></pre></td></tr></table></figure>
<h4 id="环境的注册"><a class="markdownIt-Anchor" href="#环境的注册"></a> 环境的注册</h4>
<p>全部的代码请去github上下载学习。下面重点讲一讲如何将建好的环境进行注册，以便通过gym的标准形式进行调用。其实环境的注册很简单，只需要３步：</p>
<p>第一步：将我们自己的环境文件（我创建的文件名为grid_mdp.py)拷贝到你的gym安装目录/gym/gym/envs/classic_control文件夹中。（拷贝在这个文件夹中因为要使用rendering模块。当然，也有其他办法。该方法不唯一）</p>
<p>第二步：打开该文件夹（第一步中的文件夹）下的__init__.py文件，在文件末尾加入语句：<code>from gym.envs.classic_control.grid_mdp import GridEnv</code></p>
<p>第三步：进入文件夹你的gym安装目录/gym/gym/envs，打开该文件夹下的__init__.py文件，添加代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">register(</span><br><span class="line">    <span class="comment"># gym.make(‘id’)时的id</span></span><br><span class="line">    id=<span class="string">'GridWorld-v0'</span>,</span><br><span class="line">    <span class="comment"># 函数路口</span></span><br><span class="line">    entry_point=<span class="string">'gym.envs.classic_control:GridEnv'</span>,</span><br><span class="line">    max_episode_steps=<span class="number">200</span>,</span><br><span class="line">    reward_threshold=<span class="number">100.0</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>第一个参数id就是你调用gym.make(‘id’)时的id,　这个id你可以随便选取，我取的，名字是GridWorld-v0</p>
<p>第二个参数就是函数路口了。</p>
<p>后面的参数原则上来说可以不必要写。</p>
<p>经过以上三步，就完成了注册。</p>
<p>下面，我们给个简单的demo来测试下我们的环境的效果吧：</p>
<p>我们依然写个终端程序：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gym</span><br><span class="line"></span><br><span class="line">env = gym.make(<span class="string">'GridWorld-v0'</span>)</span><br><span class="line">env.reset()</span><br><span class="line">env.render()</span><br></pre></td></tr></table></figure>
</article><!-- lincense--><div class="license-wrapper"><p> <span>Author:  </span><a href="https://nymrli.top">Mrli</a></p><p> <span>Link:  </span><a href="https://nymrli.top/2019/09/26/OpenAI-Gym使用/">https://nymrli.top/2019/09/26/OpenAI-Gym使用/</a></p><p> <span>Copyright:  </span><span>All articles in this blog are licensed under <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/3.0">CC BY-NC-SA 3.0</a> unless stating additionally.</span></p></div><div class="post-paginator"><a class="prevSlogan" href="/2019/09/27/Python-random/" title="Python random"><span>< PreviousPost</span><br><span class="prevTitle">Python random</span></a><a class="nextSlogan" href="/2019/09/23/Ubuntu16-04-CUDA-toolkit10-1-cudNN7-6-bazel0-26-1/" title="Ubuntu16.04+CUDA toolkit10.1+cudNN7.6+bazel0.26.1"><span>NextPost ></span><br><span class="nextTitle">Ubuntu16.04+CUDA toolkit10.1+cudNN7.6+bazel0.26.1</span></a><div class="clear"></div></div><div id="comment"><div id="container"></div><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script><script>var gitment = new Gitment({
  id: 'OpenAI Gym使用、rendering画图',
  owner: 'Freedomisgood',
  repo: 'Freedomisgood.github.io',
  oauth: {
    client_id: 'bc5a81fe36017dcd8b63',
    client_secret: '949cec3a1b91742c6249c47259791e4b80a6fa69',
  },
})
gitment.render('container')</script></div></section></article><footer id="cxo-footer-outer"><div id="cxo-footer-inner"><p class="footer-container"><span>Site by </span><a href="http://hexo.io"><span>Hexo</span></a><span> | theme </span><a href="https://github.com/Longlongyu/hexo-theme-Cxo"><span>Cxo</span></a></p><p class="beian"><a href="https://beian.miit.gov.cn/"> <span>备案号:苏ICP备18015439号</span></a></p><i class="fa fa-user"> </i><span id="busuanzi_value_site_uv"></span><span> | </span><i class="fa fa-eye"> </i><span id="busuanzi_value_site_pv"></span></div></footer><!-- catelog--><div class="toc-wrapper" style="top: 60vh;"><div class="toc-catalog"><i class="fa fa-list"> </i><span>CATALOG</span></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#openai-gym使用-rendering画图"><span class="toc-number">1.</span> <span class="toc-text"> OpenAI Gym使用、rendering画图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#hello-gym"><span class="toc-number">1.1.</span> <span class="toc-text"> Hello gym</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#空间spaces"><span class="toc-number">1.2.</span> <span class="toc-text"> 空间（Spaces）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#envrender画图"><span class="toc-number">1.3.</span> <span class="toc-text"> Env.render画图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#画个圆"><span class="toc-number">1.3.1.</span> <span class="toc-text"> 画个圆</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ringviewr"><span class="toc-number">1.4.</span> <span class="toc-text"> RingViewr</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#深入剖析gym环境构建转"><span class="toc-number">1.5.</span> <span class="toc-text"> 深入剖析gym环境构建[转]</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-reset函数详解"><span class="toc-number">1.5.1.</span> <span class="toc-text"> 2.1 reset()函数详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-render函数详解"><span class="toc-number">1.5.2.</span> <span class="toc-text"> 2.2 render()函数详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-step函数详解"><span class="toc-number">1.5.3.</span> <span class="toc-text"> 2.3 step()函数详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#构建网格世界的gym环境"><span class="toc-number">1.5.4.</span> <span class="toc-text"> 构建网格世界的gym环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#step函数的建立"><span class="toc-number">1.5.4.1.</span> <span class="toc-text"> step函数的建立:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#render函数的建立"><span class="toc-number">1.5.4.2.</span> <span class="toc-text"> render函数的建立:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reset函数的建立"><span class="toc-number">1.5.4.3.</span> <span class="toc-text"> reset()函数的建立：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#环境的注册"><span class="toc-number">1.5.4.4.</span> <span class="toc-text"> 环境的注册</span></a></li></ol></li></ol></li></ol></li></ol></div><!-- top--><i class="fa fa-arrow-up close" id="go-up" aria-hidden="true"></i></body></html>